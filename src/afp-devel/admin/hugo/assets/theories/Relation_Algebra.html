<div id="More_Boolean_Algebra">
<div class="head">
<h1>Theory More_Boolean_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹(More) Boolean Algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> More_Boolean_Algebra
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Laws of Boolean Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following laws of Boolean algebra support relational proofs. We
might add laws for the binary minus since that would make certain theorems look
more nicely. These are currently not so well supported.›</span></span>

<span class="keyword1"><span class="command">context</span></span> boolean_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  times <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> Groups.zero_class.zero <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> Groups.one_class.one <span class="main">(</span><span class="quoted">"<span class="keyword1">1</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span>
  inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">(</span><span class="quoted">"<span class="keyword1">0</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">(</span><span class="quoted">"<span class="keyword1">1</span>"</span><span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-meet_assoc"><span class="command">lemma</span></span> meet_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_assoc<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-aux4"><span class="command">lemma</span></span> aux4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 inf_top_right sup_compl_top<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-aux4_comm"><span class="command">lemma</span></span> aux4_comm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 sup.commute<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-aux6"><span class="command">lemma</span></span> aux6 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_compl_bot inf_sup_distrib2 sup_bot_left<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-aux6_var"><span class="command">lemma</span></span> aux6_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf_bot inf_commute inf_sup_distrib2 sup_bot_left<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-aux9"><span class="command">lemma</span></span> aux9 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 aux6 inf.commute inf_sup_absorb<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-join_iso"><span class="command">lemma</span></span> join_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl sup_mono<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-join_isol"><span class="command">lemma</span></span> join_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_iso sup.commute<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-join_double_iso"><span class="command">lemma</span></span> join_double_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf sup_inf_distrib1 sup_inf_distrib2<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-comp_anti"><span class="command">lemma</span></span> comp_anti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_le_swap2 double_compl<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-meet_iso"><span class="command">lemma</span></span> meet_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl inf_mono<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-meet_isor"><span class="command">lemma</span></span> meet_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute meet_iso<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-meet_double_iso"><span class="command">lemma</span></span> meet_double_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> meet_iso meet_isor<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-de_morgan_3"><span class="command">lemma</span></span> de_morgan_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup double_compl<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-subdist_2_var"><span class="command">lemma</span></span> subdist_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl inf_le1 sup_mono<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-dist_alt"><span class="command">lemma</span></span> dist_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 aux6 sup.commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we prove the Galois connections for complementation.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-galois_aux"><span class="command">lemma</span></span> galois_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux6 compl_sup double_compl inf.commute le_iff_inf sup_bot_right sup_compl_top<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-galois_aux2"><span class="command">lemma</span></span> galois_aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl galois_aux<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-galois_1"><span class="command">lemma</span></span> galois_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 join_iso le_iff_sup le_supE join_isol aux4<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> meet_iso aux6 le_infE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="More_Boolean_Algebra-galois_2"><span class="command">lemma</span></span> galois_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">+</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup double_compl galois_1 inf.commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute order_trans subdist_2_var aux4 join_iso<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="More_Boolean_Algebra-galois_aux3"><span class="command">lemma</span></span> galois_aux3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_1 inf_top_left top_unique<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-galois_aux4"><span class="command">lemma</span></span> galois_aux4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl galois_aux3<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boolean Algebras with Operators›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We follow J\'onsson and Tarski to define pairs of conjugate functions
on Boolean algebras. We also consider material from Maddux's article. This
gives rise to a Galois connection and the notion of Boolean algebras with
operators.

We do not explicitly define families of functions over Boolean algebras as a
type class.

This development should certainly be expanded do deal with complete Boolean
algebras one the one hand and other lattices on the other hand.

Boolean algebras with operators and their variants can be applied in various
ways. The prime example are relation algebras. The modular laws, for instance,
can be derived by instantiation. Other applications are antidomain semirings
where modal operators satisfy conjugations and Galois connections, and algebras
of predicate transformers.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define conjugation as a predicate which holds if a pair of functions
are conjugates.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_conjugation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_conjugation</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove the standard lemmas. First we show that conjugation is
symmetric and that conjugates are uniqely defined.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-is_conjugation_sym"><span class="command">lemma</span></span> is_conjugation_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> is_conjugation <span class="free">g</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute is_conjugation_def<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-is_conjugation_unique"><span class="command">lemma</span></span> is_conjugation_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_conjugation <span class="free">f</span> <span class="free">g</span><span class="main">;</span> is_conjugation <span class="free">f</span> <span class="free">h</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux inf.commute double_compl order.eq_iff ext is_conjugation_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that conjugates give rise to adjoints in a Galois
connection.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-conj_galois_1"><span class="command">lemma</span></span> conj_galois_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_def double_compl galois_aux<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-conj_galois_2"><span class="command">lemma</span></span> conj_galois_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym conj_galois_1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we prove some of the standard properties of adjoints and
conjugates. In fact, conjugate functions even distribute over all existing
suprema. We display the next proof in detail because it is elegant.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-f_pre_additive"><span class="command">lemma</span></span> f_pre_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conj_galois_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_sup_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conj_galois_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_sup_iff calculation<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Boolean_Algebra-f_additive"><span class="command">lemma</span></span> f_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>sup <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms order.eq_iff f_pre_additive<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-g_pre_additive"><span class="command">lemma</span></span> g_pre_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>sup <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> sup <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym f_pre_additive<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-g_additive"><span class="command">lemma</span></span> g_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>sup <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym f_additive<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Additivity of adjoints obviously implies their isotonicity.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-f_iso"><span class="command">lemma</span></span> f_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms f_additive le_iff_sup<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-g_iso"><span class="command">lemma</span></span> g_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">g</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym f_iso<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-f_subdist"><span class="command">lemma</span></span> f_subdist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms f_iso inf_le1<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-g_subdist"><span class="command">lemma</span></span> g_subdist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms g_iso inf_le1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove cancellation and strictness laws.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-cancellation_1"><span class="command">lemma</span></span> cancellation_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conj_galois_1 double_compl eq_refl<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-cancellation_2"><span class="command">lemma</span></span> cancellation_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym cancellation_1<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-f_strict"><span class="command">lemma</span></span> f_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf.idem inf_bot_left is_conjugation_def<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-g_strict"><span class="command">lemma</span></span> g_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym f_strict<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following variants of modular laws have more concrete counterparts
in relation algebra.›</span></span>

<span class="keyword1" id="More_Boolean_Algebra-modular_1_aux"><span class="command">lemma</span></span> modular_1_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms galois_aux inf_le2 is_conjugation_def<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-modular_2_aux"><span class="command">lemma</span></span> modular_2_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym modular_1_aux<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-modular_1"><span class="command">lemma</span></span> modular_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="free">y</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms f_additive<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms modular_1_aux sup_bot_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Boolean_Algebra-modular_2"><span class="command">lemma</span></span> modular_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_conjugation_sym modular_1<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-conjugate_eq_aux"><span class="command">lemma</span></span> conjugate_eq_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_subdist galois_aux le_inf_iff modular_1_aux<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-conjugate_eq"><span class="command">lemma</span></span> conjugate_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="main">-</span><span class="bound">y</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span><span class="bound">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_conjugation_sym conjugate_eq_aux<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 inf.left_commute inf_absorb1 inf_compl_bot inf_left_idem sup_bot_left r<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 inf.commute inf.left_commute inf_absorb1 inf_compl_bot sup_commute sup_inf_absorb r<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_conjugation_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_Boolean_Algebra-conjugation_prop1"><span class="command">lemma</span></span> conjugation_prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">g</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_infE modular_1 order_refl<span class="main">)</span>

<span class="keyword1" id="More_Boolean_Algebra-conjugation_prop2"><span class="command">lemma</span></span> conjugation_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_conjugation_sym conjugation_prop1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* boolean_algebra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra">
<div class="head">
<h1>Theory Relation_Algebra</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relation Algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#More_Boolean_Algebra">More_Boolean_Algebra</a> <a href="../../kleene_algebra/theories/#Kleene_Algebra">Kleene_Algebra.Kleene_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We follow Tarski's original article and Maddux's book, in particular we
use their notation. In contrast to Schmidt and Str\"ohlein we do not assume
that the Boolean algebra is complete and we do not consider the Tarski rule in
this development.

A main reason for using complete Boolean algebras seems to be that the
Knaster-Tarski fixpoint theorem becomes available for defining notions of
iteration. In fact, several chapters of Schmidt and Str\"ohlein's book deal
with iteration.

We capture iteration in an alternative way by linking relation algebras with
Kleene algebras (cf.~\emph{relation-algebra-rtc}).›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra <span class="main">=</span> boolean_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">composition</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span>"</span> 75<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">converse</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇧</span><sup>⌣</sup></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">unit</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">1''</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comp_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">;</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp_unitr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="main"><span class="free">1'</span></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main"><span class="free">;</span></span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conv_invol <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conv_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main">+</span> <span class="free">y</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> conv_contrav <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main"><span class="free">;</span></span> <span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comp_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⌣</sup></span></span> <span class="main"><span class="free">;</span></span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">;</span></span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first show that every relation algebra is a dioid. We do not yet
treat the zero (the minimal element of the boolean reduct) since the proof of
the annihilation laws is rather tricky to automate. Following Maddux we derive
them from properties of Boolean algebras with operators.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> relation_algebra <span class="main">⊆</span> dioid_one <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">;</span> <span class="skolem">y</span> <span class="main">;</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">;</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">;</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> comp_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.commute sup.left_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">;</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">;</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">;</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> comp_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sup.idem<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">;</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">;</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">;</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_add conv_contrav comp_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">;</span> <span class="main">1'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> comp_unitr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_unitr conv_contrav conv_invol<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.commute sup_absorb1 sup_ge1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> less_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we prove some basic facts about joins and meets.›</span></span>

<span class="keyword1" id="Relation_Algebra-meet_interchange"><span class="command">lemma</span></span> meet_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 inf_le2 le_infI mult_isol_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-join_interchange"><span class="command">lemma</span></span> join_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">;</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> local.mult_isol_var local.sup.bounded_iff local.sup.cobounded2 local.sup_ge1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove some simple facts about conversion.›</span></span>

<span class="keyword1" id="Relation_Algebra-conv_iso"><span class="command">lemma</span></span> conv_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add conv_invol le_iff_sup<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_zero"><span class="command">lemma</span></span> conv_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add conv_invol sup_bot_right sup_eq_bot_iff<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_one"><span class="command">lemma</span></span> conv_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_add conv_invol sup_top_left sup_top_right<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_compl_aux"><span class="command">lemma</span></span> conv_compl_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux9 conv_add conv_one double_compl galois_aux4 inf.commute less_eq_def sup.commute sup_top_left<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_compl"><span class="command">lemma</span></span> conv_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute conv_add conv_compl_aux conv_invol<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-comp_res_aux"><span class="command">lemma</span></span> comp_res_aux <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_res galois_aux<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_e"><span class="command">lemma</span></span> conv_e <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1'</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_unitr conv_contrav conv_invol<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_times"><span class="command">lemma</span></span> conv_times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf double_compl conv_add conv_compl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemmas show that conversion is self-conjugate in the sense of
Boolean algebra with operators.›</span></span>

<span class="keyword1" id="Relation_Algebra-conv_self_conjugate"><span class="command">lemma</span></span> conv_self_conjugate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_times conv_zero<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_self_conjugate_var"><span class="command">lemma</span></span> conv_self_conjugate_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation converse converse"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_self_conjugate is_conjugation_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas link the relative product and meet.›</span></span>

<span class="keyword1" id="Relation_Algebra-one_idem_mult"><span class="command">lemma</span></span> one_idem_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_eq_compl_iff galois_aux2 inf.commute inf_top_right mult_1_left mult_isor top_greatest<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-mult_subdistl"><span class="command">lemma</span></span> mult_subdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 mult_isol<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-mult_subdistr"><span class="command">lemma</span></span> mult_subdistr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 mult_isor<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-mult_subdistr_var"><span class="command">lemma</span></span> mult_subdistr_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute le_inf_iff mult_subdistr<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas deal with variants of the Peirce law, the
Schr\"oder laws and the Dedekind law. Some of them are obtained from Boolean
algebras with operators by instantiation, using conjugation properties.
However, Isabelle does not always pick up this relationship.›</span></span>

<span class="keyword1" id="Relation_Algebra-peirce_1"><span class="command">lemma</span></span> peirce_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_le_swap1 conv_contrav conv_self_conjugate galois_aux comp_res conv_invol galois_aux mult_isol order_trans<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-peirce"><span class="command">lemma</span></span> peirce<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> peirce_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-schroeder_1"><span class="command">lemma</span></span> schroeder_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol peirce conv_contrav conv_invol conv_self_conjugate inf.commute<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-schroeder_2"><span class="command">lemma</span></span> schroeder_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol peirce schroeder_1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two conjugation properties between multiplication with
elements and their converses are used for deriving modular laws of relation
algebra from those of Boolean algebras with operators.›</span></span>

<span class="keyword1" id="Relation_Algebra-schroeder_1_var"><span class="command">lemma</span></span> schroeder_1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation <span class="main">(</span>composition <span class="free">x</span><span class="main">)</span> <span class="main">(</span>composition <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> schroeder_1 is_conjugation_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-schroeder_2_var"><span class="command">lemma</span></span> schroeder_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_conjugation <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_conjugation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> schroeder_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following Galois connections define residuals. They link relation
algebras with action algebras. This could be further explored and formalised.
›</span></span>

<span class="keyword1" id="Relation_Algebra-conv_galois_1"><span class="command">lemma</span></span> conv_galois_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux galois_aux2 schroeder_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-conv_galois_2"><span class="command">lemma</span></span> conv_galois_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux galois_aux2 schroeder_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Variants of the modular law for relation algebras can now be
instantiated from Boolean algebras with operators.›</span></span>

<span class="keyword1" id="Relation_Algebra-modular_1_aux'"><span class="command">lemma</span></span> modular_1_aux'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> schroeder_1_var modular_1_aux<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_2_aux'"><span class="command">lemma</span></span> modular_2_aux'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> modular_1_aux schroeder_2_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_1'"><span class="command">lemma</span></span> modular_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> schroeder_1_var modular_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_2'"><span class="command">lemma</span></span> modular_2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 distrib_right inf.commute inf_sup_distrib1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_bot_right modular_2_aux'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra-modular_1_var"><span class="command">lemma</span></span> modular_1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_le2 modular_1'<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_2_var"><span class="command">lemma</span></span> modular_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_le2 modular_2'<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_var_2"><span class="command">lemma</span></span> modular_var_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right modular_1_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-modular_var_3"><span class="command">lemma</span></span> modular_var_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right modular_2_var<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The modular laws are used to prove the Dedekind rule.›</span></span>

<span class="keyword1" id="Relation_Algebra-dedekind"><span class="command">lemma</span></span> dedekind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> modular_2' modular_1_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_iso inf_le1 inf_mono mult_isol mult_isor order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra-dedekind_var_1"><span class="command">lemma</span></span> dedekind_var_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind inf.commute inf_top_left<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Schr\"oder laws allow us, finally, to prove the annihilation laws
for zero. We formalise this by proving that relation algebras form dioids with
zero.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> relation_algebra <span class="main">&lt;</span> dioid_one_zero <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1'</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> sup_bot_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_strict schroeder_2_var<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">;</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_strict schroeder_1_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove miscellaneous properties which we found in the books of
Maddux and Schmidt and Str\"ohlein. Most of them do not carry any meaningful
names.›</span></span>

<span class="keyword1" id="Relation_Algebra-ra_1"><span class="command">lemma</span></span> ra_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> modular_2_var comp_assoc order_trans eq_refl inf_mono inf_top_left mult_isor mult_subdistl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_greatest inf_top_left mult.assoc mult_subdistl mult_subdistr order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra-ra_2"><span class="command">lemma</span></span> ra_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_invol conv_one conv_times inf.idem inf.left_commute le_iff_inf meet_assoc mult_isor ra_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> modular_var_3 mult_subdistl order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_times eq_refl inf_le2 inf_mono mult.assoc mult_isol mult_isor one_idem_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> modular_var_2 mult_subdistr order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra-one_conv"><span class="command">lemma</span></span> one_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_top_left modular_1' mult.right_neutral<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-maddux_12"><span class="command">lemma</span></span> maddux_12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="free">x</span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux inf.commute inf_compl_bot schroeder_2<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-maddux_141"><span class="command">lemma</span></span> maddux_141<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute schroeder_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-maddux_142"><span class="command">lemma</span></span> maddux_142<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute schroeder_1 schroeder_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> maddux_16 <span class="main">=</span> modular_1_var

<span class="keyword1"><span class="command">lemmas</span></span> maddux_17 <span class="main">=</span> modular_2_var

<span class="keyword1" id="Relation_Algebra-maddux_20"><span class="command">lemma</span></span> maddux_20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_left mult.right_neutral mult_subdistl<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-maddux_21"><span class="command">lemma</span></span> maddux_21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor mult_onel top_greatest<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-maddux_23"><span class="command">lemma</span></span> maddux_23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.aux6 local.aux6_var local.aux9 local.compl_inf_bot local.compl_sup_top local.compl_unique local.distrib_left local.galois_2 local.sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> local.meet_iso local.mult_subdistl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relation_Algebra-maddux_24"><span class="command">lemma</span></span> maddux_24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> de_morgan_3 double_compl maddux_23<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-one_compl"><span class="command">lemma</span></span> one_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym conv_one maddux_12 mult.assoc one_idem_mult maddux_20<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra-ss_p18"><span class="command">lemma</span></span> ss_p18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil le_bot maddux_20<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This finishes our development of the basic laws of relation algebras.
The next sections are devoted to special elements such as vectors, test or
subidentities, and, in particular, functions.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra_Vectors">
<div class="head">
<h1>Theory Relation_Algebra_Vectors</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vectors›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_Vectors
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra">Relation_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Vectors can be used for modelling sets of states. In this section we
follow Maddux's book to derive some of their most important properties.›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_vector</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_vector</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="main">1</span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_compl"><span class="command">lemma</span></span> vector_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> is_vector <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_compl is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_add"><span class="command">lemma</span></span> vector_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_vector <span class="free">x</span><span class="main">;</span> is_vector <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_vector <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_distr is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_mult"><span class="command">lemma</span></span> vector_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_vector <span class="free">x</span><span class="main">;</span> is_vector <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_vector <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ra_1 is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_comp"><span class="command">lemma</span></span> vector_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_vector <span class="free">x</span><span class="main">;</span> is_vector <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_vector <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_1"><span class="command">lemma</span></span> vector_1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute ra_1 is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_1_comm"><span class="command">lemma</span></span> vector_1_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ra_1 is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_2"><span class="command">lemma</span></span> vector_2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute ra_2 is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_2_var"><span class="command">lemma</span></span> vector_2_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.left_idem vector_2<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_idem"><span class="command">lemma</span></span> vector_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_absorb2 inf_top_left maddux_21 vector_1_comm<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_rectangle"><span class="command">lemma</span></span> vector_rectangle <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vector_idem is_vector_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Vectors-vector_3"><span class="command">lemma</span></span> vector_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_vector <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute mult.left_neutral vector_1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra_Tests">
<div class="head">
<h1>Theory Relation_Algebra_Tests</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_Tests
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra">Relation_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Tests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Tests or subidentities provide another way of modelling sets. Once more
we prove the basic properties, most of which stem from Maddux's book.›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_test</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-test_conv"><span class="command">lemma</span></span> test_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> is_test <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_e conv_iso is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_conv_var"><span class="command">lemma</span></span> test_conv_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> test_conv is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_eq_conv"><span class="command">lemma</span></span> test_eq_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_absorb2 inf_le2 modular_1' mult.right_neutral is_test_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_unitr conv_contrav conv_invol order.eq_iff hyp inf_absorb2 mult_subdistl test_conv_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_times le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-test_sum"><span class="command">lemma</span></span> test_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_test <span class="free">x</span><span class="main">;</span> is_test <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_test <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_prod"><span class="command">lemma</span></span> test_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_test <span class="free">x</span><span class="main">;</span> is_test <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_test <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_infI2 is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_comp"><span class="command">lemma</span></span> test_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_test <span class="free">x</span><span class="main">;</span> is_test <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> is_test <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol comp_unitr order_trans is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_comp_eq_mult"><span class="command">lemma</span></span> test_comp_eq_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_unitr inf_absorb2 le_inf_iff mult_onel mult_subdistl mult_subdistr is_test_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_unitr modular_1_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_absorb2 le_infI2 mult.left_neutral mult_isol mult_subdistr order_trans test_eq_conv is_test_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-test_1"><span class="command">lemma</span></span> test_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf.idem inf_absorb2 mult.left_neutral one_conv ra_1 test_comp_eq_mult test_eq_conv is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-maddux_32"><span class="command">lemma</span></span> maddux_32 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_20 comp_anti inf.commute meet_isor<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_16 inf_top_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_le1 le_infE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one inf.commute le_infE meet_iso one_conv <span class="quoted"><span class="quoted">‹is_test <span class="free">x</span>›</span></span> order.eq_iff test_1 test_eq_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> two galois_aux2 le_iff_inf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">1'</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl galois_aux2 inf.commute inf_le1 le_inf_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-test_distr_1"><span class="command">lemma</span></span> test_distr_1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_left meet_iso mult_subdistl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.assoc test_1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms test_comp_eq_mult<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_subdistr_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-maddux_35"><span class="command">lemma</span></span> maddux_35<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_test <span class="free">x</span>›</span></span> comp_anti mult_isor mult_onel is_test_def inf.commute inf_le2 le_infI le_infI1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff le_infE maddux_23<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span>  <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_1 le_iff_sup distrib_left sup_compl_top sup_top_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_test <span class="free">x</span>›</span></span> mult_isor mult_onel is_test_def order_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_inf_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Complements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Text complements are complements of elements that are ``pushed below''
the multiplicative unit.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_1"><span class="command">lemma</span></span> test_compl_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> tc <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_test_def local.aux4 local.inf.absorb_iff1 local.inf_commute tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_2"><span class="command">lemma</span></span> test_compl_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> tc <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux inf.commute inf_le2 tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_test_compl"><span class="command">lemma</span></span> test_test_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> is_test <span class="main">(</span>tc <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_test_def tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_de_morgan_1"><span class="command">lemma</span></span> test_compl_de_morgan_1<span class="main">:</span> <span class="quoted"><span class="quoted">"tc <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> tc <span class="free">x</span> <span class="main">⋅</span> tc <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup inf.left_commute inf.left_idem meet_assoc tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_de_morgan_2"><span class="command">lemma</span></span> test_compl_de_morgan_2<span class="main">:</span> <span class="quoted"><span class="quoted">"tc <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> tc <span class="free">x</span> <span class="main">+</span> tc <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf inf_sup_distrib1 tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_three"><span class="command">lemma</span></span> test_compl_three <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tc <span class="main">(</span>tc <span class="main">(</span>tc <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> tc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux4 aux6 de_morgan_3 inf.commute inf_sup_absorb tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Tests-test_compl_double"><span class="command">lemma</span></span> test_compl_double <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> tc <span class="main">(</span>tc <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux6_var compl_inf double_compl inf.commute le_iff_inf tc_def is_test_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra_Functions">
<div class="head">
<h1>Theory Relation_Algebra_Functions</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_Functions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra_Vectors">Relation_Algebra_Vectors</a> <a href="#Relation_Algebra_Tests">Relation_Algebra_Tests</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section collects the most important properties of functions. Most
of them can be found in the books by Maddux and by Schmidt and Str\"ohlein. The
main material is on partial and total functions, injections, surjections,
bijections.›</span></span>

<span class="comment1">(* Perhaps this material should be reorganised so that related theorems are
grouped together ... *)</span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_p_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_p_fun</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_total</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_total</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_map</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_total <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_inj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_inj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_sur</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sur</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">1'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We distinguish between partial and total bijections. As usual we call
the latter just bijections.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_p_bij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_p_bij</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_p_fun <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_sur <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_bij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_bij</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_map <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_sur <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Our first set of lemmas relates the various concepts.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_p_fun"><span class="command">lemma</span></span> inj_p_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span> <span class="main">⟷</span> is_p_fun <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol is_inj_def is_p_fun_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_inj"><span class="command">lemma</span></span> p_fun_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟷</span> is_inj <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol inj_p_fun<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_total"><span class="command">lemma</span></span> sur_total<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span> <span class="main">⟷</span> is_total <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol is_sur_def is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_sur"><span class="command">lemma</span></span> total_sur<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟷</span> is_sur <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol sur_total<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_conv"><span class="command">lemma</span></span> bij_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span>  <span class="main">⟷</span> is_bij <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_bij_def inj_p_fun is_map_def p_fun_inj sur_total total_sur<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that tests are partial injections.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-test_is_inj_fun"><span class="command">lemma</span></span> test_is_inj_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>is_p_fun <span class="free">x</span> <span class="main">∧</span> is_inj <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_inj_def p_fun_inj test_comp test_eq_conv is_test_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show composition properties.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_comp"><span class="command">lemma</span></span> p_fun_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_p_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_p_fun_def mult_double_iso mult.right_neutral mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order_trans is_p_fun_def mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_mult_var"><span class="command">lemma</span></span> p_fun_mult_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_times inf_le1 mult_isol_var order_trans<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_compose"><span class="command">lemma</span></span> inj_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav inj_p_fun p_fun_comp<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_mult_var"><span class="command">lemma</span></span> inj_mult_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_fun_mult_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_comp"><span class="command">lemma</span></span> total_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_total <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_top_left le_iff_inf mult.assoc mult.right_neutral one_conv ra_2 is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_add_var"><span class="command">lemma</span></span> total_add_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span>  <span class="main">⟹</span> <span class="main">1'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_add local.inf.absorb2 local.inf.coboundedI1 local.join_interchange local.le_sup_iff<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_comp"><span class="command">lemma</span></span> sur_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav sur_total total_comp<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_sum_var"><span class="command">lemma</span></span> sur_sum_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">1'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> total_add_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-map_comp"><span class="command">lemma</span></span> map_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_map <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_map_def p_fun_comp total_comp<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_comp"><span class="command">lemma</span></span> bij_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_bij_def inj_compose map_comp sur_comp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that (partial) functions, unlike relations, distribute over
meets from the left.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_distl"><span class="command">lemma</span></span> p_fun_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_p_fun_def inf_le1 le_infI le_infI2 mult_isol mult_isor mult_onel<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute mult.assoc order_trans modular_1_var<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff inf.commute le_infI mult_subdistl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-map_distl"><span class="command">lemma</span></span> map_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_map_def p_fun_distl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove simple properties of functions which arise in equivalent
definitions of those concepts.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_zero"><span class="command">lemma</span></span> p_fun_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir inf_compl_bot p_fun_distl<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_one"><span class="command">lemma</span></span> total_one<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_one inf_top_left le_iff_inf mult.right_neutral one_conv ra_2 is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_1"><span class="command">lemma</span></span> total_1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_invol conv_zero inf_bot_left inf_top_left peirce total_one<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-surj_one"><span class="command">lemma</span></span> surj_one<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_invol conv_one sur_total total_one<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-surj_1"><span class="command">lemma</span></span> surj_1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">;</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_res_aux compl_bot_eq conv_contrav conv_one inf.commute inf_top_right surj_one<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_is_maprop"><span class="command">lemma</span></span> bij_is_maprop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span>  <span class="main">=</span> <span class="main">1'</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms is_bij_def order.eq_iff is_inj_def is_map_def is_p_fun_def is_sur_def is_total_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We now provide alternative definitions for functions. These can be found
in Schmidt and Str\"ohlein's book.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_def_var"><span class="command">lemma</span></span> p_fun_def_var<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_galois_1 double_compl galois_aux inf.commute is_p_fun_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_def_var_1"><span class="command">lemma</span></span> total_def_var_1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_right le_iff_inf one_conv total_one is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_def_var_2"><span class="command">lemma</span></span> total_def_var_2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> total_def_var_1 distrib_left sup_compl_top mult.right_neutral galois_aux3<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_def_var1"><span class="command">lemma</span></span> sur_def_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_contrav conv_one sur_total surj_one total_def_var_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_def_var2"><span class="command">lemma</span></span> sur_def_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sur_total total_def_var_2 conv_compl conv_contrav conv_e conv_iso<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_def_var1"><span class="command">lemma</span></span> inj_def_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_galois_2 double_compl galois_aux inf.commute is_inj_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-is_maprop"><span class="command">lemma</span></span> is_maprop<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff is_map_def p_fun_def_var total_def_var_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we prove miscellaneous properties of functions.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-ss_422iii"><span class="command">lemma</span></span> ss_422iii<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="comment1">(* by (smt antisym comp_assoc inf_commute maddux_17 meet_iso mult_isol mult_oner mult_subdistr_var order_trans is_p_fun_def) *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_17<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">z</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_subdistr_var mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_p_fun <span class="free">y</span>›</span></span> inf_absorb2 inf_le1 le_infI le_infI2 mult_subdistl is_p_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_compl"><span class="command">lemma</span></span> p_fun_compl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span><span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annir galois_aux inf.commute inf_compl_bot p_fun_distl<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-ss_422v"><span class="command">lemma</span></span> ss_422v<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_absorb2 inf_top_left maddux_23 p_fun_compl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next property is a Galois connection.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-ss43iii"><span class="command">lemma</span></span> ss43iii<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="bound">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">metis</span> inf_top_left is_map_def ss_422v total_one<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_maprop mult.right_neutral<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove a lemma from Schmidt and Str\"ohlein's book and some of
its consequences. We show the proof in detail since the textbook proof uses
Tarski's rule which we omit.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-ss423"><span class="command">lemma</span></span> ss423<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_map_def mult_1_right mult.assoc mult_isol is_total_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>›</span></span> mult_isor order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="main">1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹is_map <span class="free">x</span>›</span></span> is_map_def mult.assoc mult_isol is_p_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-ss424i"><span class="command">lemma</span></span> ss424i<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> galois_aux3 distrib_left sup_compl_top total_def_var_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-ss434ii"><span class="command">lemma</span></span> ss434ii<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.right_neutral p_fun_compl p_fun_def_var<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-is_maprop1"><span class="command">lemma</span></span> is_maprop1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ss423<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-is_maprop2"><span class="command">lemma</span></span> is_maprop2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">metis</span> galois_aux2 inf_commute mult.assoc schroeder_1 ss43iii<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> conv_contrav conv_invol conv_iso mult.assoc ss423<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-is_maprop3"><span class="command">lemma</span></span> is_maprop3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_map <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ss423<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_sur_id"><span class="command">lemma</span></span> p_fun_sur_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms order.eq_iff is_p_fun_def is_sur_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_inj_id"><span class="command">lemma</span></span> total_inj_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_invol inj_p_fun p_fun_sur_id sur_total<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_inv_1"><span class="command">lemma</span></span> bij_inv_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_is_maprop is_bij_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_inv_2"><span class="command">lemma</span></span> bij_inv_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_is_maprop is_bij_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-bij_inv_comm"><span class="command">lemma</span></span> bij_inv_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_inv_1 bij_inv_2<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-is_bijrop"><span class="command">lemma</span></span> is_bijrop<span class="main">:</span> <span class="quoted"><span class="quoted">"is_bij <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_inv_1 bij_inv_2 mult.assoc mult.left_neutral<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_map_monomorph"><span class="command">lemma</span></span> inj_map_monomorph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_inj <span class="free">x</span><span class="main">;</span> is_map <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_map_def mult.assoc mult.right_neutral total_inj_id<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-sur_map_epimorph"><span class="command">lemma</span></span> sur_map_epimorph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_sur <span class="free">x</span><span class="main">;</span> is_map <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">;</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">;</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.eq_iff mult.assoc mult.left_neutral ss423 is_sur_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Points and Rectangles›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally here is a section on points and rectangles. This is only a
beginning.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_point</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_point</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> is_vector <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_inj <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rectangle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rectangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="main">1</span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-rectangle_eq"><span class="command">lemma</span></span> rectangle_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_rectangle <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_one dedekind order.eq_iff inf_top_left mult.assoc one_idem_mult is_rectangle_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Antidomain›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section needs to be linked with domain semirings. We essentially
prove the antidomain semiring axioms. Then we have the abstract properties at
our disposition.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">antidom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">a</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">a</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">d</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">d</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">a</span> <span class="main">(</span><span class="keyword1">a</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-antidom_test_comp"><span class="command">lemma</span></span> antidom_test_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">a</span> <span class="free">x</span> <span class="main">=</span> tc <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_def tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-dom_def_aux"><span class="command">lemma</span></span> dom_def_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_test_comp dom_def double_compl inf_top_left mult.left_neutral one_compl ra_1 tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-dom_def_aux_var"><span class="command">lemma</span></span> dom_def_aux_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux one_conv<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-antidom_dom"><span class="command">lemma</span></span> antidom_dom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">a</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">a</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_test_comp dom_def_aux inf_top_left mult.left_neutral ra_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-dom_antidom"><span class="command">lemma</span></span> dom_antidom <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="main">(</span><span class="keyword1">a</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">a</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_dom dom_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-dom_verystrict"><span class="command">lemma</span></span> dom_verystrict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> dom_def_aux_var local.schroeder_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Relation_Algebra_Functions-a_1"><span class="command">lemma</span></span> a_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">a</span> <span class="free">x</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_test_comp galois_aux2 maddux_20 mult.left_neutral one_compl ra_1 tc_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-a_2"><span class="command">lemma</span></span> a_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">a</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">a</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="keyword1">d</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_test_comp dom_def_aux inf_top_left mult.assoc mult.left_neutral ra_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-a_3"><span class="command">lemma</span></span> a_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">a</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antidom_def aux4 dom_def_aux double_compl<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-test_domain"><span class="command">lemma</span></span> test_domain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux inf_le1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux inf.commute mult.right_neutral test_1 is_test_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹At this point we have all the necessary ingredients to prove that
relation algebras form Boolean domain semirings. However, we omit a formal
proof since we haven't formalized the latter.›</span></span>

<span class="keyword1" id="Relation_Algebra_Functions-dom_one"><span class="command">lemma</span></span> dom_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">;</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">d</span> <span class="free">x</span> <span class="main">;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux inf_top_left mult.left_neutral ra_1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-test_dom"><span class="command">lemma</span></span> test_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"is_test <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux inf_le1 is_test_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-p_fun_dom"><span class="command">lemma</span></span> p_fun_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"is_p_fun <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> test_dom test_is_inj_fun<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-inj_dom"><span class="command">lemma</span></span> inj_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> test_dom test_is_inj_fun<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Functions-total_alt_def"><span class="command">lemma</span></span> total_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"is_total <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">d</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom_def_aux_var le_iff_inf is_total_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra_Direct_Products">
<div class="head">
<h1>Theory Relation_Algebra_Direct_Products</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Direct Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_Direct_Products
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra_Functions">Relation_Algebra_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section uses the definition of direct products from Schmidt and
Str\"ohlein's book to prove the well known universal property.›</span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_direct_product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_direct_product</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">1'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We collect some basic properties.›</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_p_fun1"><span class="command">lemma</span></span> dp_p_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_p_fun <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def eq_refl is_p_fun_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_sur1"><span class="command">lemma</span></span> dp_sur1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_sur <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def eq_refl is_sur_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_total1"><span class="command">lemma</span></span> dp_total1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_total <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def inf_le1 is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_map1"><span class="command">lemma</span></span> dp_map1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_map <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dp_p_fun1 dp_total1 is_map_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_p_fun2"><span class="command">lemma</span></span> dp_p_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_p_fun <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def eq_refl is_p_fun_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_sur2"><span class="command">lemma</span></span> dp_sur2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_sur <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def eq_refl is_sur_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_total2"><span class="command">lemma</span></span> dp_total2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_total <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_direct_product_def inf_le2 is_total_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_map2"><span class="command">lemma</span></span> dp_map2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> is_map <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dp_p_fun2 dp_total2 is_map_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we prove four auxiliary lemmas.›</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_aux1"><span class="command">lemma</span></span> dp_aux1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inf_top_left mult.assoc ss_422iii total_one inf.commute inf_top_right<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_aux2"><span class="command">lemma</span></span> dp_aux2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_contrav conv_invol conv_one inf_top_left mult.assoc ss_422iii total_one<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_aux3"><span class="command">lemma</span></span> dp_aux3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux1 inf.commute<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-dp_aux4"><span class="command">lemma</span></span> dp_aux4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_p_fun <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_total <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="free">y</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux2 inf.commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we define a function which is an isomorphism on projections.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Φ</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Φ</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">w</span> <span class="main">;</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="bound">x</span> <span class="main">;</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_conv"><span class="command">lemma</span></span> Phi_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="free">y</span> <span class="main">;</span> <span class="free">w</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Phi<span class="antiquote"><span class="antiquote">}</span></span></span></span> is an isomorphism with respect to the
projections.›</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-mono_dp_1"><span class="command">lemma</span></span> mono_dp_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux4 is_direct_product_def dp_p_fun1 dp_total2 Phi_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-mono_dp_2"><span class="command">lemma</span></span> mono_dp_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux1 is_direct_product_def dp_p_fun2 dp_total1 Phi_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Phi<span class="antiquote"><span class="antiquote">}</span></span></span></span> is an injective function.›</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_map"><span class="command">lemma</span></span> Phi_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_map <span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="main">1'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_direct_product_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="free">y</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">;</span> <span class="free">z</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ss43iii dp_map1 dp_map2 mult.assoc distrib_left<span class="main">)</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">;</span> <span class="main">-</span><span class="main">(</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mono_dp_1 mono_dp_2<span class="main">)</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">w</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ss43iii dp_map1 dp_map2<span class="main">)</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_inf Phi_def<span class="main">)</span>
 <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_maprop<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_inj"><span class="command">lemma</span></span> Phi_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Phi_def Phi_conv Phi_map assms inj_p_fun is_map_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that the converse of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Phi<span class="antiquote"><span class="antiquote">}</span></span></span></span> is an injective
function.›</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_conv_map"><span class="command">lemma</span></span> Phi_conv_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_map <span class="main">(</span><span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Phi_conv Phi_def Phi_map assms<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_conv_inj"><span class="command">lemma</span></span> Phi_conv_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_inj <span class="main">(</span><span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Phi_inj Phi_conv Phi_def assms<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_sur"><span class="command">lemma</span></span> Phi_sur<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Phi_conv Phi_def Phi_map is_map_def sur_total<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_conv_sur"><span class="command">lemma</span></span> Phi_conv_sur<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sur <span class="main">(</span><span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Phi_conv Phi_def Phi_sur<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_bij"><span class="command">lemma</span></span> Phi_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Phi_inj Phi_map Phi_sur is_bij_def<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-Phi_conv_bij"><span class="command">lemma</span></span> Phi_conv_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">w</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bij <span class="main">(</span><span class="main">(</span><span class="keyword1">Φ</span> <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Phi_bij Phi_def Phi_conv assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we construct, for given functions~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, a
function~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which makes the standard product diagram commute, and we
verify these commutation properties.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="bound">g</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">f</span> <span class="main">;</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="bound">g</span> <span class="main">;</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-f_proj"><span class="command">lemma</span></span> f_proj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">f</span> <span class="free">x</span> <span class="free">g</span> <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux4 F_def is_map_def is_direct_product_def dp_p_fun1<span class="main">)</span>

<span class="keyword1" id="Relation_Algebra_Direct_Products-g_proj"><span class="command">lemma</span></span> g_proj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"F <span class="free">f</span> <span class="free">x</span> <span class="free">g</span> <span class="free">y</span> <span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dp_aux1 F_def is_map_def is_direct_product_def dp_p_fun2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we show uniqueness of~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> F<span class="antiquote"><span class="antiquote">}</span></span></span></span>, hence universality of the
construction.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_direct_product <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_map <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">G</span> <span class="main">;</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="free">G</span> <span class="main">;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> F <span class="free">f</span> <span class="free">x</span> <span class="free">g</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"F <span class="free">f</span> <span class="free">x</span> <span class="free">g</span> <span class="free">y</span> <span class="main">=</span> <span class="free">G</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span> <span class="main">⋅</span> <span class="free">G</span> <span class="main">;</span> <span class="main">(</span><span class="free">y</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> F_def mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">G</span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">;</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_distl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_direct_product_def calculation mult.right_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Relation_Algebra_RTC">
<div class="head">
<h1>Theory Relation_Algebra_RTC</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Reflexive Transitive Closure›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_RTC
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra">Relation_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We impose the Kleene algebra axioms for the star on relation algebras.
This gives us a reflexive transitive closure operation.›</span></span>

<span class="keyword1"><span class="command">class</span></span> relation_algebra_rtc <span class="main">=</span> relation_algebra <span class="main">+</span> star_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rtc_unfoldl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1'</span> <span class="main">+</span>  <span class="free">x</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rtc_inductl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">x</span> <span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rtc_inductr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> <span class="free">y</span> <span class="main">;</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">z</span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">y</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> relation_algebra_rtc <span class="main">⊆</span> kleene_algebra <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1'</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">star</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtc_unfoldl<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.rtc_inductl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtc_inductr<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> relation_algebra_rtc
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, we prove that the obvious interaction between the star and
converse is captured by the axioms.›</span></span>

<span class="keyword1" id="Relation_Algebra_RTC-star_conv"><span class="command">lemma</span></span> star_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.conv_add local.conv_contrav local.conv_e local.conv_iso local.star_rtc1 local.star_rtc_least<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> boffa_var conv_add conv_contrav conv_e conv_invol conv_iso star_denest star_ext star_iso star_plus_one sup.idem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we provide an example to show how facts from Kleene algebra are
picked up in relation algebra.›</span></span>

<span class="keyword1" id="Relation_Algebra_RTC-rel_church_rosser"><span class="command">lemma</span></span> rel_church_rosser<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">;</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⌣</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> church_rosser<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* relation_algebra_rtc *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Relation_Algebra_Models">
<div class="head">
<h1>Theory Relation_Algebra_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Relation Algebra
   Author:     Alasdair Armstrong, Simon Foster, Georg Struth, Tjark Weber
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
               Tjark Weber &lt;tjark.weber at it.uu.se&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models of Relation Algebra›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relation_Algebra_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Relation_Algebra">Relation_Algebra</a> <a href="../../kleene_algebra/theories/#Inf_Matrix">Kleene_Algebra.Inf_Matrix</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalise two models. First we show the obvious: binary relations
form a relation algebra. Then we show that infinite matrices (which we
formalised originally for Kleene algebras) form models of relation algebra if
we restrict their element type to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">bool</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Binary Relations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since Isabelle's libraries for binary relations are very well
developed, the proof for this model is entirely trivial.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_relation_algebra<span class="main">:</span> relation_algebra <span class="quoted"><span class="quoted">"<span class="main">(-)</span>"</span></span> <span class="quoted">uminus</span> <span class="quoted"><span class="quoted">"<span class="main">(∩)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Relation.converse</span> <span class="quoted">Id</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Infinite Boolean Matrices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we consider infinite Boolean matrices. We define the maximal
Boolean matrix (all of its entries are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> True<span class="antiquote"><span class="antiquote">}</span></span></span></span>), the converse or
transpose of a matrix, the intersection of two Boolean matrices and the
complement of a Boolean matrix.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">τ</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">τ</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_transpose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> matrix <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> matrix"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>†</sup></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>†</sup></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">j</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_inter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊓</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mat_complement</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> bool<span class="main">)</span> matrix"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>c</sup></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that the Booleans form a dioid. We state this as an
\emph{instantiation} result. The Kleene algebra files contain an
\emph{interpretation} proof, which is not sufficient for our purposes.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted">dioid_one_zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> zero_bool_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">zero_bool</span></span> <span class="main">≡</span> False"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> one_bool_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">one_bool</span></span> <span class="main">≡</span> True"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> times_bool_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">times_bool</span></span> <span class="main">≡</span> <span class="main">(∧)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> plus_bool_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">plus_bool</span></span> <span class="main">≡</span> <span class="main">(∨)</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_bool_def times_bool_def one_bool_def zero_bool_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that infinite Boolean matrices form a Boolean algebra.›</span></span>

<span class="keyword1" id="Relation_Algebra_Models-le_funI2"><span class="command">lemma</span></span> le_funI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_funI<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_ba<span class="main">:</span> boolean_algebra <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">⊓</span> <span class="bound">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="quoted">mat_complement</span> <span class="quoted"><span class="quoted">"<span class="main">(⊓)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted">mat_add</span> <span class="quoted">mat_zero</span> <span class="quoted">mat_top</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_funI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mat_inter_def plus_bool_def mat_add_def mat_zero_def zero_bool_def mat_top_def mat_complement_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We continue working towards the main result of this section, that
infinite Boolean matrices form a relation algebra.›</span></span>

<span class="keyword1" id="Relation_Algebra_Models-mat_mult_var"><span class="command">lemma</span></span> mat_mult_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⊗</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">∑</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">k</span> <span class="bound">j</span><span class="main">)</span> <span class="main">|</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_mult_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following fact is related to proving the last relation algebra
axiom in the matrix model. It is more complicated than necessary since finite
infima are not well developed in Isabelle. Instead we translate properties of
finite infima into properties of finite suprema by using Boolean algebra. For
finite suprema we have developed special-purpose theorems in the Kleene algebra
files.›</span></span>

<span class="keyword1" id="Relation_Algebra_Models-mat_res_pointwise"><span class="command">lemma</span></span> mat_res_pointwise<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">j</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">,</span> bool<span class="main">)</span> matrix"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⊗</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∑</span><span class="main">{</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_sup<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mat_complement_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> <span class="free">y</span> <span class="free">i</span> <span class="free">j</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mat_complement_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">y</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">k</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">y</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_transpose_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">k</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">y</span> <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span> <span class="bound">k</span> <span class="bound">l</span> <span class="main">∧</span> <span class="free">y</span> <span class="bound">l</span> <span class="free">j</span> <span class="main">|</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_mult_def times_bool_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span> <span class="bound">k</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">y</span> <span class="free">i</span> <span class="free">j</span><span class="main">}</span> <span class="main">≤</span> <span class="main">∑</span><span class="main">{</span><span class="free">x</span> <span class="bound">k</span> <span class="bound">l</span> <span class="main">∧</span> <span class="free">y</span> <span class="bound">l</span> <span class="free">j</span> <span class="main">|</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> UNIV<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> True"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iffI TrueI allI sum_intro<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⊗</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="main">∑</span><span class="main">{</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span> <span class="free">i</span> <span class="bound">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span><span class="main">)</span> <span class="bound">k</span> <span class="free">j</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> UNIV<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mat_mult_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_bool_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally the main result of this section.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> matrix_ra<span class="main">:</span> relation_algebra <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">⊓</span> <span class="bound">g</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span> <span class="quoted">mat_complement</span> <span class="quoted"><span class="quoted">"<span class="main">(⊓)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊕)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> False"</span></span> <span class="quoted"><span class="keyword1">τ</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊗)</span>"</span></span> <span class="quoted">mat_transpose</span> <span class="quoted"><span class="keyword1">ε</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>finite <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">j</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> False<span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> predicate2I<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_ba.bot.extremum matrix_ba.inf_compl_bot rev_predicate2D<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊕</span> <span class="skolem">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="keyword1">τ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> matrix_ba.sup_compl_top<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mat_mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="keyword1">ε</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> mat_oner<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> mat_distr<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_transpose_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊕</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⊕</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_transpose_def mat_add_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⊗</span> <span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_transpose_def mat_mult_var times_bool_def conj_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span> <span class="main">≤</span> <span class="skolem">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>c</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_funI2 mat_res_pointwise<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>