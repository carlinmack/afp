<div id="Types">
<div class="head">
<h1>Theory Types</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Types
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹type parameters:›</span>
<span class="comment1">― ‹'exp: expressions (arithmetic, boolean...)›</span>
<span class="comment1">― ‹'val: values›</span>
<span class="comment1">― ‹'id: identifier names›</span>
<span class="comment1">― ‹'com: commands›</span>
<span class="comment1">― ‹'d: domains›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is a collection of type synonyms. Note that not all of these type synonyms are 
  used within Strong-Security - some are used in WHATandWHERE-Security.›</span></span>

<span class="comment1">― ‹type for memory states - map ids to values›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="tfree">'val</span>"</span></span>

<span class="comment1">― ‹type for evaluation functions mapping expressions to a values depending on a state›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'val</span>"</span></span>

<span class="comment1">― ‹define configurations with threads as pair of commands and states›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TConfig <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State"</span></span>

<span class="comment1">― ‹define configurations with thread pools as pair of command lists (thread pool) and states›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPConfig <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'com</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State"</span></span>

<span class="comment1">― ‹type for program states (including the set of commands and a symbol for terminating - None)›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'com</span> ProgramState <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> option"</span></span>

<span class="comment1">― ‹type for configurations with program states›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> PSConfig <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> ProgramState <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State"</span></span>

<span class="comment1">― ‹type for labels with a list of spawned threads›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'com</span> Label <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> list"</span></span>

<span class="comment1">― ‹type for step relations from single commands to a program state, with a label›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TLSteps <span class="main">=</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TConfig <span class="main">×</span> <span class="tfree">'com</span> Label 
    <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> PSConfig<span class="main">)</span> set"</span></span>

<span class="comment1">― ‹curried version of previously defined type›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TLSteps_curry <span class="main">=</span>
<span class="quoted"><span class="quoted">"<span class="tfree">'com</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'com</span> Label <span class="main">⇒</span> <span class="tfree">'com</span> ProgramState 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>

<span class="comment1">― ‹type for step relations from thread pools to thread pools›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPSteps <span class="main">=</span> <span class="quoted"><span class="quoted">"
  <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPConfig <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPConfig<span class="main">)</span> set"</span></span>

<span class="comment1">― ‹curried version of previously defined type›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPSteps_curry <span class="main">=</span>
<span class="quoted"><span class="quoted">"<span class="tfree">'com</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'com</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>

<span class="comment1">― ‹define type of step relations for single threads to thread pools›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TSteps <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TConfig <span class="main">×</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TPConfig<span class="main">)</span> set"</span></span>

<span class="comment1">― ‹define the same type as TSteps, but in a curried version (allowing syntax abbreviations)›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TSteps_curry <span class="main">=</span>
<span class="quoted"><span class="quoted">"<span class="tfree">'com</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'com</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>

<span class="comment1">― ‹type for simple domain assignments; 'd has to be an instance of order (partial order›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> DomainAssignment <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">::</span>order"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'com</span> Bisimulation_type <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'com</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'com</span> list<span class="main">)</span><span class="main">)</span> set"</span></span>

<span class="comment1">― ‹type for escape hatches›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatch <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'exp</span>"</span></span>

<span class="comment1">― ‹type for sets of escape hatches›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatch<span class="main">)</span> set"</span></span>

<span class="comment1">― ‹type for local escape hatches›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatch <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'exp</span> <span class="main">×</span> nat"</span></span>

<span class="comment1">― ‹type for sets of local escape hatches›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatches <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatch<span class="main">)</span> set"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Expr">
<div class="head">
<h1>Theory Expr</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Expr
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Types">Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹type parameters:›</span>
<span class="comment1">― ‹'val: numbers, boolean constants....›</span>
<span class="comment1">― ‹'id: identifier names›</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'val</span><span class="main">)</span> operation <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> list <span class="main">⇒</span> <span class="tfree">'val</span>"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>dead <span class="tfree">'id</span><span class="main">,</span> dead <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">=</span>
Const <span class="quoted"><span class="quoted">"<span class="tfree">'val</span>"</span></span> <span class="main">|</span>
Var <span class="quoted"><span class="quoted">"<span class="tfree">'id</span>"</span></span> <span class="main">|</span>
Op <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> operation"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> list"</span></span>


<span class="comment1">― ‹defining a simple recursive evaluation function on this datatype›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ExprEval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">ExprEvalL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'val</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ExprEval</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ExprEval</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ExprEval</span> <span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free">ExprEvalL</span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">ExprEvalL</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ExprEvalL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">ExprEval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">ExprEvalL</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Domain_example">
<div class="head">
<h1>Theory Domain_example</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Domain_example
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Expr">Expr</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹When interpreting, we have to instantiate the type for domains. As an example, we take a type containing 'low' and 'high' as domains.›</span>

<span class="keyword1"><span class="command">datatype</span></span> Dom <span class="main">=</span> low <span class="main">|</span> high

<span class="keyword1"><span class="command">instantiation</span></span> Dom <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
less_eq_Dom_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="keyword1">then</span> True 
  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">=</span> low <span class="keyword1">then</span> True <span class="keyword1">else</span> False<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
less_Dom_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="keyword1">then</span> False
  <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="main">=</span> low <span class="keyword1">then</span> True <span class="keyword1">else</span> False<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">Dom</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> less_eq_Dom_def less_Dom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_Dom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> less_eq_Dom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">split</span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">;</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> less_eq_Dom_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">split</span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">split</span> if_split_asm<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="MWLf">
<div class="head">
<h1>Theory MWLf</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> MWLf
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Types">Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹SYNTAX›</span>

<span class="comment1">― ‹Commands for the multi-threaded while language with fork (to instantiate 'com)›</span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom 
  <span class="main">=</span> Skip <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">skip</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
  <span class="main">|</span> Assign <span class="quoted"><span class="quoted">"<span class="tfree">'id</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span> 
       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">:=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>70<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> Seq <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span> 
       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>61<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>
 
  <span class="main">|</span> If_Else <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">fi</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>80<span class="main">,</span>79<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> While_Do <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span> 
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">while</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">do</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">od</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>80<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> Fork <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom<span class="main">)</span> list"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">fork</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ _"</span> <span class="main">[</span>70<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>

<span class="comment1">― ‹SEMANTICS›</span>

<span class="keyword1"><span class="command">locale</span></span> MWLf_semantics <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹steps semantics, set of deterministic steps from single threads to either single threads or thread pools›</span>
<span class="keyword1"><span class="command">inductive_set</span></span> 
<span class="entity">MWLfSteps_det</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom<span class="main">)</span> TSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">MWLfSteps_det'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom<span class="main">)</span> TSteps_curry"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">MWLfSteps_det</span>"</span></span> <span class="main">|</span>
skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="keyword1">skip</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
seq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
seq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
iftrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> True <span class="main">⟹</span> 
    <span class="main"><span class="free">⟨</span></span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
iffalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> False <span class="main">⟹</span> 
    <span class="main"><span class="free">⟨</span></span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
whiletrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> True <span class="main">⟹</span> 
    <span class="main"><span class="free">⟨</span></span><span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
whilefalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> False <span class="main">⟹</span> 
    <span class="main"><span class="free">⟨</span></span><span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="main">[]</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
fork<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="keyword1">fork</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MWLfSteps_det_cases<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">skip</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span> <span class="main">:=</span> <span class="free">e</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">fork</span> <span class="free">c</span> <span class="free">V</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free">W</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>

<span class="comment1">― ‹non-deterministic, possibilistic system step (added for intuition, not used in the proofs)›</span>
<span class="keyword1"><span class="command">inductive_set</span></span>
<span class="entity">MWLfSteps_ndet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom<span class="main">)</span> TPSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">MWLfSteps_ndet'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom<span class="main">)</span> TPSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">⇒</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">V1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">V2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">V1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">V2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">MWLfSteps_ndet</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">⟩</span> <span class="main">⟹</span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">Vf</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">Va</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">Vf</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">Va</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Strong_Security">
<div class="head">
<h1>Theory Strong_Security</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Strong_Security
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Types">Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> Strong_Security <span class="main">=</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">SR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹define when two states are indistinguishable for an observer on domain d›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d_equal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">d_equal</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">DA</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_equal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State 
  <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">=⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> d_equal <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span>"</span></span>

<span class="comment1">― ‹transitivity of d-equality›</span>
<span class="keyword1" id="Strong_Security-d_equal_trans"><span class="command">lemma</span></span> d_equal_trans<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">m</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">m'</span><span class="main">;</span> <span class="free">m'</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">m''</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">m</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">m''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_equal_def<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SRabbr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">SR</span>"</span></span>

<span class="comment1">― ‹predicate for strong d-bisimulation›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Strong_d_Bisimulation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Strong_d_Bisimulation</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span>sym <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">W</span><span class="main">.</span>
  <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">m1</span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m1'</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="bound">m2</span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹union of all strong d-bisimulations›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">USdB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword1">≈⇘</span>_<span class="keyword1">⇙</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>Strong_d_Bisimulation <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">r</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">relatedbyUSdB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> list <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> list <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≈⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>66<span class="main">,</span>66<span class="main">]</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">V</span></span></span> ≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∈</span> USdB <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="comment1">― ‹predicate to define when a program is strongly secure›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Strongly_Secure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Strongly_Secure</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> ≈<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>


<span class="comment1">― ‹auxiliary lemma to obtain central strong d-Bisimulation property as Lemma
 in meta logic (allows instantiating all the variables manually if necessary)›</span>
<span class="keyword1" id="Strong_Security-strongdB_aux"><span class="command">lemma</span></span> strongdB_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span> <span class="bound">V'</span> <span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">W</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> Strong_d_Bisimulation <span class="free">d</span> <span class="free">R</span><span class="main">;</span>
 <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">V</span> <span class="main">;</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span><span class="main">;</span> <span class="bound">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m1'</span> <span class="main">⟧</span>
 <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_d_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="Strong_Security-trivialpair_in_USdB"><span class="command">lemma</span></span> trivialpair_in_USdB<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">[]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def Strong_d_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>

<span class="keyword1" id="Strong_Security-USdBsym"><span class="command">lemma</span></span> USdBsym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def Strong_d_Bisimulation_def sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Strong_Security-USdBeqlen"><span class="command">lemma</span></span> USdBeqlen<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span> <span class="main">⟹</span> length <span class="free">V</span> <span class="main">=</span> length <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def Strong_d_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>              

<span class="keyword1" id="Strong_Security-USdB_Strong_d_Bisimulation"><span class="command">lemma</span></span> USdB_Strong_d_Bisimulation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Strong_d_Bisimulation <span class="free">d</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_d_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> USdBsym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span> <span class="main">⟹</span> length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> USdBeqlen<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">W</span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> inUSdB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> stepV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> inUSdB <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> someR<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Strong_d_Bisimulation <span class="free">d</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> strongdB_aux stepV irange dequal <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Strong_Security-USdBtrans"><span class="command">lemma</span></span> USdBtrans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
  <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">V'</span><span class="main">.</span> <span class="bound">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="bound">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">V''</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> p1 p2 <span class="keyword1"><span class="command">have</span></span> inRest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> SdB_rest<span class="main">:</span> <span class="quoted"><span class="quoted">"Strong_d_Bisimulation <span class="free">d</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_d_Bisimulation_def sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
        <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> p1 USdBsym <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> p2 USdBsym <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V'</span><span class="main">.</span> <span class="skolem">V''</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="bound">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
        <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> p1 USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> 
        <span class="keyword1"><span class="command">from</span></span> p2 USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V'</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">W</span> <span class="skolem">m2</span>
        <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> p1 USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> leq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          
        <span class="keyword1"><span class="command">have</span></span> deq_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_equal_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> irange step dequal p1 USdB_Strong_d_Bisimulation 
          strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1concl<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">with</span></span> deq_same leq USdB_Strong_d_Bisimulation
          strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
          irange p2 dequal <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W''</span></span> <span class="skolem"><span class="skolem">m2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2concl<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">W'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W''</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W''</span><span class="main">,</span><span class="skolem">m2''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2'</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   

        <span class="keyword1"><span class="command">from</span></span> p1concl p2concl d_equal_trans <span class="keyword1"><span class="command">have</span></span> tt''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">from</span></span> p1concl p2concl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">with</span></span> p2concl tt'' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W''</span> <span class="bound">m2''</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W''</span><span class="main">,</span><span class="bound">m2''</span><span class="main">⟩</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">V'</span><span class="main">.</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="bound">V'</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W''</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>  

  <span class="keyword1"><span class="command">hence</span></span> liftup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">⊆</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> inRest <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Up_To_Technique">
<div class="head">
<h1>Theory Up_To_Technique</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Up_To_Technique
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Strong_Security">Strong_Security</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> Strong_Security
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹define d-bisimulation 'up to' union of strong d-Bisimulations›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d_Bisimulation_Up_To_USdB</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">d_Bisimulation_Up_To_USdB</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span>sym <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">W</span> <span class="bound">m2</span><span class="main">.</span>
  <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">m1</span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m1'</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∪</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">m2</span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Up_To_Technique-UpTo_aux"><span class="command">lemma</span></span> UpTo_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span> <span class="bound">V'</span> <span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">W</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span> d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="free">R</span><span class="main">;</span>
  <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">;</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span><span class="main">;</span> <span class="bound">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m1'</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1" id="Up_To_Technique-RuUSdBeqlen"><span class="command">lemma</span></span> RuUSdBeqlen<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="free">R</span><span class="main">;</span> 
  <span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> length <span class="free">V</span> <span class="main">=</span> length <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">rule</span> USdBeqlen<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Up_To_Technique-Up_To_Technique"><span class="command">lemma</span></span> Up_To_Technique<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> upToR<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="free">R</span> <span class="main">∪</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> S_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_d_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="comment1">― ‹show symmetry›</span>
    <span class="keyword3"><span class="command">show</span></span> symS<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">S</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> upToR
      <span class="keyword1"><span class="command">have</span></span> Rsym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> USdBsym <span class="keyword1"><span class="command">have</span></span> Usym<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sym_Un<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> S_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
    <span class="keyword3"><span class="command">assume</span></span> inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
      <span class="comment1">― ‹show equal length (by definition)›</span>
    <span class="keyword1"><span class="command">from</span></span> inS S_def upToR RuUSdBeqlen
    <span class="keyword3"><span class="command">show</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>             
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹show general bisimulation property›</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">W</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> stepV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
    
    <span class="keyword1"><span class="command">from</span></span> inS <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> firstcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> 

      <span class="keyword1"><span class="command">with</span></span> upToR dequal irange stepV
        UpTo_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∨</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>         
      <span class="keyword3"><span class="command">assume</span></span> secondcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> USdB_Strong_d_Bisimulation upToR 
        secondcase dequal irange stepV
        strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∨</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
                    
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Parallel_Composition">
<div class="head">
<h1>Theory Parallel_Composition</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Parallel_Composition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Up_To_Technique">Up_To_Technique</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> Strong_Security
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> parallel_composition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">V</span> <span class="main">=</span> length <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> partsrelated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> <span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">[</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> eqlen partsrelated <span class="keyword1"><span class="command">have</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> USdBsym <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def sym_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">RS</span> <span class="skolem">m2</span>
      <span class="keyword3"><span class="command">assume</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR <span class="keyword1"><span class="command">have</span></span> Vassump<span class="main">:</span>
        <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span> <span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>

      <span class="keyword1"><span class="command">with</span></span> step dequal USdB_Strong_d_Bisimulation irange 
      strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>

    <span class="keyword1"><span class="command">with</span></span> inR <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Parallel_Composition-parallel_decomposition"><span class="command">lemma</span></span> parallel_decomposition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> related<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> <span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="bound">C'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="bound">W</span> <span class="bound">W'</span><span class="main">.</span> <span class="bound">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">W</span> 
    <span class="main">∧</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">[</span><span class="bound">W</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">C'</span> <span class="main">=</span> <span class="main">[</span><span class="bound">W'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> related <span class="keyword1"><span class="command">have</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> USdBsym USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">C'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">C'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">C</span> <span class="main">=</span> length <span class="skolem">C'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">C'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">RS</span> <span class="skolem">m2</span>
      <span class="keyword3"><span class="command">assume</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">C'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">C</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">C</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>

     <span class="keyword1"><span class="command">from</span></span> inR <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Rassump<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"<span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">W</span> <span class="main">∧</span> <span class="skolem">C</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">W</span><span class="main">!</span><span class="skolem">j</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">C'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">W'</span><span class="main">!</span><span class="skolem">j</span><span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

     <span class="keyword1"><span class="command">with</span></span> irange <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

     <span class="keyword1"><span class="command">from</span></span> Rassump i0 strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span>"</span></span> 
       <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> 
       USdB_Strong_d_Bisimulation step dequal
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">C'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> 
       <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">⊆</span> <span class="main">(</span>≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>

   <span class="keyword1"><span class="command">with</span></span> inR <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Parallel_Composition-USdB_comp_head_tail"><span class="command">lemma</span></span> USdB_comp_head_tail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedhead<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedtail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">V'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> relatedtail USdBeqlen <span class="keyword1"><span class="command">have</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">V'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
  <span class="keyword1"><span class="command">from</span></span> relatedtail parallel_decomposition <span class="keyword1"><span class="command">have</span></span> singleV<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> <span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">with</span></span> relatedhead <span class="keyword1"><span class="command">have</span></span> intermediate<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">V'</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      
  <span class="keyword1"><span class="command">with</span></span> eqlen parallel_composition
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
       
<span class="keyword1" id="Parallel_Composition-USdB_decomp_head_tail"><span class="command">lemma</span></span> USdB_decomp_head_tail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedlist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">V'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c'</span><span class="main">]</span> <span class="main">∧</span> <span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> relatedlist USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">#</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">#</span><span class="free">V'</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">V</span> <span class="main">=</span> length <span class="free">V'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> relatedlist parallel_decomposition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">#</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">#</span><span class="free">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> intermediate<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">V</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="main">(</span><span class="free">c'</span><span class="main">#</span><span class="free">V'</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> intermediate eqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Vcase1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eqlen <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Vcase1 trivialpair_in_USdB <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">W</span>
    <span class="keyword3"><span class="command">assume</span></span> Vcase2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> <span class="skolem">c1</span><span class="main">#</span><span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> Vlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">V</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> intermediate <span class="keyword1"><span class="command">have</span></span> intermediate_aux<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">V</span>
      <span class="main">⟹</span> <span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
    <span class="keyword1"><span class="command">with</span></span> parallel_composition<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V'</span>"</span></span><span class="main">]</span> eqlen
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Strongly_Secure_Skip_Assign">
<div class="head">
<h1>Theory Strongly_Secure_Skip_Assign</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Strongly_Secure_Skip_Assign
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#MWLf">MWLf</a> <a href="#Parallel_Composition">Parallel_Composition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> Strongly_Secure_Programs <span class="main">=</span>
L<span class="main">?</span> <span class="main">:</span> MWLf_semantics <span class="quoted"><span class="quoted">"<span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span>"</span></span> 
<span class="main">+</span> SS<span class="main">?</span><span class="main">:</span> Strong_Security <span class="quoted"><span class="quoted">"MWLfSteps_det"</span></span> <span class="quoted"><span class="quoted">"<span class="free">DA</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">USdBname</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom Bisimulation_type"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword1">≈⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="main">≡</span> USdB <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">relatedbyUSdB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list <span class="main">⇒</span> <span class="tfree">'d</span>
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">≈⇘</span>_<span class="keyword1">⇙</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">V</span></span></span> ≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∈</span> USdB <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="comment1">― ‹define when two expressions are indistinguishable with respect to a domain d›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d_indistinguishable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">d_indistinguishable</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> 
  <span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">m</span> =<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">m'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_indistinguishable'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≡⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">e1</span></span></span> ≡<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> d_indistinguishable <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>

<span class="comment1">― ‹symmetry of d-indistinguishable›</span>
<span class="keyword1" id="Strongly_Secure_Skip_Assign-d_indistinguishable_sym"><span class="command">lemma</span></span> d_indistinguishable_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e'</span> <span class="main">⟹</span> <span class="free">e'</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="comment1">― ‹transitivity of d-indistinguishable›</span>
<span class="keyword1" id="Strongly_Secure_Skip_Assign-d_indistinguishable_trans"><span class="command">lemma</span></span> d_indistinguishable_trans<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e'</span><span class="main">;</span> <span class="free">e'</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e''</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> Strongly_Secure_Skip<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list<span class="main">,</span><span class="bound">V'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list<span class="main">)</span><span class="main">.</span> 
    <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> uptoR0<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def sym_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">W</span> <span class="skolem">m2</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> inR0 <span class="keyword1"><span class="command">have</span></span> Vassump<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> step irange <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        
      <span class="keyword1"><span class="command">from</span></span> Vassump irange <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> step2<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2'</span> <span class="main">=</span> <span class="skolem">m1'</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLfSteps_det.skip<span class="main">)</span>

      <span class="keyword1"><span class="command">with</span></span> step1 dequal trivialpair_in_USdB <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span>
        <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>

   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Strongly_Secure_Assign<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_indistinguishable_exp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">DA</span> <span class="free">x</span></sub><span class="hidden">⇙</span> <span class="free">e'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">:=</span> <span class="free">e</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">x</span> <span class="main">:=</span> <span class="free">e'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">e</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">V'</span> <span class="main">=</span> <span class="main">[</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">e'</span><span class="main">]</span> <span class="main">∧</span>
    <span class="bound">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">DA</span> <span class="bound">x</span></sub><span class="hidden">⇙</span> <span class="bound">e'</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> d_indistinguishable_exp <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">:=</span><span class="free">e</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">x</span><span class="main">:=</span><span class="free">e'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> d_indistinguishable_sym <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">W</span> <span class="skolem">m2</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> inR0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Vassump<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e'</span><span class="main">]</span> <span class="main">∧</span>
        <span class="skolem">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">DA</span> <span class="skolem">x</span></sub><span class="hidden">⇙</span> <span class="skolem">e'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> step irange <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> step1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="skolem">e</span> <span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">W</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        
      <span class="keyword1"><span class="command">from</span></span> Vassump irange <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> step2<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="skolem">e'</span> <span class="skolem">m1'</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2'</span> <span class="main">=</span> <span class="skolem">m1'</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLfSteps_det.assign<span class="main">)</span>

      <span class="keyword1"><span class="command">with</span></span> Vassump dequal step step1
      <span class="keyword1"><span class="command">have</span></span> dequalnext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>      
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_equal_def d_indistinguishable_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

      <span class="keyword1"><span class="command">with</span></span> step1 step2 trivialpair_in_USdB <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W'</span> <span class="bound">m2'</span><span class="main">.</span>
        <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">W'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>

   <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Language_Composition">
<div class="head">
<h1>Theory Language_Composition</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Language_Composition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Strongly_Secure_Skip_Assign">Strongly_Secure_Skip_Assign</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> Strongly_Secure_Programs
<span class="keyword2"><span class="keyword">begin</span></span>        
  
<span class="keyword1"><span class="command">theorem</span></span> Compositionality_Seq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedpart1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c1'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedpart2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c2'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c1'</span><span class="main">;</span><span class="free">c2'</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">S1</span><span class="main">,</span><span class="bound">S2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span> <span class="bound">W</span> <span class="bound">W'</span><span class="main">.</span> 
    <span class="bound">S1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">c1</span><span class="main">;</span><span class="bound">c2</span><span class="main">)</span><span class="main">#</span><span class="bound">W</span> <span class="main">∧</span> <span class="bound">S2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">;</span><span class="bound">c2'</span><span class="main">)</span><span class="main">#</span><span class="bound">W'</span> <span class="main">∧</span> 
    <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> relatedpart1 relatedpart2 trivialpair_in_USdB
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c1'</span><span class="main">;</span><span class="free">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
   
  <span class="keyword1"><span class="command">have</span></span> uptoR0<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> USdBsym 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S1</span> <span class="skolem">S2</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S1</span><span class="main">,</span><span class="skolem">S2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">S1</span> <span class="main">=</span> length <span class="skolem">S2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S1</span> <span class="skolem">S2</span> <span class="skolem">RS</span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="skolem">m1'</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">S1</span><span class="main">,</span><span class="skolem">S2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">S1</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> S1step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">S1</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> inR0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">V'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> R0def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">#</span><span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">S2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">)</span><span class="main">#</span><span class="skolem">V'</span> <span class="main">∧</span> 
          <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

        <span class="keyword1"><span class="command">with</span></span> irange <span class="keyword1"><span class="command">have</span></span> case_distinction1<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> 
          <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

              <span class="comment1">― ‹get the two different sub-cases:›</span>
            <span class="keyword1"><span class="command">with</span></span> R0def' S1step <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> case_distinction<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>
              <span class="main">∨</span> <span class="skolem">RS</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
              <span class="comment1">― ‹Case 1: first command terminates›</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span> 

              <span class="keyword1"><span class="command">from</span></span> USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> StepAssump R0def' 
                USdB_Strong_d_Bisimulation dequal
                strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> i0
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">W'</span> <span class="main">=</span> <span class="main">[]</span> 
                <span class="main">∧</span> <span class="main">[]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

              <span class="keyword1"><span class="command">with</span></span> c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.seq1<span class="main">)</span>
          
              <span class="keyword1"><span class="command">with</span></span> RSassump R0def' i0 <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>   
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>      
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
              <span class="comment1">― ‹Case 2: first command does not terminate›</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
              
              <span class="keyword1"><span class="command">from</span></span> StepAssump R0def' USdB_Strong_d_Bisimulation dequal
                strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> i0 
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">)</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
 
              <span class="keyword1"><span class="command">with</span></span> USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3'</span></span> <span class="skolem"><span class="skolem">W'</span></span> 
                <span class="keyword2"><span class="keyword">where</span></span> V''reason<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="skolem">c3'</span><span class="main">#</span><span class="skolem">W'</span> <span class="main">∧</span> length <span class="skolem">W</span> <span class="main">=</span> length <span class="skolem">W'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">V''</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
          
              <span class="keyword1"><span class="command">with</span></span> c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart1<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">)</span><span class="main">#</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.seq2<span class="main">)</span>

              <span class="keyword1"><span class="command">from</span></span> V''reason c1c1'reason 
                USdB_decomp_head_tail<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span><span class="main">]</span> 
                USdB_Strong_d_Bisimulation
              <span class="keyword1"><span class="command">have</span></span> c3aWinUSDB<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c3</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c3'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
              <span class="keyword1"><span class="command">with</span></span> R0def' <span class="keyword1"><span class="command">have</span></span> conclpart2<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span><span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">)</span><span class="main">#</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>

              <span class="keyword1"><span class="command">with</span></span> i0 RSassump R0def' V''reason conclpart1 
              <span class="keyword1"><span class="command">have</span></span> case2_concl<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">)</span><span class="main">#</span><span class="skolem">W'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span> 
            <span class="keyword1"><span class="command">ultimately</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
              <span class="keyword3"><span class="command">assume</span></span> Vnonempt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> inot0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

              <span class="keyword1"><span class="command">with</span></span> Vnonempt irange R0def' <span class="keyword1"><span class="command">have</span></span> i1range<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

              <span class="keyword1"><span class="command">from</span></span> inot0 R0def' <span class="keyword1"><span class="command">have</span></span> S1ieq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S1</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">V</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

              <span class="keyword1"><span class="command">from</span></span> inot0 R0def' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">V'</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
              <span class="keyword1"><span class="command">with</span></span> S1ieq R0def' S1step i1range dequal 
                USdB_Strong_d_Bisimulation
                strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"USdB <span class="free">d</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">S2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>          
  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>
  
  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Compositionality_Fork<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">V</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedmain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> relatedthreads<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">fork</span> <span class="free">c</span> <span class="free">V</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="keyword1">fork</span> <span class="free">c'</span> <span class="free">V'</span><span class="main">]</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">F1</span><span class="main">,</span><span class="bound">F2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">W</span> <span class="bound">W'</span><span class="main">.</span> 
    <span class="bound">F1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">fork</span> <span class="bound">c1</span> <span class="bound">W</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">F2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">fork</span> <span class="bound">c1'</span> <span class="bound">W'</span><span class="main">]</span>
    <span class="main">∧</span> <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> relatedmain relatedthreads 
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">fork</span> <span class="free">c</span> <span class="free">V</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">fork</span> <span class="free">c'</span> <span class="free">V'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> uptoR0<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> USdBsym <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F1</span> <span class="skolem">F2</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F1</span><span class="main">,</span><span class="skolem">F2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> R0_def USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">F1</span> <span class="main">=</span> length <span class="skolem">F2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F1</span> <span class="skolem">F2</span> <span class="skolem">c1V</span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="skolem">m1'</span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F1</span><span class="main">,</span><span class="skolem">F2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">F1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> F1step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">F1</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c1V</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">V'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">fork</span> <span class="skolem">c1</span> <span class="skolem">V</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">F2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">fork</span> <span class="skolem">c1'</span> <span class="skolem">V'</span><span class="main">]</span> <span class="main">∧</span> 
        <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> irange R0def' F1step
      <span class="keyword1"><span class="command">have</span></span> rew<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1V</span> <span class="main">=</span> <span class="skolem">c1</span><span class="main">#</span><span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> irange R0def' MWLfSteps_det.fork <span class="keyword1"><span class="command">have</span></span> F2step<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">F2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c1'</span><span class="main">#</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      
      <span class="keyword1"><span class="command">from</span></span> R0def' USdB_comp_head_tail <span class="keyword1"><span class="command">have</span></span> conclpart<span class="main">:</span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">c1</span><span class="main">#</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">c1'</span><span class="main">#</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">#</span><span class="skolem">V'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
      <span class="keyword1"><span class="command">with</span></span> irange rew inR0 F1step dequal R0def' F2step
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c1V'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">F2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">c1V'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">(</span><span class="skolem">c1V</span><span class="main">,</span><span class="bound">c1V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">c1V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">c1V'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
     
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>
  
  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Compositionality_If<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dind_or_branchesrelated<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">b'</span> <span class="main">∨</span> <span class="main">[</span><span class="free">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c2</span><span class="main">]</span> <span class="main">∨</span> <span class="main">[</span><span class="free">c1'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c2'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> branch1related<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c1'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> branch2related<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c2'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="keyword1">if</span> <span class="free">b'</span> <span class="keyword1">then</span> <span class="free">c1'</span> <span class="keyword1">else</span> <span class="free">c2'</span> <span class="keyword1">fi</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">I1</span><span class="main">,</span><span class="bound">I2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span>
    <span class="bound">I1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="bound">c1</span> <span class="keyword1">else</span> <span class="bound">c2</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">I2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="bound">b'</span> <span class="keyword1">then</span> <span class="bound">c1'</span> <span class="keyword1">else</span> <span class="bound">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span>
    <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">b'</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">I1</span><span class="main">,</span><span class="bound">I2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span>
    <span class="bound">I1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="bound">c1</span> <span class="keyword1">else</span> <span class="bound">c2</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">I2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="bound">b'</span> <span class="keyword1">then</span> <span class="bound">c1'</span> <span class="keyword1">else</span> <span class="bound">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span>
    <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2'</span><span class="main">]</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> <span class="main">∨</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2'</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> dind_or_branchesrelated branch1related branch2related
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">if</span> <span class="free">b'</span> <span class="keyword1">then</span> <span class="free">c1'</span> <span class="keyword1">else</span> <span class="free">c2'</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def R1_def R2_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> uptoR0<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> USdBsym d_indistinguishable_sym
        <span class="keyword1"><span class="command">have</span></span> symR1<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R1_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> USdBsym 
        <span class="keyword1"><span class="command">have</span></span> symR2<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
        
        <span class="keyword1"><span class="command">from</span></span> symR1 symR2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I1</span> <span class="skolem">I2</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">I1</span> <span class="main">=</span> length <span class="skolem">I2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def R1_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I1</span> <span class="skolem">I2</span> <span class="skolem">RS</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">I1</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> I1step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">I1</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> inR1case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
            
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R1def'<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">I1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span> <span class="keyword1">fi</span><span class="main">]</span> 
              <span class="main">∧</span> <span class="skolem">I2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span>
              <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">b'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="comment1">― ‹get the two different cases True and False from semantics:›</span>
            <span class="keyword1"><span class="command">from</span></span> irange R1def' I1step <span class="keyword1"><span class="command">have</span></span> case_distinction<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True <span class="main">∨</span>
              <span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
              <span class="comment1">― ‹Case 1: b evaluates to True›</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> bevalT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> irange bevalT I1step R1def' RSassump <span class="keyword1"><span class="command">have</span></span> memeq<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
                             
              <span class="keyword1"><span class="command">from</span></span> bevalT R1def' dequal <span class="keyword1"><span class="command">have</span></span> b'evalT<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def<span class="main">)</span>

              <span class="keyword1"><span class="command">hence</span></span> I2step_case1<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.iftrue<span class="main">)</span>
              
              <span class="keyword1"><span class="command">with</span></span> irange dequal RSassump memeq R1def' 
              <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">moreover</span></span>
              <span class="comment1">― ‹Case 2: b evaluates to False›</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> bevalF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> irange bevalF I1step R1def' RSassump <span class="keyword1"><span class="command">have</span></span> memeq<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">m2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
                          
              <span class="keyword1"><span class="command">from</span></span> bevalF R1def' dequal <span class="keyword1"><span class="command">have</span></span> b'evalF<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def<span class="main">)</span>

              <span class="keyword1"><span class="command">hence</span></span> I2step_case1<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if</span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.iffalse<span class="main">)</span>
          
              <span class="keyword1"><span class="command">with</span></span> irange dequal RSassump memeq R1def' 
              <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
            

        <span class="keyword1"><span class="command">have</span></span> inR2case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I1</span><span class="main">,</span><span class="skolem">I2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R2def'<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">I1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span> <span class="keyword1">fi</span><span class="main">]</span> 
              <span class="main">∧</span> <span class="skolem">I2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if</span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> <span class="main">∧</span>
              <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span> </sub><span class="hidden">⇙</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∨</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
              <span class="comment1">― ‹get the two different cases for the result from semantics:›</span>
            <span class="keyword1"><span class="command">from</span></span> irange R2def' I1step <span class="keyword1"><span class="command">have</span></span> case_distinction_left<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> <span class="main">∨</span> <span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> irange R2def' dequal <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">RS'</span></span> <span class="keyword2"><span class="keyword">where</span></span> I2step<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>
              <span class="main">∧</span> <span class="main">(</span><span class="skolem">RS'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∨</span> <span class="skolem">RS'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLfSteps_det.iffalse MWLfSteps_det.iftrue<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBtrans <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">;</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBtrans <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">;</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBsym <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBtrans <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">;</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span>    
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBsym <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">from</span></span> USdBtrans <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">;</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">⟧</span> 
              <span class="main">⟹</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span>  
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>            
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> 
             <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> inR0 inR1case inR2case <span class="keyword3"><span class="command">show</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">I2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
       
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>
  
  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Compositionality_While<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">b'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bodyrelated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c'</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="keyword1">while</span> <span class="free">b'</span> <span class="keyword1">do</span> <span class="free">c'</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">S1</span><span class="main">,</span><span class="bound">S2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span> <span class="bound">b</span> <span class="bound">b'</span> <span class="bound">W</span> <span class="bound">W'</span><span class="main">.</span>
    <span class="bound">S1</span> <span class="main">=</span> <span class="main">(</span><span class="bound">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="bound">b</span> <span class="keyword1">do</span> <span class="bound">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">W</span> <span class="main">∧</span> 
    <span class="bound">S2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="bound">b'</span> <span class="keyword1">do</span> <span class="bound">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="bound">W'</span> <span class="main">∧</span>
    <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">W'</span> <span class="main">∧</span> <span class="bound">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">b'</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">W1</span><span class="main">,</span><span class="bound">W2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span> 
    <span class="bound">W1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="bound">b</span> <span class="keyword1">do</span> <span class="bound">c1</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">W2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="bound">b'</span> <span class="keyword1">do</span> <span class="bound">c1'</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span>
    <span class="main">[</span><span class="bound">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">b'</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> dind bodyrelated 
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">while</span> <span class="free">b'</span> <span class="keyword1">do</span> <span class="free">c'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def R1_def R2_def<span class="main">)</span>
   
  <span class="keyword1"><span class="command">have</span></span> uptoR0<span class="main">:</span> <span class="quoted"><span class="quoted">"d_Bisimulation_Up_To_USdB <span class="free">d</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_Bisimulation_Up_To_USdB_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> USdBsym d_indistinguishable_sym <span class="keyword1"><span class="command">have</span></span> symR1<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R1_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> USdBsym d_indistinguishable_sym <span class="keyword1"><span class="command">have</span></span> symR2<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> symR1 symR2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def R0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W1</span> <span class="skolem">W2</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W1</span><span class="main">,</span><span class="skolem">W2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> USdBeqlen <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">W1</span> <span class="main">=</span> length <span class="skolem">W2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def R1_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">W1</span> <span class="skolem">W2</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">RS</span> <span class="skolem">m2</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W1</span><span class="main">,</span><span class="skolem">W2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">W1</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> W1step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">W1</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">RS</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m1'</span>"</span></span>
       
        <span class="keyword1"><span class="command">from</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W1</span><span class="main">,</span><span class="skolem">W2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>

            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">V'</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> R1def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">V</span> 
              <span class="main">∧</span> <span class="skolem">W2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">V'</span> <span class="main">∧</span> 
              <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V'</span> <span class="main">∧</span> <span class="skolem">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">b'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> irange <span class="keyword1"><span class="command">have</span></span> case_distinction1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span>
              <span class="main">(</span><span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> 
              <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
              <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword3"><span class="command">assume</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
                  <span class="comment1">― ‹get the two different sub-cases:›</span>
                <span class="keyword1"><span class="command">with</span></span> R1def' W1step <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> case_distinction<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>
                  <span class="main">∨</span> <span class="skolem">RS</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span>
                  <span class="comment1">― ‹Case 1: first command terminates›</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span> 

                  <span class="keyword1"><span class="command">from</span></span> USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> StepAssump R1def' 
                    USdB_Strong_d_Bisimulation dequal
                    strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> i0
                  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">W'</span> <span class="main">=</span> <span class="main">[]</span> 
                    <span class="main">∧</span> <span class="main">[]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

                  <span class="keyword1"><span class="command">with</span></span> c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart1<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> 
                    <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.seq1<span class="main">)</span>

                  <span class="keyword1"><span class="command">from</span></span> R1def' <span class="keyword1"><span class="command">have</span></span> conclpart2<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main">)</span>

                  <span class="keyword1"><span class="command">with</span></span> conclpart1 RSassump i0 R1def'
                  <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">moreover</span></span>
                  <span class="comment1">― ‹Case 2: first command does not terminate›</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span>"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
              
                  <span class="keyword1"><span class="command">from</span></span> StepAssump R1def' USdB_Strong_d_Bisimulation dequal
                    strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span> i0 
                  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span><span class="main">)</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">V''</span> <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
 
                  <span class="keyword1"><span class="command">with</span></span> USdBeqlen<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span><span class="main">#</span><span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3'</span></span> <span class="skolem"><span class="skolem">W'</span></span> 
                    <span class="keyword2"><span class="keyword">where</span></span> V''reason<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="skolem">c3'</span><span class="main">#</span><span class="skolem">W'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">V''</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
          
                  <span class="keyword1"><span class="command">with</span></span> c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart1<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> 
                    <span class="main">⟨</span><span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> 
                    <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.seq2<span class="main">)</span>

                  <span class="keyword1"><span class="command">from</span></span> V''reason 
                    c1c1'reason USdB_decomp_head_tail<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">c3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span><span class="main">]</span> 
                    USdB_Strong_d_Bisimulation
                  <span class="keyword1"><span class="command">have</span></span> c3aWinUSDB<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c3</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c3'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">W</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">W'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
                  <span class="keyword1"><span class="command">with</span></span> R1def' <span class="keyword1"><span class="command">have</span></span> conclpart2<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">W</span><span class="main">,</span>
                       <span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def<span class="main">)</span>

                  <span class="keyword1"><span class="command">with</span></span> i0 RSassump R1def' V''reason conclpart1 
                  <span class="keyword1"><span class="command">have</span></span> case2_concl<span class="main">:</span>
                    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">}</span></span> 
                <span class="keyword1"><span class="command">ultimately</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟧</span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
                <span class="keyword3"><span class="command">assume</span></span> Vnonempt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> inot0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

                <span class="keyword1"><span class="command">with</span></span> Vnonempt irange R1def' <span class="keyword1"><span class="command">have</span></span> i1range<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                <span class="keyword1"><span class="command">from</span></span> inot0 R1def' <span class="keyword1"><span class="command">have</span></span> W1ieq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">V</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">from</span></span> inot0 R1def' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">V'</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
                <span class="keyword1"><span class="command">with</span></span> W1ieq R1def' W1step i1range dequal 
                  USdB_Strong_d_Bisimulation
                  strongdB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"USdB <span class="free">d</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span> 
                <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>          
              <span class="keyword3"><span class="command">assume</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W1</span><span class="main">,</span><span class="skolem">W2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>

              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R2def'<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">W2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span>
                <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">b</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="skolem">b'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R2_def<span class="main">)</span>
                <span class="comment1">― ‹get the two different cases:›</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">from</span></span> irange R2def' W1step <span class="keyword1"><span class="command">have</span></span> case_distinction<span class="main">:</span>
                <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True <span class="main">∨</span>
                <span class="skolem">RS</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
                <span class="comment1">― ‹Case 1: b evaluates to True›</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> bevalT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> irange bevalT W1step R2def' RSassump <span class="keyword1"><span class="command">have</span></span> memeq<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
          
                <span class="keyword1"><span class="command">from</span></span> bevalT R2def' dequal <span class="keyword1"><span class="command">have</span></span> b'evalT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def<span class="main">)</span>

                <span class="keyword1"><span class="command">hence</span></span> W2step_case1<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> 
                    <span class="main">→</span> <span class="main">⟨</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.whiletrue<span class="main">)</span>

                <span class="keyword1"><span class="command">from</span></span> trivialpair_in_USdB R2def' <span class="keyword1"><span class="command">have</span></span> inWR2<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                     <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def<span class="main">)</span>

                <span class="keyword1"><span class="command">with</span></span> irange dequal RSassump memeq W2step_case1 R2def' 
                <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">moreover</span></span>
                <span class="comment1">― ‹Case 2: b evaluates to False›</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">assume</span></span> bevalF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> RSassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                <span class="keyword1"><span class="command">from</span></span> irange bevalF W1step R2def' RSassump <span class="keyword1"><span class="command">have</span></span> memeq<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> MWLf_semantics.MWLfSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>

                <span class="keyword1"><span class="command">from</span></span> bevalF R2def' dequal <span class="keyword1"><span class="command">have</span></span> b'equalF<span class="main">:</span> 
                  <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def<span class="main">)</span>
          
                <span class="keyword1"><span class="command">hence</span></span> W2step_case2<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while</span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="main">[]</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLfSteps_det.whilefalse<span class="main">)</span>
          
                <span class="keyword1"><span class="command">with</span></span> trivialpair_in_USdB irange dequal RSassump 
                  memeq R2def' 
                <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">RS'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">W2</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→</span> <span class="main">⟨</span><span class="bound">RS'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">RS</span><span class="main">,</span><span class="bound">RS'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∨</span> <span class="skolem">RS</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">RS'</span><span class="main">)</span>
                <span class="main">∧</span> <span class="skolem">m2</span> =<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="bound">m2'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
                  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">⊆</span> ≈<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main">)</span>
  
  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Type_System">
<div class="head">
<h1>Theory Type_System</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Type_System
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Language_Composition">Language_Composition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> Type_System <span class="main">=</span> 
  SSP<span class="main">?</span> <span class="main">:</span> Strongly_Secure_Programs <span class="quoted"><span class="quoted">"<span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">DA</span>"</span></span> 
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>
<span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span>
<span class="free">AssignSideCondition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">WhileSideCondition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">IfSideCondition</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span> semAssignSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">AssignSideCondition</span> <span class="free">x</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">DA</span> <span class="free">x</span></sub><span class="hidden">⇙</span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> semWhileSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">WhileSideCondition</span> <span class="free">e</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> semIfSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IfSideCondition</span> <span class="free">e</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="free">e</span> <span class="main">∨</span> <span class="main">[</span><span class="free">c1</span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free">c2</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹Security typing rules for the language commands›</span>
<span class="keyword1"><span class="command">inductive</span></span>
<span class="entity">ComSecTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">ComSecTypingL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLfCom list <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
skip<span class="main">:</span> <span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="keyword1">skip</span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">AssignSideCondition</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
Fork<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> ⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="keyword1">fork</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span> <span class="main">|</span>
Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free">WhileSideCondition</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟧</span> 
     <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="keyword1">while</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span>"</span></span> <span class="main">|</span>
If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">;</span> <span class="free">IfSideCondition</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span>"</span></span> <span class="main">|</span>
Parallel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> ⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">⟧</span> <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> parallel_cases<span class="main">:</span>
<span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span> <span class="free">V</span>"</span></span>

<span class="comment1">― ‹soundness proof of abstract type system›</span>
<span class="keyword1"><span class="command">theorem</span></span> ComSecTyping_single_is_sound<span class="main">:</span>
<span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span> <span class="free">c</span> <span class="main">⟹</span> Strongly_Secure <span class="main">[</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ComSecTyping_ComSecTypingL.inducts<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
    <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Strongly_Secure"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strongly_Secure_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Strongly_Secure_Skip<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Strongly_Secure_Assign semAssignSC<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Compositionality_Fork<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Compositionality_Seq<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Compositionality_While semWhileSC<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> Compositionality_If semIfSC<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> parallel_composition<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ComSecTyping_list_is_sound<span class="main">:</span>
<span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span> <span class="free">V</span> <span class="main">⟹</span> Strongly_Secure <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ComSecTyping_single_is_sound Strongly_Secure_def 
  parallel_composition parallel_cases<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Type_System_example">
<div class="head">
<h1>Theory Type_System_example</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: Strong-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Type_System_example
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Type_System">Type_System</a> <a href="#Expr">Expr</a> <a href="#Domain_example">Domain_example</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹When interpreting, we have to instantiate the type for domains.›</span> 
<span class="comment1">― ‹As an example, we take a type containing 'low' and 'high' as domains.›</span>


<span class="keyword1"><span class="command">consts</span></span> DA <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span>Dom<span class="main">)</span> DomainAssignment"</span></span>
<span class="keyword1"><span class="command">consts</span></span> BMap <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_indistinguishable'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> Dom
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≡⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">e1</span></span></span> ≡<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> 
  <span class="main">≡</span> Strongly_Secure_Programs.d_indistinguishable ExprEval DA <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">relatedbyUSdB'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom list 
  <span class="main">⇒</span> Dom <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">≈⇘</span>_<span class="keyword1">⇙</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">V</span></span></span> ≈<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">d</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∈</span> Strong_Security.USdB 
  <span class="main">(</span>MWLf_semantics.MWLfSteps_det ExprEval BMap<span class="main">)</span> DA <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="comment1">― ‹Security typing rules for expressions - will be part of a side condition›</span>
<span class="keyword1"><span class="command">inductive</span></span> 
<span class="entity">ExprSecTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> Dom set <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> _ <span class="keyword1">:</span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
Consts<span class="main">:</span> <span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
Vars<span class="main">:</span> <span class="quoted"><span class="quoted">"⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">{</span>DA <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
Ops<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">.</span> ⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dl</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>
  <span class="main">⟹</span> ⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dl</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synAssignSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synAssignSC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span>⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> <span class="bound">D</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main">≤</span> DA <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synWhileSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synWhileSC</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span>⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> <span class="bound">D</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">∈</span><span class="bound">D</span><span class="main">.</span> <span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synIfSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom 
  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLfCom <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synIfSC</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> ≡<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">]</span> ≈<span class="hidden">⇘</span><sub><span class="bound">d</span></sub><span class="hidden">⇙</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Type_System_example-ExprTypable_with_smallerD_implies_d_indistinguishable"><span class="command">lemma</span></span> ExprTypable_with_smallerD_implies_d_indistinguishable<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> ⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="free">e</span> <span class="main">:</span> <span class="free">D'</span><span class="main">;</span> <span class="main">∀</span><span class="bound">d'</span> <span class="main">∈</span> <span class="free">D'</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">e</span> ≡<span class="hidden">⇘</span><sub><span class="free">d</span></sub><span class="hidden">⇙</span> <span class="free">e</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ExprSecTyping.induct<span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strongly_Secure_Programs.d_indistinguishable_def 
    Strong_Security.d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">dl</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">arglist</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'val</span> list <span class="main">⇒</span> <span class="tfree">'val</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> State"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m2</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> State"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> ⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span> <span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span> <span class="main">:</span> <span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">d'</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> DA <span class="bound">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">m'</span> <span class="bound">x</span><span class="main">)</span> 
    <span class="main">⟶</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">m</span> <span class="main">=</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> <span class="bound">D</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">∈</span><span class="bound">D</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eqstate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> DA <span class="bound">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> <span class="skolem">m1</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">m2</span> <span class="bound">x</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> smaller <span class="keyword1"><span class="command">have</span></span> irangesubst<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> <span class="main">∀</span><span class="bound">d'</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
  <span class="keyword1"><span class="command">with</span></span> eqstate main <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">m1</span> 
    <span class="main">=</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">m2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
 
  <span class="keyword1"><span class="command">hence</span></span> substmap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">arglist</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> substmap<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> Type_System_example<span class="main">:</span> Type_System <span class="quoted">ExprEval</span> <span class="quoted">BMap</span> <span class="quoted">DA</span>
  <span class="quoted">synAssignSC</span> <span class="quoted">synWhileSC</span> <span class="quoted">synIfSC</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> synAssignSC_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> ExprTypable_with_smallerD_implies_d_indistinguishable<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> synWhileSC_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> ExprTypable_with_smallerD_implies_d_indistinguishable<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> synIfSC_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>