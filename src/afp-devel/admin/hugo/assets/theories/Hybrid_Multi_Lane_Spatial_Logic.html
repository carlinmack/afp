<div id="NatInt">
<div class="head">
<h1>Theory NatInt</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      NatInt.thy
    Author:     Sven Linker, University of Liverpool

Intervals based on natural numbers. Defines a 
bottom element (empty set), infimum (set intersection),
partial order (subset relation), cardinality (set cardinality).

The union of intervals i and j can only be created, if they are consecutive, i.e.,
max i +1 = min j (or vice versa). To express consecutiveness, we employ the 
predicate consec.

Also contains a "chopping" predicate N_Chop(i,j,k): i can be divided into
consecutive intervals j and k.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Discrete Intervals based on Natural Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define a type of intervals based on the natural numbers. To that 
end, we employ standard operators of Isabelle, but in addition prove some
structural properties of the intervals. In particular, we show that this type
constitutes a meet-semilattice with a bottom element and equality.

Furthermore, we show that this semilattice allows for a constrained join, i.e.,
the union of two intervals is defined, if either one of them is empty, or they are
consecutive. Finally, we define the notion of \emph{chopping} an interval into
two consecutive subintervals.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> NatInt
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A discrete interval is a set of consecutive natural numbers, or the empty 
set.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> nat_int <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_nat_int

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic properties of discrete intervals.›</span></span>
  
<span class="keyword1"><span class="command">locale</span></span> nat_int 
<span class="keyword1"><span class="command">interpretation</span></span> nat_int_class<span class="main">?</span><span class="main">:</span> nat_int <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> nat_int
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="NatInt-un_consec_seq"><span class="command">lemma</span></span> un_consec_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span><span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="free">l</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">l</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-int_conseq_seq"><span class="command">lemma</span></span> int_conseq_seq<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="free">l</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="NatInt-empty_type"><span class="command">lemma</span></span> empty_type<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">S</span> <span class="main">.</span> <span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span> nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-inter_result"><span class="command">lemma</span></span> inter_result<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span><span class="main">.</span> 
         <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span><span class="main">.</span> 
           <span class="bound">x</span> <span class="main">∩</span> <span class="bound">y</span> <span class="main">∈</span><span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Int_atLeastAtMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
    
<span class="keyword1" id="NatInt-union_result"><span class="command">lemma</span></span> union_result<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span><span class="main">.</span> 
         <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span>  <span class="main">}</span><span class="main">.</span> 
           <span class="bound">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> Max <span class="bound">x</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> Min <span class="bound">y</span> 
            <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span> <span class="main">∈</span><span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span>  <span class="main">}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">)</span> "</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> y_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>    
  <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span>   Max <span class="skolem">x</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> Min <span class="skolem">y</span> 
            <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">∪</span>  <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> pre<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> Max <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> Min <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_int<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> y_int<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  x_def y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>      
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ya</span> <span class="skolem">yb</span> <span class="skolem">xa</span> <span class="skolem">xb</span>
      <span class="keyword3"><span class="command">assume</span></span> y_prop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ya</span> <span class="main">≤</span> <span class="skolem">yb</span> <span class="main">∧</span> <span class="main">{</span><span class="skolem">ya</span><span class="main">..</span><span class="skolem">yb</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_prop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≤</span> <span class="skolem">xb</span> <span class="main">∧</span> <span class="main">{</span><span class="skolem">xa</span><span class="main">..</span><span class="skolem">xb</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>          
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> upper_x<span class="main">:</span><span class="quoted"><span class="quoted">"Max <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">xb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lower_y<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">ya</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Max_eq_iff Min_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> upper_x <span class="keyword2"><span class="keyword">and</span></span> lower_y <span class="keyword2"><span class="keyword">and</span></span> pre <span class="keyword1"><span class="command">have</span></span> upper_eq_lower<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xb</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">ya</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span> <span class="main">{</span><span class="skolem">xb</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span> <span class="skolem">yb</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">xa</span><span class="main">..</span><span class="skolem">yb</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> un_consec_seq upper_eq_lower x_prop y_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>      
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="bound">S</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> x_int y_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  

<span class="keyword1" id="NatInt-union_empty_result1"><span class="command">lemma</span></span> union_empty_result1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span><span class="main">.</span>
                                  <span class="bound">i</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   

<span class="keyword1" id="NatInt-union_empty_result2"><span class="command">lemma</span></span> union_empty_result2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span>  <span class="main">}</span><span class="main">.</span>
                                  <span class="main">{}</span> <span class="main">∪</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span>  <span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
<span class="keyword1" id="NatInt-finite"><span class="command">lemma</span></span> finite<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span> <span class="main">.</span> <span class="main">(</span>finite <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NatInt-not_empty_means_seq"><span class="command">lemma</span></span> not_empty_means_seq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span> <span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">{}</span>
                            <span class="main">⟶</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> atLeastatMost_empty_iff 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The empty set is the bottom element of the type. The infimum/meet of 
the semilattice is set intersection. The order is given by the subset relation.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat_int <span class="main">::</span> <span class="quoted">bot</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_nat_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Set.empty</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat_int <span class="main">::</span>  <span class="quoted">inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_nat_int</span>  <span class="main">::</span><span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> nat_int"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Set.inter</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat_int <span class="main">::</span> <span class="quoted"><span class="quoted">"order_bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_nat_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Set.subset_eq</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_nat_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Set.subset</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">::</span><span class="quoted">nat_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_nat_int.rep_eq less_le_not_le less_nat_int.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_eq_nat_int.rep_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_eq_nat_int.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_nat_int_inject less_eq_nat_int.rep_eq <span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  less_eq_nat_int.rep_eq 
    <span class="keyword1"><span class="command">using</span></span> bot_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>  

<span class="keyword1"><span class="command">instantiation</span></span> nat_int <span class="main">::</span>  <span class="quoted"><span class="quoted">"semilattice_inf"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="skolem">i</span> <span class="main">≤</span> inf <span class="skolem">j</span> <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_nat_int.rep_eq less_eq_nat_int.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" inf <span class="skolem">i</span>   <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_nat_int.rep_eq less_eq_nat_int.rep_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">i</span>  <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_nat_int.rep_eq less_eq_nat_int.rep_eq<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>      
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat_int<span class="main">::</span> <span class="quoted"><span class="quoted">"equal"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">equal_nat_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span>  
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">equal_nat_int</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>  <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted">nat_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" equal_class.equal <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> equal_nat_int_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
  
<span class="keyword1"><span class="command">context</span></span> nat_int 
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subseteq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int<span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 30<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> "</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∅</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∅</span></span> <span class="main">≡</span> bot"</span></span>
    
<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The union of two intervals is only defined, if it is also
a discrete interval.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> nat_int"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main"><span class="free">⊔</span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> Abs_nat_int <span class="main">(</span>Rep_nat_int <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∪</span> Rep_nat_int <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Non-empty intervals contain a minimal and maximal element. 
Two non-empty intervals \(i\) and \(j\) are 
consecutive, if the minimum of \(j\) is the successor of the
maximum of \(i\).
Furthermore, the interval \(i\) can be chopped into the intervals \(j\)
and \(k\), if the union of \(j\) and \(k\) equals \(i\), and if \(j\)
and \(k\) are not-empty, they must be consecutive. Finally, we define
the cardinality of discrete intervals by lifting the cardinality of
sets. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> maximum_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟹</span> <span class="free">maximum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span>   Max <span class="main">(</span>Rep_nat_int <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span> 
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> minimum_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟹</span> <span class="free">minimum</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> Min <span class="main">(</span>Rep_nat_int <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int<span class="main">⇒</span>nat_int <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">consec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">≠</span><span class="main">∅</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="main">(</span>maximum<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N_Chop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">N'_Chop'(</span>_<span class="keyword1">,</span>_<span class="keyword1">,</span>_<span class="keyword1">')</span>"</span> 51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> nchop_def <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">N_Chop(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>   <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>  <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> consec <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> card' <span class="main">::</span><span class="quoted"><span class="quoted">"nat_int <span class="main">⇒</span> nat"</span></span>  <span class="main">(</span> <span class="quoted">"<span class="keyword1">|</span>_<span class="keyword1">|</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">card</span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For convenience, we also lift the membership relation and its negation
to discrete intervals.›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> el<span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Set.member"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> not_in <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat_int <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∉</b></span>"</span> 40<span class="main">)</span>  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Set.not_member</span> <span class="keyword1"><span class="command">.</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> nat_int.el.rep_eq nat_int.not_in.rep_eq nat_int.card'.rep_eq

<span class="keyword1"><span class="command">context</span></span> nat_int 
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="NatInt-in_not_in_iff1"><span class="command">lemma</span></span> in_not_in_iff1 <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">n</span><span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="NatInt-in_not_in_iff2"><span class="command">lemma</span></span> in_not_in_iff2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    
<span class="keyword1" id="NatInt-rep_non_empty_means_seq"><span class="command">lemma</span></span> rep_non_empty_means_seq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span><span class="main">∅</span> 
                                <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span> <span class="main">=</span><span class="main">(</span> Rep_nat_int <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int Rep_nat_int_inject bot_nat_int.rep_eq nat_int.not_empty_means_seq<span class="main">)</span>
  
<span class="keyword1" id="NatInt-non_empty_max"><span class="command">lemma</span></span> non_empty_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">.</span> maximum<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-non_empty_min"><span class="command">lemma</span></span> non_empty_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main">.</span> minimum<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-minimum_in"><span class="command">lemma</span></span> minimum_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> minimum <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_in atLeastatMost_empty_iff2 finite_atLeastAtMost minimum_def
      el.rep_eq rep_non_empty_means_seq<span class="main">)</span>
    
<span class="keyword1" id="NatInt-maximum_in"><span class="command">lemma</span></span> maximum_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> maximum <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_in atLeastatMost_empty_iff2 finite_atLeastAtMost maximum_def 
      el.rep_eq rep_non_empty_means_seq<span class="main">)</span>
    
<span class="keyword1" id="NatInt-non_empty_elem_in"><span class="command">lemma</span></span> non_empty_elem_in<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm Rep_nat_int_inverse all_not_in_conv el.rep_eq bot_nat_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse assm el.rep_eq bot_nat_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-leq_nat_non_empty"><span class="command">lemma</span></span> leq_nat_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> atLeastatMost_empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span>  <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span>  <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inject empty_type non_empty bot_nat_int_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_nat_int.abs_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-leq_max_sup"><span class="command">lemma</span></span> leq_max_sup<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> Max <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Max_eq_iff<span class="main">)</span>
    
<span class="keyword1" id="NatInt-leq_min_inf"><span class="command">lemma</span></span> leq_min_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> Min <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Min_eq_iff<span class="main">)</span>
    
<span class="keyword1" id="NatInt-leq_max_sup'"><span class="command">lemma</span></span> leq_max_sup'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> maximum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leq_nat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"maximum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> maximum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_type <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"Max <span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> max <span class="keyword1"><span class="command">have</span></span> simp_max<span class="main">:</span><span class="quoted"><span class="quoted">"maximum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leq_max_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> simp_max <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maximum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-leq_min_inf'"><span class="command">lemma</span></span> leq_min_inf'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> minimum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leq_nat_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"minimum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Min<span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  minimum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> in_type <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"Min <span class="main">(</span>Rep_nat_int <span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Min <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> min <span class="keyword1"><span class="command">have</span></span> simp_min<span class="main">:</span><span class="quoted"><span class="quoted">"minimum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Min <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leq_min_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> simp_min <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"minimum<span class="main">(</span>Abs_nat_int<span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-in_refl"><span class="command">lemma</span></span> in_refl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>∈</b></span> Abs_nat_int <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Abs_nat_int <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse el_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-in_singleton"><span class="command">lemma</span></span> in_singleton<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Abs_nat_int<span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">⟶</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Abs_nat_int<span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">=</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse el_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algebraic properties of intersection and union.›</span></span>
  
<span class="keyword1" id="NatInt-inter_empty1"><span class="command">lemma</span></span> inter_empty1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">::</span>nat_int<span class="main">)</span> <span class="main">⊓</span> <span class="main">∅</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Rep_nat_int_inject inf_nat_int.rep_eq bot_nat_int.abs_eq bot_nat_int.rep_eq 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    
<span class="keyword1" id="NatInt-inter_empty2"><span class="command">lemma</span></span> inter_empty2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span>nat_int<span class="main">)</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute nat_int.inter_empty1<span class="main">)</span>
        
<span class="keyword1" id="NatInt-un_empty_absorb1"><span class="command">lemma</span></span> un_empty_absorb1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊔</span> <span class="main">∅</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span>  Abs_nat_int_inverse Rep_nat_int_inverse union_def empty_type bot_nat_int.rep_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-un_empty_absorb2"><span class="command">lemma</span></span> un_empty_absorb2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="main">⊔</span> <span class="free">i</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span>  Abs_nat_int_inverse Rep_nat_int_inverse union_def empty_type bot_nat_int.rep_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Most properties of the union of two intervals depends on them being consectuive,
to ensure that their union exists.›</span></span>

<span class="keyword1" id="NatInt-consec_un"><span class="command">lemma</span></span> consec_un<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">∉</span> Rep_nat_int<span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span> 
                  <span class="main">⟶</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span>  <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">∉</span>  Rep_nat_int <span class="free">i</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_nat_int <span class="main">(</span>Rep_nat_int <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> Abs_nat_int <span class="main">(</span>Rep_nat_int <span class="free">i</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Rep_nat_int_inverse union_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">na</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">na</span><span class="main">}</span> <span class="main">=</span> Rep_nat_int <span class="free">i</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> leq_max_sup leq_min_inf maximum_def minimum_def 
          rep_non_empty_means_seq un_consec_seq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 Abs_nat_int_inject Rep_nat_int not_in.rep_eq assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="NatInt-un_subset1"><span class="command">lemma</span></span> un_subset1<span class="main">:</span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span> <span class="main">=</span>  <span class="main">{</span>minimum <span class="free">i</span><span class="main">..</span> maximum <span class="free">j</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm nat_int.leq_max_sup nat_int.leq_min_inf nat_int.maximum_def 
        nat_int.minimum_def nat_int.rep_non_empty_means_seq nat_int.un_consec_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊑</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse Rep_nat_int 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_upper1 less_eq_nat_int.rep_eq mem_Collect_eq
        nat_int.union_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-un_subset2"><span class="command">lemma</span></span> un_subset2<span class="main">:</span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">j</span> <span class="main">⊑</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">∪</span> Rep_nat_int <span class="free">j</span> <span class="main">=</span>  <span class="main">{</span>minimum <span class="free">i</span><span class="main">..</span> maximum <span class="free">j</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm nat_int.leq_max_sup nat_int.leq_min_inf nat_int.maximum_def 
        nat_int.minimum_def nat_int.rep_non_empty_means_seq nat_int.un_consec_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">⊑</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse Rep_nat_int
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_upper2 less_eq_nat_int.rep_eq mem_Collect_eq
        nat_int.union_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1" id="NatInt-inter_distr1"><span class="command">lemma</span></span> inter_distr1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊓</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊓</span> <span class="free">k</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> consec_def
<span class="keyword1"><span class="command">proof</span></span>  
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">j</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊓</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊓</span> <span class="free">k</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> maximum <span class="bound">n</span> <span class="main">=</span> Max <span class="main">(</span>Rep_nat_int <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nat_int.maximum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">j</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm nat_int.maximum_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">=</span> Max <span class="main">(</span>Rep_nat_int <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maximum <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm nat_int.maximum_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">k</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Rep_nat_int <span class="free">j</span> <span class="main">∪</span> Rep_nat_int <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f2 Abs_nat_int_inverse Rep_nat_int assm nat_int.minimum_def 
        nat_int.union_def union_result 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse inf_nat_int.rep_eq inf_sup_distrib1 nat_int.union_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-inter_distr2"><span class="command">lemma</span></span> inter_distr2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊓</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">k</span> <span class="main">⊓</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_distr1 inf_commute<span class="main">)</span>
    
<span class="keyword1" id="NatInt-consec_un_not_elem1"><span class="command">lemma</span></span> consec_un_not_elem1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span><span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">⟶</span>  <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> un_subset1 less_eq_nat_int.rep_eq not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
<span class="keyword1" id="NatInt-consec_un_not_elem2"><span class="command">lemma</span></span> consec_un_not_elem2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span><span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">⟶</span>  <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  un_subset2 less_eq_nat_int.rep_eq not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NatInt-consec_un_element1"><span class="command">lemma</span></span> consec_un_element1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq nat_int.el.rep_eq nat_int.un_subset1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NatInt-consec_un_element2"><span class="command">lemma</span></span> consec_un_element2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq nat_int.el.rep_eq nat_int.un_subset2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NatInt-consec_lesser"><span class="command">lemma</span></span> consec_lesser<span class="main">:</span><span class="quoted"><span class="quoted">" consec <span class="free">i</span> <span class="free">j</span>  <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span>  
  <span class="keyword3"><span class="command">assume</span></span> assump<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> "</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> maximum <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹consec <span class="free">i</span> <span class="free">j</span>›</span></span> atLeastAtMost_iff leq_max_sup maximum_def consec_def
        el.rep_eq rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assump <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> minimum <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_le <span class="quoted"><span class="quoted">‹consec <span class="free">i</span> <span class="free">j</span>›</span></span> finite_atLeastAtMost minimum_def consec_def
        el.rep_eq rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> min <span class="keyword2"><span class="keyword">and</span></span> max <span class="keyword3"><span class="command">show</span></span> less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> One_nat_def Suc_le_lessD <span class="quoted"><span class="quoted">‹consec <span class="free">i</span> <span class="free">j</span>›</span></span> add.right_neutral add_Suc_right
      dual_order.trans leD leI consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_in_exclusive1"><span class="command">lemma</span></span> consec_in_exclusive1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.consec_lesser nat_int.in_not_in_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NatInt-consec_in_exclusive2"><span class="command">lemma</span></span> consec_in_exclusive2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> consec_in_exclusive1 el.rep_eq not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NatInt-consec_un_max"><span class="command">lemma</span></span> consec_un_max<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> maximum <span class="free">j</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_lesser <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> maximum <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm local.consec_def nat_int.maximum_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">≤</span> maximum <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_nat_int Rep_nat_int_inverse Un_iff assm atLeastAtMost_iff
        bot_nat_int.rep_eq less_imp_le_nat local.consec_def local.not_empty_means_seq 
        nat_int.consec_un nat_int.el.rep_eq nat_int.in_not_in_iff1 nat_int.leq_max_sup'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm atLeastAtMost_iff bot.extremum_uniqueI
        le_antisym local.consec_def nat_int.consec_un_element2 nat_int.el.rep_eq
        nat_int.leq_max_sup' nat_int.maximum_in nat_int.un_subset2 rep_non_empty_means_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_un_min"><span class="command">lemma</span></span> consec_un_min<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> minimum <span class="free">i</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_lesser <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&gt;</span> minimum <span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm local.consec_def nat_int.minimum_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">≥</span> minimum <span class="free">i</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> Rep_nat_int Rep_nat_int_inverse Un_iff assm atLeastAtMost_iff bot_nat_int.rep_eq
      less_imp_le_nat local.consec_def local.not_empty_means_seq nat_int.consec_un 
      nat_int.el.rep_eq nat_int.in_not_in_iff1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> leq_min_inf local.minimum_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI nat_int.consec_def nat_int.un_subset2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"minimum <span class="free">i</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> antisym assm atLeastAtMost_iff leq_min_inf nat_int.consec_def 
        nat_int.consec_un_element1 nat_int.el.rep_eq nat_int.minimum_def nat_int.minimum_in
        rep_non_empty_means_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_un_defined"><span class="command">lemma</span></span> consec_un_defined<span class="main">:</span>
  <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_nat_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NatInt-consec_un_min_max"><span class="command">lemma</span></span> consec_un_min_max<span class="main">:</span>
  <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> Rep_nat_int<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">j</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"minimum <span class="free">j</span> <span class="main">=</span> maximum <span class="free">i</span> <span class="main">+</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_int.consec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span>minimum <span class="free">i</span><span class="main">..</span>maximum <span class="free">i</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm nat_int.consec_def nat_int.leq_max_sup' nat_int.leq_min_inf'
        rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">j</span> <span class="main">=</span> <span class="main">{</span>minimum <span class="free">j</span><span class="main">..</span>maximum <span class="free">j</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm nat_int.consec_def nat_int.leq_max_sup' nat_int.leq_min_inf'
        rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">j</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse antisym assm bot.extremum i nat_int.consec_un_max
        nat_int.consec_un_min nat_int.leq_max_sup' nat_int.leq_min_inf' nat_int.un_subset1
        rep_non_empty_means_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_un_equality"><span class="command">lemma</span></span> consec_un_equality<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span> 
    <span class="main">⟶</span><span class="main">(</span> minimum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟶</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">assume</span></span> cons<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> endpoints<span class="main">:</span><span class="quoted"><span class="quoted">" minimum<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> minimum<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> maximum<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> maximum<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int<span class="main">(</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>minimum<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span><span class="main">..</span>maximum<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cons leq_max_sup leq_min_inf local.consec_def nat_int.consec_un_element2
        nat_int.maximum_def nat_int.minimum_def nat_int.non_empty_elem_in rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int<span class="main">(</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>minimum<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">..</span> maximum<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> endpoints <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int<span class="main">(</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>minimum<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">..</span> maximum<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cons leq_max_sup leq_min_inf nat_int.maximum_def nat_int.minimum_def
        rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_trans_lesser"><span class="command">lemma</span></span> consec_trans_lesser<span class="main">:</span>
  <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">assume</span></span> cons<span class="main">:</span><span class="quoted"><span class="quoted">" consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> assump<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> "</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">.</span> <span class="bound">k</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec_lesser assump cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> m_greater<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cons maximum_in consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assump cons consec_def dual_order.strict_trans nat_int.consec_lesser
        nat_int.maximum_in<span class="main">)</span>      
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-consec_inter_empty"><span class="command">lemma</span></span> consec_inter_empty<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">⊓</span> <span class="free">j</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> bot <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> bot <span class="main">∧</span> maximum <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Rep_nat_int_inverse bot_nat_int_def inf_nat_int.rep_eq int_conseq_seq
        nat_int.leq_max_sup nat_int.leq_min_inf nat_int.maximum_def nat_int.minimum_def
        nat_int.rep_non_empty_means_seq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1" id="NatInt-consec_intermediate1"><span class="command">lemma</span></span> consec_intermediate1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">∧</span> consec <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> consec <span class="free">i</span> <span class="free">j</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">∧</span> consec <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> min_max_yz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">+</span><span class="main">1</span><span class="main">=</span>minimum <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">hence</span></span> min_max_xyz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">i</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> consec_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> min_y_yz<span class="main">:</span><span class="quoted"><span class="quoted">"minimum <span class="free">j</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm nat_int.consec_un_min<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> min_max_xy<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> min_max_xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> consec_x_y<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-consec_intermediate2"><span class="command">lemma</span></span> consec_intermediate2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span> <span class="main">⟶</span> consec <span class="free">j</span> <span class="free">k</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> min_max_yz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">i</span> <span class="main">+</span><span class="main">1</span><span class="main">=</span>minimum <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">hence</span></span> min_max_xyz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="main">(</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> consec_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> min_y_yz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm nat_int.consec_un_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min_max_xy<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> min_max_xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> consec_x_y<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-un_assoc"><span class="command">lemma</span></span> un_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> maximum <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_un_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_un_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span>  <span class="main">=</span> Abs_nat_int<span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">j</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm nat_int.consec_un_min_max<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">k</span> <span class="main">=</span> Abs_nat_int<span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">k</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span> Rep_nat_int_inverse antisym assm bot.extremum
        nat_int.consec_def nat_int.consec_un_min nat_int.consec_un_min_max nat_int.un_subset1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span> <span class="main">=</span> Abs_nat_int<span class="main">{</span>minimum <span class="free">j</span> <span class="main">..</span> maximum <span class="free">k</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm nat_int.consec_un_min_max<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Abs_nat_int<span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">k</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span> Rep_nat_int_inverse antisym assm bot.extremum
        nat_int.consec_def nat_int.consec_un_max nat_int.consec_un_min_max nat_int.un_subset2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword2"><span class="keyword">and</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-consec_assoc1"><span class="command">lemma</span></span> consec_assoc1<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">∧</span> consec <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> consec <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span> <span class="main">∧</span> consec <span class="free">i</span> <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> min_max_yz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">+</span><span class="main">1</span><span class="main">=</span>minimum <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">hence</span></span> min_max_xyz<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">i</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> consec_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> min_y_yz<span class="main">:</span><span class="quoted"><span class="quoted">"minimum <span class="free">j</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm nat_int.consec_un_min<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> min_max_xy<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">i</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> min_max_xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> consec_x_y<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm _consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> max_y_xy<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec_lesser assm 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_int.consec_un_max<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> none_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> un_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">⊔</span><span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bot.extremum_uniqueI consec_x_y nat_int.un_subset2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="main">(</span><span class="free">i</span><span class="main">⊔</span><span class="free">j</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> min_max_yz max_y_xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"consec <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> max un_non_empty none_empty consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-consec_assoc2"><span class="command">lemma</span></span> consec_assoc2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="main">(</span><span class="free">i</span><span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span> <span class="main">⟶</span> consec <span class="free">i</span>  <span class="main">(</span><span class="free">j</span><span class="main">⊔</span> <span class="free">k</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span> <span class="main">∧</span> consec <span class="main">(</span><span class="free">i</span><span class="main">⊔</span> <span class="free">j</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> consec_y_z<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">j</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm consec_def consec_intermediate2 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> max_y_xy<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="free">j</span> <span class="main">=</span> maximum <span class="main">(</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm nat_int.consec_un_max<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> min_y_yz<span class="main">:</span><span class="quoted"><span class="quoted">"minimum <span class="free">j</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consec_y_z nat_int.consec_un_min<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> none_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> un_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">⊔</span><span class="free">k</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  bot_nat_int.rep_eq Rep_nat_int_inject consec_y_z  less_eq_nat_int.rep_eq
        un_subset1 subset_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"maximum <span class="main">(</span><span class="free">i</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="main">(</span><span class="free">j</span><span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm min_y_yz consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="main">(</span> <span class="free">j</span> <span class="main">⊔</span> <span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> max un_non_empty none_empty consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="NatInt-consec_assoc_mult"><span class="command">lemma</span></span> consec_assoc_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i2</span><span class="main">=</span><span class="main">∅</span><span class="main">∨</span> consec <span class="free">i1</span> <span class="free">i2</span> <span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i3</span> <span class="main">=</span><span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>consec <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i2</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">i4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i2</span><span class="main">=</span><span class="main">∅</span><span class="main">∨</span> consec <span class="free">i1</span> <span class="free">i2</span> <span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">i3</span> <span class="main">=</span><span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span> 
                <span class="main">∧</span> <span class="main">(</span>consec <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i2</span><span class="main">=</span><span class="main">∅</span><span class="main">∨</span> consec <span class="free">i1</span> <span class="free">i2</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i2</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">i4</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> empty2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> only_l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">=</span> <span class="free">i1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> un_empty_absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i3</span> <span class="main">=</span><span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i2</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">i4</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm bot_nat_int.rep_eq empty2 local.union_def 
          nat_int.consec_intermediate1 nat_int.un_assoc only_l1 sup_bot.left_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> consec12<span class="main">:</span><span class="quoted"><span class="quoted">" consec <span class="free">i1</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i3</span> <span class="main">=</span><span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i2</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">i4</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> empty3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i3</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> only_l4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i3</span> <span class="main">⊔</span> <span class="free">i4</span><span class="main">)</span> <span class="main">=</span> <span class="free">i4</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> un_empty_absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">i2</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> un_empty_absorb1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> only_l4<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span>  consec34<span class="main">:</span><span class="quoted"><span class="quoted">" consec <span class="free">i3</span> <span class="free">i4</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> consec12_3<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="main">(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="free">i3</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm consec34 consec_intermediate1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consec12 consec12_3 consec34 consec_intermediate2 un_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-card_subset_le"><span class="command">lemma</span></span> card_subset_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊑</span> <span class="free">i'</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">i'</span><span class="main">|</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_nat_int.rep_eq card_mono finite.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_atLeastAtMost 
      less_eq_nat_int.rep_eq local.card'.rep_eq rep_non_empty_means_seq<span class="main">)</span>
  
<span class="keyword1" id="NatInt-card_subset_less"><span class="command">lemma</span></span> card_subset_less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">::</span>nat_int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">i'</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span><span class="main">&lt;</span><span class="main">|</span><span class="free">i'</span><span class="main">|</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_nat_int.rep_eq finite.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_atLeastAtMost less_nat_int.rep_eq
      local.card'.rep_eq psubset_card_mono rep_non_empty_means_seq<span class="main">)</span> 
  
<span class="keyword1" id="NatInt-card_empty_zero"><span class="command">lemma</span></span> card_empty_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">∅</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse empty_type card'.rep_eq bot_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-card_non_empty_geq_one"><span class="command">lemma</span></span> card_non_empty_geq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟷</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse bot_nat_int.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Rep_nat_int <span class="free">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span>›</span></span> card_0_eq finite_atLeastAtMost gr0I rep_non_empty_means_seq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card'_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span><span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_empty_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-card_min_max"><span class="command">lemma</span></span> card_min_max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">(</span>maximum <span class="free">i</span> <span class="main">-</span> minimum <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span>minimum <span class="free">i</span> <span class="main">..</span> maximum <span class="free">i</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leq_max_sup leq_min_inf nat_int.maximum_def nat_int.minimum_def
        rep_non_empty_means_seq<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Rep_nat_int <span class="free">i</span><span class="main">)</span> <span class="main">=</span> maximum <span class="free">i</span> <span class="main">-</span> minimum <span class="free">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Rep_nat_int_inject assm bot_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">(</span>maximum <span class="free">i</span> <span class="main">-</span> minimum <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-card_un_add"><span class="command">lemma</span></span> card_un_add<span class="main">:</span> <span class="quoted"><span class="quoted">" consec <span class="free">i</span> <span class="free">j</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="free">j</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊓</span> <span class="free">j</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_inter_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_nat_int <span class="free">i</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>Rep_nat_int <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_nat_int.rep_eq inf_nat_int.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="main">(</span>Rep_nat_int <span class="free">i</span><span class="main">)</span><span class="main">∪</span><span class="main">(</span>Rep_nat_int <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>card<span class="main">(</span>Rep_nat_int <span class="free">i</span><span class="main">)</span><span class="main">+</span>card<span class="main">(</span>Rep_nat_int <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff add.commute add.left_neutral assm card.infinite card_Un_disjoint
        emptyE le_add1 le_antisym local.consec_def nat_int.card'.rep_eq
        nat_int.card_min_max nat_int.el.rep_eq nat_int.maximum_in nat_int.minimum_in<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="free">j</span><span class="main">|</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm nat_int.consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Rep_nat_int_inject bot_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">j</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 Rep_nat_int_inject bot_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 f1 Abs_nat_int_inverse Rep_nat_int 1 local.union_result
        nat_int.union_def nat_int_class.maximum_def nat_int_class.minimum_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NatInt-singleton"><span class="command">lemma</span></span> singleton<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_1_singletonE card'.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="NatInt-singleton2"><span class="command">lemma</span></span> singleton2<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_1_singletonE card'.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
    
<span class="keyword1" id="NatInt-card_seq"><span class="command">lemma</span></span> card_seq<span class="main">:</span><span class="quoted"><span class="quoted">"
  <span class="main">∀</span><span class="bound">i</span> <span class="main">.</span><span class="main">|</span><span class="bound">i</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span>Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> IB<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">|</span><span class="bound">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span>Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">n</span><span class="main">+</span><span class="main">(</span><span class="main">0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  card_non_empty_geq_one bot_nat_int.rep_eq  not_one_le_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">|</span><span class="bound">i</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⟶</span> Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">n</span><span class="main">+</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">|</span><span class="bound">i</span><span class="main">|</span> <span class="main">=</span> Suc <span class="skolem">x</span> <span class="main">⟶</span>
             Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="bound">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> assm_IS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">i</span><span class="main">|</span> <span class="main">=</span> Suc <span class="skolem">x</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm_IS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> nat_int.singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n'</span><span class="main">..</span> <span class="bound">n'</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> x_neq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span><span class="main">0</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> x_ge_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> assm_IS <span class="keyword1"><span class="command">have</span></span> i_is_seq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span> <span class="main">∧</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">m</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_le_mono card_non_empty_geq_one le0 rep_non_empty_means_seq<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> seq_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">n</span>  <span class="main">≤</span> <span class="skolem">m</span> <span class="main">∧</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..</span><span class="skolem">m</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> i_is_seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> n_le_m<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le seq_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm_IS card'.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_neq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  i_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="skolem">n</span><span class="main">..</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_i'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">i'</span><span class="main">|</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm_IS leq_nat_non_empty n_le_m
          nat_int_class.card_min_max nat_int_class.leq_max_sup' nat_int_class.leq_min_inf'
          seq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="skolem">i'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="skolem">i'</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="skolem">i'</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_neq_0 
        <span class="keyword1"><span class="command">using</span></span> card.empty card_i' card'.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm_IS card'.rep_eq seq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_le_m x_ge_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> seq_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="skolem">i</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="skolem">i</span> <span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">..</span> <span class="bound">n</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="NatInt-rep_single"><span class="command">lemma</span></span> rep_single<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>Abs_nat_int <span class="main">{</span><span class="free">m</span><span class="main">..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse<span class="main">)</span>

<span class="keyword1" id="NatInt-chop_empty_right"><span class="command">lemma</span></span> chop_empty_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">,</span><span class="main">∅</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> bot_nat_int.abs_eq nat_int.inter_empty1 nat_int.nchop_def nat_int.un_empty_absorb1
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-chop_empty_left"><span class="command">lemma</span></span> chop_empty_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="bound">i</span><span class="main">,</span> <span class="main">∅</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bot_nat_int.abs_eq nat_int.inter_empty2 nat_int.nchop_def nat_int.un_empty_absorb2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-chop_empty"><span class="command">lemma</span></span> chop_empty <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="main">∅</span><span class="main">,</span><span class="main">∅</span><span class="main">,</span><span class="main">∅</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_empty_left<span class="main">)</span>
    
<span class="keyword1" id="NatInt-chop_always_possible"><span class="command">lemma</span></span> chop_always_possible<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  chop_empty_right<span class="main">)</span>
    
<span class="keyword1" id="NatInt-chop_add1"><span class="command">lemma</span></span> chop_add1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span><span class="free">j</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="free">k</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_empty_zero card_un_add un_empty_absorb1 un_empty_absorb2 nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-chop_add2"><span class="command">lemma</span></span> chop_add2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm chop_empty_left nat_int.chop_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> x_eq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm nat_int.card_empty_zero nat_int.chop_empty_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> x_neq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> y_eq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm nat_int.card_empty_zero nat_int.chop_empty_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> y_neq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> rep_i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">..</span><span class="bound">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm card'.rep_eq card_seq x_neq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="free">i</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> rep_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> n_le<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> x_le<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_neq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span>  <span class="keyword2"><span class="keyword">where</span></span> j_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">j</span> <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="skolem">n</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> n_le <span class="keyword1"><span class="command">have</span></span> j_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">k</span> <span class="main">=</span>Abs_nat_int <span class="main">{</span><span class="skolem">n</span><span class="main">+</span><span class="free">x</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> x_le <span class="keyword1"><span class="command">have</span></span> k_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">+</span><span class="free">x</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">S</span><span class="main">=</span><span class="main">{}</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> consec<span class="main">:</span> <span class="quoted"><span class="quoted">"consec <span class="skolem">j</span> <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j_def k_def One_nat_def Suc_leI add.assoc diff_add n_le consec_def
              leq_max_sup' leq_min_inf' leq_nat_non_empty neq0_conv x_le x_neq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> union<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">j</span> <span class="main">⊔</span> <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse consec j_def k_def n_def n_le nat_int.consec_un_min_max
              nat_int.leq_max_sup' nat_int.leq_min_inf' x_le<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">⊓</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consec_inter_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> consec union disj nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> card_j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">j</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse j_def n_le card'.rep_eq x_neq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> card_k<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">k</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Abs_nat_int_inverse k_def x_le card'.rep_eq x_neq_0 y_neq_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">,</span><span class="skolem">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="skolem">j</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="skolem">k</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chop card_j card_k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">k</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-chop_single"><span class="command">lemma</span></span> chop_single<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="free">i</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">|</span><span class="free">j</span><span class="main">|</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="main">|</span><span class="free">k</span><span class="main">|</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chop_add1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
<span class="keyword1" id="NatInt-chop_leq_max"><span class="command">lemma</span></span> chop_leq_max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> Rep_nat_int <span class="free">i</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">≤</span> maximum <span class="free">j</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">∈</span> Rep_nat_int <span class="free">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff le_antisym less_imp_le_nat nat_int.consec_def nat_int.consec_lesser
      nat_int.consec_un nat_int.el.rep_eq nat_int.maximum_in nat_int.nchop_def
      nat_int.not_in.rep_eq<span class="main">)</span>
    
<span class="keyword1" id="NatInt-chop_geq_min"><span class="command">lemma</span></span> chop_geq_min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> Rep_nat_int <span class="free">i</span> <span class="main">∧</span> minimum <span class="free">k</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">∈</span> Rep_nat_int <span class="free">k</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff bot_nat_int.rep_eq equals0D leq_max_sup leq_min_inf 
      nat_int.consec_def nat_int.consec_un_max nat_int.maximum_def nat_int.minimum_def
      nat_int.nchop_def rep_non_empty_means_seq<span class="main">)</span>
     
<span class="keyword1" id="NatInt-chop_min"><span class="command">lemma</span></span> chop_min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> minimum <span class="free">i</span> <span class="main">=</span> minimum <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.consec_un_min nat_int.nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="NatInt-chop_max"><span class="command">lemma</span></span> chop_max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∧</span> consec <span class="free">j</span> <span class="free">k</span> <span class="main">⟶</span> maximum <span class="free">i</span> <span class="main">=</span> maximum <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.consec_un_max nat_int.nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="NatInt-chop_assoc1"><span class="command">lemma</span></span> chop_assoc1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">i1</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i2</span><span class="main">,</span><span class="free">i3</span><span class="main">,</span><span class="free">i4</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">i1</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i2</span><span class="main">,</span><span class="free">i3</span><span class="main">,</span><span class="free">i4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> chop_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">=</span>  <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i2</span>   <span class="main">∧</span>
        <span class="main">(</span><span class="free">i1</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>  <span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i1</span> <span class="free">i2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i1</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>  <span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i1</span> <span class="free">i2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm chop_def nat_int.chop_empty_left nat_int.un_empty_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i1</span> <span class="free">i2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm bot.extremum_uniqueI nat_int.chop_empty_right nat_int.nchop_def
            nat_int.un_empty_absorb2 nat_int.un_subset1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" consec <span class="free">i1</span> <span class="free">i2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> consec_i1_i2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span><span class="main">∅</span> <span class="main">∧</span> <span class="free">i2</span> <span class="main">≠</span><span class="main">∅</span> <span class="main">∧</span> maximum <span class="free">i1</span> <span class="main">+</span><span class="main">1</span> <span class="main">=</span> minimum <span class="free">i2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i3</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="free">i4</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> i3_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i3</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_empty_right nat_int.nchop_def nat_int.un_empty_absorb2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i4</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i3</span> <span class="free">i4</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> i4_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i4</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_empty_right nat_int.nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> consec_i3_i4<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i3</span> <span class="free">i4</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span> <span class="main">⊔</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i1</span><span class="main">,</span> <span class="free">i3</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹consec <span class="free">i1</span> <span class="free">i2</span>›</span></span> assm nat_int.consec_assoc1 nat_int.consec_intermediate1
                nat_int.nchop_def nat_int.un_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-chop_assoc2"><span class="command">lemma</span></span> chop_assoc2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">i1</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span><span class="main">,</span><span class="free">i3</span><span class="main">,</span><span class="free">i4</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">i1</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i1</span><span class="main">,</span><span class="free">i3</span><span class="main">,</span><span class="free">i4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i1</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>  <span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i1</span> <span class="free">i2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i1_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm nat_int.chop_empty_left nat_int.consec_un_not_elem1 nat_int.in_not_in_iff1
         nat_int.nchop_def nat_int.non_empty_elem_in nat_int.un_empty_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> consec <span class="free">i1</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> i2_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i2</span><span class="main">=</span><span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_empty_right nat_int.nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> consec_i1_i2<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i1</span> <span class="free">i2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i3</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>  <span class="free">i4</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> i3_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i3</span><span class="main">=</span><span class="main">∅</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_empty_left nat_int.nchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">i4</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> <span class="main">(</span> consec <span class="free">i3</span> <span class="free">i4</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> i4_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i4</span><span class="main">=</span><span class="main">∅</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assm nat_int.nchop_def nat_int.un_empty_absorb1 nat_int.un_empty_absorb2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> consec_i3_i4<span class="main">:</span><span class="quoted"><span class="quoted">"consec <span class="free">i3</span> <span class="free">i4</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span> <span class="free">i3</span><span class="main">,</span> <span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">)</span><span class="main">∧</span> <span class="keyword1">N_Chop(</span><span class="free">i4</span> <span class="main">⊔</span> <span class="free">i2</span><span class="main">,</span> <span class="free">i4</span><span class="main">,</span><span class="free">i2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm consec_i1_i2 nat_int.consec_assoc2 nat_int.consec_intermediate2
                nat_int.nchop_def nat_int.un_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NatInt-chop_subset1"><span class="command">lemma</span></span> chop_subset1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">j</span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_empty_right nat_int.nchop_def nat_int.un_subset1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NatInt-chop_subset2"><span class="command">lemma</span></span> chop_subset2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">k</span> <span class="main">⊑</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_empty_left nat_int.nchop_def nat_int.un_subset2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RealInt">
<div class="head">
<h1>Theory RealInt</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      RealInt.thy
    Author:     Sven Linker

Closed, non-empty intervals based on real numbers. Defines functions left, right
to refer to the left (resp. right) border of an interval. 

Defines a length function as the difference between left and right border
and a function to shift an interval by a real value (i.e., the value is added
to both borders).

Instantiates "order", as a notion of sub-intervals.

Also contains a "chopping" predicate R_Chop(r,s,t): r can be divided into
sub-intervals s and t.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Closed Real-valued Intervals›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define a type for real-valued intervals. It consists of pairs of real numbers, where
the first is lesser or equal to the second. Both endpoints are understood to be part of
the interval, i.e., the intervals are closed. This also implies that we do not
consider empty intervals. 

We define a measure on these intervals as the difference between the left and
right endpoint. In addition, we introduce a notion of shifting an interval by
a real value \(x\). Finally, an interval \(r\) can be chopped into \(s\) and
\(t\), if the left endpoint of \(r\) and \(s\) as well as the right endpoint
of \(r\) and \(t\) coincides, and if the right endpoint of \(s\) is 
the left endpoint of \(t\).
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> RealInt
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Real.html">HOL.Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">typedef</span></span> real_int <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_real_int
  
<span class="keyword1"><span class="command">lift_definition</span></span> left<span class="main">::</span><span class="quoted"><span class="quoted">"real_int <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">fst</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> right<span class="main">::</span><span class="quoted"><span class="quoted">"real_int <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">snd</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span><span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> left.rep_eq right.rep_eq  
  
<span class="keyword1"><span class="command">locale</span></span> real_int
<span class="keyword1"><span class="command">interpretation</span></span> real_int_class<span class="main">?</span><span class="main">:</span> real_int <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> real_int
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_int <span class="main">⇒</span> real"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∥</span>_<span class="keyword1">∥</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∥</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">∥</span></span> <span class="main">≡</span> right <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">-</span> left <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift</span><span class="main">::</span><span class="quoted"><span class="quoted">"real_int <span class="main">⇒</span> real <span class="main">⇒</span> real_int"</span></span> <span class="main">(</span><span class="quoted">" <span class="keyword1">shift</span> _ _"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">shift</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> right <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R_Chop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_int <span class="main">⇒</span> real_int <span class="main">⇒</span> real_int <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">R'_Chop'(</span>_<span class="keyword1">,</span>_<span class="keyword1">,</span>_<span class="keyword1">')</span>"</span> 51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> rchop_def <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">R_Chop(</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">==</span>  left <span class="free"><span class="bound"><span class="entity">r</span></span></span>  <span class="main">=</span> left <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> right <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> left <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> right <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span>  right <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
        
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The intervals defined in this way allow for the definition of an order: 
the subinterval relation.›</span></span>
  
<span class="keyword1"><span class="command">instantiation</span></span> real_int <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">less_eq_real_int</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span>left <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≥</span> left <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> right <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">less_real_int</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span>left <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≥</span> left <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> right <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> 
                                  <span class="main">∧</span>  <span class="main">¬</span><span class="main">(</span><span class="main">(</span>left <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≥</span> left <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>right <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> right <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>   
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted">real_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def less_real_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">r</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_real_int_inject left.rep_eq less_le less_eq_real_int_def 
        not_le prod.collapse right.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">context</span></span> real_int
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1" id="RealInt-left_leq_right"><span class="command">lemma</span></span> left_leq_right<span class="main">:</span> <span class="quoted"><span class="quoted">"left <span class="free">r</span> <span class="main">≤</span> right <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Rep_real_int left.rep_eq right.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="RealInt-length_ge_zero"><span class="command">lemma</span></span> length_ge_zero <span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Rep_real_int left.rep_eq right.rep_eq length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RealInt-consec_add"><span class="command">lemma</span></span> consec_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"left <span class="free">r</span> <span class="main">=</span> left <span class="free">s</span> <span class="main">∧</span> right <span class="free">r</span> <span class="main">=</span> right <span class="free">t</span> <span class="main">∧</span> right <span class="free">s</span> <span class="main">=</span> left <span class="free">t</span> <span class="main">⟹</span> <span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span><span class="free">s</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span><span class="free">t</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>length_def<span class="main">)</span>
    
<span class="keyword1" id="RealInt-length_zero_iff_borders_eq"><span class="command">lemma</span></span> length_zero_iff_borders_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> left <span class="free">r</span> <span class="main">=</span> right <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="RealInt-shift_left_eq_right"><span class="command">lemma</span></span> shift_left_eq_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> left_leq_right <span class="keyword1"><span class="command">.</span></span>
    
<span class="keyword1" id="RealInt-shift_keeps_length"><span class="command">lemma</span></span> shift_keeps_length<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span> <span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">∥</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse left.rep_eq real_int.length_def length_ge_zero shift_def 
    right.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="RealInt-shift_zero"><span class="command">lemma</span></span> shift_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_real_int_inverse shift_def <span class="main">)</span>
    
<span class="keyword1" id="RealInt-shift_additivity"><span class="command">lemma</span></span> shift_additivity<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">shift</span> <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="main">(</span>left <span class="free">r</span><span class="main">)</span> <span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>right <span class="free">r</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="free">r</span><span class="main">)</span> <span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>right <span class="free">r</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> left<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>left <span class="free">r</span><span class="main">)</span> <span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse 1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> right<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>right <span class="free">r</span><span class="main">)</span> <span class="main">+</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse 1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span><span class="free">y</span><span class="main">,</span> right<span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> left <span class="free">r</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shift_def  Abs_real_int_inverse <span class="quoted">"2"</span> fstI mem_Collect_eq prod.sel<span class="main">(</span>2<span class="main">)</span> left.rep_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> right <span class="free">r</span> <span class="main">+</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> shift_def Abs_real_int_inverse <span class="quoted">"2"</span> fstI mem_Collect_eq prod.sel<span class="main">(</span>2<span class="main">)</span> right.rep_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword2"><span class="keyword">and</span></span> l1 <span class="keyword2"><span class="keyword">and</span></span> r1 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="main">(</span><span class="keyword1">shift</span> <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left  <span class="free">r</span><span class="main">+</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">,</span> right  <span class="free">r</span><span class="main">+</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_always_possible"><span class="command">lemma</span></span> chop_always_possible<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span> <span class="main">.</span><span class="main">∃</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">s</span>  <span class="main">∧</span> <span class="skolem">s</span> <span class="main">≤</span> right <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span>  <span class="keyword2"><span class="keyword">where</span></span> x1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="skolem">x</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> right <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> x1_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="skolem">x</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> x2_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> right <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="skolem">x</span> <span class="main">=</span> left <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1_in_type l Abs_real_int_inverse 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  x1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse x1_def x1_in_type right.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="skolem">x1</span> <span class="main">=</span> left <span class="skolem">x2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse x1_def x1_in_type x2_def x2_in_type left.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse rchop_def snd_conv x2_def x2_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_singleton_right"><span class="command">lemma</span></span> chop_singleton_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span><span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="bound">r</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span>  Abs_real_int<span class="main">(</span>right <span class="skolem">x</span><span class="main">,</span> right <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse real_int.rchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_singleton_left"><span class="command">lemma</span></span> chop_singleton_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span><span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span>  Abs_real_int<span class="main">(</span>left <span class="skolem">x</span><span class="main">,</span> left <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse real_int.rchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="skolem">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_add_length"><span class="command">lemma</span></span> chop_add_length<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span><span class="free">s</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span><span class="free">t</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> consec_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rchop_def<span class="main">)</span>
    
<span class="keyword1" id="RealInt-chop_add_length_ge_0"><span class="command">lemma</span></span> chop_add_length_ge_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="free">s</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span><span class="free">t</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟶</span> <span class="main">∥</span><span class="free">r</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chop_add_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="RealInt-chop_dense"><span class="command">lemma</span></span> chop_dense <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">s</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">t</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="free">r</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ff1<span class="main">:</span> <span class="quoted"><span class="quoted">" left <span class="free">r</span> <span class="main">&lt;</span> right <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Rep_real_int <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="main">∥</span><span class="free">r</span><span class="main">∥</span>›</span></span> length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="free">r</span><span class="main">,</span> right <span class="free">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Rep_real_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span>  x_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">x</span>  <span class="main">=</span> <span class="main">(</span>left <span class="free">r</span> <span class="main">+</span> right <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> x_gr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> left <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ff1 field_less_half_sum x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> x_le<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> right <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ff1 x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_sum_of_halves<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="free">r</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> right <span class="free">r</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> s_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="free">r</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> x_def x_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> t_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> right <span class="free">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> x_def x_gr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> s_gr_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">s</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse s_def length_def x_gr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> t_gr_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="skolem">t</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse t_def length_def x_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse s_def s_in_type t_def t_in_type rchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="skolem">s</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span><span class="skolem">t</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> s_gr_0 t_gr_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">s</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span><span class="bound">t</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1" id="RealInt-chop_assoc1"><span class="command">lemma</span></span> chop_assoc1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">r1</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="free">r2</span><span class="main">,</span><span class="free">r3</span><span class="main">,</span><span class="free">r4</span><span class="main">)</span> 
     <span class="main">⟶</span> <span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span> Abs_real_int<span class="main">(</span>left <span class="free">r1</span><span class="main">,</span> right <span class="free">r3</span><span class="main">)</span><span class="main">,</span> <span class="free">r4</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="keyword1">R_Chop(</span>Abs_real_int<span class="main">(</span>left <span class="free">r1</span><span class="main">,</span> right <span class="free">r3</span><span class="main">)</span><span class="main">,</span> <span class="free">r1</span><span class="main">,</span><span class="free">r3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">r1</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="free">r2</span><span class="main">,</span><span class="free">r3</span><span class="main">,</span><span class="free">r4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" Abs_real_int<span class="main">(</span>left <span class="free">r1</span><span class="main">,</span> right <span class="free">r3</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="free">r1</span> <span class="main">=</span> left <span class="var">?y1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Abs_real_int_inverse assm fst_conv left.rep_eq mem_Collect_eq
        order_trans real_int.left_leq_right real_int.rchop_def snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="var">?y1</span> <span class="main">=</span> right <span class="free">r3</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Rep_real_int_cases Rep_real_int_inverse assm fst_conv mem_Collect_eq
        order_trans real_int.left_leq_right real_int.rchop_def right.rep_eq snd_conv<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span> <span class="var">?y1</span><span class="main">,</span> <span class="free">r4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm  rchop_def r1 l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="var">?y1</span><span class="main">,</span> <span class="free">r1</span><span class="main">,</span><span class="free">r3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm  rchop_def r1 l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span> <span class="var">?y1</span><span class="main">,</span> <span class="free">r4</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="var">?y1</span><span class="main">,</span> <span class="free">r1</span><span class="main">,</span><span class="free">r3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g1 g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_assoc2"><span class="command">lemma</span></span> chop_assoc2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">r1</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="free">r1</span><span class="main">,</span><span class="free">r3</span><span class="main">,</span><span class="free">r4</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">r3</span><span class="main">,</span> Abs_real_int<span class="main">(</span>left <span class="free">r4</span><span class="main">,</span> right <span class="free">r2</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="keyword1">R_Chop(</span>Abs_real_int<span class="main">(</span>left <span class="free">r4</span><span class="main">,</span> right <span class="free">r2</span><span class="main">)</span><span class="main">,</span> <span class="free">r4</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">r1</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="free">r1</span><span class="main">,</span><span class="free">r3</span><span class="main">,</span><span class="free">r4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" Abs_real_int<span class="main">(</span>left <span class="free">r4</span><span class="main">,</span> right <span class="free">r2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="var">?y1</span> <span class="main">≤</span> right <span class="var">?y1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"left <span class="free">r4</span> <span class="main">=</span> right <span class="free">r3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm real_int.rchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="free">r3</span> <span class="main">≤</span> right <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assm order_trans real_int.left_leq_right real_int.rchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="var">?y1</span> <span class="main">=</span> left <span class="free">r4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="var">?y1</span> <span class="main">=</span> right <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse right f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span> <span class="free">r3</span><span class="main">,</span> <span class="var">?y1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm  rchop_def r1 l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="var">?y1</span><span class="main">,</span> <span class="free">r4</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm  rchop_def r1 l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span> <span class="free">r3</span><span class="main">,</span> <span class="var">?y1</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">R_Chop(</span><span class="var">?y1</span><span class="main">,</span> <span class="free">r4</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g1 g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="RealInt-chop_leq1"><span class="command">lemma</span></span> chop_leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_eq_real_int_def order_refl real_int.left_leq_right real_int.rchop_def<span class="main">)</span>
    
<span class="keyword1" id="RealInt-chop_leq2"><span class="command">lemma</span></span> chop_leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_eq_real_int_def order_refl real_int.left_leq_right real_int.rchop_def<span class="main">)</span>
    
<span class="keyword1" id="RealInt-chop_empty1"><span class="command">lemma</span></span> chop_empty1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="free">s</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">=</span> <span class="free">t</span> "</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_real_int_inject left.rep_eq prod.collapse
      real_int.length_zero_iff_borders_eq real_int.rchop_def right.rep_eq<span class="main">)</span>

<span class="keyword1" id="RealInt-chop_empty2"><span class="command">lemma</span></span> chop_empty2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="free">t</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">=</span> <span class="free">s</span> "</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_real_int_inject left.rep_eq prod.collapse
      real_int.length_zero_iff_borders_eq real_int.rchop_def right.rep_eq<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*lemmas[simp] = length_dict *)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Cars">
<div class="head">
<h1>Theory Cars</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Cars.thy
    Author:     Sven Linker

A countably infinite type to denote cars in the model of HMLSL.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Cars›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We define a type to refer to cars. For simplicity, we assume that (countably)
infinite cars exist.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cars
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The type of cars consists of the natural numbers. However, we do not
define or prove any additional structure about it.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> cars <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> True<span class="main">}</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">locale</span></span> cars 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For the construction of possible counterexamples, it is beneficial to 
prove that at least two cars exist. Furthermore, we show that there indeed
exist infinitely many cars.
›</span></span>

<span class="keyword1" id="Cars-at_least_two_cars_exists"><span class="command">lemma</span></span> at_least_two_cars_exists<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">d</span> <span class="main">::</span>cars <span class="main">.</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_cars <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> Abs_cars<span class="main">(</span><span class="main">1</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Abs_cars_inject<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cars-infinite_cars"><span class="command">lemma</span></span> infinite_cars<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">c</span><span class="main">::</span>cars <span class="main">.</span> True<span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_def finite_imageI type_definition.Rep_range type_definition_cars<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Traffic">
<div class="head">
<h1>Theory Traffic</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Traffic.thy
    Author:     Sven Linker

Defines a type for traffic snapshots. Consists of six elements:
pos: positions of cars
res: reservations of cars
clm: claims of cars
dyn: current dynamic behaviour of cars
physical_size: the real sizes of cars
braking_distance: braking distance each car needs in emergency

Definitions for transitions between traffic snapshots.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Traffic Snapshots›</span></span> 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Traffic snapshots define the spatial and dynamical arrangement of cars
on the whole of the motorway at a single point in time. A traffic snapshot
consists of several functions assigning spatial properties and dynamical
behaviour to each car. The functions are named as follows.
\begin{itemize}
\item pos: positions of cars
\item res: reservations of cars
\item clm: claims of cars
\item dyn: current dynamic behaviour of cars
\item physical\_size: the real sizes of cars
\item braking\_distance: braking distance each car needs in emergency
\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Traffic
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#NatInt">NatInt</a> <a href="#RealInt">RealInt</a> <a href="#Cars">Cars</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> lanes <span class="main">=</span> <span class="quoted">nat_int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> extension <span class="main">=</span> <span class="quoted">real_int</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition of the type of traffic snapshots. 
The constraints on the different functions are the \emph{sanity conditions}
of traffic snapshots.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> traffic <span class="main">=</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ts</span> <span class="main">::</span> <span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">)</span>  <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>snd<span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">∪</span>Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span>  snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>
 <span class="main">}</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?type</span></span></span> <span class="main">=</span> 
    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ts</span> <span class="main">::</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">)</span>  <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>snd<span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> 
                <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">∪</span>Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span>  snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>  
 <span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pos</span></span> <span class="keyword2"><span class="keyword">where</span></span> sp_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">.</span> <span class="skolem">pos</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">re</span></span> <span class="keyword2"><span class="keyword">where</span></span> re_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">.</span> <span class="skolem">re</span> <span class="bound">c</span> <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cl</span></span> <span class="keyword2"><span class="keyword">where</span></span> cl_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">.</span> <span class="skolem">cl</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dyn</span></span> <span class="keyword2"><span class="keyword">where</span></span> dyn_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real <span class="main">.</span> <span class="main">(</span><span class="skolem">dyn</span> <span class="bound">c</span><span class="main">)</span> <span class="bound">x</span>  <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps_def <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars <span class="main">.</span> <span class="skolem">ps</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sd</span></span> <span class="keyword2"><span class="keyword">where</span></span> sd_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars <span class="main">.</span> <span class="skolem">sd</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">pos</span><span class="main">,</span><span class="skolem">re</span><span class="main">,</span><span class="skolem">cl</span><span class="main">,</span> <span class="skolem">dyn</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">,</span> <span class="skolem">sd</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl_def nat_int.inter_empty1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> re_geq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse re_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> re_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> re_def nat_int.rep_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> cl_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero cl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> add_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero cl_def re_leq_two <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> consec_re<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span><span class="main">|</span> <span class="main">=</span><span class="numeral">2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse  re_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>  clNextRe <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int <span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dyn_def <span class="keyword1"><span class="command">have</span></span> dyn_geq_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">dyn</span><span class="main">(</span><span class="bound">c</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ps_def <span class="keyword1"><span class="command">have</span></span> ps_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">ps</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sd_def <span class="keyword1"><span class="command">have</span></span> sd_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">sd</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">∈</span><span class="var">?type</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sp_def re_def cl_def disj re_geq_one re_leq_two cl_leq_one add_leq_two
      consec_re ps_def sd_def ts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">locale</span></span> traffic
<span class="keyword2"><span class="keyword">begin</span></span>   

<span class="keyword1"><span class="command">notation</span></span> nat_int.consec <span class="main">(</span><span class="quoted">"<span class="keyword1">consec</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For brevity, we define names for the different functions
within a traffic snapshot.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pos</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pos</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">res</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> lanes<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clm</span> <span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> lanes<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">clm</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dyn</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> <span class="main">(</span>real<span class="main">⇒</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dyn</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">physical_size</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">physical_size</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">braking_distance</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">braking_distance</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Rep_traffic <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
It is helpful to be able to refer to the sanity conditions of a traffic 
snapshot via lemmas, hence we prove that the sanity conditions hold
for each traffic snapshot.
›</span></span>

<span class="keyword1" id="Traffic-disjoint"><span class="command">lemma</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Rep_traffic res_def clm_def   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-atLeastOneRes"><span class="command">lemma</span></span> atLeastOneRes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">|</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">|</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> Rep_traffic  res_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-atMostTwoRes"><span class="command">lemma</span></span> atMostTwoRes<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">|</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Rep_traffic  res_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-atMostOneClm"><span class="command">lemma</span></span>  atMostOneClm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> Rep_traffic  clm_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-atMostTwoLanes"><span class="command">lemma</span></span> atMostTwoLanes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">|</span> <span class="main">+</span><span class="main">|</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Rep_traffic  res_def clm_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-consecutiveRes"><span class="command">lemma</span></span>  consecutiveRes<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">|</span>res <span class="free">ts</span>  <span class="free">c</span><span class="main">|</span> <span class="main">=</span><span class="numeral">2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> Rep_nat_int <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assump<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>res <span class="free">ts</span>  <span class="free">c</span><span class="main">|</span> <span class="main">=</span><span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> not_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_non_empty_geq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assump <span class="keyword2"><span class="keyword">and</span></span> card_seq 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>res <span class="free">ts</span>  <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> Rep_nat_int <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_left' atLeastAtMost_singleton insert_is_Un nat_int.un_consec_seq
        one_add_one order_refl<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> assump <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> Rep_nat_int <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Rep_nat_int_inject bot_nat_int.rep_eq card_non_empty_geq_one 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Traffic-clmNextRes"><span class="command">lemma</span></span> clmNextRes <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int<span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int<span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_traffic res_def clm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-psGeZero"><span class="command">lemma</span></span> psGeZero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>physical_size <span class="free">ts</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_traffic physical_size_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Traffic-sdGeZero"><span class="command">lemma</span></span> sdGeZero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>braking_distance <span class="free">ts</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_traffic braking_distance_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
While not a sanity condition directly, the following lemma helps to establish
general properties of HMLSL later on. It is a consequence of clmNextRes. 
›</span></span>

<span class="keyword1" id="Traffic-clm_consec_res"><span class="command">lemma</span></span> clm_consec_res<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="keyword1">consec</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="keyword1">consec</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">≠</span><span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int<span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int<span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> clmNextRes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int<span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">∪</span>Rep_nat_int<span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span><span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊓</span> clm <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> n_def <span class="keyword2"><span class="keyword">and</span></span> disj 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> clm <span class="free">ts</span> <span class="free">c</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnE bot_nat_int.rep_eq disjoint_insert<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> el.rep_eq inf_nat_int.rep_eq
          insertI1 insert_absorb not_in.rep_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="keyword1">consec</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> n_in_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">∧</span>  <span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> suc_n_in_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI assm el.rep_eq in_not_in_iff1 insert_iff n_def non_empty_elem_in 
          singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm disj n_def inf_absorb1 inf_commute less_eq_nat_int.rep_eq 
          sup.cobounded2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> suc_n_not_in_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> res <span class="free">ts</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> n_def n_in_res nat_int.el.rep_eq nat_int.not_in.rep_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> n_in_res <span class="keyword1"><span class="command">have</span></span> n_not_in_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.maximum <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> n_in_res suc_n_not_in_res nat_int.el.rep_eq nat_int.not_in.rep_eq n_def 
        nat_int.maximum_in nat_int.non_empty_elem_in inf_sup_aci<span class="main">(</span>4<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.minimum <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> suc_n_in_clm n_not_in_clm nat_int.el.rep_eq nat_int.not_in.rep_eq
        n_def nat_int.minimum_in nat_int.non_empty_elem_in  <span class="keyword1"><span class="command">using</span></span> inf_sup_aci<span class="main">(</span>4<span class="main">)</span>  
        not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm max min n_in_res nat_int.consec_def nat_int.non_empty_elem_in
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> n_in_clm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> clm <span class="free">ts</span> <span class="free">c</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> res <span class="free">ts</span> <span class="free">c</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> suc_n_in_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free">ts</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free">ts</span> <span class="free">c</span> "</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_insert_right_if0 One_nat_def Suc_leI add.right_neutral add_Suc_right 
            atMostTwoRes el.rep_eq inf_bot_right inf_sup_absorb insert_not_empty le_antisym 
            n_def one_add_one order.not_eq_order_implies_strict singleton traffic.atLeastOneRes
            traffic.consecutiveRes<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> n_in_clm 
        <span class="keyword1"><span class="command">using</span></span> nat_int.el.rep_eq nat_int.not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.maximum <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>       
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm n_in_clm card_non_empty_geq_one 
          le_antisym nat_int.in_singleton nat_int.maximum_in singleton traffic.atMostOneClm<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.minimum <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_insert_right_if0 Int_insert_right_if1 Rep_nat_int_inverse 
          bot_nat_int.rep_eq el.rep_eq in_not_in_iff1 in_singleton inf_nat_int.rep_eq 
          inf_sup_absorb insert_not_empty inter_empty1 minimum_in n_def 
          n_in_clm suc_n_in_res<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm max min nat_int.consec_def nat_int.non_empty_elem_in 
        suc_n_in_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define several possible transitions between traffic snapshots. 
Cars may create or withdraw claims and reservations, as long as the sanity conditions 
of the traffic snapshots are fullfilled. 

In particular, a car can only create
a claim, if it possesses only a reservation on a single lane, and does not 
already possess a claim. Withdrawing a claim can be done in any situation. 
It only has an effect, if the car possesses a claim. Similarly, the 
transition for a car to create a reservation is always possible, but only
changes the spatial situation on the road, if the car already has a claim.
Finally, a car may withdraw its reservation to a single lane, if its
current reservation consists of two lanes.

All of these transitions concern the spatial properties of a single car at a time, i.e., 
for several cars to change their properties, several transitions have to be taken.
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">create_claim</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>cars<span class="main">⇒</span>nat<span class="main">⇒</span>traffic<span class="main">⇒</span>bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>─</b>c'(</span> _<span class="keyword1">,</span> _ <span class="keyword1">')</span> <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">❙</span><b>─</b>c(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>  <span class="main">==</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
                                <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">|</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>
                                <span class="main">∧</span> <span class="main">|</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>
                                <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span>Abs_nat_int <span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">withdraw_claim</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>cars <span class="main">⇒</span>traffic<span class="main">⇒</span>bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc'(</span> _ <span class="keyword1">')</span> <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">❙</span><b>─</b>wdc(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>  <span class="main">==</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
                                <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span><span class="main">∅</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">create_reservation</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>cars<span class="main">⇒</span>traffic<span class="main">⇒</span>bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>─</b>r'(</span> _ <span class="keyword1">')</span> <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">❙</span><b>─</b>r(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>  <span class="main">==</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
                                <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span><span class="main">(</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">⊔</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span><span class="main">∅</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">withdraw_reservation</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>cars<span class="main">⇒</span>nat<span class="main">⇒</span>traffic<span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr'(</span> _<span class="keyword1">,</span> _ <span class="keyword1">')</span> <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="keyword1"><span class="free"><span class="hidden">❙</span><b>─</b>wdr(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span>  <span class="main">==</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
                                <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span> Abs_nat_int<span class="main">{</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span> <span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">|</span>res <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">|</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two transitions concern the dynamical behaviour of the cars. 
Similar to the spatial properties, a car may change its dynamics, by setting
it to a new function \(f\) from real to real. Observe that this function is indeed 
arbitrary and does not constrain the possible behaviour in any way. However,
this transition allows a car to change the function determining their braking
distance (in fact, all cars are allowed to change this function, if a car changes
sets a new dynamical function). That is, our model describes an over-approximation
of a concrete situation, where the braking distance is determined by the dynamics. 

The final transition describes the passing of \(x\) time units. That is, all cars 
update their position according to their current dynamical behaviour. Observe that
this transition requires that the dynamics of each car is at least \(0\), for each time
point between \(0\) and \(x\). Hence, this condition denotes that all cars drive
into the same direction. If the current dynamics of a car violated this constraint,
it would have to reset its dynamics, until time may pass again.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">change_dyn</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>cars<span class="main">⇒</span><span class="main">(</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">⇒</span>traffic<span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">" _ <span class="keyword1"><span class="hidden">❙</span><b>─</b></span> <span class="keyword1">dyn'(</span>_<span class="keyword1">,</span>_<span class="keyword1">')</span> <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>─</b></span></span><span class="keyword1"><span class="free">dyn(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span> 
                              <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">drive</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"traffic<span class="main">⇒</span>real<span class="main">⇒</span>traffic<span class="main">⇒</span>bool"</span></span> <span class="main">(</span><span class="quoted">" _ <span class="keyword1"><span class="hidden">❙</span><b>─</b></span> _ <span class="keyword1"><span class="hidden">❙</span><b>→</b></span> _"</span> 27<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>─</b></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">==</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="bound">c</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>  
                              <span class="main">∧</span> <span class="main">(</span>res <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> res <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>clm <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> clm <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>dyn <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">=</span> dyn <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>
                              <span class="main">∧</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We bundle the dynamical transitions into \emph{evolutions}, since
we will only reason about combinations of the dynamical behaviour. 
This fits to the level of abstraction by hiding the dynamics completely
inside of the model.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">evolve</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> traffic <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>↝</b></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> refl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↝</b></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span>"</span></span> <span class="main">|</span>
 change<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="hidden">❙</span><b>─</b></span><span class="keyword1">dyn(</span><span class="bound">c</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↝</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↝</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> <span class="main">|</span>
 drive<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="hidden">❙</span><b>─</b></span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↝</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>    <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>↝</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> 

<span class="keyword1" id="Traffic-evolve_trans"><span class="command">lemma</span></span> evolve_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts0</span> <span class="main"><span class="hidden">❙</span><b>↝</b></span> <span class="free">ts1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ts1</span> <span class="main"><span class="hidden">❙</span><b>↝</b></span> <span class="free">ts2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ts0</span> <span class="main"><span class="hidden">❙</span><b>↝</b></span> <span class="free">ts2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>evolve.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl <span class="skolem">ts</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>drive <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> evolve.drive<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>change <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> evolve.change<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For general transition sequences, we introduce \emph{abstract transitions}. 
A traffic snapshot \(ts^\prime\) is reachable from \(ts\) via an abstract transition,
if there is an arbitrary sequence of transitions from \(ts\) to \(ts^\prime\).
›</span></span>
 
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">abstract</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> traffic <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">❙</span><b>⇒</b></span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">ts</span>
<span class="keyword2"><span class="keyword">where</span></span> refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free">ts</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  evolve<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main"><span class="hidden">❙</span><b>↝</b></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>   <span class="main">⟹</span> <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> <span class="main">|</span>
  cr_clm<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">⟹</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="bound">c</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span><span class="main">)</span>     <span class="main">⟹</span> <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> <span class="main">|</span>
  wd_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span>  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="bound">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> <span class="main">|</span>
  cr_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="bound">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> <span class="main">|</span>
  wd_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span><span class="main">.</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="bound">c</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="free">ts</span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⇒</b></span></span> <span class="free"><span class="bound"><span class="entity">ts''</span></span></span>"</span></span> 
  
  
<span class="keyword1" id="Traffic-abs_trans"><span class="command">lemma</span></span> abs_trans<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">ts1</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="free">ts2</span><span class="main">)</span> <span class="main">⟹</span><span class="main">(</span><span class="free">ts0</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="free">ts1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ts0</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="free">ts2</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>abstract.induct    <span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> refl
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>evolve <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.evolve <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.cr_clm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.wd_clm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.cr_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.wd_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Most properties of the transitions are straightforward. However, to show
that the transition to create a reservation is always possible,
we need to explicitly construct the resulting traffic snapshot. Due
to the size of such a snapshot, the proof is lengthy.
›</span></span>
  
    
<span class="keyword1" id="Traffic-create_res_subseteq1"><span class="command">lemma</span></span> create_res_subseteq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts'</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊔</span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> create_reservation_def
    <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_commute clm_consec_res  nat_int.un_subset2 
        nat_int.union_def nat_int.chop_subset1 nat_int.nchop_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Traffic-create_res_subseteq2"><span class="command">lemma</span></span> create_res_subseteq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> clm <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts'</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊔</span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> create_reservation_def
    <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_commute clm_consec_res disjoint inf_le1 nat_int.un_subset1 nat_int.un_subset2
        nat_int.union_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Traffic-create_res_subseteq1_neq"><span class="command">lemma</span></span> create_res_subseteq1_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">≠</span><span class="free">c</span> <span class="main">⟶</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts'</span> <span class="free">c</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> create_reservation_def
  <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Traffic-create_res_subseteq2_neq"><span class="command">lemma</span></span> create_res_subseteq2_neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">≠</span><span class="free">c</span> <span class="main">⟶</span> clm <span class="free">ts</span> <span class="free">c</span><span class="main">=</span> clm <span class="free">ts'</span> <span class="free">c</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span>  clm <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> create_reservation_def
    <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Traffic-always_create_res"><span class="command">lemma</span></span> always_create_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">ts'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?type</span></span></span> <span class="main">=</span> 
    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ts</span> <span class="main">::</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">)</span>  <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>snd<span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">∪</span>Rep_nat_int<span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>
                     <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span>  snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> 
     <span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="bound">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"clm <span class="skolem">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main">=</span> <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> create_reservation_def True fun_upd_triv nat_int.un_empty_absorb1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">=</span>  <span class="main">(</span>pos <span class="skolem">ts</span><span class="main">,</span> 
                                <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span><span class="main">(</span><span class="free">c</span><span class="main">:=</span><span class="main">(</span> <span class="main">(</span>res <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">⊔</span> <span class="main">(</span>clm <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span><span class="main">(</span><span class="free">c</span><span class="main">:=</span><span class="main">∅</span><span class="main">)</span><span class="main">,</span>
                                <span class="main">(</span>dyn <span class="skolem">ts</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>physical_size <span class="skolem">ts</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>braking_distance <span class="skolem">ts</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint nat_int.inter_empty1 ts'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> re_geq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">|</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span> <span class="bound">d</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">|</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span> <span class="skolem">d</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">=</span> res <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">⊔</span> clm <span class="skolem">ts</span> <span class="free">c</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"res <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">⊑</span> fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False True Un_ac<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat_int.un_subset1 nat_int.un_subset2 
              nat_int.union_def traffic.clm_consec_res<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI card_non_empty_geq_one traffic.atLeastOneRes<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> traffic.atLeastOneRes ts'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> re_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_commute add.commute
          atMostTwoLanes atMostTwoRes nat_int.card_un_add clm_consec_res fun_upd_apply
          nat_int.union_def False prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ts'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cl_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> atMostOneClm nat_int.card_empty_zero ts'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> add_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_1 add_Suc add_diff_cancel_left' 
          add_mono_thms_linordered_semiring<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> card_non_empty_geq_one cl_leq_one
          fun_upd_apply le_SucE one_add_one prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> re_leq_two
          traffic.atMostTwoLanes ts'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> clNextRe <span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> 
        <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> clmNextRes ts'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ps_ge_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ts'_def psGeZero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> sd_ge_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ts'_def sdGeZero <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> ts'_type<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">∈</span> <span class="var">?type</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  ts'_def disj  re_geq_one re_leq_two cl_leq_one add_leq_two    
        clNextRe mem_Collect_eq  ps_ge_zero  sd_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> rep_eq<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_traffic <span class="main">(</span>Abs_traffic <span class="skolem">ts'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ts'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ts'_def ts'_type Abs_traffic_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> sp_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>pos <span class="main">(</span>Abs_traffic <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pos <span class="skolem">ts</span><span class="main">)</span> "</span></span>  
      <span class="keyword1"><span class="command">using</span></span> rep_eq ts'_def Rep_traffic pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> res_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>res  <span class="main">(</span>Abs_traffic <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span><span class="main">(</span><span class="free">c</span><span class="main">:=</span><span class="main">(</span> <span class="main">(</span>res <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">⊔</span> <span class="main">(</span>clm <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Rep_traffic ts'_def ts'_type Abs_traffic_inverse rep_eq res_def clm_def 
        fstI sndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> dyn_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>dyn  <span class="main">(</span>Abs_traffic <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>dyn <span class="skolem">ts</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Rep_traffic ts'_def ts'_type Abs_traffic_inverse rep_eq dyn_def fstI sndI 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> clm_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>clm  <span class="main">(</span>Abs_traffic <span class="skolem">ts'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span><span class="main">(</span><span class="free">c</span><span class="main">:=</span><span class="main">∅</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ts'_def ts'_type Abs_traffic_inverse rep_eq clm_def fstI sndI Rep_traffic
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span>  <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> Abs_traffic <span class="skolem">ts'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ts'_def ts'_type create_reservation_def 
        ts'_def disj re_geq_one re_leq_two cl_leq_one add_leq_two
        fst_conv snd_conv rep_eq sp_eq res_eq dyn_eq clm_eq
        Rep_traffic clm_def res_def clm_def dyn_def physical_size_def braking_distance_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Traffic-create_clm_eq_res"><span class="command">lemma</span></span> create_clm_eq_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span>  <span class="main">⟶</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts'</span> <span class="free">c</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_claim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Traffic-withdraw_clm_eq_res"><span class="command">lemma</span></span> withdraw_clm_eq_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> res <span class="free">ts</span> <span class="free">c</span><span class="main">=</span> res <span class="free">ts'</span> <span class="free">c</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> withdraw_claim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Traffic-withdraw_res_subseteq"><span class="command">lemma</span></span> withdraw_res_subseteq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> res <span class="free">ts'</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts</span> <span class="free">c</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> withdraw_reservation_def order_refl less_eq_nat_int.rep_eq nat_int.el.rep_eq 
    nat_int.in_refl nat_int.in_singleton  fun_upd_apply subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Views">
<div class="head">
<h1>Theory Views</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Views.thy
    Author:     Sven Linker, University of Liverpool

Defines a type for views on traffic. Consists of closed real valued interval
denoting "extension" (length on the road visible", the visible interval of lanes,
and the owner of the view.

Contains chopping relations on extension and lanes and switching to
different owners.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Views on Traffic›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
In this section, we define a notion of locality for each car. These
local parts of a road are called \emph{views} and define the part of 
the model currently under consideration by a car. In particular, a 
view consists of 
\begin{itemize}
\item the \emph{extension}, a real-valued interval denoting the distance perceived,  
\item the \emph{lanes}, a discrete interval, denoting which lanes are perceived,
\item the \emph{owner}, the car associated with this view.
\end{itemize} 
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Views
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#NatInt">NatInt</a> <a href="#RealInt">RealInt</a> <a href="#Cars">Cars</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> lanes <span class="main">=</span> <span class="quoted">nat_int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> extension <span class="main">=</span> <span class="quoted">real_int</span>
  
  
<span class="keyword1"><span class="command">record</span></span> view <span class="main">=</span> 
  ext<span class="main">::</span><span class="quoted">extension</span> 
  lan <span class="main">::</span><span class="quoted">lanes</span>  
  own <span class="main">::</span><span class="quoted">cars</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The orders on discrete and continuous intervals induce an order on views. 
For two views \(v\) and \(v^\prime\) with \(v \leq v^\prime\), we call \(v\)
a \emph{subview} of \(v^\prime\).›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span>  view_ext<span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">less_eq_view_ext</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">::</span> <span class="tfree">'a</span> view_ext<span class="main">)</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">::</span> <span class="tfree">'a</span> view_ext<span class="main">)</span>  <span class="main">≡</span>
     <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≤</span> ext <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lan <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊑</span>  lan <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∧</span> own <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">V'</span></span></span>
   <span class="main">∧</span> more <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≤</span> more <span class="free"><span class="bound"><span class="entity">V'</span></span></span>"</span></span>  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">less_view_ext</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> view_ext<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">::</span> <span class="tfree">'a</span> view_ext<span class="main">)</span>  <span class="main">≡</span> 
     <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≤</span> ext <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lan <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊑</span>  lan <span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">)</span> <span class="main">∧</span> own <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">V</span></span></span>
    <span class="main">∧</span> more <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≤</span> more <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">∧</span>
     <span class="main">¬</span><span class="main">(</span><span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≤</span> ext <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lan <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">⊑</span>  lan <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">∧</span> own <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">V</span></span></span>
      <span class="main">∧</span> more <span class="free"><span class="bound"><span class="entity">V'</span></span></span> <span class="main">≤</span> more <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">instance</span></span>   
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">v'</span> <span class="skolem">v''</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> view_ext"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">v</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def less_eq_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">v</span> <span class="main">&lt;</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">v'</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def less_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">v'</span> <span class="main">⟹</span> <span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v''</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">v''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def less_eq_nat_int.rep_eq order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">v'</span> <span class="main">⟹</span> <span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword2"><span class="keyword">end</span></span> 
  
  
<span class="keyword1"><span class="command">locale</span></span> view
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> nat_int.maximum <span class="main">(</span><span class="quoted">"<span class="keyword1">maximum</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> nat_int.minimum <span class="main">(</span><span class="quoted">"<span class="keyword1">minimum</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> nat_int.consec <span class="main">(</span><span class="quoted">"<span class="keyword1">consec</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We lift the chopping relations from discrete and continuous intervals
to views, and introduce new notation for these relations.›</span></span> 

<span class="keyword1"><span class="command">definition</span></span>       <span class="entity">hchop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"view <span class="main">⇒</span> view <span class="main">⇒</span>  view <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">=</span>_<span class="keyword1">∥</span>_"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free">∥</span></span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">==</span> real_int.R_Chop<span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                    lan <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span>lan <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> 
                    lan <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span>lan <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> 
                    own <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> 
                    own <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> 
                    more <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span>
                    more <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">u</span></span></span>  "</span></span>
<span class="keyword1"><span class="command">definition</span></span>   <span class="entity">vchop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"view <span class="main">⇒</span> view <span class="main">⇒</span>  view <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">=</span>_<span class="keyword1">--</span>_"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main"><span class="free">--</span></span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">==</span> nat_int.N_Chop<span class="main">(</span>lan <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">(</span>lan <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">(</span> lan <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                     ext <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> ext <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> 
                     ext <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> ext <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> 
                     own <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> 
                     own  <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> own <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span>
                     more <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span>
                     more <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">u</span></span></span> "</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can also switch the perspective of a view to the car \(c\). That is,
we substitute \(c\) for the original owner of the view.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">switch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"view <span class="main">⇒</span> cars <span class="main">⇒</span> view <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">=</span> _ <span class="keyword1">&gt;</span> _"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main"><span class="free">=</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">&gt;</span></span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">==</span> ext <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> ext <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> 
                        lan <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> lan <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span>  
                        own <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> 
                        more <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> more <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Most of the lemmas in this theory are direct transfers of the corresponding
lemmas on discrete and continuous intervals, which implies rather simple proofs.
The only exception is 
the connection between subviews and the chopping operations. This proof is rather lengthy,
since we need to distinguish several cases, and within each case, we need to
 explicitly construct six different views for the chopping relations.›</span></span>

<span class="keyword1" id="Views-h_chop_middle1"><span class="command">lemma</span></span> h_chop_middle1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">u</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hchop_def real_int.rchop_def real_int.left_leq_right<span class="main">)</span>
    
<span class="keyword1" id="Views-h_chop_middle2"><span class="command">lemma</span></span> h_chop_middle2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">w</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> real_int.left_leq_right real_int.rchop_def view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="Views-horizontal_chop1"><span class="command">lemma</span></span> horizontal_chop1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∃</span> <span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">∥</span><span class="bound">w</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> real_chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span>  <span class="keyword1">R_Chop(</span>ext <span class="free">v</span><span class="main">,</span> <span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> real_int.chop_singleton_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1_x2_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="keyword1">R_Chop(</span>ext <span class="free">v</span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> real_chop <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">V2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> <span class="skolem">x1</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V2</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> <span class="skolem">x2</span><span class="main">,</span>lan<span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span> "</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> v1 <span class="keyword2"><span class="keyword">and</span></span> v2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="skolem">V1</span><span class="main">∥</span><span class="skolem">V2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hchop_def x1_x2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Views-horizontal_chop_empty_right"><span class="command">lemma</span></span> horizontal_chop_empty_right <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">=</span><span class="bound">v</span><span class="main">∥</span><span class="bound">u</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> hchop_def real_int.chop_singleton_right 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs<span class="main">)</span> 
    
<span class="keyword1" id="Views-horizontal_chop_empty_left"><span class="command">lemma</span></span> horizontal_chop_empty_left <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">=</span><span class="bound">u</span><span class="main">∥</span><span class="bound">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> hchop_def real_int.chop_singleton_left 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs<span class="main">)</span> 
    
<span class="keyword1" id="Views-horizontal_chop_non_empty"><span class="command">lemma</span></span> horizontal_chop_non_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">∥</span><span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">u</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">w</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">l2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="keyword1">R_Chop(</span>ext <span class="free">v</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span><span class="skolem">l2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span><span class="skolem">l1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span><span class="skolem">l2</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> real_int.chop_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="keyword2"><span class="keyword">where</span></span> v1_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> <span class="skolem">l1</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v</span> <span class="main">⦈</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V2</span></span> <span class="keyword2"><span class="keyword">where</span></span> v2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">V2</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> <span class="skolem">l2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v</span> <span class="main">⦈</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">V1</span><span class="main">∥</span><span class="skolem">V2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">V1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">V2</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span>  chop hchop_def v1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">V1</span> <span class="bound">V2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">V1</span><span class="main">∥</span><span class="bound">V2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">V1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">V2</span><span class="main">∥</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="Views-horizontal_chop_split_add"><span class="command">lemma</span></span> horizontal_chop_split_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">∥</span><span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">u</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">w</span><span class="main">∥</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">assume</span></span> geq_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v1_def<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v1_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> geq_0<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v2_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="free">x</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
             lan <span class="main">=</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v2_in_type<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="free">x</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> geq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> v1_def <span class="keyword2"><span class="keyword">and</span></span> geq_0 <span class="keyword1"><span class="command">have</span></span> len_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">u</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v1_in_type 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse  real_int.length_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> v2_def <span class="keyword2"><span class="keyword">and</span></span> geq_0 <span class="keyword1"><span class="command">have</span></span> len_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">w</span><span class="main">∥</span><span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v2_in_type 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse  real_int.length_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> v1_def <span class="keyword2"><span class="keyword">and</span></span> v2_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">u</span><span class="main">∥</span><span class="skolem">w</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse fst_conv hchop_def len_v prod.collapse real_int.rchop_def
      real_int.length_def snd_conv v1_in_type v2_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> len_v1 <span class="keyword2"><span class="keyword">and</span></span> len_v2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">u</span><span class="main">∥</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">u</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">w</span><span class="main">∥</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">∥</span><span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">u</span><span class="main">∥</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="bound">w</span><span class="main">∥</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Views-horizontal_chop_assoc1"><span class="command">lemma</span></span> horizontal_chop_assoc1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v'</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v3</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span><span class="main">⦇</span> ext <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v3</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
             lan <span class="main">=</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="skolem">v'</span><span class="main">∥</span><span class="free">v4</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm real_int.chop_assoc1 hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v'_def assm real_int.chop_assoc1 hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">v'</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v'</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Views-horizontal_chop_assoc2"><span class="command">lemma</span></span> horizontal_chop_assoc2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="free">v4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="main">⦇</span> ext <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v4</span><span class="main">)</span><span class="main">,</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            lan <span class="main">=</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="skolem">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm fst_conv real_int.chop_assoc2 snd_conv hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">∥</span><span class="free">v2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm real_int.chop_assoc2 v'_def hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">∥</span><span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
  
  
<span class="keyword1" id="Views-horizontal_chop_width_stable"><span class="command">lemma</span></span> horizontal_chop_width_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span><span class="main">⟶</span><span class="main">|</span>lan <span class="free">v</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>lan <span class="free">u</span><span class="main">|</span><span class="main">∧</span><span class="main">|</span>lan <span class="free">v</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>lan <span class="free">w</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-horizontal_chop_own_trans"><span class="command">lemma</span></span> horizontal_chop_own_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> own <span class="free">u</span> <span class="main">=</span> own <span class="free">w</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    
<span class="keyword1" id="Views-vertical_chop1"><span class="command">lemma</span></span> vertical_chop1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">=</span><span class="bound">u</span><span class="main">--</span><span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vchop_def  nat_int.chop_always_possible
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs<span class="main">)</span>
    
<span class="keyword1" id="Views-vertical_chop_empty_down"><span class="command">lemma</span></span> vertical_chop_empty_down<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span><span class="main">(</span><span class="bound">v</span><span class="main">=</span><span class="bound">v</span><span class="main">--</span><span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vchop_def nat_int.chop_empty_right 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs<span class="main">)</span>
    
    
<span class="keyword1" id="Views-vertical_chop_empty_up"><span class="command">lemma</span></span> vertical_chop_empty_up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span><span class="main">(</span><span class="bound">v</span><span class="main">=</span><span class="bound">u</span><span class="main">--</span><span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vchop_def nat_int.chop_empty_left 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs<span class="main">)</span>
    
    
<span class="keyword1" id="Views-vertical_chop_assoc1"><span class="command">lemma</span></span> vertical_chop_assoc1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v'</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v3</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span><span class="main">⦇</span> ext <span class="main">=</span> ext <span class="free">v</span><span class="main">,</span> lan<span class="main">=</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>lan <span class="free">v3</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="skolem">v'</span><span class="main">--</span><span class="free">v4</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_assoc1 vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v3</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> v'_def assm nat_int.chop_assoc1 vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">v'</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v'</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Views-vertical_chop_assoc2"><span class="command">lemma</span></span> vertical_chop_assoc2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="main">⦇</span> ext <span class="main">=</span> ext <span class="free">v</span><span class="main">,</span> lan <span class="main">=</span><span class="main">(</span>lan <span class="free">v4</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="skolem">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm fst_conv nat_int.chop_assoc2 snd_conv vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">--</span><span class="free">v2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm nat_int.chop_assoc2 v'_def vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="bound">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">v4</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Views-vertical_chop_singleton"><span class="command">lemma</span></span> vertical_chop_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">|</span>lan <span class="free">u</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">|</span>lan <span class="free">w</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_single vchop_def Rep_nat_int_inverse 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Views-vertical_chop_add1"><span class="command">lemma</span></span> vertical_chop_add1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span>lan <span class="free">u</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span>lan <span class="free">w</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_add1 vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    
<span class="keyword1" id="Views-vertical_chop_add2"><span class="command">lemma</span></span> vertical_chop_add2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">u</span> <span class="bound">w</span><span class="main">.</span>  <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">--</span><span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">u</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">w</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> add<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="keyword1">N_Chop(</span>lan <span class="free">v</span><span class="main">,</span> <span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">i</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">j</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chop_add2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> l1_l2_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">N_Chop(</span>lan <span class="free">v</span><span class="main">,</span> <span class="skolem">i</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span><span class="skolem">i</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">|</span><span class="skolem">j</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span>  ext <span class="free">v</span><span class="main">,</span> lan <span class="main">=</span> <span class="skolem">i</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="free">v</span><span class="main">,</span> lan <span class="main">=</span> <span class="skolem">j</span><span class="main">,</span> own <span class="main">=</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">u</span><span class="main">--</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="skolem">u</span><span class="main">|</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="skolem">w</span><span class="main">|</span><span class="main">=</span><span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> l1_l2_def view.vchop_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">u</span> <span class="bound">w</span><span class="main">.</span>  <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">u</span><span class="main">--</span><span class="bound">w</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">u</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">w</span><span class="main">|</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Views-vertical_chop_length_stable"><span class="command">lemma</span></span> vertical_chop_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>ext <span class="free">u</span><span class="main">∥</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>ext <span class="free">w</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-vertical_chop_own_trans"><span class="command">lemma</span></span> vertical_chop_own_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> own <span class="free">u</span> <span class="main">=</span> own <span class="free">w</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    
<span class="keyword1" id="Views-vertical_chop_width_mon"><span class="command">lemma</span></span> vertical_chop_width_mon<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="free">v3</span><span class="main">|</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟶</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">≥</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_add1 trans_le_add2 vertical_chop_add1<span class="main">)</span>
    
<span class="keyword1" id="Views-horizontal_chop_leq1"><span class="command">lemma</span></span> horizontal_chop_leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_int.chop_leq1 hchop_def less_eq_view_ext_def order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Views-horizontal_chop_leq2"><span class="command">lemma</span></span> horizontal_chop_leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_int.chop_leq2 hchop_def less_eq_view_ext_def order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Views-vertical_chop_leq1"><span class="command">lemma</span></span> vertical_chop_leq1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_subset1 vchop_def less_eq_view_ext_def order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Views-vertical_chop_leq2"><span class="command">lemma</span></span> vertical_chop_leq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.chop_subset2 vchop_def less_eq_view_ext_def order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
    
<span class="keyword1" id="Views-somewhere_leq"><span class="command">lemma</span></span> somewhere_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">vl</span> <span class="bound">vr</span> <span class="bound">vu</span> <span class="bound">vd</span><span class="main">.</span> 
                <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="bound">vl</span><span class="main">∥</span><span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v1</span><span class="main">=</span><span class="bound">v2</span><span class="main">∥</span><span class="bound">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">vd</span><span class="main">--</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="bound">vu</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> assm_exp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>ext <span class="free">v</span> <span class="main">≤</span> ext <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>lan <span class="free">v</span> <span class="main">⊑</span> lan <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>own <span class="free">v</span> <span class="main">=</span> own <span class="free">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vl</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">vr</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> 
      vl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vl</span><span class="main">=</span><span class="main">⦇</span>ext<span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">,</span>left<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> lan<span class="main">=</span>lan <span class="free">v'</span><span class="main">,</span> own<span class="main">=</span>own <span class="free">v'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 
      v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">=</span><span class="main">⦇</span>ext<span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span>right<span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> lan<span class="main">=</span>lan <span class="free">v'</span><span class="main">,</span> own<span class="main">=</span>own <span class="free">v'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 
      v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">=</span><span class="main">⦇</span>ext<span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span>right<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> lan<span class="main">=</span>lan <span class="free">v'</span><span class="main">,</span> own<span class="main">=</span>own <span class="free">v'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 
      vr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vr</span><span class="main">=</span><span class="main">⦇</span>ext<span class="main">=</span>Abs_real_int<span class="main">(</span>right<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span>right<span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> lan<span class="main">=</span>lan <span class="free">v'</span><span class="main">,</span> own<span class="main">=</span>own <span class="free">v'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> vl_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def assm_exp real_int.left_leq_right snd_conv 
      fst_conv mem_Collect_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> v1_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def assm_exp real_int.left_leq_right snd_conv fst_conv
      mem_Collect_eq order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> v2_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def assm_exp real_int.left_leq_right snd_conv fst_conv 
      mem_Collect_eq order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> vr_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">::</span><span class="main">(</span>real<span class="main">*</span>real<span class="main">)</span> <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def assm_exp real_int.left_leq_right snd_conv fst_conv
      mem_Collect_eq order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hchops<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="skolem">vl</span><span class="main">∥</span><span class="skolem">v1</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">=</span><span class="skolem">v2</span><span class="main">∥</span><span class="skolem">vr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> vl v1 v2 vr less_eq_real_int_def hchop_def real_int.rchop_def 
     vl_in_type  v1_in_type  v2_in_type vr_in_type Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
  <span class="keyword1"><span class="command">have</span></span> lanes_v2<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v2</span> <span class="main">=</span> lan <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> own_v2<span class="main">:</span><span class="quoted"><span class="quoted">"own <span class="skolem">v2</span> <span class="main">=</span> own <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ext_v2<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="skolem">v2</span> <span class="main">=</span>ext <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> v2 v2_in_type Abs_real_int_inverse  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_real_int_inverse<span class="main">)</span>   
  <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">vl</span> <span class="bound">vr</span> <span class="bound">vu</span> <span class="bound">vd</span><span class="main">.</span> <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="bound">vl</span><span class="main">∥</span><span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v1</span><span class="main">=</span><span class="bound">v2</span><span class="main">∥</span><span class="bound">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">vd</span><span class="main">--</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="bound">vu</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lan <span class="free">v'</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vd</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vd</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> <span class="main">∅</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span><span class="main">⦈</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> v3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v'</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vu</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> <span class="main">∅</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vd v3 vu True vchop_def nat_int.nchop_def nat_int.un_empty_absorb1 
        nat_int.un_empty_absorb2 nat_int.inter_empty1 nat_int.inter_empty2 lanes_v2
        own_v2 ext_v2 assm_exp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hchops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> v'_neq_empty<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="free">v'</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm_exp nat_int.card_empty_zero nat_int.card_non_empty_geq_one 
          nat_int.card_subset_le le_0_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lan <span class="free">v</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vd</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vu</span></span> <span class="keyword2"><span class="keyword">where</span></span> vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vd</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> <span class="main">∅</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> v3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v'</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vu</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v'</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> vd v3 vu False vchop_def nat_int.nchop_def
          nat_int.un_empty_absorb1 nat_int.un_empty_absorb2
          nat_int.inter_empty1 nat_int.inter_empty2 lanes_v2 own_v2 ext_v2 assm_exp
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> hchops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span><span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse assm_exp atLeastatMost_subset_iff leI le_antisym
              nat_int.leq_max_sup nat_int.leq_min_inf nat_int.maximum_def nat_int.minimum_def
              nat_int.rep_non_empty_means_seq less_eq_nat_int.rep_eq False True 
              v'_neq_empty<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vd</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vu</span></span> 
          <span class="keyword2"><span class="keyword">where</span></span> vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vd</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> <span class="main">∅</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span><span class="main">⦈</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> v3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v'</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vu</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> 
            Abs_nat_int<span class="main">(</span><span class="main">{</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> vu_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">..</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">n</span><span class="main">.</span><span class="main">{</span><span class="bound">m</span><span class="main">..</span><span class="bound">n</span> <span class="main">}</span><span class="main">=</span><span class="bound">S</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> consec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">vu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Suc_leI   nat_int.consec_def nat_int.leq_min_inf' 
              nat_int.leq_nat_non_empty True  vu<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> disjoint<span class="main">:</span><span class="quoted"><span class="quoted">" lan <span class="free">v</span> <span class="main">⊓</span>  lan <span class="skolem">vu</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> consec nat_int.consec_inter_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> union<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="free">v'</span> <span class="main">=</span> lan <span class="free">v</span> <span class="main">⊔</span> lan <span class="skolem">vu</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_leI consec leq_max_sup' max min
              nat_int.consec_un_equality nat_int.consec_un_max nat_int.consec_un_min 
              select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> v'_neq_empty vu<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vd v3 vu vchop_def nat_int.nchop_def nat_int.un_empty_absorb1 
            nat_int.un_empty_absorb2 nat_int.inter_empty1 nat_int.inter_empty2
            lanes_v2 own_v2 ext_v2 assm_exp vu_in_type  Abs_nat_int_inverse
            consec union disjoint select_convs
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hchops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>         
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  min<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Min_le True assm_exp finite_atLeastAtMost le_neq_implies_less 
              less_eq_nat_int.rep_eq nat_int.el.rep_eq nat_int.minimum_def 
              nat_int.minimum_in rep_non_empty_means_seq subsetCE v'_neq_empty<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vd</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vu</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> 
              vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vd</span> <span class="main">=</span> 
              <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span>
                lan <span class="main">=</span> Abs_nat_int <span class="main">(</span><span class="main">{</span><span class="keyword1">minimum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span><span class="main">..</span><span class="keyword1">minimum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
                own <span class="main">=</span> own <span class="free">v'</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> 
            v3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> 
            vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vu</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> <span class="main">∅</span> <span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> consec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>lan <span class="skolem">vd</span><span class="main">)</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True leq_max_sup' leq_nat_non_empty min 
              nat_int.consec_def vd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec consec_un_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> max'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec consec_un_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>   
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastatMost_empty_iff vd bot_nat_int.abs_eq consec 
                nat_int.consec_def nat_int.leq_min_inf' select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> union<span class="main">:</span><span class="quoted"><span class="quoted">" lan <span class="free">v'</span> <span class="main">=</span> lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="free">v</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec max' min' nat_int.consec_un_equality v'_neq_empty
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assm_exp consec ext_v2 lanes_v2 nat_int.nchop_def nat_int.un_empty_absorb1
              own_v2 v3 vd view.vchop_def vu <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> hchops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm_exp atLeastatMost_subset_iff nat_int.leq_max_sup 
                nat_int.maximum_def nat_int.rep_non_empty_means_seq less_eq_nat_int.rep_eq
                True order.not_eq_order_implies_strict v'_neq_empty<span class="main">)</span>              
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vd</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vu</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> vd<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">vd</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span>
                      lan <span class="main">=</span> Abs_nat_int <span class="main">(</span><span class="main">{</span><span class="keyword1">minimum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span><span class="main">..</span><span class="keyword1">minimum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
                      own <span class="main">=</span> own <span class="free">v'</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> v3<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="skolem">v3</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">v</span> <span class="main">⊔</span> lan <span class="skolem">vu</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> vu<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="skolem">vu</span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> ext <span class="skolem">v2</span><span class="main">,</span> 
                    lan <span class="main">=</span> Abs_nat_int <span class="main">(</span><span class="main">{</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">..</span><span class="keyword1">maximum</span><span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
                    own <span class="main">=</span> own <span class="free">v'</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> consec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">vu</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True leq_nat_non_empty max nat_int.consec_def nat_int.leq_min_inf'
              vu 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                    
          <span class="keyword1"><span class="command">have</span></span> union<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v3</span> <span class="main">=</span> lan <span class="free">v</span> <span class="main">⊔</span> lan <span class="skolem">vu</span>"</span></span>      
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v3 min max consec<span class="main">)</span>              
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> chop1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assm_exp consec ext_v2 nat_int.nchop_def v3 view.vchop_def
              vu
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> min_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> chop1 consec nat_int.chop_min vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> neq3<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v3</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI consec nat_int.consec_def nat_int.un_subset2
                union<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> consec2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>lan <span class="skolem">vd</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">v3</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> min consec union min_eq Suc_leI nat_int.consec_def nat_int.leq_max_sup'
              nat_int.leq_min_inf' nat_int.leq_nat_non_empty neq3 v3 vd 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>   
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec2 consec_un_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vd atLeastatMost_empty_iff2 bot_nat_int.abs_eq consec2 leq_min_inf'
                nat_int.consec_def select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span>lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">v3</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec2 consec_un_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span>lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vu</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec consec_un_max union <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> max'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="skolem">vd</span> <span class="main">⊔</span>lan <span class="skolem">v3</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_leI max nat_int.leq_max_sup' 
                select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vu<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> union2<span class="main">:</span><span class="quoted"><span class="quoted">" lan <span class="free">v'</span> <span class="main">=</span> lan <span class="skolem">vd</span> <span class="main">⊔</span> lan <span class="skolem">v3</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> min max consec2 neq3 min' max' nat_int.consec_un_equality v'_neq_empty 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> union2 chop1 consec2 nat_int.nchop_def v2 v3 vd 
              view.vchop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hchops <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">vl</span> <span class="bound">vr</span> <span class="bound">vu</span> <span class="bound">vd</span><span class="main">.</span> <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="bound">vl</span><span class="main">∥</span><span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v1</span><span class="main">=</span><span class="bound">v2</span><span class="main">∥</span><span class="bound">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">vd</span><span class="main">--</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="bound">vu</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vl</span></span> <span class="skolem"><span class="skolem">vr</span></span> <span class="skolem"><span class="skolem">vu</span></span> <span class="skolem"><span class="skolem">vd</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="skolem">vl</span><span class="main">∥</span><span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">=</span><span class="skolem">v2</span><span class="main">∥</span><span class="skolem">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> horizontal_chop_leq1 horizontal_chop_leq2 order_trans vertical_chop_leq1
        vertical_chop_leq2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The switch relation is compatible with the chopping relations, in the 
following sense. If we can chop a view \(v\) into two subviews \(u\) and
\(w\), and we can reach \(v^\prime\) via the switch relation, then
there also exist two subviews \(u^\prime\), \(w^\prime\) of \(v^\prime\),
such that \(u^\prime\) is reachable from \(u\) (and respectively for \(w^\prime\), \(w\)).
›</span></span>
  <span class="comment1">(* switch lemmas *)</span>
<span class="keyword1" id="Views-switch_unique"><span class="command">lemma</span></span> switch_unique<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟶</span><span class="free">u</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-switch_exists"><span class="command">lemma</span></span> switch_exists<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">u</span><span class="main">.</span><span class="main">(</span> <span class="free">v</span><span class="main">=</span><span class="bound">c</span><span class="main">&gt;</span><span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-switch_always_exists"><span class="command">lemma</span></span> switch_always_exists<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">c</span><span class="main">&gt;</span><span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> select_convs switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_origin"><span class="command">lemma</span></span> switch_origin<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">=</span><span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">&gt;</span><span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> switch_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-switch_refl"><span class="command">lemma</span></span> switch_refl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">&gt;</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_symm"><span class="command">lemma</span></span> switch_symm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">u</span><span class="main">=</span><span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">&gt;</span><span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_trans"><span class="command">lemma</span></span> switch_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">u</span><span class="main">=</span><span class="free">d</span><span class="main">&gt;</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">d</span><span class="main">&gt;</span><span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_triangle"><span class="command">lemma</span></span> switch_triangle<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">d</span><span class="main">&gt;</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">u</span><span class="main">=</span><span class="free">d</span><span class="main">&gt;</span><span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Views-switch_hchop1"><span class="command">lemma</span></span> switch_hchop1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span> <span class="bound">v1'</span> <span class="bound">v2'</span><span class="main">.</span> <span class="main">(</span><span class="free">v1</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="bound">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="bound">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="bound">v1'</span><span class="main">∥</span><span class="bound">v2'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs view.hchop_def view.switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_hchop2"><span class="command">lemma</span></span> switch_hchop2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="free">v1'</span><span class="main">∥</span><span class="free">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v1</span><span class="main">∥</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs view.hchop_def view.switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_vchop1"><span class="command">lemma</span></span> switch_vchop1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">v1'</span> <span class="bound">v2'</span><span class="main">.</span> <span class="main">(</span><span class="free">v1</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="bound">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="bound">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="bound">v1'</span><span class="main">--</span><span class="bound">v2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs view.vchop_def view.switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_vchop2"><span class="command">lemma</span></span> switch_vchop2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v'</span><span class="main">=</span><span class="free">v1'</span><span class="main">--</span><span class="free">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v1</span><span class="main">--</span><span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> select_convs view.vchop_def view.switch_def<span class="main">)</span>
    
<span class="keyword1" id="Views-switch_leq"><span class="command">lemma</span></span> switch_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="free">v</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> more_eq<span class="main">:</span><span class="quoted"><span class="quoted">"more <span class="free">v</span> <span class="main">=</span> more <span class="free">u</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> view.switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span>ext <span class="free">u'</span><span class="main">,</span> lan <span class="main">=</span> lan <span class="free">u'</span><span class="main">,</span> own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ext<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="skolem">v'</span> <span class="main">≤</span> ext <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm switch_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_view_ext_def v'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lan<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v'</span> <span class="main">≤</span> lan <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm switch_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_view_ext_def v'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> more<span class="main">:</span><span class="quoted"><span class="quoted">"more <span class="skolem">v'</span> <span class="main">≤</span> more <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> more_eq assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_view_ext_def ext lan more v'_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_view_ext_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> switch<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="free">u'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v'_def switch_def assm 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_view_ext_def<span class="main">)</span>     
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span> <span class="bound">v'</span> <span class="main">=</span> <span class="free">c</span> <span class="main">&gt;</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">v'</span> <span class="main">≤</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> switch less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Restriction">
<div class="head">
<h1>Theory Restriction</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Restriction.thy
    Author:     Sven Linker

Restrict a function from cars to lanes to a given view. Will be
used for claim and reservation functions of Traffic Snapshots.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Restrict Claims and Reservations to a View›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
To model that a view restricts the number of lanes a car may 
perceive, we define a function \(restrict\) taking a view \(v\), a function
\(f\) from cars to lanes and a car \(f\), and returning the intersection
between \(f(c)\) and the set of lanes of \(v\). This function
will in the following only be applied to the functions yielding
reservations and claims from traffic snapshots. 

The lemmas of this section describe the connection between 
\(restrict\) and the different operations on traffic snapshots
and views (e.g., the transition relations or the fact that 
reservations and claims are consecutive).
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Restriction
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Traffic">Traffic</a> <a href="#Views">Views</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">locale</span></span> restriction <span class="main">=</span> view<span class="main">+</span>traffic
<span class="keyword2"><span class="keyword">begin</span></span>
  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"view <span class="main">⇒</span> <span class="main">(</span>cars <span class="main">⇒</span> lanes<span class="main">)</span> <span class="main">⇒</span> cars <span class="main">⇒</span> lanes"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">restrict</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">==</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⊓</span>  lan <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>  
    
<span class="keyword1" id="Restriction-restrict_def'"><span class="command">lemma</span></span> restrict_def'<span class="main">:</span><span class="quoted"><span class="quoted">" restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_commute restriction.restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restrict_subseteq"><span class="command">lemma</span></span> restrict_subseteq<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">f</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_le1 restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restrict_clm"><span class="command">lemma</span></span> restrict_clm <span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> inf_le1 restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restrict_res"><span class="command">lemma</span></span> restrict_res<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_le1 restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restrict_view"><span class="command">lemma</span></span> restrict_view<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_le1 restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restriction_stable"><span class="command">lemma</span></span> restriction_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">u</span> <span class="free">f</span>  <span class="free">c</span> <span class="main">=</span> restrict <span class="free">w</span> <span class="free">f</span>  <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hchop_def restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restriction_stable1"><span class="command">lemma</span></span> restriction_stable1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">v</span> <span class="free">f</span>  <span class="free">c</span> <span class="main">=</span> restrict <span class="free">u</span> <span class="free">f</span>  <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def restrict_def<span class="main">)</span>
    
<span class="keyword1" id="Restriction-restriction_stable2"><span class="command">lemma</span></span> restriction_stable2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">∥</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">v</span> <span class="free">f</span>  <span class="free">c</span> <span class="main">=</span> restrict <span class="free">w</span> <span class="free">f</span>  <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restriction_stable restriction_stable1<span class="main">)</span>
    
<span class="keyword1" id="Restriction-restriction_un"><span class="command">lemma</span></span> restriction_un<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span>restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊔</span> restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.inter_distr1 nat_int.inter_empty1 nat_int.un_empty_absorb1
    nat_int.un_empty_absorb2 nat_int.nchop_def restrict_def vchop_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Restriction-restriction_mon1"><span class="command">lemma</span></span> restriction_mon1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> inf_mono nat_int.chop_subset1 restrict_def vchop_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> order_refl<span class="main">)</span>
    
<span class="keyword1" id="Restriction-restriction_mon2"><span class="command">lemma</span></span> restriction_mon2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> inf_mono nat_int.chop_subset2 restrict_def vchop_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> order_refl<span class="main">)</span>

<span class="keyword1" id="Restriction-restriction_disj"><span class="command">lemma</span></span> restriction_disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="free">u</span> <span class="main">⊓</span> lan <span class="free">w</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vchop_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inter_empty1 nat_int.consec_inter_empty nat_int.nchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> lan <span class="free">u</span> <span class="main">⊓</span> lan <span class="free">w</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono restriction.restrict_view<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot.extremum_uniqueI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Restriction-vertical_chop_restriction_res_consec_or_empty"><span class="command">lemma</span></span> vertical_chop_restriction_res_consec_or_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="keyword1">consec</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  
    <span class="main">¬</span><span class="keyword1">consec</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> 
      <span class="main">⟶</span> restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span>
      <span class="keyword1">consec</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">¬</span><span class="keyword1">consec</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span>
   <span class="main">(</span><span class="keyword1">maximum</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span><span class="keyword1">minimum</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_int.consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> empty_or_non_consec<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="keyword1">maximum</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span><span class="keyword1">minimum</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> consec_lanes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> subs<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restrict_view
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> max<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">maximum</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span><span class="keyword1">minimum</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> empty_or_non_consec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ex_n<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.el.rep_eq non_empty nat_int.non_empty_elem_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> res1_or2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">|</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 atLeastOneRes atMostTwoRes dual_order.antisym le_SucE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> res_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> one_lane<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm equals0D nat_int.el.rep_eq less_eq_nat_int.rep_eq 
            nat_int.non_empty_elem_in restrict_res singletonI subset_singletonD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_lane assm inf.absorb1 less_eq_nat_int.rep_eq restriction.restrict_res
            restriction_disj subset_singleton_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">using</span></span> ex_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> res_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> ex_two_ln<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> consecutiveRes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span><span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> rep_restrict_v1<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq restrict_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> 
         <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∈</span> Rep_nat_int<span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm bot.extremum_unique less_eq_nat_int.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> suc_n_in_res_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> suc_n_in_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq restrict_view <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm vchop_def nat_int.nchop_def nat_int.consec_in_exclusive1 
            nat_int.el.rep_eq nat_int.not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> suc_n_not_in_res_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v2</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">≥</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> consec_lanes nat_int.minimum_def nat_int.consec_def 
            nat_int.el.rep_eq atLeastAtMost_iff nat_int.leq_min_inf
            nat_int.rep_non_empty_means_seq<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v2</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm nat_int.consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v2</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> consec_lanes nat_int.maximum_def nat_int.card_seq 
            nat_int.consec_def suc_n_in_v1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_int.consec_lesser<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> suc_n_in_v1 assm nat_int.consec_def nat_int.el.rep_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∉</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq rev_subsetD subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> insert_absorb insert_ident insert_not_empty n_def less_eq_nat_int.rep_eq
            restrict_res singleton_insert_inj_eq subset_insert suc_n_not_in_res_v2 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> n_in_res_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> n_not_in_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm vchop_def nat_int.nchop_def  nat_int.consec_in_exclusive1 
            nat_int.consec_in_exclusive2 nat_int.el.rep_eq nat_int.not_in.rep_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_eq_nat_int.rep_eq restrict_view subsetCE<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> n_not_in_res_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∈</span> Rep_nat_int<span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> insert_absorb insert_ident insert_not_empty n_def n_not_in_res_v2
              less_eq_nat_int.rep_eq restrict_res singleton_insert_inj_eq' subset_insert 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">NN</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> nat <span class="main">⇒</span> nat set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">x0</span> <span class="main">=</span> insert <span class="bound">x1</span> <span class="bound">v2</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">v2</span><span class="main">)</span> 
              <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span> <span class="main">=</span> insert <span class="bound">x1</span> <span class="main">(</span><span class="skolem">NN</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="skolem">NN</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> 
              insert <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">NN</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">∧</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∉</span> <span class="skolem">NN</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mk_disjoint_insert True<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">NN</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⊆</span> <span class="main">{</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">∪</span><span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insert_is_Un n_def n_not_in_res_v2 less_eq_nat_int.rep_eq
                restrict_res subset_insert<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.minimum <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Min_singleton nat_int.minimum_def non_empty<span class="main">)</span>              
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> suc_n_in_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> nat_int.el.rep_eq less_eq_nat_int.rep_eq subs True
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v1</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">≤</span> <span class="keyword1">maximum</span> <span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atLeastAtMost_iff consec_lanes nat_int.maximum_def  nat_int.consec_def
              nat_int.el.rep_eq nat_int.leq_max_sup nat_int.rep_non_empty_means_seq<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v1</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm 
            <span class="keyword1"><span class="command">using</span></span> nat_int.consec_lesser nat_int.minimum_in nat_int.consec_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">.</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="free">v1</span> <span class="main">⟶</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> consec_lanes  nat_int.card_seq nat_int.consec_def suc_n_in_v2 
              nat_int.consec_lesser <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> suc_n_not_in_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>lan <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> nat_int.el.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> suc_n_not_in_res_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">∉</span> Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> less_eq_nat_int.rep_eq restrict_view suc_n_not_in_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> rep_restrict_v1 <span class="keyword2"><span class="keyword">and</span></span> n_in_res_v1 <span class="keyword1"><span class="command">have</span></span> res_v1_singleton<span class="main">:</span>
            <span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Set.set_insert insert_absorb2 insert_commute singleton_insert_inj_eq'
              subset_insert suc_n_not_in_res_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_int.maximum <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse nat_int.leq_max_sup' order_refl 
                res_v1_singleton nat_int.rep_single<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> min <span class="keyword2"><span class="keyword">and</span></span> max <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="keyword1">maximum</span> <span class="main">(</span>restrict <span class="free">v1</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>restrict <span class="free">v2</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
            <span class="keyword1"><span class="command">using</span></span> empty_or_non_consec non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Restriction-restriction_consec_res"><span class="command">lemma</span></span> restriction_consec_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> 
  <span class="main">⟶</span> restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> 
  <span class="main">∨</span>  <span class="keyword1">consec</span> <span class="main">(</span>restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span> restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> 
  <span class="main">∨</span>  <span class="keyword1">consec</span> <span class="main">(</span>restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span> restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span><span class="main">∅</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True inter_empty1 restriction.restrict_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assm inter_empty1 nat_int.nchop_def 
          restriction.restrict_def restriction.vertical_chop_restriction_res_consec_or_empty
          view.vchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Restriction-restriction_clm_res_disjoint"><span class="command">lemma</span></span> restriction_clm_res_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf_assoc nat_int.inter_empty2 restriction.restrict_def
      restrict_def' traffic.disjoint<span class="main">)</span>
    
<span class="keyword1" id="Restriction-el_in_restriction_clm_singleton"><span class="command">lemma</span></span> el_in_restriction_clm_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⟶</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_nat_int<span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> n_in_restr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊓</span> <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∩</span> Rep_nat_int <span class="main">(</span>lan <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_nat_int.rep_eq nat_int.el_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> n_in_rep_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span><span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_int.el.rep_eq nat_int.non_empty_elem_in 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_int.card_non_empty_geq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> atMostOneClm le_antisym 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> n_in_rep_clm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_nat_int<span class="main">(</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse nat_int.singleton singletonD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Restriction-restriction_clm_v2_non_empty_v1_empty"><span class="command">lemma</span></span> restriction_clm_v2_non_empty_v1_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span>  
    <span class="keyword1">consec</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>lan <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∧</span> <span class="keyword1">consec</span> <span class="main">(</span>lan <span class="free">u</span><span class="main">)</span> <span class="main">(</span>lan <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_in_res_v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm maximum_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_nat_int<span class="main">(</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_in_res_v2  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> el_in_restriction_clm_singleton<span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm inf.absorb_iff2 inf_commute less_eq_nat_int.rep_eq 
        n_in_res_v2 nat_int.el.rep_eq nat_int.in_singleton restriction.restrict_subseteq
        restriction.restriction_disj subsetI<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Restriction-restriction_consec_clm"><span class="command">lemma</span></span> restriction_consec_clm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="keyword1">consec</span> <span class="main">(</span>lan <span class="free">u</span><span class="main">)</span> <span class="main">(</span>lan <span class="free">w</span><span class="main">)</span> 
    <span class="main">⟶</span> restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_un_add nat_int.card_empty_zero restriction_un atMostOneClm
    nat_int.chop_add1 nat_int.inter_distr1 nat_int.inter_empty1 nat_int.un_empty_absorb1
    nat_int.un_empty_absorb2 nat_int.nchop_def restrict_def vchop_def 
    restriction_clm_v2_non_empty_v1_empty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    
    
    
<span class="keyword1" id="Restriction-restriction_add_res"><span class="command">lemma</span></span> restriction_add_res<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">+</span><span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊓</span> restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> restriction.restriction_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">=</span>restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">⊔</span>restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> restriction.restriction_un <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">+</span><span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_cancel_left_left assm nat_int.card_empty_zero
        nat_int.card_un_add nat_int.un_empty_absorb1 nat_int.un_empty_absorb2 
        restriction.restriction_consec_res<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>    
  
<span class="keyword1" id="Restriction-restriction_eq_view_card"><span class="command">lemma</span></span> restriction_eq_view_card<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span> <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span><span class="main">|</span>lan <span class="free">v</span><span class="main">|</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="Restriction-restriction_card_mon1"><span class="command">lemma</span></span> restriction_card_mon1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">u</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_subset_le restriction_mon1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
    
<span class="keyword1" id="Restriction-restriction_card_mon2"><span class="command">lemma</span></span> restriction_card_mon2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">w</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_subset_le restriction_mon2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
    
<span class="keyword1" id="Restriction-restriction_res_leq_two"><span class="command">lemma</span></span> restriction_res_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atMostTwoRes nat_int.card_subset_le le_trans restrict_res
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    
<span class="keyword1" id="Restriction-restriction_clm_leq_one"><span class="command">lemma</span></span> restriction_clm_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atMostOneClm nat_int.card_subset_le le_trans restrict_clm
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    

<span class="keyword1" id="Restriction-restriction_add_clm"><span class="command">lemma</span></span> restriction_add_clm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">+</span><span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">u</span><span class="main">--</span><span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def le_0_eq le_SucE restriction.restriction_clm_leq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">+</span><span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> clm_u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> clm_u card_non_empty_geq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assm card_empty_zero inf_commute inter_empty2
          nat_int.nchop_def restriction.restrict_def 
          restriction.restriction_clm_v2_non_empty_v1_empty view.vchop_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_0_right assm clm_u inf.absorb1 inf_commute 
          restriction.restriction_card_mon1 restriction.restriction_clm_leq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> no_clm_u<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">u</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def le_0_eq le_SucE restriction.restriction_clm_leq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> no_clm_u add_cancel_left_left antisym_conv3 assm leD 
            restriction.restriction_card_mon2 restriction.restriction_clm_leq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> no_clm_w<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">w</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm card_empty_zero chop_empty 
            nat_int.card_non_empty_geq_one nat_int.nchop_def no_clm_u 
            restriction.restriction_un<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> no_clm_u no_clm_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Restriction-restriction_card_mon_trans"><span class="command">lemma</span></span> restriction_card_mon_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">v3</span><span class="main">--</span><span class="free">v4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">|</span>restrict <span class="free">v3</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span><span class="main">≥</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI neq0_conv not_less_eq_eq 
      restriction_card_mon1 restriction_card_mon2<span class="main">)</span>

    
<span class="keyword1" id="Restriction-restriction_card_somewhere_mon"><span class="command">lemma</span></span> restriction_card_somewhere_mon<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">vl</span><span class="main">∥</span><span class="free">v1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v2</span><span class="main">∥</span><span class="free">vr</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">vu</span><span class="main">--</span><span class="free">v3</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v3</span><span class="main">=</span><span class="free">v'</span><span class="main">--</span><span class="free">vd</span><span class="main">)</span><span class="main">∧</span><span class="main">|</span>restrict <span class="free">v'</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">1</span>
      <span class="main">⟶</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">vl</span><span class="main">∥</span><span class="free">v1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v1</span><span class="main">=</span><span class="free">v2</span><span class="main">∥</span><span class="free">vr</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v2</span><span class="main">=</span><span class="free">vu</span><span class="main">--</span><span class="free">v3</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">v3</span><span class="main">=</span><span class="free">v'</span><span class="main">--</span><span class="free">vd</span><span class="main">)</span><span class="main">∧</span><span class="main">|</span>restrict <span class="free">v'</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v2</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restriction_card_mon_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restriction_stable1 restriction_stable2 assm
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Restriction-restrict_eq_lan_subs"><span class="command">lemma</span></span> restrict_eq_lan_subs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">∧</span> <span class="main">(</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span> <span class="main">∧</span> <span class="main">(</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_int.card_non_empty_geq_one nat_int.card_empty_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lan <span class="free">v</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm nat_int.card_empty_zero nat_int.card_non_empty_geq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> res_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> non_eq<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">≠</span> lan <span class="free">v</span>"</span></span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span> <span class="main">&lt;</span> lan <span class="free">v</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assm less_le<span class="main">)</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="free">f</span> <span class="free">c</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span>lan <span class="free">v</span><span class="main">|</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> card_subset_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Restriction-create_reservation_restrict_union"><span class="command">lemma</span></span> create_reservation_restrict_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> 
    <span class="main">⟶</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊔</span> restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> res_ts'<span class="main">:</span><span class="quoted"><span class="quoted">"res <span class="free">ts'</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊔</span> clm <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> create_reservation_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊔</span> restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> res_ts'eq_ts<span class="main">:</span><span class="quoted"><span class="quoted">"res <span class="free">ts'</span> <span class="free">c</span> <span class="main">=</span> res <span class="free">ts</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> res_ts' nat_int.un_empty_absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> restrict_clm<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.inter_empty2 restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> res_ts'eq_ts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> restrict_clm 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_int.un_empty_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="keyword1">consec</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clm_consec_res<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> consec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> inter_distr1 res_ts' restriction.restrict_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_ac<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_commute nat_int.union_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> consec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">consec</span> <span class="main">(</span>res <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_distr2 res_ts' restriction.restrict_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  <span class="comment1">(* switch lemmas *)</span>
<span class="keyword1" id="Restriction-switch_restrict_stable"><span class="command">lemma</span></span> switch_restrict_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">u</span><span class="main">)</span> <span class="main">⟶</span> restrict <span class="free">v</span> <span class="free">f</span> <span class="free">d</span> <span class="main">=</span> restrict <span class="free">u</span> <span class="free">f</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def<span class="main">)</span> 
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Move">
<div class="head">
<h1>Theory Move</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Move.thy
    Author:     Sven Linker

  The move function shifts a view by the difference in position of the owner of the view.
  The lanes and owner itself are not changed.

*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Move a View according to Difference between Traffic Snapshots›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section, we define a function to move a view according
to the changes between two traffic snapshots. The intuition is
that the view moves with the same speed as its owner. That is,
if we move a view \(v\) from \(ts\) to \(ts^\prime\), we 
shift the extension of the view by the difference in the
position of the owner of \(v\).
›</span></span>


<span class="keyword1"><span class="command">theory</span></span> Move
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Traffic">Traffic</a> <a href="#Views">Views</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> traffic 
<span class="keyword2"><span class="keyword">begin</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">move</span><span class="main">::</span><span class="quoted"><span class="quoted">"traffic <span class="main">⇒</span> traffic <span class="main">⇒</span> view <span class="main">⇒</span> view"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">move</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">⦇</span> ext <span class="main">=</span> <span class="keyword1">shift</span> <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts'</span></span></span> <span class="main">(</span>own <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">(</span>own <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                       lan <span class="main">=</span> lan <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> 
                       own <span class="main">=</span>own <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Move-move_keeps_length"><span class="command">lemma</span></span> move_keeps_length<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>ext <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_int.shift_keeps_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> move_def<span class="main">)</span>

<span class="keyword1" id="Move-move_keeps_lanes"><span class="command">lemma</span></span> move_keeps_lanes<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="free">v</span> <span class="main">=</span> lan <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Move-move_keeps_owner"><span class="command">lemma</span></span> move_keeps_owner<span class="main">:</span><span class="quoted"><span class="quoted">"own <span class="free">v</span> <span class="main">=</span> own <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Move-move_nothing"><span class="command">lemma</span></span> move_nothing <span class="main">:</span><span class="quoted"><span class="quoted">"move <span class="free">ts</span> <span class="free">ts</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> real_int.shift_zero move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Move-move_trans"><span class="command">lemma</span></span> move_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span><span class="free">ts''</span><span class="main">)</span> <span class="main">⟶</span> move <span class="free">ts'</span> <span class="free">ts''</span> <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> move <span class="free">ts</span> <span class="free">ts''</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span><span class="free">ts''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span> pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"move <span class="free">ts'</span> <span class="free">ts''</span> <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">⦇</span> ext <span class="main">=</span> 
    <span class="keyword1">shift</span> <span class="main">(</span>ext <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> pos <span class="free">ts'</span> <span class="main">(</span>own <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
     lan <span class="main">=</span> lan <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> 
     own <span class="main">=</span> own <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="main">⦈</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"move <span class="free">ts'</span> <span class="free">ts''</span> <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> 
 <span class="main">⦇</span> ext <span class="main">=</span> <span class="keyword1">shift</span> <span class="main">(</span>ext <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">-</span> pos <span class="free">ts'</span> <span class="main">(</span>own  <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  lan <span class="main">=</span> lan  <span class="free">v</span><span class="main">,</span> own <span class="main">=</span> own  <span class="free">v</span> <span class="main">⦈</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"move <span class="free">ts'</span> <span class="free">ts''</span> <span class="main">(</span>move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> move <span class="free">ts</span> <span class="free">ts''</span> <span class="free">v</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">+</span> <span class="bound">x0</span> <span class="main">=</span> <span class="bound">x0</span> <span class="main">+</span> <span class="bound">x1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span>
          <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">*</span>pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">*</span>pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span> pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">shift</span> <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span>  pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="keyword1">shift</span> <span class="main">(</span><span class="keyword1">shift</span>  <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">(</span>pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> pos <span class="free">ts</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>pos <span class="free">ts''</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">1</span> <span class="main">*</span> pos <span class="free">ts'</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f2 real_int.shift_additivity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> move_def f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Move-move_stability_res"><span class="command">lemma</span></span> move_stability_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> move_stability_clm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">c</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> move_stability_wdr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">c</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> move_stability_wdc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> move <span class="free">ts</span> <span class="free">ts'</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_reservation_def create_claim_def withdraw_reservation_def
    withdraw_claim_def move_def move_nothing 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sensors">
<div class="head">
<h1>Theory Sensors</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:     Sensors.thy
    Author:     Sven Linker

Defines perfect sensors for cars. Cars can perceive both
the physical size and braking distance of all other cars.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Sensors for Cars›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section presents the abstract definition of a function
determining the sensor capabilities of cars. Such a function
takes a car \(e\), a traffic snapshot \(ts\) and another
car \(c\), and returns the length of \(c\) as perceived
by \(e\) at the situation determined by \(ts\). The 
only restriction we impose is that this length is always
greater than zero.

With such a function, we define a derived notion of the
\emph{space} the car \(c\) occupies as perceived by \(e\).
However, this does not define the lanes \(c\) occupies, but
only a continuous interval. The lanes occupied by \(c\) 
are given by the reservation and claim functions of 
the traffic snapshot \(ts\).
›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Sensors
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Traffic">Traffic</a>"</span> <span class="quoted">"<a href="#Views">Views</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">locale</span></span> sensors <span class="main">=</span> traffic <span class="main">+</span> view <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sensors</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>cars<span class="main">)</span> <span class="main">⇒</span> traffic <span class="main">⇒</span> <span class="main">(</span>cars<span class="main">)</span> <span class="main">⇒</span> real"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sensors_ge<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sensors</span> <span class="free">e</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">space</span> <span class="main">::</span><span class="quoted"><span class="quoted">" traffic <span class="main">⇒</span> view <span class="main">⇒</span> cars <span class="main">⇒</span> real_int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">space</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> Abs_real_int <span class="main">(</span>pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> pos <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="free">sensors</span> <span class="main">(</span>own <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
    
<span class="keyword1" id="Sensors-left_space"><span class="command">lemma</span></span> left_space<span class="main">:</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> pos <span class="free">ts</span> <span class="free">c</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"pos <span class="free">ts</span> <span class="free">c</span> <span class="main">&lt;</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> <span class="free">sensors</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sensors_ge  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  less_add_same_cancel1  <span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">)</span> <span class="main">=</span> pos <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> space_def Abs_real_int_inverse 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Sensors-right_space"><span class="command">lemma</span></span> right_space<span class="main">:</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span>   pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> <span class="free">sensors</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"pos <span class="free">ts</span> <span class="free">c</span> <span class="main">&lt;</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> <span class="free">sensors</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sensors_ge  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  less_add_same_cancel1  <span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"right<span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">)</span> <span class="main">=</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> <span class="free">sensors</span> <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> space_def Abs_real_int_inverse 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Sensors-space_nonempty"><span class="command">lemma</span></span> space_nonempty<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> left_space right_space sensors_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Length">
<div class="head">
<h1>Theory Length</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Length.thy
    Author:     Sven Linker

The length of cars visible to the owner of a given view.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Visible Length of Cars with Perfect Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Given a sensor function, we can define the length
of a car \(c\) as perceived by the owner of a view \(v\). This
length is restricted by the size of the extension of the view \(v\),
but always given by a continuous interval, which may possibly
be degenerate (i.e., a point-interval).

The lemmas connect the end-points of the perceived length
with the end-points of the current view. Furthermore, they
show how the chopping and subview relations affect
the perceived length of a car.  
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Length
  <span class="keyword2"><span class="keyword">imports</span></span>  <a href="#Sensors">Sensors</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> sensors
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">len</span><span class="main">::</span> <span class="quoted"><span class="quoted">"view <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real_int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> len_def <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">len</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">==</span>
    <span class="keyword1">if</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>  
      <span class="keyword1">then</span>  Abs_real_int <span class="main">(</span>right <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span>right <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="keyword1">else</span>
      <span class="keyword1">if</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> 
        <span class="keyword1">then</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span>left <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span>  
        Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                      min <span class="main">(</span>right <span class="main">(</span>ext <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Length-len_left"><span class="command">lemma</span></span> len_left<span class="main">:</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span>  <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse left_leq_right sensors.len_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Length-len_right"><span class="command">lemma</span></span> len_right<span class="main">:</span> <span class="quoted"><span class="quoted">" right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span>  <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse left_leq_right sensors.len_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Length-len_sub_int"><span class="command">lemma</span></span> len_sub_int<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">≤</span> ext <span class="free">v</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def len_left len_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Length-len_space_left"><span class="command">lemma</span></span> len_space_left<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_def len_left real_int.left_leq_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_less_trans not_less order.asym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> 
    Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                   min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse False assm real_int.left_leq_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1" id="Length-len_space_right"><span class="command">lemma</span></span> len_space_right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_def len_right real_int.left_leq_right 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_less_trans not_less order.asym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> 
      Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                     min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse False assm real_int.left_leq_right
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>    


<span class="keyword1" id="Length-len_hchop_left_right_border"><span class="command">lemma</span></span> len_hchop_left_right_border<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>right <span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l1 <span class="keyword2"><span class="keyword">and</span></span> l2 <span class="keyword1"><span class="command">have</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assm hchop_def real_int.rchop_def 
        real_int.left_leq_right <span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> r3<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> r3 <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> neg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse left_space len_def neg1 right.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> contra <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> less1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> neg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> len_def  neg2 assm hchop_def real_int.left_leq_right less1 space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="main">)</span><span class="free">c</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> l3 assm contra less1 len_def neg2 r2 r3  real_int.left_leq_right
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> l1 <span class="keyword1"><span class="command">have</span></span> r4<span class="main">:</span><span class="quoted"><span class="quoted">"right<span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assm l2 len_def neg2 assm hchop_def less1 real_int.left_leq_right r2
              space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> r2 r3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> r4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> contra  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> less2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> len_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
            min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Rep_real_int less1 less2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> less1 <span class="keyword2"><span class="keyword">and</span></span> less2 <span class="keyword1"><span class="command">have</span></span> len_def_v1<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span><span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def  space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> less <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> len_def_v1 <span class="keyword2"><span class="keyword">and</span></span> less <span class="keyword2"><span class="keyword">and</span></span> len_in_type
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse sndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> r4<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> len_v_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
            min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span>                 
          <span class="keyword1"><span class="command">using</span></span> r4 l2 len_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse Pair_inject r4 len_def real_int.left_leq_right 
            surjective_pairing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> r1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_hchop_left_left_border"><span class="command">lemma</span></span> len_hchop_left_left_border<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def <span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l1 <span class="keyword2"><span class="keyword">and</span></span> l2 <span class="keyword1"><span class="command">have</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assm hchop_def real_int.rchop_def 
        real_int.left_leq_right <span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> r3<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> 
      <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> greater<span class="main">:</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.order_iff_strict len_left<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> len_in_type<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
           min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Rep_real_int True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span>  
        Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                       min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> maximum<span class="main">:</span>
        <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> maximum neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> greater maximum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> l4<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> len_v_in_type<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
          min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span>   
        <span class="keyword1"><span class="command">using</span></span> len_in_type r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse l4 sensors.len_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> negative<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> empty<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> real_int.chop_assoc2 real_int.chop_singleton_right real_int.rchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> len_geq<span class="main">:</span><span class="quoted"><span class="quoted">"left<span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> l2 len_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> len_left <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>  "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> dual_order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">hence</span></span> l5<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">hence</span></span> l6<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> well_sp<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>  
            <span class="keyword1"><span class="command">using</span></span> real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> well_v<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
          <span class="keyword1"><span class="command">hence</span></span> rs_geq_vl<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> empty len_geq negative r3 well_sp <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">from</span></span> True <span class="keyword2"><span class="keyword">and</span></span> rs_geq_vl <span class="keyword1"><span class="command">have</span></span> len_in_type<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> CollectD CollectI Rep_real_int fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span><span class="free">ts</span><span class="main">)</span> <span class="free">c</span>  <span class="main">=</span> 
                Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                               min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">using</span></span> True rs_geq_vl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span> max_less<span class="main">:</span>
            <span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span>  left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> l5 assm fst_conv left.rep_eq len_in_type<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
            <span class="keyword1"><span class="command">using</span></span> empty max_less negative r3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> empty_len_v<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
            <span class="keyword1"><span class="command">using</span></span> l6 empty empty_len_v r2 r3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span> <span class="main">≤</span> space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> r4<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  less_eq_real_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">assume</span></span> left_outside<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span> <span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def real_int.left_leq_right r1 r2 l1 l2 l3 r3  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_less_trans less_trans not_less<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_view_hchop_left"><span class="command">lemma</span></span> len_view_hchop_left<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_real_int_inverse left.rep_eq len_hchop_left_left_border 
      len_hchop_left_right_border prod.collapse right.rep_eq<span class="main">)</span>

<span class="keyword1" id="Length-len_hchop_right_left_border"><span class="command">lemma</span></span> len_hchop_right_left_border<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def <span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> r1 <span class="keyword2"><span class="keyword">and</span></span> r2 <span class="keyword1"><span class="command">have</span></span> r3<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm less_eq_real_int_def real_int.chop_leq2 view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> l3 <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> neg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>   
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">,</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> len_def  neg1 assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm l2 l3 len_def neg1 r3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> contra <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> less1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> neg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span> <span class="main">≤</span> space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_real_int_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> neg2 <span class="keyword1"><span class="command">have</span></span> greater<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span> <span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> len_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">,</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> len_def  neg2 assm hchop_def   less1 space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> l4<span class="main">:</span><span class="quoted"><span class="quoted">"left<span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_def less neg2  assm hchop_def 
              CollectI len_empty prod.collapse prod.inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> l2 l3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> contra  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> less2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> len_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
            min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Rep_real_int less1 less2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> less1 <span class="keyword2"><span class="keyword">and</span></span> less2 <span class="keyword1"><span class="command">have</span></span> len_def_v2<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> less <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> l2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> len_def_v2 <span class="keyword2"><span class="keyword">and</span></span> less <span class="keyword2"><span class="keyword">and</span></span> len_in_type
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse sndI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> l5<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> l2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> len_v_in_type<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
             min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span>                 
          <span class="keyword1"><span class="command">using</span></span> r2 len_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse Pair_inject l5 len_def real_int.left_leq_right
            surjective_pairing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> l1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_hchop_right_right_border"><span class="command">lemma</span></span> len_hchop_right_right_border<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def <span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> r1 <span class="keyword2"><span class="keyword">and</span></span> r2 <span class="keyword1"><span class="command">have</span></span> r3<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm view.h_chop_middle2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> 
      <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">" right <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lesser<span class="main">:</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_right less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> len_in_type<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
          min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Rep_real_int True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
          Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                         min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_def assm hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> maximum<span class="main">:</span>
        <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> min_right<span class="main">:</span>
        <span class="quoted"><span class="quoted">"min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> maximum neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> lesser maximum <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> right_v<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> right_inside<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> True assm less_eq_real_int_def less_eq_view_ext_def 
            order_trans view.horizontal_chop_leq2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword2"><span class="keyword">and</span></span> right_inside
      <span class="keyword1"><span class="command">have</span></span> len_v_in_type<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
          min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span>   
        <span class="keyword1"><span class="command">using</span></span> min_right r2 real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse Pair_inject right_v len_def 
          real_int.left_leq_right surjective_pairing 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">∨</span> 
               <span class="main">¬</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> negative<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
       <span class="keyword1"><span class="command">using</span></span> left_space negative r1 r3 sensors.len_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> left_outside<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">,</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> len_def l2 le_less_trans not_less order.asym
            space_nonempty r2<span class="main">)</span>   
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> len_empty<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span><span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> len_def real_int.left_leq_right Abs_real_int_inverse  
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_trans not_less space_nonempty<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>right <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_real_int_inverse assm dual_order.antisym 
              left.rep_eq len len_empty prod.collapse real_int.chop_singleton_left 
              real_int.rchop_def right.rep_eq view.h_chop_middle1 view.hchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> l2 left_outside len_space_right r1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_view_hchop_right"><span class="command">lemma</span></span> len_view_hchop_right<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v2</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_real_int_inverse left.rep_eq len_hchop_right_left_border 
      len_hchop_right_right_border prod.collapse right.rep_eq<span class="main">)</span>

<span class="keyword1" id="Length-len_compose_hchop"><span class="command">lemma</span></span> len_compose_hchop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v2</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> left_v1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> right_v1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def <span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> left_v2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> right_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> right_v2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True     
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm right_v2 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def <span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right<span class="main">(</span> ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm hchop_def sensors.space_def sensors_axioms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ext <span class="free">v2</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v2</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_real_int_inverse fst_conv left.rep_eq
          real_int.chop_singleton_right real_int.length_zero_iff_borders_eq
          real_int.rchop_def right.rep_eq snd_conv surj_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm hchop_def real_int.rchop_def real_int.chop_empty2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm hchop_def len_def sensors.space_def sensors_axioms  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_left<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm left_v1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hchop_def real_int.rchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> out_v1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def sensors.space_def sensors_axioms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_def in_left 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_less_trans less_trans not_le real_int.left_leq_right<span class="main">)</span>   
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ext <span class="free">v1</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="free">v1</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral real_int.chop_singleton_left
            real_int.length_zero_iff_borders_eq real_int.rchop_def real_int.shift_def
            real_int.shift_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def real_int.rchop_def real_int.chop_empty1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def len_def sensors.space_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> in_right<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"own <span class="free">v</span> <span class="main">=</span> own <span class="free">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"own <span class="free">v</span> <span class="main">=</span> own <span class="free">v1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">R_Chop(</span>ext <span class="free">v</span><span class="main">,</span>ext <span class="free">v1</span><span class="main">,</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                      min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_def in_left in_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> len1<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                      min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm f2 f1 chop assm in_left in_right len_def len_space_left
            not_le real_int.rchop_def space_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm chop f1 f2 in_left len_space_left max.orderE
            real_int.rchop_def space_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> left_border<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> left_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> len2<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                      min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> len_def in_left in_right assm f2 f1 chop len_space_right not_le
            real_int.rchop_def space_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm chop f1 f2 in_right len_space_right min.absorb_iff1 
            real_int.rchop_def space_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right_border<span class="main">:</span>
        <span class="quoted"><span class="quoted">"min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> right_v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def sensors.space_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def sensors.space_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def real_int.rchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min max left_border right_border False add.right_neutral 
            chop in_left len_def not_le real_int.rchop_def real_int.shift_def
            real_int.shift_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Length-len_stable"><span class="command">lemma</span></span> len_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ext_eq1<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ext_eq2<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ext1_eq_ext2<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="free">v1</span> <span class="main">=</span> ext <span class="free">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm ext1_eq_ext2 left_space right_space sensors.len_def sensors_axioms 
      view.vertical_chop_own_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_empty_on_subview1"><span class="command">lemma</span></span> len_empty_on_subview1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_v_borders<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>real_int.length_zero_iff_borders_eq<span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> left_outside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>  
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm fst_conv hchop_def len_def real_int.length_zero_iff_borders_eq
        mem_Collect_eq snd_conv space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> left_inside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> right_outside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v1</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm hchop_def space_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span><span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def len_def real_int.length_def  Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> right_inside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> len_v1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                                        min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> left_inside_v1 len_def right_inside_v1 assm hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> left_inside_v1 <span class="keyword2"><span class="keyword">and</span></span> right_inside_v1 <span class="keyword1"><span class="command">have</span></span> inside_v<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Rep_real_int <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> snd <span class="main">(</span>Rep_real_int <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assm view.h_chop_middle2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assm left_inside_v1 real_int.rchop_def right_inside_v1 view.hchop_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> len_v<span class="main">:</span>
        <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                    min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> less_eq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">≤</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inside_v real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
      <span class="keyword1"><span class="command">from</span></span> len_v <span class="keyword1"><span class="command">have</span></span> len_v_empty<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse Rep_real_int_inverse inside_v
        len_v_borders local.less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> left_len_eq<span class="main">:</span>
        <span class="quoted"><span class="quoted">" max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> right_len_leq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">≥</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assm min.bounded_iff min_less_iff_conj not_le
            order_refl real_int.rchop_def view.h_chop_middle2 view.hchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> left_geq_right<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
         <span class="main">≥</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> left_len_eq len_v_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> 
          <span class="quoted"><span class="quoted">" <span class="main">¬</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">≤</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∨</span> 
              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym_conv left_geq_right left_len_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r</span> 
             <span class="main">∨</span> <span class="main">¬</span> left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r</span> 
             <span class="main">∨</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> left_len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"  min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 inside_v left_inside_v1 real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assm left_len_eq len_v len_v1 len_v_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_empty_on_subview2"><span class="command">lemma</span></span> len_empty_on_subview2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_v_borders<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>real_int.length_zero_iff_borders_eq<span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> left_outside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>  
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm fst_conv hchop_def len_def 
        real_int.length_zero_iff_borders_eq mem_Collect_eq snd_conv space_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> left_inside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> right_outside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm fst_conv hchop_def len_def 
          real_int.length_zero_iff_borders_eq mem_Collect_eq snd_conv 
          right_outside_v2 space_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> right_inside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> len_v2<span class="main">:</span>
        <span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                                     min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> left_inside_v2 len_def right_inside_v2 assm hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> left_inside_v2 <span class="keyword2"><span class="keyword">and</span></span> right_inside_v2 <span class="keyword1"><span class="command">have</span></span> inside_v<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assm view.h_chop_middle1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assm left_inside_v2 real_int.rchop_def right_inside_v2 view.hchop_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> len_v<span class="main">:</span>
        <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                                    min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> less_eq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">≤</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inside_v real_int.left_leq_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
      <span class="keyword1"><span class="command">from</span></span> len_v <span class="keyword1"><span class="command">have</span></span> len_v_empty<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse Rep_real_int_inverse inside_v
        <span class="keyword1"><span class="command">using</span></span> len_v_borders local.less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> left_len_eq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">≤</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assm left_leq_right max.mono order_refl
            real_int.rchop_def view.hchop_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> right_len_leq<span class="main">:</span>
        <span class="quoted"><span class="quoted">"  min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm real_int.rchop_def view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> left_geq_right<span class="main">:</span>
        <span class="quoted"><span class="quoted">" max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">≥</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> left_len_eq len_v_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">≥</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assm hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"  max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v2</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> antisym_conv assm hchop_def len_v_empty
            max_def min.bounded_iff not_le space_def right_inside_v2 right_len_leq
            view.h_chop_middle2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  assm hchop_def len_v len_v2 len_v_empty
            space_def right_len_leq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_hchop_add"><span class="command">lemma</span></span> len_hchop_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">∥</span><span class="free">v2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> len_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse  len_def real_int.length_zero_iff_borders_eq
          snd_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> chop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_cancel_right_left len_empty_on_subview1 len_empty_on_subview2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>   
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> len_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_real_int_inverse len_def real_int.length_zero_iff_borders_eq
            snd_eqD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> chop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_cancel_right_left len_empty_on_subview1 len_empty_on_subview2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> len_def_v<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> len_def inside_left inside_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left <span class="keyword2"><span class="keyword">and</span></span> inside_right <span class="keyword1"><span class="command">have</span></span> 
        len_in_type<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                      min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> CollectD CollectI Rep_real_int fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> inside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min_less_v1<span class="main">:</span>
          <span class="quoted"><span class="quoted">"min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type len_def_v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> outside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> chop real_int.rchop_def view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> chop dual_order.order_iff_strict
                min_less_iff_conj min_less_v1 not_less view.h_chop_middle2<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">hence</span></span> len_v2_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  Abs_real_int_inverse len_def 
            real_int.length_zero_iff_borders_eq outside_v2  snd_eqD Rep_real_int_inverse
            chop hchop_def prod.collapse real_int.rchop_def real_int.chop_singleton_right
            space_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> inside_left_v1<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> chop hchop_def inside_left real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> inside_right_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inside_right less_trans min_less_iff_disj min_less_v1 
              order.asym space_nonempty<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> len1_def<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>        
          <span class="keyword1"><span class="command">using</span></span> len_def inside_left_v1 inside_right_v1 chop hchop_def space_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> chop left_leq_right real_int.rchop_def view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> chop len1_def len_def_v min_less_v1 real_int.rchop_def view.hchop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> len_v2_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> r_inside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> inside_v2<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> max_geq_v1<span class="main">:</span><span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_in_type len_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> outside_v1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chop view.h_chop_middle1<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> chop max_geq_v1 real_int.rchop_def view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> len_v1_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse len_def real_int.length_zero_iff_borders_eq
              outside_v1 snd_eqD Rep_real_int_inverse chop hchop_def prod.collapse
              real_int.rchop_def real_int.chop_singleton_right space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> inside_left_v2<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inside_left less_max_iff_disj less_trans max_geq_v1 order.asym
                space_nonempty<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> inside_right_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> chop hchop_def inside_right real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> len2_def<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>        
            <span class="keyword1"><span class="command">using</span></span> len_def inside_left_v2 inside_right_v2 hchop_def chop space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> chop real_int.rchop_def view.h_chop_middle1
                  view.hchop_def<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> chop inside_left inside_right len2_def len_def outside_v1
                real_int.rchop_def view.hchop_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> len_v1_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> l_inside_v1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> inside_left_v1<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> chop hchop_def inside_left real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> inside_right_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse chop hchop_def l_inside_v1 len_in_type
              len_def real_int.rchop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> len1_def<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span><span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> inside_left_v1 inside_right_v1 len_def chop hchop_def space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> inside_left_v1 <span class="keyword2"><span class="keyword">and</span></span> inside_right_v1 <span class="keyword1"><span class="command">have</span></span> len1_in_type<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> CollectD CollectI Rep_real_int fst_conv snd_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> inside_left_v2<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">¬</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> real_int.rchop_def hchop_def inside_left chop Abs_real_int_inverse 
              len_def_v len_in_type r_inside_v2 snd_conv
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> inside_right_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse chop hchop_def l_inside_v1 len_in_type len_def
              real_int.rchop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> len2_def<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> 
                Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> inside_left_v2 inside_right_v2 len_def chop hchop_def space_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> inside_left_v2 <span class="keyword2"><span class="keyword">and</span></span> inside_right_v2 <span class="keyword1"><span class="command">have</span></span> len2_in_type<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span> <span class="main">::</span> real<span class="main">*</span>real <span class="main">.</span> fst <span class="bound">r</span> <span class="main">≤</span> snd <span class="bound">r</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> CollectD CollectI Rep_real_int fst_conv snd_conv 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> left_v_v1<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> chop hchop_def real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> 
               <span class="quoted"><span class="quoted">"max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> left_v_v1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">have</span></span> right_v_v2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> chop hchop_def real_int.rchop_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                <span class="main">(</span>min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>                 
            <span class="keyword1"><span class="command">using</span></span> right_v_v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> max <span class="keyword1"><span class="command">have</span></span> left_len_v1_v<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse fst_conv len1_def len1_in_type
              len_def_v len_in_type
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> min <span class="keyword1"><span class="command">have</span></span> right_len_v2_v<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse fst_conv len1_def len2_in_type len_def_v 
              len_in_type <span class="keyword1"><span class="command">using</span></span> len2_def snd_eqD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v1</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>len <span class="free">v2</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse chop hchop_def len1_def len1_in_type len2_def
              len2_in_type real_int.rchop_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">+</span> <span class="main">∥</span>len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> left_len_v1_v real_int.consec_add right_len_v2_v  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_non_empty_inside"><span class="command">lemma</span></span> len_non_empty_inside<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> 
  <span class="main">⟶</span> left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> 
              <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> 
          <span class="main">∨</span> <span class="main">¬</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∨</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> left_eq<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans real_int.left_leq_right<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> left_eq <span class="keyword2"><span class="keyword">and</span></span> inside_left <span class="keyword1"><span class="command">have</span></span> len_v<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                                         min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> left<span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_eq max_def min_def real_int.left_leq_right<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm real_int.length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm len_def real_int.length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> 
            <span class="main">∨</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> right_eq<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans real_int.left_leq_right<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> right_eq <span class="keyword2"><span class="keyword">and</span></span> inside_right <span class="keyword1"><span class="command">have</span></span> len_v<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> 
          <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max.commute max_def min_def real_int.left_leq_right right_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse assm real_int.length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> right_le<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_real_int_inverse assm left.rep_eq len_def
              length_zero_iff_borders_eq less_irrefl prod.collapse real_int.rchop_def 
              right.rep_eq view.hchop_def view.horizontal_chop_empty_left 
              view.horizontal_chop_empty_right<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-len_fills_subview"><span class="command">lemma</span></span> len_fills_subview<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> 
      <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v1</span><span class="main">∥</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">v'</span><span class="main">∥</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> len <span class="bound">v'</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="bound">v'</span> <span class="main">∧</span> 
                          <span class="main">∥</span>len <span class="bound">v'</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span> <span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">v1</span><span class="main">∥</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">v'</span><span class="main">∥</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> len <span class="bound">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="bound">v'</span> <span class="main">∧</span> 
          <span class="main">∥</span>len <span class="bound">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> inside<span class="main">:</span>
      <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> len_non_empty_inside <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> len_v<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span>max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                              min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> len_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v'</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> v1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">,</span> left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
             lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span>
             own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
           lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span>
           own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span>Abs_real_int<span class="main">(</span>left<span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
           lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span>
           own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">v3</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span>Abs_real_int<span class="main">(</span>right<span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
           lan <span class="main">=</span> lan <span class="free">v</span><span class="main">,</span>
           own <span class="main">=</span> own <span class="free">v</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">v'</span><span class="main">∥</span><span class="skolem">v3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inside hchop_def real_int.rchop_def Abs_real_int_inverse real_int.left_leq_right
        v1 v2 v' v3 len_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> right<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_real_int_inverse  v'<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inside len_space_left less_imp_le order_trans real_int.left_leq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> left<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_real_int_inverse  v'<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> left'<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inside len_space_right less_imp_le order_trans real_int.left_leq_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inside'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> left' right' antisym_conv assm inside left len_space_left
          len_space_right less_imp_le not_le real_int.left_leq_right
          real_int.length_zero_iff_borders_eq right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> inside''<span class="main">:</span>
      <span class="quoted"><span class="quoted">"left <span class="main">(</span>space <span class="free">ts</span> <span class="skolem">v'</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span>space <span class="free">ts</span> <span class="skolem">v'</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> hchop_def inside' sensors.space_def sensors_axioms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> len_v_v'<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="skolem">v'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left prod.collapse right left.rep_eq right.rep_eq Rep_real_int_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_v Abs_real_int_inverse Rep_real_int inside
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> left <span class="keyword1"><span class="command">have</span></span> left_len'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> left_len<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>left <span class="main">(</span>space <span class="free">ts</span> <span class="skolem">v'</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span>  hchop_def space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span><span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> len_v Abs_real_int_inverse inside Rep_real_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> right <span class="keyword1"><span class="command">have</span></span> right_len'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> right_len<span class="main">:</span>
      <span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>right <span class="main">(</span>space <span class="free">ts</span> <span class="skolem">v'</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>         
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span>  hchop_def space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> ext <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_len' right_len' len_v len_v_v' order.asym inside''
          len_def left_len right_len<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">∥</span>len <span class="skolem">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">∥</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> len_left len_right hchop_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"2"</span> len_v_v'<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-ext_eq_len_eq"><span class="command">lemma</span></span> ext_eq_len_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v'</span><span class="main">∧</span> own <span class="free">v</span> <span class="main">=</span> own <span class="free">v'</span> <span class="main">⟶</span> len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> len <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> left_space right_space sensors.len_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Length-len_stable_down"><span class="command">lemma</span></span> len_stable_down<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> len <span class="free">v1</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> ext_eq_len_eq view.vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Length-len_stable_up"><span class="command">lemma</span></span> len_stable_up<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">v1</span><span class="main">--</span><span class="free">v2</span><span class="main">)</span> <span class="main">⟶</span> len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> len <span class="free">v2</span> <span class="free">ts</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ext_eq_len_eq view.vchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Length-len_empty_subview"><span class="command">lemma</span></span> len_empty_subview<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v'</span> <span class="main">≤</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">∥</span>len <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v'</span> <span class="main">≤</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">v3</span> <span class="bound">vl</span> <span class="bound">vr</span> <span class="bound">vu</span> <span class="bound">vd</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="bound">vl</span><span class="main">∥</span><span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v1</span><span class="main">=</span><span class="bound">v2</span><span class="main">∥</span><span class="bound">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v2</span><span class="main">=</span><span class="bound">vd</span><span class="main">--</span><span class="bound">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v3</span><span class="main">=</span><span class="free">v'</span><span class="main">--</span><span class="bound">vu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
      somewhere_leq   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="skolem"><span class="skolem">vl</span></span> <span class="skolem"><span class="skolem">vr</span></span> <span class="skolem"><span class="skolem">vu</span></span> <span class="skolem"><span class="skolem">vd</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> views<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="skolem">vl</span><span class="main">∥</span><span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">=</span><span class="skolem">v2</span><span class="main">∥</span><span class="skolem">vr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="skolem">vd</span><span class="main">--</span><span class="skolem">v3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v3</span><span class="main">=</span><span class="free">v'</span><span class="main">--</span><span class="skolem">vu</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v1</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> views assm len_empty_on_subview2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v2</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> views len_empty_on_subview1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v3</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> views len_stable_up <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> views len_stable_down <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Length-view_leq_len_leq"><span class="command">lemma</span></span> view_leq_len_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>ext <span class="free">v</span> <span class="main">≤</span> ext <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>own <span class="free">v</span> <span class="main">=</span> own <span class="free">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> 
                          <span class="main">⟶</span> len <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">≤</span> len <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse  length_def length_ge_zero less_eq_real_int_def 
    sensors.len_def sensors.space_def sensors_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HMLSL">
<div class="head">
<h1>Theory HMLSL</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      HMLSL.thy
    Author:     Sven Linker

Definition of HMLSL syntax over traffic snapshots and views for cars
with any sensors. Each formula is a function with a traffic snapshot 
and view as parameters, and evaluates to True or False.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Basic HMLSL›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
In this section, we define the basic formulas of HMLSL. 
All of these basic formulas and theorems are independent 
of the choice of sensor function. However, they show how
the general operators (chop, changes in perspective, 
atomic formulas) work. 
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> HMLSL
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Restriction">Restriction</a>"</span> <span class="quoted">"<a href="#Move">Move</a>"</span> <a href="#Length">Length</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax of Basic HMLSL›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Formulas are functions associating a traffic snapshot
and a view with a Boolean value.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> σ <span class="main">=</span> <span class="quoted"><span class="quoted">" traffic <span class="main">⇒</span> view <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">locale</span></span> hmlsl <span class="main">=</span> restriction<span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sensors</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sensors_ge<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sensors</span> <span class="free">e</span> <span class="free">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> hmlsl<span class="main">&lt;</span>sensors 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sensors.intro sensors_ge<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> hmlsl
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
All formulas are defined as abbreviations. As a consequence,
proofs will directly refer to the semantics of HMLSL, i.e.,
traffic snapshots and views.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The first-order operators are direct translations into HOL operators.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mtrue</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊤</b></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⊤</b></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> True"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mfalse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⊥</b></span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⊥</b></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> False"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mnot</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>¬</b></span>_"</span><span class="main">[</span>52<span class="main">]</span>53<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>¬</b></span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mnegpred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cars<span class="main">⇒</span>σ<span class="main">)</span><span class="main">⇒</span><span class="main">(</span>cars<span class="main">⇒</span>σ<span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">⇧</span><sup>¬</sup></span>_"</span><span class="main">[</span>52<span class="main">]</span>53<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">⇧</span><sup>¬</sup></span></span><span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">¬</span><span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mand</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∧</b></span>"</span>51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>∧</b></span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">∧</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mor</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∨</b></span>"</span>50 <span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>∨</b></span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">∨</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mimp</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>→</b></span>"</span>49<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>→</b></span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">⟶</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mequ</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>↔</b></span>"</span>48<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>↔</b></span></span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span><span class="main">⟷</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mforall</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span>σ<span class="main">)</span><span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span>"</span><span class="main">)</span>      
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∀</b></span></span><span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mforallB</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span>σ<span class="main">)</span><span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span>"</span><span class="main">[</span>8<span class="main">]</span>9<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∀</b></span></span><span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mexists</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">⇒</span>σ<span class="main">)</span><span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∃</b></span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∃</b></span></span><span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mexistsB</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span><span class="main">⇒</span>σ<span class="main">)</span><span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∃</b></span>"</span><span class="main">[</span>8<span class="main">]</span>9<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∃</b></span></span><span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">meq</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>=</b></span>"</span>60<span class="main">)</span> <span class="comment1">― ‹Equality›</span>  
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>=</b></span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mgeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ord<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>≥</b></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>≥</b></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">mge</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ord<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>&gt;</b></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>&gt;</b></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
For the spatial modalities, we use the chopping operations
defined on views. Observe that our chop modalities are existential.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hchop</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⌢</b></span>"</span> 53<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⌢</b></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="bound">v</span><span class="main">∥</span><span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">v</span><span class="main">)</span><span class="main">∧</span><span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">vchop</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⌣</b></span>"</span> 53<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>⌣</b></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span><span class="main">∃</span><span class="bound">v</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="bound">v</span><span class="main">--</span><span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">somewhere</span> <span class="main">::</span><span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>⟨</b></span>_<span class="keyword1"><span class="hidden">❙</span><b>⟩</b></span> "</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>⟨</b></span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>⟩</b></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main"><span class="hidden">❙</span><b>⌣</b></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span><span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⌢</b></span><span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">everywhere</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ<span class="main">⇒</span>σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>[</b></span>_<span class="keyword1"><span class="hidden">❙</span><b>]</b></span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>[</b></span></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="free"><span class="hidden">❙</span><b>]</b></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
To change the perspective of a view, we use 
an operator in the fashion of Hybrid Logic.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">at</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ <span class="main">⇒</span> σ "</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>@</b></span> _ _"</span> 56<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>@</b></span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ts</span> <span class="bound">w</span> <span class="main">.</span>  <span class="main">∀</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&gt;</span><span class="bound">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">v'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The behavioural modalities are defined as usual modal
box-like modalities, where the accessibility relations
are given by the different types of transitions between
traffic snapshots.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">res_box</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>□</b>r'(</span>_<span class="keyword1">')</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>□</b>r(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">clm_box</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>□</b>c'(</span>_<span class="keyword1">')</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>□</b>c(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">wdres_box</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>□</b>wdr'(</span>_<span class="keyword1">')</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>□</b>wdr(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">wdclm_box</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>□</b>wdc'(</span>_<span class="keyword1">')</span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>□</b>wdc(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span><span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">time_box</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> _"</span> 55<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="main"><span class="hidden">❙</span><b>↝</b></span><span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span>move <span class="bound">ts</span> <span class="bound">ts'</span> <span class="bound">w</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">globally</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>G</b></span> _"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>G</b></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ts</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ts'</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="bound">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts'</span><span class="main">)</span><span class="main">(</span>move <span class="bound">ts</span> <span class="bound">ts'</span> <span class="bound">w</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The spatial atoms to refer to reservations, claims
and free space are direct translations of the original
definitions of MLSL \cite{Hilscher2011} into the Isabelle implementation.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">re</span><span class="main">::</span> <span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">re'(</span>_<span class="keyword1">')</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">re(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∥</span>ext <span class="bound">v</span><span class="main">∥</span><span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> len <span class="bound">v</span> <span class="bound">ts</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> ext <span class="bound">v</span> <span class="main">∧</span> 
                      restrict <span class="bound">v</span> <span class="main">(</span>res <span class="bound">ts</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> lan <span class="bound">v</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">v</span><span class="main">|</span><span class="main">=</span><span class="main">1</span>"</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">cl</span><span class="main">::</span> <span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">cl'(</span>_<span class="keyword1">')</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">cl(</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∥</span>ext <span class="bound">v</span><span class="main">∥</span><span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> len <span class="bound">v</span> <span class="bound">ts</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> ext <span class="bound">v</span> <span class="main">∧</span> 
                      restrict <span class="bound">v</span> <span class="main">(</span>clm <span class="bound">ts</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> lan <span class="bound">v</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">free</span><span class="main">::</span> <span class="quoted"><span class="quoted">"σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">free</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">free</span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∥</span>ext <span class="bound">v</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="bound">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span>  <span class="main">∥</span>len <span class="bound">v</span> <span class="bound">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> 
                    <span class="main">(</span>restrict <span class="bound">v</span> <span class="main">(</span>clm <span class="bound">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="bound">v</span> <span class="main">(</span>res <span class="bound">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Even though we do not need them for the subsequent proofs of safety,
we define ways to measure the number of lanes (width) and the
size of the extension (length) of a view. This allows us 
to connect the atomic formulas for reservations and claims
with the atom denoting free space \cite{Linker2015a}.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">width_eq</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="keyword1">=</span> _ "</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>ω</b></span></span> <span class="main"><span class="free">=</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">λ</span>  <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">|</span>lan <span class="bound">v</span><span class="main">|</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>  

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">width_geq</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="keyword1">≥</span> _"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>ω</b></span></span> <span class="main"><span class="free">≥</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">λ</span>  <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">|</span>lan <span class="bound">v</span><span class="main">|</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">width_ge</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="keyword1">&gt;</span> _"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>ω</b></span></span> <span class="main"><span class="free">&gt;</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">length_eq</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="keyword1">=</span> _ "</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>𝗅</b></span></span> <span class="main"><span class="free">=</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∥</span>ext <span class="bound">v</span><span class="main">∥</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">length_ge</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="keyword1">&gt;</span> _"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>𝗅</b></span></span> <span class="main"><span class="free">&gt;</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∥</span>ext <span class="bound">v</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">length_geq</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> σ"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="keyword1">≥</span> _"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="hidden">❙</span><b>𝗅</b></span></span> <span class="main"><span class="free">≥</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
For convenience, we use abbreviations for 
the validity and satisfiability of formulas. While
the former gives a nice way to express theorems, 
the latter is useful within proofs.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"σ <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨</span> _"</span> 10 <span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span>  <span class="main">∀</span><span class="bound">ts</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">(</span><span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">satisfies</span><span class="main">::</span><span class="quoted"><span class="quoted">" traffic <span class="main">⇒</span> view <span class="main">⇒</span> σ <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">,</span> _ <span class="keyword1">⊨</span> _"</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">⊨</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorems about Basic HMLSL›</span></span>

<span class="keyword1" id="HMLSL-hchop_weaken1"><span class="command">lemma</span></span> hchop_weaken1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊨</span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_right  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-hchop_weaken2"><span class="command">lemma</span></span> hchop_weaken2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊨</span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">φ</span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_left  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-hchop_weaken"><span class="command">lemma</span></span> hchop_weaken<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊨</span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> hchop_weaken1 hchop_weaken2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-hchop_neg1"><span class="command">lemma</span></span> hchop_neg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-hchop_neg2"><span class="command">lemma</span></span> hchop_neg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main"><span class="hidden">❙</span><b>⌢</b></span><span class="free">φ</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-hchop_disj_distr1"><span class="command">lemma</span></span> hchop_disj_distr1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-hchop_disj_distr2"><span class="command">lemma</span></span> hchop_disj_distr2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">χ</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⌢</b></span><span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">φ</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="main">(</span><span class="free">χ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-hchop_assoc"><span class="command">lemma</span></span> hchop_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">χ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">χ</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_assoc1 horizontal_chop_assoc2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-v_chop_weaken1"><span class="command">lemma</span></span> v_chop_weaken1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> vertical_chop_empty_down  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-v_chop_weaken2"><span class="command">lemma</span></span> v_chop_weaken2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> vertical_chop_empty_up  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-v_chop_assoc"><span class="command">lemma</span></span> v_chop_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">χ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vertical_chop_assoc1 vertical_chop_assoc2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-vchop_disj_distr1"><span class="command">lemma</span></span> vchop_disj_distr1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">χ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-vchop_disj_distr2"><span class="command">lemma</span></span> vchop_disj_distr2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">χ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">φ</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">φ</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="main">(</span><span class="free">χ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-at_exists"><span class="command">lemma</span></span> at_exists <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="free">φ</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>own <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">d</span> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm switch_refl switch_unique  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-at_conj_distr"><span class="command">lemma</span></span> at_conj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span> <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-at_disj_dist"><span class="command">lemma</span></span> at_disj_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span> <span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-at_hchop_dist1"><span class="command">lemma</span></span> at_hchop_dist1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> switch_always_exists  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="skolem">v1'</span><span class="main">∥</span><span class="skolem">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1'</span> <span class="main">⊨</span> <span class="free">φ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2'</span><span class="main">⊨</span><span class="free">ψ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> v' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> origin<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> switch_hchop2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> switch_unique chop <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>   
  <span class="keyword1"><span class="command">from</span></span> v1 <span class="keyword2"><span class="keyword">and</span></span> v2 <span class="keyword2"><span class="keyword">and</span></span> origin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-at_hchop_dist2"><span class="command">lemma</span></span> at_hchop_dist2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>  "</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique switch_hchop1 switch_def   <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-at_hchop_dist"><span class="command">lemma</span></span> at_hchop_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>  "</span></span>
  <span class="keyword1"><span class="command">using</span></span> at_hchop_dist1 at_hchop_dist2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-at_vchop_dist1"><span class="command">lemma</span></span> at_vchop_dist1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2'</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="skolem">v1'</span><span class="main">--</span><span class="skolem">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1'</span> <span class="main">⊨</span> <span class="free">φ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2'</span><span class="main">⊨</span><span class="free">ψ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> v' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> origin<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v1'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v2'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">--</span><span class="skolem">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> switch_vchop2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> switch_unique chop <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>      
  <span class="keyword1"><span class="command">from</span></span> v1 <span class="keyword2"><span class="keyword">and</span></span> v2 <span class="keyword2"><span class="keyword">and</span></span> origin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-at_vchop_dist2"><span class="command">lemma</span></span> at_vchop_dist2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>  "</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique switch_vchop1 switch_def   <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-at_vchop_dist"><span class="command">lemma</span></span> at_vchop_dist<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="free">ψ</span><span class="main">)</span><span class="main">)</span>  "</span></span>
  <span class="keyword1"><span class="command">using</span></span> at_vchop_dist1 at_vchop_dist2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-at_eq"><span class="command">lemma</span></span> at_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">e</span> <span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_always_exists  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>

<span class="keyword1" id="HMLSL-at_neg1"><span class="command">lemma</span></span> at_neg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> select_convs switch_def<span class="main">)</span>

<span class="keyword1" id="HMLSL-at_neg2"><span class="command">lemma</span></span> at_neg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-at_neg"><span class="command">lemma</span></span> at_neg <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> at_neg1 at_neg2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-at_neg'"><span class="command">lemma</span></span> at_neg'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> at_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-at_neg_neg1"><span class="command">lemma</span></span> at_neg_neg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique switch_def switch_refl 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> select_convs switch_def<span class="main">)</span>

<span class="keyword1" id="HMLSL-at_neg_neg2"><span class="command">lemma</span></span> at_neg_neg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span>  <span class="free">φ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_unique switch_def switch_refl  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-at_neg_neg"><span class="command">lemma</span></span> at_neg_neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="free">φ</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> at_neg_neg1 at_neg_neg2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="HMLSL-globally_all_iff"><span class="command">lemma</span></span> globally_all_iff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>G</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span><span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="HMLSL-globally_all_iff'"><span class="command">lemma</span></span> globally_all_iff'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ts</span><span class="main">,</span><span class="free">v</span><span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>G</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span><span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-globally_refl"><span class="command">lemma</span></span> globally_refl<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">φ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> traffic.abstract.refl traffic.move_nothing  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-globally_4"><span class="command">lemma</span></span> globally_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>G</b></span>  <span class="free">φ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span> <span class="skolem">ts''</span> 
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="free">φ</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> traffic.abs_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.move_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>  <span class="main">⊨</span><span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="HMLSL-spatial_weaken"><span class="command">lemma</span></span> spatial_weaken<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">φ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_left horizontal_chop_empty_right vertical_chop_empty_down
    vertical_chop_empty_up   
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-spatial_weaken2"><span class="command">lemma</span></span> spatial_weaken2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ψ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">ψ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> spatial_weaken horizontal_chop_empty_left horizontal_chop_empty_right 
    vertical_chop_empty_down vertical_chop_empty_up 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="HMLSL-somewhere_distr"><span class="command">lemma</span></span> somewhere_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">φ</span><span class="main"><span class="hidden">❙</span><b>∨</b></span><span class="free">ψ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">φ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">ψ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-somewhere_and"><span class="command">lemma</span></span> somewhere_and<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">ψ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">φ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="free">ψ</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-somewhere_and_or_distr"><span class="command">lemma</span></span> somewhere_and_or_distr <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="free">χ</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="free">ψ</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="free">χ</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span>  <span class="free">φ</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="free">χ</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">ψ</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-width_add1"><span class="command">lemma</span></span> width_add1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vertical_chop_add1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-width_add2"><span class="command">lemma</span></span> width_add2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vertical_chop_add2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-width_hchop_stable"><span class="command">lemma</span></span> width_hchop_stable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span><span class="main">=</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hchop_def horizontal_chop1 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 

<span class="keyword1" id="HMLSL-length_geq_zero"><span class="command">lemma</span></span> length_geq_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.not_eq_order_implies_strict real_int.length_ge_zero<span class="main">)</span>

<span class="keyword1" id="HMLSL-length_split"><span class="command">lemma</span></span> length_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_non_empty  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-length_meld"><span class="command">lemma</span></span> length_meld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hchop_def real_int.chop_add_length_ge_0 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="HMLSL-length_dense"><span class="command">lemma</span></span> length_dense<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_meld length_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-length_add1"><span class="command">lemma</span></span> length_add1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span> <span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hchop_def real_int.rchop_def real_int.length_def   <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-length_add2"><span class="command">lemma</span></span> length_add2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>≥</b></span> <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>≥</b></span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_split_add  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-length_add"><span class="command">lemma</span></span> length_add<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>≥</b></span> <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>≥</b></span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">=</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_add1 length_add2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-length_vchop_stable"><span class="command">lemma</span></span> length_vchop_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vchop_def vertical_chop1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="HMLSL-res_ge_zero"><span class="command">lemma</span></span> res_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-clm_ge_zero"><span class="command">lemma</span></span> clm_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-free_ge_zero"><span class="command">lemma</span></span> free_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-width_res"><span class="command">lemma</span></span> width_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HMLSL-width_clm"><span class="command">lemma</span></span> width_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-width_free"><span class="command">lemma</span></span> width_free<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-width_somewhere_res"><span class="command">lemma</span></span> width_somewhere_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> view.hchop_def view.vertical_chop_width_mon <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1" id="HMLSL-clm_disj_res"><span class="command">lemma</span></span> clm_disj_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> view.somewhere_leq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> disjoint 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_non_empty_geq_one inf.idem restriction.restriction_clm_leq_one
        restriction.restriction_clm_res_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-width_ge"><span class="command">lemma</span></span> width_ge<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span><span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>&gt;</b></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  vertical_chop_add1  add_gr_0 zero_less_one  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HMLSL-two_res_width"><span class="command">lemma</span></span> two_res_width<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_add_one width_add1<span class="main">)</span>


<span class="keyword1" id="HMLSL-res_at_most_two"><span class="command">lemma</span></span> res_at_most_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> notI <span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v3</span></span>  
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v1</span><span class="main">--</span><span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">=</span><span class="skolem">v2</span><span class="main">--</span><span class="skolem">v3</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v3</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v'</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">&lt;</span> <span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">--</span><span class="skolem">v'</span>›</span></span> restriction.restriction_add_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v3</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span><span class="main">=</span><span class="skolem">v2</span><span class="main">--</span><span class="skolem">v3</span>›</span></span> not_less 
          one_add_one restriction_add_res restriction_res_leq_two<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-res_at_most_two2"><span class="command">lemma</span></span> res_at_most_two2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> res_at_most_two <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-res_at_most_somewhere"><span class="command">lemma</span></span> res_at_most_somewhere<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vu</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vm</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vd</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> chops<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">vu</span><span class="main">--</span><span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v1</span> <span class="main">=</span> <span class="skolem">vm</span><span class="main">--</span><span class="skolem">vd</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">vu</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span> 
                 <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">vm</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span> <span class="main">∧</span><span class="main">(</span> <span class="skolem">ts</span><span class="main">,</span><span class="skolem">vd</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> res_vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">vu</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restriction_card_somewhere_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> res_vm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">vm</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restriction_card_somewhere_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> res_vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">vd</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restriction_card_somewhere_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> 
     <span class="main">|</span>restrict <span class="skolem">vu</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span><span class="main">+</span> <span class="main">|</span>restrict <span class="skolem">vm</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span>restrict <span class="skolem">vd</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> restriction_add_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> res_vu <span class="keyword2"><span class="keyword">and</span></span> res_vd res_vm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> restriction_res_leq_two <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less_eq_eq numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-res_adj"><span class="command">lemma</span></span> res_adj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> "</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vn</span></span>  
    <span class="keyword2"><span class="keyword">where</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">--</span><span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="skolem">vn</span><span class="main">--</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span><span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">vn</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span><span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> res1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword1"><span class="command">have</span></span> res2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v2</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> res1 <span class="keyword2"><span class="keyword">and</span></span> res2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chop restriction.restriction_add_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> resv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_order.antisym restriction.restriction_res_leq_two <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> res_two_lanes<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>res <span class="skolem">ts</span> <span class="free">c</span><span class="main">|</span> <span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> atMostTwoRes restrict_res 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> nat_int.card_subset_le dual_order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def<span class="main">:</span><span class="quoted"><span class="quoted">"Rep_nat_int <span class="main">(</span>res <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consecutiveRes <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_nat_int <span class="main">{</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">⊑</span> lan <span class="skolem">v</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_nat_int_inverse atMostTwoRes card_seteq finite_atLeastAtMost
        insert_not_empty nat_int.card'.rep_eq nat_int.card_seq less_eq_nat_int.rep_eq
        p_def resv restrict_res restrict_view<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> vn_not_e<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">vn</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chop
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_int.card_empty_zero less_irrefl width_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> consec_vn_v2<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.consec <span class="main">(</span>lan <span class="skolem">vn</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero chop nat_int.nchop_def one_neq_zero vchop_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> v'_not_e<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v'</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chop 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl nat_int.card_empty_zero view.vertical_chop_assoc2 width_ge<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> consec_v1_v'<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.consec <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> nat_int.card_empty_zero chop nat_int.nchop_def
        one_neq_zero vchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> consec_v1_vn<span class="main">:</span><span class="quoted"><span class="quoted">"nat_int.consec <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span> <span class="main">(</span>lan <span class="skolem">vn</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> chop consec_vn_v2 nat_int.consec_def 
        nat_int.chop_min vchop_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lesser_con<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consec_v1_vn consec_vn_v2 nat_int.consec_trans_lesser
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> p_in_v1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v1</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> lan <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> chop  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop <span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">∩</span> <span class="main">(</span>Rep_nat_int <span class="main">(</span>res <span class="skolem">ts</span> <span class="free">c</span><span class="main">)</span> <span class="main">∩</span> Rep_nat_int <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chop Rep_nat_int_inject bot_nat_int.rep_eq consec_v1_v' 
             inf_nat_int.rep_eq nat_int.consec_def p_def restriction.restrict_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>›</span></span> inf_nat_int.rep_eq not_in.rep_eq
          restriction.restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> chop el.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> suc_p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chop <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> lan <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_def restrict_def <span class="keyword1"><span class="command">using</span></span> lesser_con nat_int.el.rep_eq
        nat_int.not_in.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="skolem">v2</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span> <span class="main">∈</span> Rep_nat_int <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> consec_vn_v2 el.rep_eq minimum_in nat_int.consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lan <span class="skolem">v2</span> <span class="main">⊑</span> res <span class="skolem">ts</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> chop restriction.restrict_res<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> lan <span class="skolem">v2</span>›</span></span> f1 less_eq_nat_int.rep_eq not_in.rep_eq p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chop el.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_def restrict_def 
      <span class="keyword1"><span class="command">using</span></span> chop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> lesser_con suc_p p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> p_not_in_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> lan <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_def restrict_def lesser_con 
      nat_int.el.rep_eq nat_int.not_in.rep_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> restrict <span class="skolem">v2</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> consec_vn_v2 minimum_in nat_int.consec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> mini<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">minimum</span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD1 p_not_in_v2  chop el.rep_eq f1 inf_nat_int.rep_eq insertE mini
          not_in.rep_eq p_def restriction.restrict_def singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> chop f1 mini <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> suc_p_in_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_def restrict_def <span class="keyword1"><span class="command">using</span></span> chop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">vn</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consec_v1_vn nat_int.consec_lesser <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p_in_v1 <span class="keyword1"><span class="command">have</span></span> ge_p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">vn</span> <span class="main">⟶</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">vn</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>lan <span class="skolem">v2</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> consec_vn_v2 nat_int.consec_lesser <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> suc_p_in_v2 <span class="keyword1"><span class="command">have</span></span> less_suc_p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">vn</span> <span class="main">⟶</span>  <span class="bound">m</span><span class="main">&lt;</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">vn</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">m</span><span class="main">&lt;</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ge_p less_suc_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">vn</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI add.right_neutral add_Suc_right linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lan <span class="skolem">vn</span> <span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_int.non_empty_elem_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> vn_not_e <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-clm_sing"><span class="command">lemma</span></span> clm_sing<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> atMostOneClm  restriction_add_clm vchop_def restriction_clm_leq_one   
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_eq_self_zero le_add1 le_antisym one_neq_zero<span class="main">)</span>

<span class="keyword1" id="HMLSL-clm_sing_somewhere"><span class="command">lemma</span></span> clm_sing_somewhere<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> clm_sing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-clm_sing_not_interrupted"><span class="command">lemma</span></span> clm_sing_not_interrupted<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atMostOneClm  restriction_add_clm vchop_def restriction_clm_leq_one clm_sing
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_eq_self_zero dual_order.antisym
      le_add1 one_neq_zero<span class="main">)</span>

<span class="keyword1" id="HMLSL-clm_sing_somewhere2"><span class="command">lemma</span></span> clm_sing_somewhere2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">using</span></span> clm_sing_not_interrupted vertical_chop_assoc1 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1" id="HMLSL-clm_sing_somewhere3"><span class="command">lemma</span></span> clm_sing_somewhere3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span>  <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> clm_sing_not_interrupted view.vertical_chop_assoc1<span class="main">)</span>

<span class="keyword1" id="HMLSL-clm_at_most_somewhere"><span class="command">lemma</span></span> clm_at_most_somewhere<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vu</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vd</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> chops<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">vu</span><span class="main">--</span><span class="skolem">vd</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">vu</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span> <span class="skolem">ts</span><span class="main">,</span><span class="skolem">vd</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> clm_vu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">vu</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restriction_card_somewhere_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> clm_vd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">vd</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restriction_card_somewhere_mon<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> chops <span class="keyword1"><span class="command">have</span></span> clm_add<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> <span class="main">|</span>restrict <span class="skolem">vu</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span>restrict <span class="skolem">vd</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restriction_add_clm      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> clm_vu <span class="keyword2"><span class="keyword">and</span></span> clm_vd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> add.commute add_eq_self_zero dual_order.antisym le_add1 less_one not_le
      restriction_res_leq_two
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> restriction_clm_leq_one <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def not_less_eq_eq numeral_2_eq_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="HMLSL-res_decompose"><span class="command">lemma</span></span> res_decompose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">v1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">v2</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  view.horizontal_chop_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v1</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v2</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm view.hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v1</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2 1  assm len_view_hchop_left  restriction.restrict_eq_lan_subs
        restriction.restrict_view restriction.restriction_stable1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v2</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> <span class="quoted">"3"</span> <span class="quoted">"6"</span> assm len_view_hchop_right restriction.restrict_eq_lan_subs
        restriction.restrict_view restriction.restriction_stable<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 6 <span class="keyword2"><span class="keyword">and</span></span> 7 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-res_compose"><span class="command">lemma</span></span> res_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>     
  <span class="keyword1"><span class="command">using</span></span>  real_int.chop_dense len_compose_hchop hchop_def length_dense restrict_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="HMLSL-res_dense"><span class="command">lemma</span></span> res_dense<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> res_decompose res_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-res_continuous"><span class="command">lemma</span></span> res_continuous <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span>     
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> hchop_def len_view_hchop_left len_view_hchop_right
      restrict_def<span class="main">)</span>

<span class="keyword1" id="HMLSL-no_clm_before_res"><span class="command">lemma</span></span> no_clm_before_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> nat_int.card_empty_zero nat_int.card_subset_le
      disjoint hchop_def inf_assoc inf_le1 not_one_le_zero restrict_def<span class="main">)</span>

<span class="keyword1" id="HMLSL-no_clm_before_res2"><span class="command">lemma</span></span> no_clm_before_res2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> clm_subs<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restriction_stable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> hchop_def restrict_def<span class="main">)</span>      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span> <span class="main">)</span><span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm nat_int.card_non_empty_geq_one restriction_stable1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_in_neq<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊓</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span><span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> clm_subs inf_absorb1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> restriction_clm_res_disjoint      
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute restriction.restriction_clm_res_disjoint<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-clm_decompose"><span class="command">lemma</span></span> clm_decompose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> restr<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> lan <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> len_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="free">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> chop<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">v1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">v2</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm view.horizontal_chop_non_empty    
    <span class="keyword1"><span class="command">using</span></span> length_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> len <span class="keyword1"><span class="command">have</span></span> len_v1<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v1</span> <span class="skolem">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_view_hchop_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> len <span class="keyword1"><span class="command">have</span></span> len_v2<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v2</span> <span class="skolem">ts</span> <span class="free">c</span> <span class="main">=</span> ext <span class="skolem">v2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_view_hchop_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> restr <span class="keyword1"><span class="command">have</span></span> restr_v1<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v1</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> lan <span class="skolem">v1</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> hchop_def restriction.restriction_stable1<span class="main">)</span>     
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> restr <span class="keyword1"><span class="command">have</span></span> restr_v2<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v2</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> lan <span class="skolem">v2</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> hchop_def restriction.restriction_stable2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> chop <span class="keyword2"><span class="keyword">and</span></span> len_v1 len_v2 restr_v1 restr_v2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hchop_def assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="HMLSL-clm_compose"><span class="command">lemma</span></span> clm_compose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>  <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span>  real_int.chop_dense len_compose_hchop hchop_def length_dense restrict_def     
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="HMLSL-clm_dense"><span class="command">lemma</span></span> clm_dense<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> clm_decompose clm_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-clm_continuous"><span class="command">lemma</span></span> clm_continuous <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span>     
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> hchop_def len_view_hchop_left len_view_hchop_right
      restrict_def<span class="main">)</span>


<span class="keyword1" id="HMLSL-res_not_free"><span class="command">lemma</span></span> res_not_free<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="keyword1">free</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero one_neq_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HMLSL-clm_not_free"><span class="command">lemma</span></span> clm_not_free<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="keyword1">free</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HMLSL-free_no_res"><span class="command">lemma</span></span> free_no_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero one_neq_zero 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl<span class="main">)</span>

<span class="keyword1" id="HMLSL-free_no_clm"><span class="command">lemma</span></span> free_no_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero one_neq_zero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl<span class="main">)</span>

<span class="keyword1" id="HMLSL-free_decompose"><span class="command">lemma</span></span> free_decompose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">free</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> non_empty_v1_v2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">v1</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">∥</span>ext <span class="skolem">v2</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm length_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> one_lane<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v1</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="skolem">v2</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm hchop_def non_empty_v1_v2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> nothing_on_v1<span class="main">:</span>
    <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v1</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> 
        <span class="main">∨</span> <span class="main">(</span>restrict <span class="skolem">v1</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assm len_empty_on_subview1 non_empty_v1_v2
        restriction_stable1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> nothing_on_v2<span class="main">:</span>
    <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v2</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> 
        <span class="main">∨</span> <span class="main">(</span>restrict <span class="skolem">v2</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v2</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assm len_empty_on_subview2 non_empty_v1_v2
        restriction_stable2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>  
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">∥</span>ext <span class="skolem">v1</span><span class="main">∥</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="skolem">v1</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v1</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> 
        <span class="main">∨</span><span class="main">(</span> restrict <span class="skolem">v1</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v1</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">∥</span>ext <span class="skolem">v2</span><span class="main">∥</span> <span class="main">∧</span> <span class="main">|</span>lan <span class="skolem">v2</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v2</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> 
        <span class="main">∨</span><span class="main">(</span> restrict <span class="skolem">v2</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v2</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> non_empty_v1_v2 nothing_on_v1 nothing_on_v2 one_lane <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-free_compose"><span class="command">lemma</span></span> free_compose<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">free</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> len_ge_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">v</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm length_meld <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> widt_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> horizontal_chop_width_stable<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> no_car<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> 
           <span class="main">∨</span> <span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> ex<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> ex <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> less_eq_real_def real_int.length_ge_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assm add.left_neutral ex len_hchop_add
            restriction.restrict_def view.hchop_def<span class="main">)</span>    
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assm add.left_neutral ex len_hchop_add 
            restriction.restrict_def view.hchop_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">free</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len_ge_0 widt_one no_car <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="HMLSL-free_dense"><span class="command">lemma</span></span> free_dense<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> free_decompose free_compose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-free_dense2"><span class="command">lemma</span></span> free_dense2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_left horizontal_chop_empty_right  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next lemmas show the connection between the spatial. In particular,
if the view consists of one lane and a non-zero extension, where neither
a reservation nor a car resides, the view satisfies free (and vice versa). 
›</span></span>

<span class="keyword1" id="HMLSL-no_cars_means_free"><span class="command">lemma</span></span> no_cars_means_free<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">free</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ge_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword1"><span class="command">have</span></span> one_lane<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>    
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1">free</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> no_car<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="keyword1">free</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> contra<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∧</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ge_0 one_lane <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ex_car<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="bound">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> real_int.length_ge_zero dual_order.antisym not_le 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span>"</span></span>       
      <span class="keyword1"><span class="command">using</span></span> ex_car <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> one_lane <span class="keyword1"><span class="command">have</span></span> clm_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> el_in_restriction_clm_singleton      
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_non_empty_geq_one dual_order.antisym restriction.restriction_clm_leq_one<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v4</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> ext <span class="skolem">v3</span> <span class="main">∧</span> <span class="main">∥</span>len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_left horizontal_chop_empty_right 
          len_fills_subview c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>›</span></span> restriction_stable restriction_stable1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> len_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_eq c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span><span class="main">1</span> "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> clm_one restriction_stable restriction_stable1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> v3_one_lane<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v3</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> hchop_def one_lane
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> clm_fills_v3<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> lan <span class="skolem">v3</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span>  aux<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> lan <span class="skolem">v3</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">⊑</span> lan <span class="skolem">v3</span>"</span></span>      
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_view<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v3</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> aux <span class="quoted"><span class="quoted">‹<span class="main">|</span>restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>›</span></span> 
            restriction.restrict_eq_lan_subs v3_one_lane
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v3</span><span class="main">|</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span> <span class="main">(</span>restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹restrict <span class="skolem">v3</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≤</span> lan <span class="skolem">v3</span>›</span></span> aux
            restriction.restrict_eq_lan_subs v3_one_lane
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v3_one_lane <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">v3</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span> <span class="skolem">v3</span> <span class="main">⊨</span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> clm_one len_eq c_def clm_fills_v3 v3_one_lane
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_car <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> one_lane <span class="keyword1"><span class="command">have</span></span> clm_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> el_in_restriction_clm_singleton      
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_int.card_non_empty_geq_one nat_int.card_subset_le 
            dual_order.antisym restrict_view<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v3</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v4</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span><span class="quoted"><span class="quoted">"len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> ext <span class="skolem">v3</span> <span class="main">∧</span> <span class="main">∥</span>len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">=</span> <span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> horizontal_chop_empty_left horizontal_chop_empty_right 
          len_fills_subview c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> res_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span>›</span></span> restriction_stable restriction_stable1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> len_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v3</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> len_eq c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span><span class="main">1</span> "</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> clm_one restriction_stable restriction_stable1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> v3_one_lane<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v3</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> hchop_def one_lane
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> lan <span class="skolem">v3</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span>  aux<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> lan <span class="skolem">v3</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">⊑</span> lan <span class="skolem">v3</span>"</span></span>      
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_view<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> lan <span class="skolem">v3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> aux <span class="quoted"><span class="quoted">‹<span class="main">|</span>restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>›</span></span> restriction.restrict_eq_lan_subs v3_one_lane
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>lan <span class="skolem">v3</span><span class="main">|</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span> <span class="main">(</span>restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span><span class="main">|</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≤</span> lan <span class="skolem">v3</span>›</span></span> aux
            restriction.restrict_eq_lan_subs v3_one_lane
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v3_one_lane <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span>ext <span class="skolem">v3</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span> <span class="skolem">v3</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> clm_one len_eq c_def <span class="quoted"><span class="quoted">‹restrict <span class="skolem">v3</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> lan <span class="skolem">v3</span>›</span></span> v3_one_lane
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span><span class="main">=</span><span class="skolem">v3</span><span class="main">∥</span><span class="skolem">v4</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_car <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-free_means_no_cars"><span class="command">lemma</span></span> free_means_no_cars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1">free</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> no_car<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">vc</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      vc_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="skolem">v1</span><span class="main">∥</span><span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">v'</span><span class="main">=</span><span class="skolem">vc</span><span class="main">∥</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">vc</span> <span class="main">⊨</span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> len_ge_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span>len <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> len_empty_on_subview1 len_empty_on_subview2 less_eq_real_def
          real_int.length_ge_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> vc_def <span class="keyword1"><span class="command">have</span></span> vc_ex_car<span class="main">:</span>
      <span class="quoted"><span class="quoted">"restrict <span class="skolem">vc</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">vc</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span><span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero one_neq_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> eq_lan<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">v</span> <span class="main">=</span> lan <span class="skolem">vc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vc_def hchop_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> v_ex_car<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">v</span> <span class="main">(</span>clm <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="skolem">v</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">≠</span><span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vc_ex_car <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restrict_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> len_ge_zero <span class="keyword2"><span class="keyword">and</span></span> v_ex_car <span class="keyword2"><span class="keyword">and</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-free_eq_no_cars"><span class="command">lemma</span></span> free_eq_no_cars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> no_cars_means_free free_means_no_cars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-free_nowhere_res"><span class="command">lemma</span></span> free_nowhere_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> free_eq_no_cars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-two_res_not_res"><span class="command">lemma</span></span> two_res_not_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_self_zero one_neq_zero width_add1<span class="main">)</span>

<span class="keyword1" id="HMLSL-two_clm_width"><span class="command">lemma</span></span> two_clm_width<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main">(</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> one_add_one width_add1<span class="main">)</span>

<span class="keyword1" id="HMLSL-two_res_no_car"><span class="command">lemma</span></span> two_res_no_car<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌣</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_self_zero one_neq_zero width_add1<span class="main">)</span>

<span class="keyword1" id="HMLSL-two_lanes_no_car"><span class="command">lemma</span></span> two_lanes_no_car<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="keyword1"><span class="hidden">❙</span><b>ω</b></span><span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span><span class="main">(</span><span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-empty_no_car"><span class="command">lemma</span></span> empty_no_car<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span><span class="main">(</span><span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HMLSL-car_one_lane_non_empty"><span class="command">lemma</span></span> car_one_lane_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span><span class="main">(</span><span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HMLSL-one_lane_notfree"><span class="command">lemma</span></span> one_lane_notfree<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="keyword1">free</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="keyword1">free</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> not_free<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="keyword1">free</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> free_eq_no_cars <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span>  <span class="main">(</span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL-one_lane_empty_or_car"><span class="command">lemma</span></span> one_lane_empty_or_car<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>ω</b></span> <span class="main">=</span><span class="main">1</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>𝗅</b></span><span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1">free</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⌢</b></span> <span class="main"><span class="hidden">❙</span><b>⊤</b></span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_lane_notfree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Perfect_Sensors">
<div class="head">
<h1>Theory Perfect_Sensors</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      perfect/Perfect_Sensors.thy
    Author:     Sven Linker

Instantiation of the sensor function to model "perfect sensors". That is,
each car can perceive both the physical size as well as the concrete
braking distance of all other cars.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Perfect Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section contains an instantiations of the sensor function for 
"perfect sensors". That is, each car can perceive both the physical
size as well as the braking distance of each other car. 
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Perfect_Sensors
  <span class="keyword2"><span class="keyword">imports</span></span>  <span class="quoted">"<a href="#Length">../Length</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perfect</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">perfect</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> traffic.physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> traffic.braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> "</span></span> 
    
<span class="keyword1"><span class="command">locale</span></span> perfect_sensors <span class="main">=</span> traffic<span class="main">+</span>view
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> perfect_sensors <span class="main">:</span> sensors <span class="quoted"><span class="quoted">"perfect <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> perfect <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_add_same_cancel2 less_trans perfect_def traffic.psGeZero traffic.sdGeZero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">notation</span></span> perfect_sensors.space <span class="main">(</span><span class="quoted">"<span class="keyword1">space</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> perfect_sensors.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
With this sensor definition, we can show that the perceived length of a car
is independent of the spatial transitions between traffic snapshots. The 
length may only change during evolutions, in particular if the car changes its dynamical
behaviour.
›</span></span>

<span class="keyword1" id="Perfect_Sensors-create_reservation_length_stable"><span class="command">lemma</span></span> create_reservation_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.create_reservation_def perfect_sensors.space_def perfect_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Perfect_Sensors-create_claim_length_stable"><span class="command">lemma</span></span> create_claim_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.create_claim_def perfect_sensors.space_def perfect_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Perfect_Sensors-withdraw_reservation_length_stable"><span class="command">lemma</span></span> withdraw_reservation_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.withdraw_reservation_def perfect_sensors.space_def perfect_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>      
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Perfect_Sensors-withdraw_claim_length_stable"><span class="command">lemma</span></span> withdraw_claim_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.withdraw_claim_def perfect_sensors.space_def perfect_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>      
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The following lemma shows that the perceived length is independent from
the owner of the view. That is, as long as two views consist of the same 
extension, the perceived length of each car is the same in both views.
›</span></span>
  
<span class="keyword1" id="Perfect_Sensors-all_own_ext_eq_len_eq"><span class="command">lemma</span></span> all_own_ext_eq_len_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v'</span>  <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="free">v</span> <span class="main">=</span> ext <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> sp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_def  perfect_sensors.space_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> left_eq<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> right_eq<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> right_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perfect_sensors.len_def right_eq assm sp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> right_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v'</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> left_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> perfect_sensors.len_def left_eq sp right_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v'</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> left_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' left_eq right_eq
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>perfect_sensors.len_def sp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Finally, switching the perspective of a view does not change the
perceived length.
›</span></span>
    
<span class="keyword1" id="Perfect_Sensors-switch_length_stable"><span class="command">lemma</span></span> switch_length_stable<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">d</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v'</span> <span class="free">ts</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> all_own_ext_eq_len_eq view.switch_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HMLSL_Perfect">
<div class="head">
<h1>Theory HMLSL_Perfect</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      perfect/HMLSL_Perfect.thy
    Author:     Sven Linker

Defines HMLSL with perfect sensors for cars. Cars can perceive both
the physical size and braking distance of all other cars.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹HMLSL for Perfect Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Within this section, we instantiate HMLSL for cars with 
perfect sensors.
›</span></span>


<span class="keyword1"><span class="command">theory</span></span> HMLSL_Perfect
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#HMLSL">../HMLSL</a>"</span> <span class="quoted">"<a href="#Perfect_Sensors">Perfect_Sensors</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
  
<span class="keyword1"><span class="command">locale</span></span> hmlsl_perfect <span class="main">=</span> perfect_sensors <span class="main">+</span> restriction
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">interpretation</span></span> hmlsl <span class="main">:</span> hmlsl <span class="quoted"><span class="quoted">"perfect <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span> 
  
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> perfect <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_add_same_cancel2 less_trans perfect_def traffic.psGeZero
        traffic.sdGeZero<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">notation</span></span> hmlsl.re <span class="main">(</span><span class="quoted">"<span class="keyword1">re'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.cl<span class="main">(</span><span class="quoted">"<span class="keyword1">cl'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
 The spatial atoms are independent of the perspective of the view. 
Hence we can prove several lemmas on the relation between the hybrid modality
and the spatial atoms.
›</span></span>
  
<span class="keyword1" id="HMLSL_Perfect-at_res1"><span class="command">lemma</span></span> at_res1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> perfect_sensors.switch_length_stable 
      restriction.switch_restrict_stable view.switch_def<span class="main">)</span>
    
<span class="keyword1" id="HMLSL_Perfect-at_res2"><span class="command">lemma</span></span> at_res2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> view.switch_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="HMLSL_Perfect-at_res"><span class="command">lemma</span></span> at_res<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> at_res1 at_res2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="HMLSL_Perfect-at_res_inst"><span class="command">lemma</span></span> at_res_inst<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">d</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">d</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="main">(</span><span class="free">d</span><span class="main">)</span><span class="main">&gt;</span> <span class="skolem">v'</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> view.switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> v' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> restriction.switch_restrict_stable perfect_sensors.switch_length_stable v'_def
      view.switch_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> all_own_ext_eq_len_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="HMLSL_Perfect-at_clm1"><span class="command">lemma</span></span> at_clm1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  all_own_ext_eq_len_eq view.switch_def 
      restriction.switch_restrict_stable<span class="main">)</span>
    
<span class="keyword1" id="HMLSL_Perfect-at_clm2"><span class="command">lemma</span></span> at_clm2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> view.switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="HMLSL_Perfect-at_clm"><span class="command">lemma</span></span> at_clm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> at_clm1 at_clm2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="HMLSL_Perfect-at_clm_inst"><span class="command">lemma</span></span> at_clm_inst<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">d</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">d</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="main">(</span><span class="free">d</span><span class="main">)</span><span class="main">&gt;</span> <span class="skolem">v'</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> view.switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assm <span class="keyword1"><span class="command">have</span></span> v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> v' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restriction.switch_restrict_stable switch_length_stable v'_def view.switch_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> all_own_ext_eq_len_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
With the definition of sensors, we can also express how the spatial situation
changes after the different transitions. In particular, we can prove 
lemmas corresponding to the activity and stability rules of the
proof system for MLSL \cite{Linker2015a}.

Observe that we were not able to prove these rules for basic HMLSL, since 
its generic sensor function allows for instantiations where the perceived length changes
during spatial transitions.
›</span></span>
  
<span class="keyword1" id="HMLSL_Perfect-backwards_res_act"><span class="command">lemma</span></span> backwards_res_act<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> len_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> create_reservation_length_stable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm traffic.create_res_subseteq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> restr_subs_res<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restriction.restrict_view assm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm traffic.create_res_subseteq2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> restr_subs_clm<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> restriction.restrict_view assm<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> restr_res_nonempty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> restrict_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.card_non_empty_geq_one nat_int.card_subset_le dual_order.antisym
        restr_subs_res assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span> <span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> restr_subs_res assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> restriction.restrict_eq_lan_subs restrict_one assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> restr_res_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> clm_non_empty<span class="main">:</span><span class="quoted"><span class="quoted">" restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm inter_empty2 local.hmlsl.free_no_clm 
          restriction.create_reservation_restrict_union restriction.restrict_def' 
          un_empty_absorb1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> restrict_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.card_non_empty_geq_one nat_int.card_subset_le dual_order.antisym
        restr_subs_clm assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> restr_subs_clm assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> restriction.restrict_eq_lan_subs restrict_one assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="HMLSL_Perfect-backwards_res_act_somewhere"><span class="command">lemma</span></span> backwards_res_act_somewhere<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> backwards_res_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="HMLSL_Perfect-backwards_res_stab"><span class="command">lemma</span></span> backwards_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="free">d</span> <span class="main">≠</span><span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perfect_sensors.create_reservation_length_stable restriction.restrict_def'
    traffic.create_res_subseteq1_neq 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="HMLSL_Perfect-backwards_c_res_stab"><span class="command">lemma</span></span> backwards_c_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_claim_length_stable traffic.create_clm_eq_res 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> traffic.create_claim_def<span class="main">)</span> 
    
<span class="keyword1" id="HMLSL_Perfect-backwards_wdc_res_stab"><span class="command">lemma</span></span> backwards_wdc_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> withdraw_claim_length_stable traffic.withdraw_clm_eq_res 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> traffic.withdraw_claim_def<span class="main">)</span> 
    
<span class="keyword1" id="HMLSL_Perfect-backwards_wdr_res_stab"><span class="command">lemma</span></span> backwards_wdr_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 order_trans perfect_sensors.withdraw_reservation_length_stable
      restriction.restrict_def' restriction.restrict_res traffic.withdraw_res_subseteq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We now proceed to prove the \emph{reservation lemma}, which was 
crucial in the manual safety proof \cite {Hilscher2011}. 
›</span></span>
<span class="keyword1" id="HMLSL_Perfect-reservation1"><span class="command">lemma</span></span> reservation1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="skolem">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> re<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 order_trans perfect_sensors.create_reservation_length_stable
          re restriction.restrict_def' restriction.restrict_subseteq 
          traffic.create_res_subseteq1 ts'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> cl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cl inf.absorb1 order_trans perfect_sensors.create_reservation_length_stable
          restriction.restrict_def' restriction.restrict_subseteq
          traffic.create_res_subseteq2 ts'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="HMLSL_Perfect-reservation2"><span class="command">lemma</span></span> reservation2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> backwards_res_act traffic.always_create_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="HMLSL_Perfect-reservation"><span class="command">lemma</span></span> reservation<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reservation1 reservation2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div><div id="Safety_Perfect">
<div class="head">
<h1>Theory Safety_Perfect</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      perfect/Safety_Perfect.thy
    Author:     Sven Linker

Distance and Lane change controller for cars with perfect sensors.
Safety theorem and invariance with respect to switching views.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Safety for Cars with Perfect Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section contains the definition of requirements for
lane change and distance controllers for cars, with the assumption
of perfect sensors. Using these definitions, we show that safety
is an invariant along all possible behaviour of cars.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Safety_Perfect
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#HMLSL_Perfect">HMLSL_Perfect</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">context</span></span> hmlsl_perfect
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> hmlsl <span class="main">:</span> hmlsl <span class="quoted"><span class="quoted">"perfect <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>   
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> perfect <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_add_same_cancel2 less_trans perfect_def traffic.psGeZero
        traffic.sdGeZero<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">notation</span></span> hmlsl.re <span class="main">(</span><span class="quoted">"<span class="keyword1">re'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.cl<span class="main">(</span><span class="quoted">"<span class="keyword1">cl'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Safety in the context of HMLSL means the absence of overlapping
reservations. Using the somewhere modality, this is easy to formalise. 
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">safe</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars<span class="main">⇒</span>σ"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">safe</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The distance controller ensures, that as long as the cars do not try
to change their lane, they keep their distance. More formally,
if the reservations of two cars do not overlap, they will also not
overlap after an arbitrary amount of time passed. Observe that
the cars are allowed to change their dynamical behaviour, i.e.,
to accelerate and brake.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">DC</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DC</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>
                   <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
To identify possibly dangerous situations during a lane change manoeuvre, 
we use the \emph{potential collision check}. It allows us to identify
situations, where the claim of a car \(d\) overlaps with 
any part of the car \(c\).
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pcc</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> cars <span class="main">⇒</span> σ"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pcc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The only restriction the lane change controller imposes onto the cars is
that in the case of a potential collision, they are not allowed to change
the claim into a reservation. 
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">LC</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LC</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span>  "</span></span>
    

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The safety theorem is as follows. If the controllers of all
cars adhere to the specifications given by \(LC\) and \(DC\),
and we start with an initially safe traffic snapshot, then
all reachable traffic snapshots are also safe.
›</span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> safety<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">c</span><span class="main">::</span><span class="quoted">cars</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span>  abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nequals<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> init<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> DC <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> DC"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> LC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> LC"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> abs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> traffic.move_nothing <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> init traffic.move_nothing nequals  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>evolve <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_DC<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>
                               <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"evolve.hyps"</span> DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"evolve.IH"</span>  <span class="keyword2"><span class="keyword">and</span></span> nequals <span class="keyword1"><span class="command">have</span></span> 
        ts'_safe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> no_coll_after_evol<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> move_eq<span class="main">:</span><span class="quoted"><span class="quoted">"move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"evolve.hyps"</span> traffic.abstract.evolve traffic.abstract.refl 
          traffic.move_trans 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> no_coll_after_evol <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"evolve.hyps"</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> e_def <span class="keyword1"><span class="command">using</span></span>  move_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_LC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LC <span class="quoted">"cr_res.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> traffic.move_stability_res <span class="quoted">"cr_res.hyps"</span> traffic.move_trans 
      move_stability_clm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> traffic.abstract.simps cr_res.hyps traffic.move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"cr_res.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq   
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>   <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab nequals
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span>  v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH e_def move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> e_def nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> pcc <span class="skolem">c</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>  "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> local_LC move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">d</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> neq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> 
          <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_stab <span class="keyword1"><span class="command">have</span></span> overlap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab nequals neq2 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def neq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> unsafe2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  nequals view.somewhere_leq v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> cr_res.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> unsafe2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab nequals 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def eq2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH e_def move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> e_def nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> pcc <span class="skolem">e</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">d</span><span class="main">.</span> pcc <span class="bound">d</span> <span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>  "</span></span>
              <span class="keyword1"><span class="command">using</span></span> local_LC move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> traffic.move_stability_clm cr_clm.hyps traffic.move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> traffic.abstract.simps cr_clm.hyps traffic.move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="skolem">d</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cr_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_def backwards_c_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v'_def view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>   
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> cr_clm.IH move_stab e_def nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> traffic.move_stability_wdr wd_res.hyps traffic.move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> traffic.abstract.simps wd_res.hyps traffic.move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="skolem">d</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> wd_res.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_def backwards_wdr_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v'_def view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>          
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_res.IH move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> traffic.move_stability_wdc wd_clm.hyps traffic.move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> traffic.abstract.simps wd_clm.hyps traffic.move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wd_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_def backwards_wdc_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> v'_def view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_clm.IH move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
While the safety theorem was only proven for a single car, we can
show that the choice of this car is irrelevant. That is, if we have
a safe situation, and switch the perspective to another car,
the resulting situation is also safe.
›</span></span>
  
<span class="keyword1" id="Safety_Perfect-safety_switch_invariant"><span class="command">lemma</span></span> safety_switch_invariant<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">v'</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">d</span> <span class="main">::</span> <span class="quoted">cars</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="skolem">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> nequals<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">d</span> <span class="main"><span class="hidden">❙</span><b>=</b></span>  <span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'sub</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'sub_def<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'sub</span> <span class="main">≤</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'sub</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"own <span class="skolem">v'</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v'_def view.switch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"own <span class="skolem">v'sub</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v'sub_def less_eq_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vsub</span></span> <span class="keyword2"><span class="keyword">where</span></span> vsub<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vsub</span> <span class="main">=</span><span class="free">c</span><span class="main">&gt;</span> <span class="skolem">v'sub</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">vsub</span> <span class="main">≤</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> v'_def v'sub_def view.switch_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> v'sub_def <span class="keyword2"><span class="keyword">and</span></span> vsub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vsub</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> view.switch_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> vsub_re_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vsub</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> at_res_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> v'sub_def <span class="keyword2"><span class="keyword">and</span></span> vsub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vsub</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="free">c</span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> view.switch_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> vsub_re_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vsub</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> at_res_inst <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vsub</span><span class="main">⊨</span><span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vsub_re_e vsub_re_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vsub view.somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm nequals <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Regular_Sensors">
<div class="head">
<h1>Theory Regular_Sensors</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      regular/Regular_Sensors.thy
    Author:     Sven Linker

Instantiation of the sensor function to model "regular sensors". That is,
each car can perceive its the physical size and the concrete
braking distance, but can only perceive the physical size of all other cars.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Regular Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section contains an instantiations of the sensor function for 
"regular sensors". That is, each car can perceive its own physical
size and braking distance. However, it can only perceive
the physical size of other cars, and does not know about
their braking distance.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Regular_Sensors
  <span class="keyword2"><span class="keyword">imports</span></span>  <span class="quoted">"<a href="#Length">../Length</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">regular</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">regular</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> 
    <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="keyword1">then</span> traffic.physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> traffic.braking_distance <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> 
               <span class="keyword1">else</span> traffic.physical_size <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> "</span></span>  
    
<span class="keyword1"><span class="command">locale</span></span> regular_sensors <span class="main">=</span> traffic <span class="main">+</span> view
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> regular_sensors<span class="main">:</span> sensors <span class="quoted"><span class="quoted">"regular <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> regular <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> less_add_same_cancel2 less_trans regular_def
        traffic.psGeZero traffic.sdGeZero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>        
  
<span class="keyword1"><span class="command">notation</span></span> regular_sensors.space <span class="main">(</span><span class="quoted">"<span class="keyword1">space</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> regular_sensors.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Similar to the situation with perfect sensors, we can show that the perceived length of a car
is independent of the spatial transitions between traffic snapshots. The 
length may only change during evolutions, in particular if the car changes its dynamical
behaviour.
›</span></span>

<span class="keyword1" id="Regular_Sensors-create_reservation_length_stable"><span class="command">lemma</span></span> create_reservation_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.create_reservation_def sensors.space_def regular_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.sensors_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Regular_Sensors-create_claim_length_stable"><span class="command">lemma</span></span> create_claim_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.create_claim_def sensors.space_def regular_def  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.sensors_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Regular_Sensors-withdraw_reservation_length_stable"><span class="command">lemma</span></span> withdraw_reservation_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> traffic.withdraw_reservation_def sensors.space_def regular_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.sensors_axioms<span class="main">)</span>      
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Regular_Sensors-withdraw_claim_length_stable"><span class="command">lemma</span></span> withdraw_claim_length_stable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span><span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="free">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> traffic.withdraw_claim_def sensors.space_def regular_def  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.sensors_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> outside_right<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> outside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> outside_right <span class="keyword2"><span class="keyword">and</span></span> outside_right' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> inside_right<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inside_right'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="main">(</span> <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> outside_left<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> outside_left'<span class="main">:</span><span class="quoted"><span class="quoted">" left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span><span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> outside_left <span class="keyword2"><span class="keyword">and</span></span> outside_left' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inside_left<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">hence</span></span> inside_left'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> left <span class="main">(</span>ext <span class="free">v</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span><span class="main">(</span><span class="keyword1">space</span> <span class="free">ts'</span> <span class="free">v</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inside_left inside_right inside_left' inside_right' eq 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_sensors.len_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Since the perceived length of cars depends on the owner of the view,
we can now prove how this perception changes if we change the
perspective of a view.
›</span></span>

<span class="keyword1" id="Regular_Sensors-sensors_le"><span class="command">lemma</span></span> sensors_le<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟶</span> regular <span class="free">e</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">&lt;</span> regular <span class="free">c</span> <span class="free">ts</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  traffic.sdGeZero <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_def<span class="main">)</span> 
   
<span class="keyword1" id="Regular_Sensors-sensors_leq"><span class="command">lemma</span></span> sensors_leq<span class="main">:</span><span class="quoted"><span class="quoted">" regular <span class="free">e</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">≤</span> regular <span class="free">c</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_real_def regular_sensors.sensors_le<span class="main">)</span> 
    
<span class="keyword1" id="Regular_Sensors-space_eq"><span class="command">lemma</span></span> space_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"own <span class="free">v</span> <span class="main">=</span> own <span class="free">v'</span> <span class="main">⟶</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> regular_sensors.space_def sensors_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Regular_Sensors-switch_space_le"><span class="command">lemma</span></span> switch_space_le<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> sens<span class="main">:</span><span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">&lt;</span> regular <span class="main">(</span>own <span class="free">v'</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sensors_le view.switch_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span><span class="quoted"><span class="quoted">"pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> regular <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">&lt;</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> regular <span class="main">(</span>own <span class="free">v'</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
  <span class="keyword1"><span class="command">have</span></span> left_eq<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> regular_sensors.left_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">)</span> <span class="main">=</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> regular <span class="main">(</span>own <span class="free">v</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> regular_sensors.right_space  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span> <span class="main">)</span> <span class="main">=</span> pos <span class="free">ts</span> <span class="free">c</span> <span class="main">+</span> regular <span class="main">(</span>own <span class="free">v'</span><span class="main">)</span> <span class="free">ts</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> regular_sensors.right_space  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> right<span class="main">(</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> r1 r2 le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span>  
              <span class="main">∧</span> <span class="main">(</span>right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right<span class="main">(</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∧</span>  <span class="main">¬</span><span class="main">(</span>left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span>  
                    <span class="main">∧</span> right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> regular_sensors.left_space left_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> less_real_int_def left_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Regular_Sensors-switch_space_leq"><span class="command">lemma</span></span> switch_space_leq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">=</span><span class="free">c</span><span class="main">&gt;</span><span class="free">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v</span> <span class="free">c</span> <span class="main">≤</span> <span class="keyword1">space</span> <span class="free">ts</span> <span class="free">v'</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_le order_refl switch_space_le view.switch_refl view.switch_unique<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="HMLSL_Regular">
<div class="head">
<h1>Theory HMLSL_Regular</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      regular/HMLSL_Regular.thy
    Author:     Sven Linker

Defines HMLSL with regular sensors for cars.
*)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹HMLSL for Regular Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Within this section, we instantiate HMLSL for cars with 
regular sensors.
›</span></span>


<span class="keyword1"><span class="command">theory</span></span> HMLSL_Regular
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#HMLSL">../HMLSL</a>"</span> <a href="#Regular_Sensors">Regular_Sensors</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">locale</span></span> hmlsl_regular <span class="main">=</span> regular_sensors <span class="main">+</span> restriction
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> hmlsl <span class="main">:</span> hmlsl <span class="quoted"><span class="quoted">"regular <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>   
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> regular <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_add_same_cancel2 less_trans regular_def
        traffic.psGeZero traffic.sdGeZero<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">notation</span></span> hmlsl.re <span class="main">(</span><span class="quoted">"<span class="keyword1">re'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.cl<span class="main">(</span><span class="quoted">"<span class="keyword1">cl'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The spatial atoms are dependent of the perspective of the view,
hence we cannot prove similar lemmas as for perfect sensors.

However, we can still prove 
lemmas corresponding to the activity and stability rules of the
proof system for MLSL \cite{Linker2015a}.

Similar to the situation with perfect sensors, needed to instantiate the 
sensor function, to ensure that the perceived length does not change
during spatial transitions.
›</span></span>
  
<span class="keyword1" id="HMLSL_Regular-backwards_res_act"><span class="command">lemma</span></span> backwards_res_act<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> len_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts</span> <span class="free">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="free">v</span> <span class="free">ts'</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> create_reservation_length_stable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"res <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm traffic.create_res_subseteq1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> restr_subs_res<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>    
    <span class="keyword1"><span class="command">using</span></span> assm restriction.restrict_view <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clm <span class="free">ts</span> <span class="free">c</span> <span class="main">⊑</span> res <span class="free">ts'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm traffic.create_res_subseteq2     
    <span class="keyword1"><span class="command">using</span></span> assm restriction.restrict_view  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">hence</span></span> restr_subs_clm<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts'</span><span class="main">)</span> <span class="free">c</span>"</span></span>     
    <span class="keyword1"><span class="command">using</span></span> assm restriction.restrict_view <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">∨</span> restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> restr_res_nonempty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> restrict_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.card_non_empty_geq_one nat_int.card_subset_le dual_order.antisym
        restr_subs_res assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span> <span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restr_subs_res assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restriction.restrict_eq_lan_subs
        restrict_one assm  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assm len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> restr_res_empty<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>res <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="main">∅</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  clm_non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assm bot.extremum inf.absorb1 inf_commute local.hmlsl.free_no_clm
          restriction.create_reservation_restrict_union restriction.restrict_def
          un_empty_absorb1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> restrict_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">|</span>restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span> <span class="free">c</span> <span class="main">|</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nat_int.card_non_empty_geq_one nat_int.card_subset_le dual_order.antisym
        restr_subs_clm assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span> <span class="main">)</span> <span class="free">c</span> <span class="main">⊑</span> lan <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restr_subs_clm assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">v</span> <span class="main">(</span>clm <span class="free">ts</span><span class="main">)</span><span class="free">c</span> <span class="main">=</span> lan <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> restriction.restrict_eq_lan_subs
        restrict_one assm   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assm len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL_Regular-backwards_res_act_somewhere"><span class="command">lemma</span></span> backwards_res_act_somewhere<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> backwards_res_act <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 


<span class="keyword1" id="HMLSL_Regular-backwards_res_stab"><span class="command">lemma</span></span> backwards_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="free">d</span> <span class="main">≠</span><span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> regular_sensors.create_reservation_length_stable restrict_def'
    traffic.create_res_subseteq1_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="HMLSL_Regular-backwards_c_res_stab"><span class="command">lemma</span></span> backwards_c_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> create_claim_length_stable traffic.create_clm_eq_res  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> traffic.create_claim_def<span class="main">)</span> 
    
<span class="keyword1" id="HMLSL_Regular-backwards_wdc_res_stab"><span class="command">lemma</span></span> backwards_wdc_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="free">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> withdraw_claim_length_stable traffic.withdraw_clm_eq_res
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> traffic.withdraw_claim_def<span class="main">)</span>
    
<span class="keyword1" id="HMLSL_Regular-backwards_wdr_res_stab"><span class="command">lemma</span></span> backwards_wdr_res_stab<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="free">d</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="free">ts'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ts'</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">ts</span><span class="main">,</span><span class="free">v</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 order_trans regular_sensors.withdraw_reservation_length_stable
      restrict_def' restriction.restrict_res traffic.withdraw_res_subseteq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We now proceed to prove the \emph{reservation lemma}, which was 
crucial in the manual safety proof \cite {Hilscher2011}. 
›</span></span>
<span class="keyword1" id="HMLSL_Regular-reservation1"><span class="command">lemma</span></span> reservation1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ts'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>→</b></span><span class="skolem">ts'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> re<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 order_trans regular_sensors.create_reservation_length_stable
          restrict_def' restriction.restrict_subseteq traffic.create_res_subseteq1 ts'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> cl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 order_trans regular_sensors.create_reservation_length_stable
          restrict_def' restriction.restrict_subseteq traffic.create_res_subseteq2 ts'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HMLSL_Regular-reservation2"><span class="command">lemma</span></span> reservation2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> backwards_res_act traffic.always_create_res     
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    
<span class="keyword1" id="HMLSL_Regular-reservation"><span class="command">lemma</span></span> reservation<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>↔</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reservation1 reservation2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div><div id="Safety_Regular">
<div class="head">
<h1>Theory Safety_Regular</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      regular/Safety_Regular.thy
    Author:     Sven Linker

Distance and Lane change controller for cars with regular sensors.
Flawed safety theorem and proof of flawedness.
Controller definitions that take knowledge of other cars
into account and correct safety theorem.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Safety for Cars with Regular Sensors›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This section contains the definition of requirements for
lane change and distance controllers for cars, with the assumption
of regular sensors. Using these definitions, we show that safety
is an invariant along all possible behaviour of cars. 
However, we need to slightly amend our notion of safety, compared
to the safety proof for perfect sensors.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Safety_Regular
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#HMLSL_Regular">HMLSL_Regular</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">context</span></span> hmlsl_regular 
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">interpretation</span></span> hmlsl <span class="main">:</span> hmlsl <span class="quoted"><span class="quoted">"regular <span class="main">::</span> cars <span class="main">⇒</span> traffic <span class="main">⇒</span> cars <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>   
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> regular <span class="skolem">e</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_add_same_cancel2 less_trans regular_def
        traffic.psGeZero traffic.sdGeZero<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.space <span class="main">(</span><span class="quoted">"<span class="keyword1">space</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.re <span class="main">(</span><span class="quoted">"<span class="keyword1">re'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.cl<span class="main">(</span><span class="quoted">"<span class="keyword1">cl'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> hmlsl.len <span class="main">(</span><span class="quoted">"<span class="keyword1">len</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
First we show that the same "safety" theorem as for perfect senors can be 
proven. However, we will subsequently show that this theorem does not
ensure safety from the perspective of each car.

The controller definitions for this "flawed" safety are the same as for perfect sensors.
›</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">safe</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars<span class="main">⇒</span>σ"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">safe</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">DC</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DC</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> 
                  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pcc</span><span class="main">::</span><span class="quoted"><span class="quoted">"cars <span class="main">⇒</span> cars <span class="main">⇒</span> σ"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pcc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">LC</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LC</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span>"</span></span>
    

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The safety proof is exactly the same as for perfect sensors. Note
in particular, that we fix a single car \(e\) for which we show
safety.
›</span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> safety_flawed<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>  
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">c</span><span class="main">::</span> <span class="quoted">cars</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> neg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> init<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe <span class="bound">e</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> DC <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> DC"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> LC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> LC"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl <span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> move_nothing  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> init move_nothing neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>evolve <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_DC<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> 
                            <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> evolve.hyps DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> evolve.IH  <span class="keyword2"><span class="keyword">and</span></span> e_def <span class="keyword2"><span class="keyword">and</span></span> neg <span class="keyword1"><span class="command">have</span></span> 
        ts'_safe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> no_coll_after_evol<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local_DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> move_eq<span class="main">:</span><span class="quoted"><span class="quoted">"move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"evolve.hyps"</span> abstract.evolve abstract.refl move_trans
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> traffic.abstract.evolve traffic.abstract.refl traffic.move_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> no_coll_after_evol <span class="keyword2"><span class="keyword">and</span></span> evolve.hyps <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> e_def <span class="keyword1"><span class="command">using</span></span>  move_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_LC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span><span class="main">)</span>  "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LC cr_res.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> move_stability_res cr_res.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> cr_res.hyps local.create_reservation_def local.move_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cr_res.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">∨</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab neg 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span>  v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH e_def move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> pcc <span class="skolem">c</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> pcc <span class="bound">c</span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>  "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> local_LC move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">d</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> neq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> 
          <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_stab <span class="keyword1"><span class="command">have</span></span> overlap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab neg neq2 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def neq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> unsafe2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>   somewhere_leq v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">from</span></span> cr_res.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> unsafe2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> eq2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>   <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> e_def  backwards_res_stab neg 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def eq2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH e_def move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> pcc <span class="skolem">e</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">d</span><span class="main">.</span> pcc <span class="bound">d</span> <span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>  "</span></span>
              <span class="keyword1"><span class="command">using</span></span> local_LC move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_clm cr_clm.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps cr_clm.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="skolem">d</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cr_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_def backwards_c_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e_def v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> cr_clm.IH move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_wdr wd_res.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps wd_res.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> wd_res.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_def backwards_wdr_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
          v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_res.IH move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_wdc wd_clm.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps wd_clm.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wd_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_def backwards_wdc_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_clm.IH move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
As stated above, the flawed safety theorem does not ensure safety for 
the perspective of each car.
In particular, we can construct a traffic snapshot and a view, such that
it satisfies our safety predicate for each car, but if we switch the
perspective of the view to another car, the situation is unsafe. A
visualisation of this situation can be found in the publication
of this work at iFM 2017 \cite{Linker2017}.
›</span></span>

<span class="keyword1" id="Safety_Regular-safety_not_invariant_switch"><span class="command">lemma</span></span> safety_not_invariant_switch<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">ts</span><span class="main">,</span><span class="bound">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span><span class="quoted">cars</span> <span class="keyword2"><span class="keyword">where</span></span> assumption<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span><span class="skolem">c</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> cars.at_least_two_cars_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pos'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  pos'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">pos'</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">po</span></span> <span class="keyword2"><span class="keyword">where</span></span> pos_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">po</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pos'</span><span class="main">(</span><span class="skolem">c</span><span class="main">:=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">d</span><span class="main">:=</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">re</span></span> <span class="keyword2"><span class="keyword">where</span></span> res_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">)</span><span class="main">.</span> <span class="skolem">re</span> <span class="bound">c</span> <span class="main">=</span> Abs_nat_int<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cl</span></span> <span class="keyword2"><span class="keyword">where</span></span> clm_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">)</span><span class="main">.</span> <span class="skolem">cl</span> <span class="bound">c</span><span class="main">=</span> <span class="main">∅</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dy</span></span> <span class="keyword2"><span class="keyword">where</span></span> dyn_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real <span class="main">.</span> <span class="main">(</span><span class="skolem">dy</span> <span class="bound">c</span><span class="main">)</span> <span class="bound">x</span>  <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sd</span></span> <span class="keyword2"><span class="keyword">where</span></span> sd_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">)</span><span class="main">.</span> <span class="skolem">sd</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span>cars<span class="main">)</span><span class="main">.</span> <span class="skolem">ps</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts_rep</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_rep_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts_rep</span><span class="main">=</span> <span class="main">(</span><span class="skolem">po</span><span class="main">,</span> <span class="skolem">re</span><span class="main">,</span> <span class="skolem">cl</span><span class="main">,</span> <span class="skolem">dy</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">,</span> <span class="skolem">sd</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      
  <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">∅</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clm_def nat_int.inter_empty1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> re_geq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_nat_int_inverse nat_int.card'_def res_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> re_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.card'.rep_eq res_def nat_int.rep_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> cl_leq_one<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero clm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> add_leq_two<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> <span class="main">|</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> nat_int.card_empty_zero clm_def re_leq_two <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>  clNextRe <span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="skolem">re</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int <span class="main">(</span><span class="skolem">cl</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> clm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dyn_def <span class="keyword1"><span class="command">have</span></span> dyn_geq_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">dy</span> <span class="bound">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ps_def <span class="keyword1"><span class="command">have</span></span> ps_ge_zero <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">ps</span> <span class="bound">c</span><span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sd_def <span class="keyword1"><span class="command">have</span></span> sd_ge_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">sd</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ts_in_type<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">ts_rep</span> <span class="main">∈</span> 
  <span class="main">{</span><span class="bound">ts</span> <span class="main">::</span> <span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>lanes<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">*</span><span class="main">(</span>cars<span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">∅</span> <span class="main">)</span>  <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">|</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">+</span> <span class="main">|</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">|</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>snd<span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">∅</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∪</span> Rep_nat_int <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> 
        <span class="main">=</span> <span class="main">{</span><span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">.</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span>  snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span><span class="bound">ts</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>
 <span class="main">}</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pos_def res_def clm_def disj re_geq_one re_leq_two cl_leq_one add_leq_two
      ps_ge_zero sd_ge_zero ts_rep_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> lan <span class="main">=</span> Abs_nat_int<span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> own <span class="main">=</span> <span class="skolem">d</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ts</span></span> <span class="keyword2"><span class="keyword">where</span></span> ts_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">=</span>Abs_traffic <span class="skolem">ts_rep</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">have</span></span> size<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> physical_size <span class="skolem">ts</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps_def physical_size_def ts_rep_def
      ts_in_type ts_def ps_ge_zero <span class="keyword1"><span class="command">using</span></span> Abs_traffic_inverse 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">have</span></span> safe<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> other_len_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">≠</span><span class="skolem">d</span> <span class="main">⟶</span> <span class="main">∥</span> <span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="bound">e</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
      <span class="keyword3"><span class="command">assume</span></span> e_def<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">e</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> position<span class="main">:</span><span class="quoted"><span class="quoted">"pos <span class="skolem">ts</span> <span class="skolem">e</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_def ts_def ts_rep_def ts_in_type ts_def
          Abs_traffic_inverse pos_def fun_upd_apply pos'_def traffic.pos_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="skolem">v</span><span class="main">)</span> <span class="skolem">ts</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e_def v_def sensors_def ps_def ts_def size regular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> space<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">e</span> <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e_def pos_def position hmlsl.space_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">&gt;</span> right <span class="main">(</span>ext <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> space v_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∥</span> <span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">e</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hmlsl.len_def real_int.length_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> no_cars<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">≠</span><span class="skolem">d</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="bound">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
      <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> other_len_zero <span class="keyword1"><span class="command">have</span></span> len_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">e</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> contra <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> v'_def <span class="keyword2"><span class="keyword">and</span></span> len_e <span class="keyword1"><span class="command">have</span></span> len_v'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">e</span><span class="main">∥</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hmlsl.len_empty_subview  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> v'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> len_v' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword1"><span class="command">have</span></span> sensors_c<span class="main">:</span><span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="skolem">v</span><span class="main">)</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> v_def regular_def ps_def ts_def size assumption <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> space_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pos_def ts_def ts_rep_def ts_in_type Abs_traffic_inverse
        fun_upd_apply sensors_c  assumption hmlsl.space_def traffic.pos_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lc<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_c Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rv<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> lv<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_c Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> len_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> space_c v_def hmlsl.len_def lc lv rv rc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sensors_d<span class="main">:</span><span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="skolem">v</span><span class="main">)</span> <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> v_def regular_def braking_distance_def ts_def size sd_def
        Abs_traffic_inverse ts_in_type ts_rep_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> space_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">d</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pos_def ts_def ts_rep_def ts_in_type Abs_traffic_inverse
        fun_upd_apply sensors_d assumption hmlsl.space_def traffic.pos_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ld<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_d Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rd<span class="main">:</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_d Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> len_d <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> space_d v_def hmlsl.len_def ld rd lv rv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> no_overlap_c_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> contra<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> len_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> <span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> v'_def <span class="keyword1"><span class="command">have</span></span> v'_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
                   <span class="keyword2"><span class="keyword">and</span></span>  v'_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∥</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">d</span><span class="main">∥</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> v'_c <span class="keyword1"><span class="command">have</span></span> v'_rel_c<span class="main">:</span>
        <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> hmlsl.len_non_empty_inside <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> v'_d <span class="keyword1"><span class="command">have</span></span> v'_rel_d<span class="main">:</span>
        <span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">&lt;</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">∧</span> right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">&gt;</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> hmlsl.len_non_empty_inside <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> less_len<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hmlsl.view_leq_len_leq v'_c v'_def less_eq_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> sp_eq_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">c</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v'_def less_eq_view_ext_def regular_def hmlsl.space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> sp_eq_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v'</span> <span class="skolem">d</span> <span class="main">=</span> <span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> v'_def less_eq_view_ext_def regular_def hmlsl.space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ld lc v'_rel_c v'_rel_d sp_eq_c sp_eq_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> r_v'<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">5</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> rd rc v'_rel_c v'_rel_d sp_eq_c sp_eq_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> l_v'<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">≠</span> ext <span class="skolem">v'</span>  "</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> ext <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> right <span class="main">(</span>ext <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> less_len <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">≤</span> right <span class="main">(</span><span class="keyword1">len</span> <span class="skolem">v</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_int_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> len_c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">len</span> <span class="skolem">v'</span> <span class="skolem">ts</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> r_v' eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> safe<span class="main">(</span><span class="skolem">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> x_neg_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">y</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_cars <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">y</span> <span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> y_eq_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">c</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">d</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> no_overlap_c_d y_eq_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_eq_c x_neg_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_cars x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> y_eq_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">d</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_overlap_c_d y_eq_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span><span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_eq_c x_neg_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_cars x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">c</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> notI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">vc</span>
      <span class="keyword3"><span class="command">assume</span></span> sw<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="skolem">v</span><span class="main">=</span><span class="skolem">c</span><span class="main">&gt;</span><span class="skolem">vc</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> spatial_vc<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="skolem">v</span> <span class="main">=</span> ext <span class="skolem">vc</span> <span class="main">∧</span> lan <span class="skolem">v</span> <span class="main">=</span> lan <span class="skolem">vc</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> switch_def sw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> safe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vc</span><span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vc'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vc'_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">vc'</span><span class="main">=</span><span class="main">⦇</span>ext <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> lan <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">,</span> own <span class="main">=</span> <span class="skolem">c</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">have</span></span> own_eq<span class="main">:</span><span class="quoted"><span class="quoted">"own <span class="skolem">vc'</span> <span class="main">=</span> own <span class="skolem">vc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sw switch_def vc'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ext_vc<span class="main">:</span><span class="quoted"><span class="quoted">"ext <span class="skolem">vc</span> <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spatial_vc v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> right_ok<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">vc</span><span class="main">)</span> <span class="main">≥</span> right <span class="main">(</span>ext <span class="skolem">vc'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vc'_def ext_vc Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> left_ok<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">vc'</span><span class="main">)</span> <span class="main">≥</span> left <span class="main">(</span>ext <span class="skolem">vc</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vc'_def ext_vc Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ext_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"ext <span class="skolem">vc'</span> <span class="main">≤</span> ext <span class="skolem">vc</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> right_ok left_ok less_eq_real_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lan <span class="skolem">vc</span> <span class="main">=</span> Abs_nat_int<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_def switch_def sw <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> lan_leq<span class="main">:</span><span class="quoted"><span class="quoted">"lan <span class="skolem">vc'</span> <span class="main">⊑</span> lan <span class="skolem">vc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  vc'_def  order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> leqvc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">vc'</span> <span class="main">≤</span> <span class="skolem">vc</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ext_leq lan_leq own_eq less_eq_view_ext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>         
      <span class="keyword1"><span class="command">have</span></span> sensors_c<span class="main">:</span><span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="skolem">vc'</span><span class="main">)</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vc'_def regular_def ps_def traffic.braking_distance_def 
          ts_def sd_def size assumption Abs_traffic_inverse ts_in_type  ts_rep_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> space_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">c</span> <span class="main">=</span> Abs_real_int <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pos_def ts_def ts_rep_def ts_in_type Abs_traffic_inverse
          fun_upd_apply sensors_c  assumption hmlsl.space_def traffic.pos_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lc<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_c Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> rv<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span>ext <span class="skolem">vc'</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vc'_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lv<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span>ext <span class="skolem">vc'</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vc'_def Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_c Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> len_c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">vc'</span> <span class="skolem">ts</span> <span class="skolem">c</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> space_c v_def hmlsl.len_def lc lv rv rc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> res_c<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">vc'</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ts_def ts_rep_def ts_in_type Abs_traffic_inverse res_def traffic.res_def
          inf_idem restrict_def vc'_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>          
      <span class="keyword1"><span class="command">have</span></span> sensors_d<span class="main">:</span><span class="quoted"><span class="quoted">"regular <span class="main">(</span>own <span class="skolem">vc'</span><span class="main">)</span> <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vc'_def regular_def ts_def size sd_def Abs_traffic_inverse ts_in_type
          ts_rep_def assumption
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> space_d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">d</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pos_def ts_def ts_rep_def ts_in_type Abs_traffic_inverse
          fun_upd_apply sensors_d assumption hmlsl.space_def traffic.pos_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ld<span class="main">:</span><span class="quoted"><span class="quoted">"left <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_d Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> rd<span class="main">:</span> <span class="quoted"><span class="quoted">"right <span class="main">(</span><span class="keyword1">space</span> <span class="skolem">ts</span> <span class="skolem">vc'</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> space_d Abs_real_int_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> len_d <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">len</span> <span class="skolem">vc'</span> <span class="skolem">ts</span> <span class="skolem">d</span> <span class="main">=</span> Abs_real_int<span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> space_d v_def hmlsl.len_def ld rd lv rv
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span>  res_d<span class="main">:</span><span class="quoted"><span class="quoted">"restrict <span class="skolem">vc'</span> <span class="main">(</span>res <span class="skolem">ts</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">=</span> Abs_nat_int <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ts_def ts_rep_def ts_in_type Abs_traffic_inverse res_def traffic.res_def
          inf_idem restrict_def vc'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>          
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vc'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 
          len_d len_c vc'_def ts_def ts_rep_def ts_in_type Abs_traffic_inverse
          res_c res_d nat_int.card'_def
          Abs_real_int_inverse real_int.length_def traffic.res_def
          nat_int.singleton2 Abs_nat_int_inverse
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> leqvc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vc</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> assumption <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">vc</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> safe <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> safe <span class="keyword2"><span class="keyword">and</span></span> unsafe <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span>  <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> safe<span class="main">(</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Now we show how to amend the controller specifications to gain safety as an invariant
even with regular sensors.

The distance controller can be strengthened, by requiring that we switch
to the perspective of one of the cars involved first, before checking
for the collision. Since all variables are universally quantified, 
this ensures that no collision exists for the perspective of any car.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">DC'</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DC'</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> 
                  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The amendment to the lane change controller is slightly different. Instead
of checking the potential collision only from the perspective of the
car \(d\) trying to change lanes, we require that also no other car may
perceive a potential collision. Note that the restriction to \(d\)'s
behaviour can only be enforced within \(d\), if the information from
the other car is somehow passed to \(d\). Hence, we require the 
cars to communicate in some way. However, we do not need to specifiy,
\emph{how} this communication is implemented. 
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">LC'</span><span class="main">::</span><span class="quoted"><span class="quoted">"σ"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LC'</span> <span class="main">≡</span> <span class="keyword1"><span class="hidden">❙</span><b>G</b></span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span>  <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span> <span class="main">)</span> "</span></span>
    

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
With these new controllers, we can prove a stronger theorem than before. Instead
of proving safety from the perspective of a single car as previously, we now
only consider a traffic situation to be safe, if it satisfies the safety
predicate from the perspective of \emph{all} cars. Note that this immediately
implies the safety invariance theorem proven for perfect sensors. 
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> safety<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">e</span> <span class="main">(</span> safe <span class="bound">e</span> <span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC' <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC' <span class="main"><span class="hidden">❙</span><b>→</b></span>  <span class="keyword1"><span class="hidden">❙</span><b>G</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">e</span><span class="main">.</span>  <span class="main"><span class="hidden">❙</span><b>@</b></span> <span class="bound">e</span> <span class="main">(</span>safe <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="skolem">ts'</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">e</span> <span class="main">(</span>safe <span class="bound">e</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> DC' <span class="main"><span class="hidden">❙</span><b>∧</b></span> LC'"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span> <span class="main"><span class="hidden">❙</span><b>⇒</b></span> <span class="skolem">ts'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> init<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">e</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">e</span> <span class="main">(</span>safe <span class="bound">e</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> DC <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> DC'"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword1"><span class="command">have</span></span> LC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">,</span><span class="skolem">v</span> <span class="main">⊨</span> LC'"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl <span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> move_nothing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span>    move_nothing init  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>evolve <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_DC<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>
                             <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="bound">d</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> evolve.hyps DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists switch_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ve</span></span> <span class="keyword2"><span class="keyword">where</span></span> ve_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span><span class="skolem">e</span><span class="main">&gt;</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> evolve.IH  <span class="keyword2"><span class="keyword">and</span></span> c_def <span class="keyword1"><span class="command">have</span></span> 
        ts'_safe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> not_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> safe'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> hmlsl.at_conj_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> not_eq <span class="keyword1"><span class="command">have</span></span> not_eq_v<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hmlsl.at_eq switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>
                                 <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> local_DC <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> dc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span>
                                      <span class="main">(</span><span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_eq_v
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> no_coll_after_evol<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b><span class="hidden">❙</span><b>τ</b></span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> safe' 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> evolve.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> move_eq<span class="main">:</span><span class="quoted"><span class="quoted">"move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"evolve.hyps"</span> abstract.evolve abstract.refl move_trans
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> move_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main"><span class="hidden">❙</span><b>⟨</b></span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_clm cr_clm.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps cr_clm.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists switch_unique 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ve</span></span> <span class="keyword2"><span class="keyword">where</span></span> ve_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span><span class="skolem">e</span><span class="main">&gt;</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> c_neq_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>c(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cr_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_def backwards_c_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="main">(</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_neq_e c_def v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> cr_clm.IH move_stab ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>                                     
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_wdr wd_res.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps wd_res.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists switch_unique  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ve</span></span> <span class="keyword2"><span class="keyword">where</span></span> ve_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span><span class="skolem">e</span><span class="main">&gt;</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> c_neq_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">n</span></span>  <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdr(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wd_res.hyps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n_def backwards_wdr_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="main">(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> c_neq_e c_def v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_res.IH move_stab ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>                                     
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>wd_clm <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_wdc wd_clm.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps wd_clm.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ve</span></span> <span class="keyword2"><span class="keyword">where</span></span> ve_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span><span class="skolem">e</span><span class="main">&gt;</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> c_neq_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>wdc(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wd_clm.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_def backwards_wdc_res_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="main">(</span><span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_neq_e c_def v'_def somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> wd_clm.IH move_stab ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>                                     
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cr_res <span class="skolem">ts'</span> <span class="skolem">ts''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> local_LC<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">d</span><span class="main">.</span><span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> LC cr_res.hyps<span class="main">(</span>1<span class="main">)</span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts'</span> <span class="skolem">ts''</span> <span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> move_stability_res cr_res.hyps move_trans 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> move_stab<span class="main">:</span> <span class="quoted"><span class="quoted">"move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">=</span> move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abstract.simps cr_res.hyps move_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">d</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cr_res.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  e_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists switch_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ve</span></span> <span class="keyword2"><span class="keyword">where</span></span> ve_def<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span><span class="skolem">e</span><span class="main">&gt;</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> safe <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> switch_always_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> unsafe<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="bound">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> c_neq_e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span><span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="skolem">e</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>   <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_def  backwards_res_stab c_neq_e 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def True<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span>  v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> somewhere_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
          <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH c_def move_stab ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> pcc <span class="skolem">c</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>pcc <span class="skolem">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ve_def move_stab switch_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">c</span> <span class="main">(</span>pcc <span class="skolem">c</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>pcc <span class="skolem">c</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">c</span><span class="main">.</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">c</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>pcc <span class="bound">c</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> local_LC e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">d</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_stab <span class="keyword1"><span class="command">have</span></span> overlap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> c_def  backwards_res_stab c_neq_e False
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def neq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> unsafe2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> safe<span class="main">(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  c_neq_e somewhere_leq v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> cr_res.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>safe<span class="main">(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> move_stab <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> unsafe2 ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">best</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True            
          <span class="keyword1"><span class="command">hence</span></span> e_trans<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span> <span class="keyword1"><span class="hidden">❙</span><b>─</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="skolem">ts''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> c_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'_def<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts''</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> backwards_res_act <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">v'</span> <span class="main">⊨</span>   <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> c_def  backwards_res_stab c_neq_e 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> d_def True<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">≤</span> <span class="skolem">ve</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ts'</span><span class="main">,</span><span class="bound">v'</span> <span class="main">⊨</span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> v'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> somewhere_leq move_stab 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span> "</span></span> 
            <span class="keyword1"><span class="command">using</span></span> hmlsl.somewhere_and_or_distr  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> 
          <span class="keyword1"><span class="command">proof</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">re(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assm' cr_res.IH c_def move_stab ve_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> assm'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span>  <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span><span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span><span class="main"><span class="hidden">❙</span><b>¬</b></span> <span class="main">(</span><span class="skolem">c</span> <span class="main"><span class="hidden">❙</span><b>=</b></span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main"><span class="hidden">❙</span><b>⟨</b></span> <span class="keyword1">cl(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∧</b></span> <span class="main">(</span><span class="keyword1">re(</span><span class="skolem">e</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="keyword1">cl(</span><span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⟩</b></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span><span class="skolem">ve</span> <span class="main">⊨</span> pcc <span class="skolem">e</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>pcc <span class="skolem">e</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ve_def move_stab  switch_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">hence</span></span> pcc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span> move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">e</span> <span class="main">(</span>pcc <span class="skolem">e</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">c</span> <span class="main">(</span>pcc <span class="skolem">e</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span> <span class="bound">d</span><span class="main">.</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="bound">d</span> <span class="main">(</span>pcc <span class="bound">d</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∨</b></span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>@</b></span><span class="skolem">c</span> <span class="main">(</span>pcc <span class="bound">d</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>→</b></span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> local_LC move_stab c_def e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts'</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts'</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="keyword1"><span class="hidden">❙</span><b>□</b>r(</span><span class="skolem">c</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ts''</span><span class="main">,</span>move <span class="skolem">ts</span> <span class="skolem">ts''</span> <span class="skolem">v</span> <span class="main">⊨</span> <span class="main"><span class="hidden">❙</span><b>⊥</b></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>