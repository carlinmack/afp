<div id="NetworkCore">
<div class="head">
<h1>Theory NetworkCore</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Packets and Networks›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  NetworkCore
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In networks based e.g. on TCP/IP, a message from A to B is encapsulated in  \emph{packets}, which 
  contain the content of the message and routing information. The routing information mainly 
  contains its source and its destination address.
  
  In the case of stateless packet filters, a firewall bases its decision upon this routing 
  information and, in the stateful case, on the content. Thus, we model a packet as a four-tuple of 
  the mentioned elements, together with an id field.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The ID is an integer:›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> id <span class="main">=</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  To enable different representations of addresses (e.g. IPv4 and IPv6, with or without ports), 
  we model them as an unconstrained type class and directly provide several instances: 
›</span></span>
<span class="keyword1"><span class="command">class</span></span> adr

<span class="keyword1"><span class="command">type_synonym</span></span>    <span class="tfree">'α</span> src  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span>    <span class="tfree">'α</span> dest <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span><span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> nat <span class="main">::</span><span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">adr</span><span class="main">,</span><span class="quoted">adr</span><span class="main">)</span> <span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> prod <span class="main">::</span> <span class="main">(</span><span class="quoted">adr</span><span class="main">,</span><span class="quoted">adr</span><span class="main">)</span> <span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The content is also specified with an unconstrained generic type: 
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'β</span> content <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'β</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For applications where the concrete representation of the content field does not matter (usually 
  the case for stateless packet filters), we provide a default type which can be used in those
  cases: 
›</span></span>
 
<span class="keyword1"><span class="command">datatype</span></span> DummyContent <span class="main">=</span> data

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, a packet is:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">=</span> <span class="quoted"><span class="quoted">"id <span class="main">×</span> <span class="tfree">'α</span> src <span class="main">×</span> <span class="tfree">'α</span> dest <span class="main">×</span> <span class="tfree">'β</span> content"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Protocols (e.g. http) are not modelled explicitly. In the case of stateless packet filters, they 
  are only visible by the destination port of a packet, which are modelled as part of the address. 
  Additionally, stateful firewalls often determine the protocol by the content of a packet. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">src</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'α</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">src</span>  <span class="main">=</span> fst <span class="keyword1">o</span> snd "</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Port numbers (which are part of an address) are also modelled in a generic way. The integers and 
  the naturals are typical representations of port numbers. 
›</span></span>

<span class="keyword1"><span class="command">class</span></span> port

<span class="keyword1"><span class="command">instance</span></span> int <span class="main">::</span><span class="quoted">port</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> nat <span class="main">::</span> <span class="quoted">port</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">port</span><span class="main">,</span><span class="quoted">port</span><span class="main">)</span> <span class="quoted">port</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"prod"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">port</span><span class="main">,</span><span class="quoted">port</span><span class="main">)</span> <span class="quoted">port</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A packet therefore has two parameters, the first being the address, the second the content. For 
  the sake of simplicity, we do not allow to have a different address representation format for the 
  source and the destination of a packet. 
  
  To access the different parts of a packet directly, we define a couple of projectors: 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">id</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> id"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">id</span> <span class="main">=</span> fst"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'α</span> dest"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dest</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">content</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'β</span> content"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">content</span> <span class="main">=</span> snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> protocol <span class="main">=</span> tcp <span class="main">|</span> udp

<span class="keyword1" id="NetworkCore-either"><span class="command">lemma</span></span> either<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">≠</span> tcp<span class="main">;</span><span class="free">a</span> <span class="main">≠</span> udp<span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NetworkCore-either2"><span class="command">lemma</span></span> either2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≠</span> tcp<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> udp<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>                 

<span class="keyword1" id="NetworkCore-either3"><span class="command">lemma</span></span> either3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≠</span> udp<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> tcp<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>                

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following two constants give the source and destination port number of a packet. Address 
  representations using port numbers need to provide a definition for these types.
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> src_port <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword1"><span class="command">consts</span></span> dest_port <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword1"><span class="command">consts</span></span> src_protocol <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> protocol"</span></span>
<span class="keyword1"><span class="command">consts</span></span> dest_protocol <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> protocol"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A subnetwork (or simply a network) is a set of sets of addresses.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> net <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> set set"</span></span>
 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The relation {in\_subnet} (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊏›</span></span></span></span>) checks if an address is in a specific network.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">in_subnet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 100<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">in_subnet</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="bound">s</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemmas will be useful later.›</span></span>

<span class="keyword1" id="NetworkCore-in_subnet"><span class="command">lemma</span></span> in_subnet<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">e</span><span class="main">)</span> <span class="main">⊏</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x1</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span> <span class="free">a</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_subnet_def<span class="main">)</span>

<span class="keyword1" id="NetworkCore-src_in_subnet"><span class="command">lemma</span></span> src_in_subnet<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"src<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">e</span><span class="main">)</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⊏</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x1</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span> <span class="free">a</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_subnet_def in_subnet src_def<span class="main">)</span>

<span class="keyword1" id="NetworkCore-dest_in_subnet"><span class="command">lemma</span></span> dest_in_subnet<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dest <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="free">e</span><span class="main">)</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">⊏</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x1</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="free">P</span> <span class="free">a</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_subnet_def in_subnet dest_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Address models should provide a definition for the following constant, returning a network 
  consisting of the input address only. 
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> subnet_of <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> packet_defs <span class="main">=</span> in_subnet_def id_def content_def src_def dest_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DatatypeAddress">
<div class="head">
<h1>Theory DatatypeAddress</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype Addresses›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  DatatypeAddress
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A theory describing a network consisting of three subnetworks. Hosts within a network are not 
  distinguished.
›</span></span>
 
<span class="keyword1"><span class="command">datatype</span></span> DatatypeAddress <span class="main">=</span> dmz_adr <span class="main">|</span> intranet_adr <span class="main">|</span> internet_adr

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dmz</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypeAddress net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dmz</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span>dmz_adr<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">intranet</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypeAddress net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intranet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span>intranet_adr<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">internet</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypeAddress net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span>internet_adr<span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DatatypePort">
<div class="head">
<h1>Theory DatatypePort</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype Addresses with Ports›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  DatatypePort
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A theory describing a network consisting of three subnetworks, including port numbers modelled 
  as Integers. Hosts within a network are not distinguished.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> DatatypeAddress <span class="main">=</span> dmz_adr <span class="main">|</span> intranet_adr <span class="main">|</span> internet_adr

<span class="keyword1"><span class="command">type_synonym</span></span>  
  port <span class="main">=</span> <span class="quoted">int</span>
<span class="keyword1"><span class="command">type_synonym</span></span>  
  DatatypePort <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>DatatypeAddress <span class="main">×</span> port<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> DatatypeAddress <span class="main">::</span> <span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dmz</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypePort net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dmz</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> dmz_adr<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">intranet</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypePort net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intranet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> intranet_adr<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">internet</span><span class="main">::</span><span class="quoted"><span class="quoted">"DatatypePort net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> internet_adr<span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">overloading</span></span> src_port_datatype <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_port_datatype</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>DatatypePort<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span>  <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> dest_port_datatype <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_port_datatype</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>DatatypePort<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span>  <span class="main">≡</span><span class="main">(</span>snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> subnet_of_datatype <span class="main">≡</span> <span class="quoted"><span class="quoted">"subnet_of <span class="main">::</span> <span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subnet_of_datatype</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>DatatypePort<span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="DatatypePort-src_port"><span class="command">lemma</span></span> src_port <span class="main">:</span> <span class="quoted"><span class="quoted">"src_port <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">)</span><span class="main">::</span><span class="main">(</span>DatatypePort<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> src_port_datatype_def in_subnet<span class="main">)</span>

<span class="keyword1" id="DatatypePort-dest_port"><span class="command">lemma</span></span> dest_port <span class="main">:</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">e</span><span class="main">)</span><span class="main">::</span><span class="main">(</span>DatatypePort<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dest_port_datatype_def in_subnet<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemmas</span></span> DatatypePortLemmas <span class="main">=</span> src_port dest_port src_port_datatype_def dest_port_datatype_def 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IntegerAddress">
<div class="head">
<h1>Theory IntegerAddress</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Integer Addresses›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  IntegerAddress
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A theory where addresses are modelled as Integers.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  adr<span class="hidden">⇩</span><sub>i</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"int"</span></span> 
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IntegerPort">
<div class="head">
<h1>Theory IntegerPort</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Integer Addresses with Ports›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  IntegerPort
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A theory describing addresses which are modelled as a pair of Integers - the first being the 
  host address, the second the port number.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  address <span class="main">=</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  port <span class="main">=</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"address <span class="main">×</span> port"</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> src_port_int <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_port_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span>  <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> fst  <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> dest_port_int <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_port_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> fst <span class="keyword1">o</span>  snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> subnet_of_int <span class="main">≡</span> <span class="quoted"><span class="quoted">"subnet_of <span class="main">::</span> <span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subnet_of_int</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">)</span><span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="IntegerPort-src_port"><span class="command">lemma</span></span> src_port<span class="main">:</span> <span class="quoted"><span class="quoted">"src_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">::</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> src_port_int_def in_subnet<span class="main">)</span>

<span class="keyword1" id="IntegerPort-dest_port"><span class="command">lemma</span></span> dest_port<span class="main">:</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">x</span><span class="main">::</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dest_port_int_def in_subnet<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas <span class="main">=</span> src_port dest_port src_port_int_def dest_port_int_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IntegerPort_TCPUDP">
<div class="head">
<h1>Theory IntegerPort_TCPUDP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Integer Addresses with Ports and Protocols›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  IntegerPort_TCPUDP
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A theory describing addresses which are modelled as a pair of Integers - the first being 
       the host address, the second the port number.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  address <span class="main">=</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  port <span class="main">=</span> <span class="quoted">int</span> 

<span class="keyword1"><span class="command">type_synonym</span></span> 
  adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"address <span class="main">×</span> port <span class="main">×</span> protocol"</span></span> 

<span class="keyword1"><span class="command">instance</span></span> protocol <span class="main">::</span> <span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">overloading</span></span> src_port_int_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_port_int_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span>  <span class="main">≡</span> <span class="main">(</span>fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst  <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> dest_port_int_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_port_int_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span>  snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> subnet_of_int_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"subnet_of <span class="main">::</span> <span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subnet_of_int_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">)</span><span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span><span class="main">::</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">overloading</span></span> src_protocol_int_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_protocol <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> protocol"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_protocol_int_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">overloading</span></span> dest_protocol_int_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_protocol <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> protocol"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_protocol_int_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="IntegerPort_TCPUDP-src_port"><span class="command">lemma</span></span> src_port<span class="main">:</span> <span class="quoted"><span class="quoted">"src_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">::</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> src_port_int_TCPUDP_def in_subnet<span class="main">)</span>

<span class="keyword1" id="IntegerPort_TCPUDP-dest_port"><span class="command">lemma</span></span> dest_port<span class="main">:</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">x</span><span class="main">::</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dest_port_int_TCPUDP_def in_subnet<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Common test constraints:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">port_positive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">port_positive</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>dest_port <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>port<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fix_values</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fix_values</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>  <span class="main">(</span>src_port <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>port<span class="main">)</span> <span class="main">∧</span> src_protocol <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> udp <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> data <span class="main">∧</span> id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas <span class="main">=</span> src_port dest_port src_port_int_TCPUDP_def dest_port_int_TCPUDP_def 
  src_protocol_int_TCPUDP_def dest_protocol_int_TCPUDP_def subnet_of_int_TCPUDP_def 

<span class="keyword1"><span class="command">lemmas</span></span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub>TestConstraints <span class="main">=</span> port_positive_def fix_values_def
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IPv4">
<div class="head">
<h1>Theory IPv4</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Formalizing IPv4 Addresses›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  IPv4
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NetworkCore">NetworkCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A theory describing IPv4 addresses with ports. The host address is a four-tuple of Integers, 
  the port number is a single Integer.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  ipv4_ip <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="main">×</span> int <span class="main">×</span> int <span class="main">×</span> int<span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">type_synonym</span></span> 
  port    <span class="main">=</span>  <span class="quoted"><span class="quoted">"int"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  ipv4    <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4_ip <span class="main">×</span> port<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">overloading</span></span> src_port_ipv4 <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_port_ipv4</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>ipv4<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> dest_port_ipv4 <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_port_ipv4</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>ipv4<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> subnet_of_ipv4 <span class="main">≡</span> <span class="quoted"><span class="quoted">"subnet_of <span class="main">::</span> <span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subnet_of_ipv4</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>ipv4<span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span>  fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnet_of_ip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4_ip <span class="main">⇒</span> ipv4 net"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subnet_of_ip</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="IPv4-src_port"><span class="command">lemma</span></span> src_port<span class="main">:</span> <span class="quoted"><span class="quoted">"src_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>ipv4<span class="main">)</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> src_port_ipv4_def in_subnet<span class="main">)</span>

<span class="keyword1" id="IPv4-dest_port"><span class="command">lemma</span></span> dest_port<span class="main">:</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>ipv4<span class="main">)</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dest_port_ipv4_def in_subnet<span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> IPv4Lemmas <span class="main">=</span> src_port dest_port src_port_ipv4_def dest_port_ipv4_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IPv4_TCPUDP">
<div class="head">
<h1>Theory IPv4_TCPUDP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹IPv4 with Ports and Protocols›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  IPv4_TCPUDP
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#IPv4">IPv4</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> 
  ipv4_TCPUDP    <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4_ip <span class="main">×</span> port <span class="main">×</span> protocol<span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">instance</span></span> protocol <span class="main">::</span> <span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">overloading</span></span> src_port_ipv4_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"src_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">src_port_ipv4_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>ipv4_TCPUDP<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> dest_port_ipv4_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_port_ipv4_TCPUDP</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>ipv4_TCPUDP<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">overloading</span></span> subnet_of_ipv4_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"subnet_of <span class="main">::</span> <span class="tfree">'α</span><span class="main">::</span>adr <span class="main">⇒</span> <span class="tfree">'α</span> net"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subnet_of_ipv4_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>ipv4_TCPUDP<span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span><span class="main">::</span><span class="main">(</span>ipv4_TCPUDP net<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">overloading</span></span> dest_protocol_ipv4_TCPUDP <span class="main">≡</span> <span class="quoted"><span class="quoted">"dest_protocol <span class="main">::</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> protocol"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">dest_protocol_ipv4_TCPUDP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span>ipv4_TCPUDP<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd <span class="keyword1">o</span> fst <span class="keyword1">o</span> snd <span class="keyword1">o</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnet_of_ip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4_ip <span class="main">⇒</span> ipv4_TCPUDP net"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subnet_of_ip</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ip</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="IPv4_TCPUDP-src_port"><span class="command">lemma</span></span> src_port<span class="main">:</span> <span class="quoted"><span class="quoted">"src_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>ipv4_TCPUDP<span class="main">)</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> src_port_ipv4_TCPUDP_def in_subnet<span class="main">)</span>

<span class="keyword1" id="IPv4_TCPUDP-dest_port"><span class="command">lemma</span></span> dest_port<span class="main">:</span> <span class="quoted"><span class="quoted">"dest_port <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>ipv4_TCPUDP<span class="main">)</span><span class="main">,</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dest_port_ipv4_TCPUDP_def in_subnet<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Ipv4_TCPUDPLemmas <span class="main">=</span> src_port dest_port src_port_ipv4_TCPUDP_def dest_port_ipv4_TCPUDP_def 
  dest_protocol_ipv4_TCPUDP_def subnet_of_ipv4_TCPUDP_def
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NetworkModels">
<div class="head">
<h1>Theory NetworkModels</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Network Models›</span></span>
<span class="keyword1"><span class="command">theory</span></span>            
  NetworkModels
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#DatatypeAddress">DatatypeAddress</a>
    <a href="#DatatypePort">DatatypePort</a>

    <a href="#IntegerAddress">IntegerAddress</a>
    <a href="#IntegerPort">IntegerPort</a>
    <a href="#IntegerPort_TCPUDP">IntegerPort_TCPUDP</a>

    <a href="#IPv4">IPv4</a>
    <a href="#IPv4_TCPUDP">IPv4_TCPUDP</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  One can think of many different possible address representations. In this distribution, we include 
  seven different variants:
  \begin{itemize} 
    \item DatatypeAddress: Three explicitly named addresses, which build up a network consisting of 
          three disjunct  subnetworks. I.e. there are no overlaps and there is no way to distinguish 
          between individual hosts within a network.
    \item DatatypePort: An address is a pair, with the first element being the same as above, and 
          the second being a port number modelled as an Integer\footnote{For technical reasons,
          we always use Integers instead of Naturals. As a consequence, the (test) specifications 
          have to be adjusted to eliminate negative numbers.}.
    \item adr\_i: An address in an Integer.
    \item adr\_ip: An address is a pair of an Integer and a port (which is again an Integer).
    \item adr\_ipp: An address is a triple consisting of two Integers modelling the IP address and 
          the port number, and the specification of the network protocol
    \item IPv4: An address is a pair. The first element is a four-tuple of Integers, modelling an 
          IPv4 address, the second element is an Integer denoting the port number.
    \item IPv4\_TCPUDP: The same as above, but including additionally the specification of the 
          network protocol.
  \end{itemize}

  The theories of each pf the networks are relatively small. It suffices to provide the required 
  types, a couple of lemmas, and - if required - a definition for the source and destination ports 
  of a packet.
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PolicyCore">
<div class="head">
<h1>Theory PolicyCore</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Policy Core›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PolicyCore
  <span class="keyword2"><span class="keyword">imports</span></span> 
     <a href="#NetworkCore">NetworkCore</a> 
     <a href="../../upf/theories/#UPF">UPF.UPF</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A policy is seen as a partial mapping from packet to packet out.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> FWPolicy <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  When combining several rules, the firewall is supposed to apply the
  first matching one. In our setting this means the first rule which
  maps the packet in question to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Some (packet out)›</span></span></span></span>. This is
  exactly what happens when using the map-add operator (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>rule1
  ++ rule2›</span></span></span></span>). The only difference is that the rules must be given in
  reverse order. 
›</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p_accept›</span></span></span></span> is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>True›</span></span></span></span> iff the policy
  accepts the packet. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">p_accept</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> FWPolicy <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p_accept</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">pol</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">pol</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">⌊</span>allow <span class="main">()</span><span class="main">⌋</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PolicyCombinators">
<div class="head">
<h1>Theory PolicyCombinators</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Policy Combinators›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PolicyCombinators
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#PolicyCore">PolicyCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In order to ease the specification of a concrete policy, we
  define some combinators. Using these combinators, the specification
  of a policy gets very easy, and can be done similarly as in tools
  like IPTables.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_all_from</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="main">=</span>   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span> "</span></span> 

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span>   <span class="main">=</span>  <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src <span class="bound">pa</span> <span class="main">⊏</span>  <span class="free"><span class="bound"><span class="entity">src_net</span></span></span><span class="main">}</span>  <span class="main">◃</span><span class="keyword1">D<span class="hidden">⇩</span><sub>U</sub></span> "</span></span>
        
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_to</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_to</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>   <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest <span class="bound">pa</span> <span class="main">⊏</span>  <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span><span class="main">}</span>  <span class="main">◃</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_to</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span><span class="main">}</span> <span class="main">◃</span><span class="keyword1">D<span class="hidden">⇩</span><sub>U</sub></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_all_from_to</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_to</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span> 
                                   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="main">∧</span> dest <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_to</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_to</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="main">∧</span> dest <span class="bound">pa</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="keyword1">D<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All these combinators and the default rules are put into one
  single lemma called <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>PolicyCombinators›</span></span></span></span> to facilitate proving
  over policies.›</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> PolicyCombinators <span class="main">=</span> allow_all_from_def deny_all_from_def
  allow_all_to_def deny_all_to_def allow_all_from_to_def
  deny_all_from_to_def UPFDefs
                           
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PortCombinators">
<div class="head">
<h1>Theory PortCombinators</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Policy Combinators with Ports›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PortCombinators
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#PolicyCombinators">PolicyCombinators</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory defines policy combinators for those network models which 
  have ports. They are provided in addition to the the ones defined in the 
  PolicyCombinators theory. 

  This theory requires from the network models a definition for the two following constants:
  \begin{itemize}
    \item $src\_port :: ('\alpha,'\beta) packet \Rightarrow ('\gamma::port)$
    \item $dest\_port :: ('\alpha,'\beta) packet \Rightarrow ('\gamma::port)$
  \end{itemize}
›</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'γ</span><span class="main">::</span>port<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from <span class="free"><span class="bound"><span class="entity">src_net</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span>  <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_to_port</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_to_port</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>  <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_to <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_to_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_to_port</span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_to <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_to</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_to</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>   
       <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port_to</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port_to</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>  
      <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_to_port</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span>
                              <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_to_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_port_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port_to_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                                 <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port_to_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
     <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_port_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_all_from_to_port</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                                <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_to_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span>  
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_to_port</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span>
                               <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_to_port</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
                                 <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_port_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">allow_from_port_to</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
            <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_port_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">deny_from_port_to</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
            <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_to_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">allow_from_to_port</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
         <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_to_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">deny_from_to_port</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
         <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_ports_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_from_ports_to</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
         <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_to_ports</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_from_to_ports</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
        <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_ports_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_from_ports_to</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
         <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> src_port <span class="bound">pa</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_to_ports</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_from_to_ports</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
        <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_tos</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'γ</span><span class="main">::</span>port<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_tos</span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>   
       <span class="main">=</span> <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_port <span class="bound">pa</span> <span class="main">∈</span>  <span class="free"><span class="bound"><span class="entity">s_port</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As before, we put all the rules into one lemma called PortCombinators to ease  writing later.  
›</span></span> 

<span class="keyword1"><span class="command">lemmas</span></span> PortCombinatorsCore <span class="main">=</span> 
  allow_all_from_port_def deny_all_from_port_def allow_all_to_port_def
  deny_all_to_port_def allow_all_from_to_port_def
  deny_all_from_to_port_def
  allow_from_ports_to_def allow_from_to_ports_def
  deny_from_ports_to_def deny_from_to_ports_def
  allow_all_from_port_to_def deny_all_from_port_to_def
  allow_from_port_to_def allow_from_to_port_def deny_from_to_port_def
  deny_from_port_to_def allow_all_from_port_tos_def

<span class="keyword1"><span class="command">lemmas</span></span> PortCombinators <span class="main">=</span> PortCombinatorsCore PolicyCombinators

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ProtocolPortCombinators">
<div class="head">
<h1>Theory ProtocolPortCombinators</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Policy Combinators with Ports and Protocols›</span></span>

<span class="keyword1"><span class="command">theory</span></span> 
  ProtocolPortCombinators
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#PortCombinators">PortCombinators</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory defines policy combinators for those network models which 
  have ports. They are provided in addition to the the ones defined in the 
  PolicyCombinators theory. 

  This theory requires from the network models a definition for the two following constants:
  \begin{itemize}
    \item $src\_port :: ('\alpha,'\beta) packet \Rightarrow ('\gamma::port)$
    \item $dest\_port :: ('\alpha,'\beta) packet \Rightarrow ('\gamma::port)$
  \end{itemize}
›</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'γ</span><span class="main">::</span>port<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="main">=</span>   
       <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port_prot</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="main">=</span>  
       <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_to_port_prot</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>  <span class="main">=</span>  
     <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_to_port <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_to_port_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_to_port <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_to_prot</span><span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>  
   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_port_to <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port_to_prot</span><span class="main">::</span><span class="quoted"><span class="quoted">"protocol <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span> 
   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span>  deny_all_from_port_to  <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">allow_all_from_port_to_port_prot</span><span class="main">::</span><span class="quoted"><span class="quoted">"protocol <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span>
                              <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_port_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
       <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span>      allow_all_from_port_to_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_port_to_port_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>  <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                                 <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_port_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span>              
   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span>       deny_all_from_port_to_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">s_port</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_all_from_to_port_prot</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                                <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_all_from_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span> 
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_all_from_to_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_all_from_to_port_prot</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span>
                               <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_all_from_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_all_from_to_port <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="free"><span class="bound"><span class="entity">d_port</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_port_to_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">allow_from_port_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_from_port_to <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_port_to_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">deny_from_port_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_from_port_to <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_to_port_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">allow_from_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
  <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_to_port_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port  <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">deny_from_to_port_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_ports_to_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_from_ports_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
   <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_from_ports_to <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">allow_from_to_ports_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allow_from_to_ports_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> allow_from_to_ports <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_ports_to_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_from_ports_to_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_from_ports_to <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">deny_from_to_ports_prot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"protocol <span class="main">=&gt;</span><span class="tfree">'γ</span><span class="main">::</span>port set <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span> <span class="tfree">'α</span><span class="main">::</span>adr net <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deny_from_to_ports_prot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span> <span class="main">=</span>   
    <span class="main">{</span><span class="bound">pa</span><span class="main">.</span> dest_protocol <span class="bound">pa</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span> <span class="main">◃</span> deny_from_to_ports <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">src_net</span></span></span> <span class="free"><span class="bound"><span class="entity">dest_net</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As before, we put all the rules into one lemma to ease writing later.›</span></span> 

<span class="keyword1"><span class="command">lemmas</span></span> ProtocolCombinatorsCore <span class="main">=</span> 
  allow_all_from_port_prot_def deny_all_from_port_prot_def allow_all_to_port_prot_def
  deny_all_to_port_prot_def allow_all_from_to_port_prot_def
  deny_all_from_to_port_prot_def
  allow_from_ports_to_prot_def allow_from_to_ports_prot_def
  deny_from_ports_to_prot_def deny_from_to_ports_prot_def
  allow_all_from_port_to_prot_def deny_all_from_port_to_prot_def
  allow_from_port_to_prot_def allow_from_to_port_prot_def deny_from_to_port_prot_def
  deny_from_port_to_prot_def 

<span class="keyword1"><span class="command">lemmas</span></span> ProtocolCombinators <span class="main">=</span> PortCombinators.PortCombinators ProtocolCombinatorsCore

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ports">
<div class="head">
<h1>Theory Ports</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ports›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Ports
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory can be used if we want to specify the port numbers by names denoting their default 
  Integer values. If you want to use them, please add <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Ports›</span></span></span></span> to the simplifier.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">http</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">http</span> <span class="main">=</span> <span class="numeral">80</span>"</span></span>

<span class="keyword1" id="Ports-http1"><span class="command">lemma</span></span> http1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">80</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> http"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> http_def<span class="main">)</span>

<span class="keyword1" id="Ports-http2"><span class="command">lemma</span></span> http2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">80</span> <span class="main">⟹</span> http <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> http_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">smtp</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">smtp</span> <span class="main">=</span> <span class="numeral">25</span>"</span></span>

<span class="keyword1" id="Ports-smtp1"><span class="command">lemma</span></span> smtp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">25</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> smtp"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smtp_def<span class="main">)</span>

<span class="keyword1" id="Ports-smtp2"><span class="command">lemma</span></span> smtp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">25</span> <span class="main">⟹</span> smtp <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smtp_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ftp</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ftp</span> <span class="main">=</span> <span class="numeral">21</span>"</span></span>

<span class="keyword1" id="Ports-ftp1"><span class="command">lemma</span></span> ftp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">21</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> ftp"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftp_def<span class="main">)</span>

<span class="keyword1" id="Ports-ftp2"><span class="command">lemma</span></span> ftp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="numeral">21</span> <span class="main">⟹</span> ftp <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ftp_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹And so on for all desired port numbers.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Ports <span class="main">=</span> http1 http2 ftp1 ftp2 smtp1 smtp2

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PacketFilter">
<div class="head">
<h1>Theory PacketFilter</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Network Policies: Packet Filter›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PacketFilter
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#NetworkModels">NetworkModels</a>
    <a href="#ProtocolPortCombinators">ProtocolPortCombinators</a>
    <a href="#Ports">Ports</a>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NAT">
<div class="head">
<h1>Theory NAT</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Network Address Translation›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  NAT
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="#PacketFilter">../PacketFilter/PacketFilter</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">src2pool</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">src2pool</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">da</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> id <span class="bound">p</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">=</span> dest <span class="bound">p</span> <span class="main">∧</span> <span class="bound">da</span> <span class="main">=</span> content <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">src2poolAP</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">src2poolAP</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>src2pool <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcNat2pool</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> set <span class="main">⇒</span> <span class="tfree">'α</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">::</span>adr<span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">srcNat2pool</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span> <span class="free"><span class="bound"><span class="entity">transl</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> src <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="main">(</span>src2poolAP <span class="free"><span class="bound"><span class="entity">transl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">src2poolPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">src2poolPort</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">,</span><span class="bound">da</span><span class="main">)</span><span class="main">.</span> 
          <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> id <span class="bound">p</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>src <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>dest <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                <span class="bound">d2</span> <span class="main">=</span> snd <span class="main">(</span>dest <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">da</span> <span class="main">=</span> content <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">src2poolPort_Protocol</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">src2poolPort_Protocol</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">s2</span><span class="main">,</span><span class="bound">s3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">,</span><span class="bound">d3</span><span class="main">)</span><span class="main">,</span> <span class="bound">da</span><span class="main">)</span><span class="main">.</span> 
  <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> id <span class="bound">p</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>src <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> snd <span class="main">(</span>snd <span class="main">(</span>src <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                   <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">,</span><span class="bound">d3</span><span class="main">)</span> <span class="main">=</span> dest <span class="bound">p</span> <span class="main">∧</span> <span class="bound">da</span> <span class="main">=</span> content <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcNat2pool_IntPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address set <span class="main">⇒</span> address set <span class="main">⇒</span> 
 <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">srcNat2pool_IntPort</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span> <span class="free"><span class="bound"><span class="entity">transl</span></span></span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">x</span><span class="main">.</span> fst <span class="main">(</span>src <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>src2poolPort <span class="free"><span class="bound"><span class="entity">transl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcNat2pool_IntProtocolPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> int set <span class="main">⇒</span> 
 <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">srcNat2pool_IntProtocolPort</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span> <span class="free"><span class="bound"><span class="entity">transl</span></span></span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span> <span class="main">(</span>src <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>src2poolPort_Protocol <span class="free"><span class="bound"><span class="entity">transl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcPat2poolPort_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">srcPat2poolPort_t</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">)</span><span class="main">,</span><span class="bound">da</span><span class="main">)</span><span class="main">.</span> 
           <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> id <span class="bound">p</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">d1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="main">(</span>dest <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">d2</span> <span class="main">=</span> snd <span class="main">(</span>dest <span class="bound">p</span><span class="main">)</span><span class="main">∧</span> <span class="bound">da</span> <span class="main">=</span> content <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcPat2poolPort_Protocol_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">srcPat2poolPort_Protocol_t</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">s2</span><span class="main">,</span><span class="bound">s3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">,</span><span class="bound">d3</span><span class="main">)</span><span class="main">,</span><span class="bound">da</span><span class="main">)</span><span class="main">.</span> 
  <span class="main">(</span><span class="bound">i</span> <span class="main">=</span> id <span class="bound">p</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> src_protocol <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d1</span><span class="main">,</span><span class="bound">d2</span><span class="main">,</span><span class="bound">d3</span><span class="main">)</span> <span class="main">=</span> dest <span class="bound">p</span> <span class="main">∧</span> <span class="bound">da</span> <span class="main">=</span> content <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcPat2pool_IntPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> 
                                            <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">srcPat2pool_IntPort</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span> <span class="free"><span class="bound"><span class="entity">transl</span></span></span> <span class="main">=</span> 
  <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>src <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>srcPat2poolPort_t <span class="free"><span class="bound"><span class="entity">transl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">srcPat2pool_IntProtocol</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"int set <span class="main">⇒</span> int set <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet <span class="main">↦</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> packet set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 

  <span class="quoted"><span class="quoted">"<span class="free">srcPat2pool_IntProtocol</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span> <span class="free"><span class="bound"><span class="entity">transl</span></span></span> <span class="main">=</span> 
  <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>src <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">srcs</span></span></span><span class="main">}</span> <span class="main">◃</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>srcPat2poolPort_Protocol_t <span class="free"><span class="bound"><span class="entity">transl</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following lemmas are used for achieving a normalized output format of packages after 
  applying NAT. This is used, e.g., by our firewall execution tool. 
›</span></span>

<span class="keyword1" id="NAT-datasimp"><span class="command">lemma</span></span> datasimp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                    <span class="main">∀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">b</span> <span class="bound">ba</span><span class="main">.</span> <span class="bound">aba</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i101</span> <span class="main">∧</span> 
                               <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">X606X3</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">X607X4</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span> 
                 <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                    <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i101</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">X606X3</span> <span class="main">∧</span>
                    <span class="bound">b</span> <span class="main">=</span> <span class="free">X607X4</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp2"><span class="command">lemma</span></span> datasimp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                    <span class="main">∀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">b</span> <span class="bound">ba</span><span class="main">.</span> <span class="bound">aba</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> 
                        <span class="bound">s2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i4</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>
                <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                       <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> 
                       <span class="bound">aa</span> <span class="main">=</span> <span class="free">i4</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp3"><span class="command">lemma</span></span> datasimp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                     <span class="main">∀</span> <span class="bound">a</span> <span class="bound">aa</span> <span class="bound">b</span> <span class="bound">ba</span><span class="main">.</span> <span class="bound">aba</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="free">i115</span> <span class="main">&lt;</span> <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">&lt;</span> <span class="free">i124</span> <span class="main">∧</span> 
                         <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i3</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>
                <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                         <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="free">i115</span> <span class="main">&lt;</span> <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">&lt;</span> <span class="free">i124</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> 
                       <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">&amp;</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i3</span> <span class="main">&amp;</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">&amp;</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp4"><span class="command">lemma</span></span> datasimp4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                    <span class="main">∀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">b</span> <span class="bound">ba</span><span class="main">.</span> <span class="bound">aba</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> 
                        <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i7</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>
                <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                        <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> 
                        <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i7</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp5"><span class="command">lemma</span></span> datasimp5<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                     <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i101</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">X606X3</span> <span class="main">∧</span> 
                       <span class="bound">b</span> <span class="main">=</span> <span class="free">X607X4</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>
                 <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span>
                       <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i101</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span>  <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">X606X3</span> <span class="main">∧</span> 
                       <span class="bound">b</span> <span class="main">=</span> <span class="free">X607X4</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp6"><span class="command">lemma</span></span> datasimp6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                     <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span>  <span class="bound">aa</span> <span class="main">=</span> <span class="free">i4</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>
                 <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span>
                       <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> 
                       <span class="bound">aa</span> <span class="main">=</span> <span class="free">i4</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp7"><span class="command">lemma</span></span> datasimp7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span>
                     <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="free">i115</span> <span class="main">&lt;</span> <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">&lt;</span> <span class="free">i124</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i3</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span> 
                <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span>
                     <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="free">i115</span> <span class="main">&lt;</span> <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">&lt;</span> <span class="free">i124</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> 
                     <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i3</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NAT-datasimp8"><span class="command">lemma</span></span> datasimp8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="bound">aba</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span> 
                   <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i7</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">)</span> <span class="bound">aba</span><span class="main">}</span>
                <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span> <span class="bound">s2</span><span class="main">,</span> <span class="bound">s3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">aa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">i132</span> <span class="main">∧</span> <span class="bound">s3</span> <span class="main">=</span> <span class="free">iudp</span> 
                                   <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="free">ii1</span> <span class="main">∧</span>  <span class="bound">a</span> <span class="main">=</span> <span class="free">i110</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">i7</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">itcp</span> <span class="main">∧</span> <span class="bound">ba</span> <span class="main">=</span> data<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> datasimps <span class="main">=</span> datasimp datasimp2 datasimp3 datasimp4
                   datasimp5 datasimp6 datasimp7 datasimp8

<span class="keyword1"><span class="command">lemmas</span></span> NATLemmas <span class="main">=</span> src2pool_def src2poolPort_def
                   src2poolPort_Protocol_def src2poolAP_def srcNat2pool_def
                   srcNat2pool_IntProtocolPort_def srcNat2pool_IntPort_def
                   srcPat2poolPort_t_def srcPat2poolPort_Protocol_t_def
                   srcPat2pool_IntPort_def srcPat2pool_IntProtocol_def
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FWNormalisationCore">
<div class="head">
<h1>Theory FWNormalisationCore</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Policy Normalisation: Core Definitions›</span></span>
<span class="keyword1"><span class="command">theory</span></span>
  FWNormalisationCore
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="#PacketFilter">../PacketFilter/PacketFilter</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory contains all the definitions used for policy normalisation as described 
  in~\cite{brucker.ea:icst:2010,brucker.ea:formal-fw-testing:2014}.

  The normalisation procedure transforms policies into semantically equivalent  ones which are 
  ``easier'' to test. It is organized into nine phases. We impose the following two restrictions 
  on the input policies: 
  \begin{itemize}
  \item Each policy must contain a $\mathtt{DenyAll}$ rule. If this restriction were to be lifted, 
        the $\mathtt{insertDenies}$ phase would have to be adjusted accordingly.
  \item For each pair of networks $n_1$ and $n_2$, the networks are either disjoint or equal. If 
        this restriction were to be lifted, we would need some additional phases before the start 
        of the normalisation procedure presented below. This rule would split single rules into 
        several by splitting up the networks such that they are all pairwise disjoint or equal. 
        Such a transformation is clearly semantics-preserving and the condition would hold after
        these phases.
  \end{itemize}
  As a result, the procedure generates a list of policies, in which:
  \begin{itemize}
  \item each element of the list contains a policy which completely specifies the blocking behavior 
        between two networks, and
  \item there are no shadowed rules.
  \end{itemize}
  This result is desirable since the test case generation for rules between networks $A$ and $B$ 
  is independent of the rules that specify the behavior for traffic flowing between networks $C$ 
  and $D$. Thus, the different segments of the policy can be processed individually. The 
  normalization procedure does not aim to minimize the number of rules. While it does remove 
  unnecessary ones, it also adds new ones, enabling a policy to be split into several independent
  parts.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Policy transformations are functions that map policies to policies.  We decided to represent
  policy transformations as \emph{syntactic rules}; this choice paves the way for expressing the 
  entire normalisation process inside HOL by functions manipulating abstract policy syntax. 
›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Basics›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define a very simple policy language:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> Combinators <span class="main">=</span> 
  DenyAll
  <span class="main">|</span> DenyAllFromTo <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> 
  <span class="main">|</span> AllowPortFromTo <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'β</span></span></span> 
  <span class="main">|</span> Conc <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊕</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  And define the semantic interpretation of it. For technical reasons, we fix here the type to 
  policies over IntegerPort addresses. However, we could easily provide definitions for other
  address types as well, using a generic constants for the type definition and a primitive 
  recursive definition for each desired address model.  
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Auxiliary definitions and functions.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This section defines several functions which are useful later for the combinators, invariants, 
  and proofs. 
›</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">srcNet</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">srcNet</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">srcNet</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">srcNet</span> DenyAll <span class="main">=</span> undefined"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">srcNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">va</span></span></span><span class="main">)</span> <span class="main">=</span> undefined"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">destNet</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">destNet</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">destNet</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">destNet</span> DenyAll <span class="main">=</span> undefined"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">destNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">va</span></span></span><span class="main">)</span> <span class="main">=</span> undefined"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">srcnets</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">srcnets</span> DenyAll <span class="main">=</span> <span class="main">[]</span> "</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">srcnets</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> "</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">srcnets</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> "</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">srcnets</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">srcnets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">srcnets</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">destnets</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">destnets</span> DenyAll <span class="main">=</span> <span class="main">[]</span> "</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">destnets</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span> "</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">destnets</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span> "</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">destnets</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">destnets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">destnets</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">net_list_aux</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">net_list_aux</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">net_list_aux</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">net_list_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">net_list_aux</span> <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">net_list_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">net_list_aux</span> <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">net_list_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">net_list_aux</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">net_list_aux</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">net_list_aux</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">net_list_aux</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">net_list</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">net_list</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> remdups <span class="main">(</span>net_list_aux <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bothNets</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bothNets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>zip <span class="main">(</span>srcnets <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>destnets <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">normBothNets</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">normBothNets</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> 
                            <span class="keyword1">then</span> <span class="main">(</span><span class="free">normBothNets</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
                            <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">normBothNets</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">normBothNets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">makeSets</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">makeSets</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">#</span><span class="main">(</span><span class="free">makeSets</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">makeSets</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bothNet</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">bothNet</span> DenyAll <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">bothNet</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">bothNet</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">bothNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">va</span></span></span><span class="main">)</span> <span class="main">=</span> undefined "</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  $Nets\_List$ provides from a list of rules a list where the entries are the appearing sets of 
  source and destination network of each rule. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Nets_List</span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Nets_List</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> makeSets <span class="main">(</span>normBothNets <span class="main">(</span>bothNets <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">first_srcNet</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">first_srcNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">first_srcNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">first_srcNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> srcNet <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">first_destNet</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">first_destNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">first_destNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">first_destNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> destNet <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">first_bothNet</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">first_bothNet</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">first_bothNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">first_bothNet</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">in_list</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">in_list</span> DenyAll <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">in_list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span>bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">all_in_list</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">all_in_list</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">all_in_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span>in_list <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">all_in_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">member</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">member</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">member</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">member</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">member</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sdnets</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sdnets</span> DenyAll <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sdnets</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sdnets</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sdnets</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">sdnets</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> <span class="free">sdnets</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">packet_Nets</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">packet_Nets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∨</span>
                                                    <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnetsOfAdr</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subnetsOfAdr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊏</span> <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fst_set</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fst_set</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">snd_set</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">snd_set</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">memberP</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">memberP</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>member <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∨</span> <span class="free">memberP</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">memberP</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">firstList</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">firstList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>first_bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">firstList</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Invariants›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If there is a DenyAll, it is at the first position›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wellformed_policy1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy1</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>DenyAll <span class="main">∉</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is a DenyAll at the first position›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wellformed_policy1_strong</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy1_strong</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy1_strong</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span>DenyAll <span class="main">∧</span> <span class="main">(</span>DenyAll <span class="main">∉</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All two networks are either disjoint or equal.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">netsDistinct</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">netsDistinct</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊏</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">twoNetsDistinct</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">twoNetsDistinct</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">(</span>netsDistinct <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∨</span> netsDistinct <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">allNetsDistinct</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">allNetsDistinct</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span>
                        <span class="bound">b</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> netsDistinct <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">disjSD_2</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">disjSD_2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>sdnets <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span>  <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">∈</span>sdnets <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟶</span>
      <span class="main">(</span>twoNetsDistinct <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> twoNetsDistinct <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The policy is given as a list of single rules.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">singleCombinators</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">singleCombinators</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">singleCombinators</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">singleCombinators</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">singleCombinators</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">onlyTwoNets</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">onlyTwoNets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>sdnets <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Each entry of the list contains rules between two networks only.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">OnlyTwoNets</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">OnlyTwoNets</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">OnlyTwoNets</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OnlyTwoNets</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>onlyTwoNets <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free">OnlyTwoNets</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">OnlyTwoNets</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">noDenyAll</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">noDenyAll</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> member DenyAll <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">noDenyAll</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">noDenyAll</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">noDenyAll1</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">noDenyAll1</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> noDenyAll <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">noDenyAll1</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> noDenyAll <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">separated</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">separated</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span> disjSD_2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">separated</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">separated</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">NetsCollected</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">NetsCollected</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>first_bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> firstList <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> first_bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">NetsCollected</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">NetsCollected</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">NetsCollected2</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">NetsCollected2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>first_bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> firstList <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span>
                           <span class="free">NetsCollected2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">NetsCollected2</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Transformations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following two functions transform a policy into a list of single rules and vice-versa (by 
  staying on the combinator level).
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">policy2list</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators <span class="main">⇒</span>
                 <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy2list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>concat <span class="main">[</span><span class="main">(</span><span class="free">policy2list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">policy2list</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">policy2list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list2FWpolicy</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span>
                  <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">list2FWpolicy</span> <span class="main">[]</span> <span class="main">=</span> undefined "</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">list2FWpolicy</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">list2FWpolicy</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="main">(</span><span class="free">list2FWpolicy</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Remove all the rules appearing before a DenyAll. There are two alternative versions.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">removeShadowRules1</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>DenyAll <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> 
                                <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free">removeShadowRules1</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>
                                <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">removeShadowRules1_alternative_rev</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1_alternative_rev</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1_alternative_rev</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>DenyAll<span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1_alternative_rev</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1_alternative_rev</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">=</span>
                 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">removeShadowRules1_alternative_rev</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">removeShadowRules1_alternative</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules1_alternative</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
                         rev <span class="main">(</span>removeShadowRules1_alternative_rev <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Remove all the rules which allow a port, but are shadowed by a deny between these subnets.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">removeShadowRules2</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span>
                          <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">removeShadowRules2</span> <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span> 
         <span class="keyword1">then</span> <span class="main">(</span><span class="main">(</span><span class="free">removeShadowRules2</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">removeShadowRules2</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">removeShadowRules2</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeShadowRules2</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Sorting a policies:  We first need to define an ordering on rules.  This ordering depends 
   on the $Nets\_List$ of a policy.  
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">smaller</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators <span class="main">⇒</span> 
                <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators <span class="main">⇒</span> 
                <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">)</span> set<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">smaller</span> DenyAll <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> True"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">smaller</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> DenyAll <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">smaller</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span>         <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bothNet <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">then</span> 
                       <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>DenyAllFromTo <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> DenyAllFromTo <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span>  
                            <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span>  True<span class="main">)</span>
                    <span class="keyword1">else</span>
                        <span class="main">(</span>position <span class="main">(</span>bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">&lt;=</span> position <span class="main">(</span>bothNet <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We provide two different sorting algorithms: Quick Sort (qsort) and Insertion Sort (sort)›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">qsort</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">qsort</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>     <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">qsort</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">qsort</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>smaller <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="free">qsort</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> smaller <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FWNormalisationCore-qsort_permutes"><span class="command">lemma</span></span> qsort_permutes<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>qsort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qsort.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FWNormalisationCore-set_qsort"><span class="command">lemma</span></span> set_qsort <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>qsort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span>  <span class="main">=</span> set <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qsort_permutes<span class="main">)</span>
    
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insort</span> <span class="keyword2"><span class="keyword">where</span></span>
	  <span class="quoted"><span class="quoted">"<span class="free">insort</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span>"</span></span>
	<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insort</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>smaller <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">insort</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sort</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sort</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sort</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> insort <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">sort</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sorted</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sorted</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sorted</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sorted</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span>smaller <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">sorted</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">zs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">separate</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">separate</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span><span class="free">separate</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">separate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>first_bothNet <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> first_bothNet <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> 
                   <span class="keyword1">then</span> <span class="main">(</span><span class="free">separate</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>
                   <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">separate</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">separate</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>                

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Insert the DenyAllFromTo rules, such that traffic between two networks can be tested 
  individually.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">insertDenies</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">insertDenies</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> DenyAll <span class="main">⇒</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="main">(</span><span class="free">insertDenies</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>
                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span>  <span class="main">⇒</span> <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">⊕</span> 
                       <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_destNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span>
                                <span class="main">(</span><span class="free">insertDenies</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertDenies</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Remove duplicate rules. This is especially necessary as insertDenies might have inserted 
  duplicate rules. The second function is supposed to work on a list of policies. Only
  rules which are duplicated within the same policy are removed.  
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">removeDuplicates</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">removeDuplicates</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> member <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">removeDuplicates</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
                              <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⊕</span><span class="main">(</span><span class="free">removeDuplicates</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">removeDuplicates</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">removeAllDuplicates</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">removeAllDuplicates</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>removeDuplicates <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">removeAllDuplicates</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">removeAllDuplicates</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Insert a DenyAll at the beginning of a policy.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">insertDeny</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">insertDeny</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">insertDeny</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sort'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> sort <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qsort'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> qsort <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> dom_eq_empty_conv <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list2policyR</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span>
                   <span class="main">(</span><span class="main">(</span><span class="tfree">'α</span><span class="main">,</span> <span class="tfree">'β</span><span class="main">)</span> Combinators<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">list2policyR</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">list2policyR</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">list2policyR</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">list2policyR</span> <span class="main">[]</span> <span class="main">=</span> undefined "</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We provide the definitions for two address representations. 
›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹IntPort›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">↦</span> unit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">" <span class="free">C</span> DenyAll <span class="main">=</span> deny_all"</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> allow_from_to_port <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">C</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free">C</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">++</span> <span class="free">C</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">CRotate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">↦</span> unit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">" <span class="free">CRotate</span> DenyAll <span class="main">=</span> C DenyAll"</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">CRotate</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">CRotate</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">CRotate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">CRotate</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">++</span> <span class="main">(</span><span class="main">(</span><span class="free">CRotate</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rotatePolicy</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rotatePolicy</span> DenyAll <span class="main">=</span> DenyAll"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rotatePolicy</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> DenyAllFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rotatePolicy</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rotatePolicy</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rotatePolicy</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">rotatePolicy</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FWNormalisationCore-check"><span class="command">lemma</span></span> check<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> policy2list <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> 


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  All rules appearing at the left of a DenyAllFromTo, have disjunct domains from it 
  (except DenyAll). 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">wellformed_policy2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wellformed_policy2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> DenyAllFromTo <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span>
                 Map.dom <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∩</span> Map.dom <span class="main">(</span>C <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">wellformed_policy2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  An allow rule is disjunct with all rules appearing at the right of it. This invariant is not 
  necessary as it is a consequence from others, but facilitates some proofs. 
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">wellformed_policy3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3</span> <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span>
      dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">wellformed_policy3</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wellformed_policy3</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">normalize'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="keyword1">o</span> insertDenies <span class="keyword1">o</span> separate <span class="keyword1">o</span>
                   <span class="main">(</span>sort' <span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">o</span> removeShadowRules2 <span class="keyword1">o</span> remdups <span class="keyword1">o</span>
                   <span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="keyword1">o</span> insertDeny <span class="keyword1">o</span> removeShadowRules1 <span class="keyword1">o</span>
                   policy2list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">normalizeQ'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="keyword1">o</span> insertDenies <span class="keyword1">o</span> separate <span class="keyword1">o</span>
                   <span class="main">(</span>qsort' <span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">o</span> removeShadowRules2 <span class="keyword1">o</span> remdups <span class="keyword1">o</span>
                   <span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="keyword1">o</span> insertDeny <span class="keyword1">o</span> removeShadowRules1 <span class="keyword1">o</span>
                   policy2list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalize</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> 
   <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators list"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>sort
                   <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="main">(</span>insertDeny
                  <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalize_manual_order</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate
    <span class="main">(</span>sort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="main">(</span>insertDeny
    <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalizeQ</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> 
   <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators list"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalizeQ</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>qsort
                   <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="main">(</span>insertDeny
                  <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalize_manual_orderQ</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate
    <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules C<span class="main">)</span> <span class="main">(</span>insertDeny
    <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Of course, normalize is equal to normalize', the latter looks nicer though. 
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">=</span> normalize'"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_def normalize'_def sort'_def<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> C.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span><span class="main">]</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹TCP\_UDP\_IntegerPort›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Cp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> 
          <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">↦</span> unit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">" <span class="free">Cp</span> DenyAll <span class="main">=</span> deny_all"</span></span>  
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Cp</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> deny_all_from_to <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Cp</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> allow_from_to_port_prot <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Cp</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="free">Cp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">++</span> <span class="free">Cp</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Dp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators <span class="main">⇒</span> 
          <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">↦</span> unit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">" <span class="free">Dp</span> DenyAll <span class="main">=</span> Cp DenyAll"</span></span> 
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Dp</span> <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>DenyAllFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Dp</span> <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">Dp</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span>  Cp <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  All rules appearing at the left of a DenyAllFromTo, have disjunct domains from it 
  (except DenyAll). 
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">wellformed_policy2Pr</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2Pr</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2Pr</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wellformed_policy2Pr</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy2Pr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> DenyAllFromTo <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span>
                 Map.dom <span class="main">(</span>Cp <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∩</span> Map.dom <span class="main">(</span>Cp <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">wellformed_policy2Pr</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  An allow rule is disjunct with all rules appearing at the right of it. This invariant is not
  necessary as it is a consequence from others, but facilitates some proofs. 
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">wellformed_policy3Pr</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3Pr</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3Pr</span> <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟶</span>
      dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">wellformed_policy3Pr</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">wellformed_policy3Pr</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">wellformed_policy3Pr</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
 <span class="entity">normalizePr'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators
  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">normalizePr'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="keyword1">o</span> insertDenies <span class="keyword1">o</span> separate <span class="keyword1">o</span>
                   <span class="main">(</span>sort' <span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">o</span> removeShadowRules2 <span class="keyword1">o</span> remdups <span class="keyword1">o</span>
                   <span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="keyword1">o</span> insertDeny <span class="keyword1">o</span> removeShadowRules1 <span class="keyword1">o</span>
                   policy2list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalizePr</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators
  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalizePr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>sort
                   <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="main">(</span>insertDeny
                  <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalize_manual_orderPr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate
    <span class="main">(</span>sort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="main">(</span>insertDeny
    <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> 
 <span class="entity">normalizePrQ'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators
  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">normalizePrQ'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="keyword1">o</span> insertDenies <span class="keyword1">o</span> separate <span class="keyword1">o</span>
                   <span class="main">(</span>qsort' <span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">o</span> removeShadowRules2 <span class="keyword1">o</span> remdups <span class="keyword1">o</span>
                   <span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="keyword1">o</span> insertDeny <span class="keyword1">o</span> removeShadowRules1 <span class="keyword1">o</span>
                   policy2list<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalizePrQ</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators
  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> protocol <span class="main">×</span> port<span class="main">)</span> Combinators list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalizePrQ</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>qsort
                   <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="main">(</span>insertDeny
                  <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Nets_List <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">normalize_manual_orderPrQ</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate
    <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span><span class="main">(</span>rm_MT_rules Cp<span class="main">)</span> <span class="main">(</span>insertDeny
    <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Of course, normalize is equal to normalize', the latter looks nicer though. 
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"normalizePr <span class="main">=</span> normalizePr'"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalizePr_def normalizePr'_def sort'_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following definition helps in creating the test specification for the individual parts 
  of a normalized policy. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">makeFUTPr</span> <span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">makeFUTPr</span> <span class="free"><span class="bound"><span class="entity">FUT</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> 
     <span class="main">(</span>packet_Nets <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>fst <span class="main">(</span>normBothNets <span class="main">(</span>bothNets <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>  
                     <span class="main">(</span>snd<span class="main">(</span>normBothNets <span class="main">(</span>bothNets <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
    <span class="free"><span class="bound"><span class="entity">FUT</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Cp <span class="main">(</span><span class="main">(</span>normalizePr <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">!</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> Cp.simps <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> PLemmas <span class="main">=</span> C.simps Cp.simps dom_def PolicyCombinators.PolicyCombinators
                 PortCombinators.PortCombinatorsCore aux
                 ProtocolPortCombinators.ProtocolCombinatorsCore src_def dest_def in_subnet_def
                 adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas

<span class="keyword1" id="FWNormalisationCore-aux"><span class="command">lemma</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="free">a</span><span class="main">;</span> <span class="free">y</span><span class="main">≠</span><span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span>  <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FWNormalisationCore-aux2"><span class="command">lemma</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NormalisationGenericProofs">
<div class="head">
<h1>Theory NormalisationGenericProofs</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Normalisation Proofs (Generic)›</span></span>
  <span class="keyword1"><span class="command">theory</span></span>
    NormalisationGenericProofs
    <span class="keyword2"><span class="keyword">imports</span></span> 
      <a href="#FWNormalisationCore">FWNormalisationCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory contains the generic proofs of the normalisation procedure, i.e. those which 
  are independent from the concrete semantical interpretation function.  
›</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-domNMT"><span class="command">lemma</span></span> domNMT<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">≠</span> <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-denyNMT"><span class="command">lemma</span></span> denyNMT<span class="main">:</span> <span class="quoted"><span class="quoted">"deny_all <span class="main">≠</span>  <span class="main">∅</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> domNMT<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deny_all_def dom_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed_policy1_charn"><span class="command">lemma</span></span> wellformed_policy1_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span> <span class="main">⟶</span> DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p'</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> DenyAll <span class="main">#</span> <span class="bound">p'</span> <span class="main">∧</span> DenyAll <span class="main">∉</span> set <span class="bound">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-singleCombinatorsConc"><span class="command">lemma</span></span> singleCombinatorsConc<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> singleCombinators <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux0_0"><span class="command">lemma</span></span> aux0_0<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊕</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-aux0_4"><span class="command">lemma</span></span> aux0_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">∈</span> set <span class="free">x</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">x</span><span class="main">@</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux0_1"><span class="command">lemma</span></span> aux0_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">xs</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">⟧</span> <span class="main">⟹</span>
               singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-aux0_6"><span class="command">lemma</span></span> aux0_6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">xs</span><span class="main">;</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">⊕</span> <span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
               singleCombinators<span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aux0_1<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux0_5"><span class="command">lemma</span></span> aux0_5<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">⊕</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> singleCombinators <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>   
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux0_6<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDConc"><span class="command">lemma</span></span> ANDConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux6"><span class="command">lemma</span></span> aux6<span class="main">:</span> <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a1</span> <span class="free">a2</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
            dom <span class="main">(</span>deny_all_from_to <span class="free">a1</span> <span class="free">a2</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>deny_all_from_to <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def src_def dest_def 
      in_subnet_def PolicyCombinators.PolicyCombinators dom_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux5"><span class="command">lemma</span></span> aux5<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> net_list_aux.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-aux5a"><span class="command">lemma</span></span> aux5a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="free">b</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> net_list_aux.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-aux5c"><span class="command">lemma</span></span> aux5c<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> net_list_aux.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-aux5d"><span class="command">lemma</span></span> aux5d<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>AllowPortFromTo <span class="free">b</span> <span class="free">a</span> <span class="free">po</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> net_list_aux.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-aux10"><span class="command">lemma</span></span> aux10<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationGenericProofs-srcInNetListaux"><span class="command">lemma</span></span> srcInNetListaux<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> singleCombinators<span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">⟧</span> <span class="main">⟹</span> srcNet <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1" id="NormalisationGenericProofs-destInNetListaux"><span class="command">lemma</span></span> destInNetListaux<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> singleCombinators<span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">⟧</span> <span class="main">⟹</span> destNet <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
<span class="keyword1" id="NormalisationGenericProofs-tND1"><span class="command">lemma</span></span> tND1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>allNetsDistinct <span class="free">p</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">a</span> <span class="main">=</span> srcNet <span class="free">x</span><span class="main">;</span>
             <span class="free">b</span> <span class="main">=</span> destNet <span class="free">x</span><span class="main">;</span> <span class="free">c</span> <span class="main">=</span> srcNet <span class="free">y</span><span class="main">;</span> <span class="free">d</span> <span class="main">=</span> destNet <span class="free">y</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">;</span>
             singleCombinators<span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">;</span> singleCombinators<span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">;</span>
             <span class="free">y</span> <span class="main">≠</span> DenyAll<span class="main">⟧</span> <span class="main">⟹</span> twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def twoNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-tND2"><span class="command">lemma</span></span> tND2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>allNetsDistinct <span class="free">p</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">a</span> <span class="main">=</span> srcNet <span class="free">x</span><span class="main">;</span>
             <span class="free">b</span> <span class="main">=</span> destNet <span class="free">x</span><span class="main">;</span> <span class="free">c</span> <span class="main">=</span> srcNet <span class="free">y</span><span class="main">;</span> <span class="free">d</span> <span class="main">=</span> destNet <span class="free">y</span><span class="main">;</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span><span class="main">;</span>
             singleCombinators<span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">;</span> singleCombinators<span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">;</span>
             <span class="free">y</span> <span class="main">≠</span> DenyAll<span class="main">⟧</span> <span class="main">⟹</span> twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def twoNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-tND"><span class="command">lemma</span></span> tND<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>allNetsDistinct <span class="free">p</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> <span class="free">a</span> <span class="main">=</span> srcNet <span class="free">x</span><span class="main">;</span>
            <span class="free">b</span> <span class="main">=</span> destNet <span class="free">x</span><span class="main">;</span> <span class="free">c</span> <span class="main">=</span> srcNet <span class="free">y</span><span class="main">;</span> <span class="free">d</span> <span class="main">=</span> destNet <span class="free">y</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span><span class="main">;</span>
            singleCombinators<span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">;</span> singleCombinators<span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">;</span> <span class="free">y</span> <span class="main">≠</span> DenyAll<span class="main">⟧</span>
            <span class="main">⟹</span> twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux7"><span class="command">lemma</span></span> aux7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">;</span>
             <span class="free">a</span><span class="main">≠</span> <span class="free">c</span><span class="main">∨</span> <span class="free">b</span><span class="main">≠</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux7a"><span class="command">lemma</span></span> aux7a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span>  <span class="main">∈</span> set <span class="free">p</span><span class="main">;</span>
              allNetsDistinct <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">∨</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> 
              twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
      y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"AllowPortFromTo  <span class="free">c</span> <span class="free">d</span> <span class="free">po</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-nDComm"><span class="command">lemma</span></span> nDComm<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"netsDistinct <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"netsDistinct <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ab<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> netsDistinct_def  in_subnet_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-tNDComm"><span class="command">lemma</span></span> tNDComm<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> abcd<span class="main">:</span> <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">c</span> <span class="free">d</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> abcd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> twoNetsDistinct_def nDComm<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux"><span class="command">lemma</span></span> aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> removeShadowRules2.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux12"><span class="command">lemma</span></span> aux12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">x</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ND0aux1"><span class="command">lemma</span></span> ND0aux1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">⟹</span>  
                             <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux5 net_list.simps set_remdups<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ND0aux2"><span class="command">lemma</span></span> ND0aux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">⟹</span>  
                             <span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux5a net_list.simps set_remdups<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ND0aux3"><span class="command">lemma</span></span> ND0aux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">⟹</span>  
                             <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux5c net_list.simps set_remdups<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ND0aux4"><span class="command">lemma</span></span> ND0aux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">⟹</span>  
                             <span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux5d net_list.simps set_remdups<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aNDSubsetaux"><span class="command">lemma</span></span> aNDSubsetaux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">a</span>  <span class="main">⟶</span> set <span class="free">a</span> <span class="main">⊆</span> set <span class="free">b</span> <span class="main">⟶</span> 
                                  set <span class="main">(</span>net_list_aux <span class="free">a</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a a' x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contra_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ND0aux1 ND0aux2 contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ND0aux3 ND0aux4 contra_subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aNDSetsEqaux"><span class="command">lemma</span></span> aNDSetsEqaux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">a</span> <span class="main">⟶</span> singleCombinators <span class="free">b</span> <span class="main">⟶</span> 
                 set <span class="free">a</span> <span class="main">=</span> set <span class="free">b</span> <span class="main">⟶</span> set <span class="main">(</span>net_list_aux <span class="free">a</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>net_list_aux <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubsetaux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aNDSubset"><span class="command">lemma</span></span> aNDSubset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">a</span><span class="main">;</span>set <span class="free">a</span> <span class="main">⊆</span> set <span class="free">b</span><span class="main">;</span> allNetsDistinct <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> 
                  allNetsDistinct <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> aNDSubsetaux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aNDSetsEq"><span class="command">lemma</span></span> aNDSetsEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">a</span><span class="main">;</span> singleCombinators <span class="free">b</span><span class="main">;</span> set <span class="free">a</span> <span class="main">=</span> set <span class="free">b</span><span class="main">;</span> 
                  allNetsDistinct <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> allNetsDistinct <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> aNDSetsEqaux <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCConca"><span class="command">lemma</span></span> SCConca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">⟧</span> <span class="main">⟹</span> 
                singleCombinators <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> aux0_1<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux3"><span class="command">lemma</span></span> aux3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">;</span>  
                     allNetsDistinct <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aNDSetsEq aux0_1 insert_absorb2 list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_aux1a"><span class="command">lemma</span></span> wp1_aux1a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> wellformed_policy1_strong <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> 
                               wellformed_policy1_strong <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1alternative_RS1"><span class="command">lemma</span></span> wp1alternative_RS1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> 
                              wellformed_policy1_strong <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed_eq"><span class="command">lemma</span></span> wellformed_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> 
                      <span class="main">(</span><span class="main">(</span>wellformed_policy1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>wellformed_policy1_strong <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-set_insort"><span class="command">lemma</span></span> set_insort<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-set_sort"><span class="command">lemma</span></span> set_sort<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>sort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_insort<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-set_sortQ"><span class="command">lemma</span></span> set_sortQ<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>qsort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux79"><span class="command">lemma</span></span> aux79<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>insort <span class="free">x</span> <span class="free">a</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux80"><span class="command">lemma</span></span> aux80<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">y</span> <span class="main">∉</span> set <span class="free">p</span><span class="main">;</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∉</span> set <span class="main">(</span>insort <span class="free">x</span> <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> aux79 set_sort<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-WP1Conca"><span class="command">lemma</span></span> WP1Conca<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1 <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-saux"><span class="command">lemma</span></span> saux<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insort DenyAll <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-saux3"><span class="command">lemma</span></span> saux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">list</span> <span class="main">⟶</span> 
                          DenyAllFromTo <span class="free">c</span> <span class="free">d</span> <span class="main">∉</span> set <span class="free">list</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-waux2"><span class="command">lemma</span></span> waux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>DenyAll <span class="main">∉</span> set <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy1 <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-waux3"><span class="command">lemma</span></span> waux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="free">a</span><span class="main">;</span>  <span class="free">x</span> <span class="main">∉</span> set <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>insort <span class="free">a</span> <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux79<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed1_sorted_aux"><span class="command">lemma</span></span> wellformed1_sorted_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
                                            wellformed_policy1 <span class="main">(</span>insort <span class="free">x</span> <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.set_insort list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> saux waux2 wellformed_eq 
            wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed1_sorted_auxQ"><span class="command">lemma</span></span> wellformed1_sorted_auxQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
                                            wellformed_policy1 <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">S</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">metis</span> Combinators.simps append_Cons append_Nil qsort.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_ConsD set_qsort waux2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>        
    
<span class="keyword1" id="NormalisationGenericProofs-SR1Subset"><span class="command">lemma</span></span> SR1Subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCSubset"><span class="command">lemma</span></span> SCSubset<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" singleCombinators <span class="free">b</span> <span class="main">⟶</span> set <span class="free">a</span> <span class="main">⊆</span> set <span class="free">b</span> <span class="main">⟶</span>
                              singleCombinators <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> aux0_0 aux0_5 subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-setInsert"><span class="command">lemma</span></span> setInsert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">list</span> <span class="main">⊆</span> insert <span class="free">a</span> <span class="main">(</span>set <span class="free">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC_RS1"><span class="command">lemma</span></span> SC_RS1<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="free">p</span> <span class="main">⟶</span>
    singleCombinators <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">using</span></span> ANDConc singleCombinatorsConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS2Set"><span class="command">lemma</span></span> RS2Set<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-WP1"><span class="command">lemma</span></span> WP1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> set <span class="free">list</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> set <span class="main">(</span>removeShadowRules2 <span class="free">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RS2Set <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">list</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-denyAllDom"><span class="command">lemma</span></span> denyAllDom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>deny_all<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UPFDefs<span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> domI<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-lCdom2"><span class="command">lemma</span></span> lCdom2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="main">(</span><span class="free">b</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span><span class="main">@</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCConcEnd"><span class="command">lemma</span></span> SCConcEnd<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> singleCombinators <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
    
<span class="keyword1" id="NormalisationGenericProofs-list2FWpolicyconc"><span class="command">lemma</span></span> list2FWpolicyconc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
                               <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xa</span> <span class="main">#</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xa</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1n_tl"><span class="command">lemma</span></span> wp1n_tl <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>
                              <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-foo2"><span class="command">lemma</span></span> foo2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> set <span class="free">ps</span> <span class="main">⟹</span> 
             <span class="free">a</span> <span class="main">∉</span> set <span class="free">ss</span> <span class="main">⟹</span>
             set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
             <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="main">(</span><span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
             <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">ss</span><span class="main">)</span> <span class="main">⟹</span> 
             set <span class="main">(</span><span class="free">ps</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ss</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-SCnotConc"><span class="command">lemma</span></span> SCnotConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⊕</span><span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span>False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> p ps  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-auxx8"><span class="command">lemma</span></span> auxx8<span class="main">:</span> <span class="quoted"><span class="quoted">"removeShadowRules1_alternative_rev <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS1End"><span class="command">lemma</span></span> RS1End<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> removeShadowRules1 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
                            <span class="main">(</span>removeShadowRules1 <span class="free">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux114"><span class="command">lemma</span></span> aux114<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> removeShadowRules1_alternative_rev <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> 
               <span class="free">x</span><span class="main">#</span><span class="main">(</span>removeShadowRules1_alternative_rev <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> auxx8<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aux115"><span class="command">lemma</span></span> aux115<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll<span class="main">⟹</span>removeShadowRules1_alternative <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> 
                            <span class="main">=</span> <span class="main">(</span>removeShadowRules1_alternative <span class="free">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def aux114<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS1_DA"><span class="command">lemma</span></span> RS1_DA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"removeShadowRules1 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAll<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>DenyAll<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-rSR1_eq"><span class="command">lemma</span></span> rSR1_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"removeShadowRules1_alternative <span class="main">=</span> removeShadowRules1"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xs
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> RS1End aux114 rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-domInterMT"><span class="command">lemma</span></span> domInterMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>dom <span class="free">a</span> <span class="main">∩</span> dom <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="free">a</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-domComm"><span class="command">lemma</span></span> domComm<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">a</span> <span class="main">∩</span> dom <span class="free">b</span> <span class="main">=</span> dom <span class="free">b</span> <span class="main">∩</span> dom <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="NormalisationGenericProofs-r_not_DA_in_tl"><span class="command">lemma</span></span> r_not_DA_in_tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>  <span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_aux1aa"><span class="command">lemma</span></span> wp1_aux1aa<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span> DenyAll <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-mauxa"><span class="command">lemma</span></span> mauxa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">⌊</span><span class="bound">r</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">⊥</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-l2p_aux"><span class="command">lemma</span></span> l2p_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">list</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
                             list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊕</span><span class="main">(</span>list2FWpolicy <span class="free">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">list</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-l2p_aux2"><span class="command">lemma</span></span> l2p_aux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">list</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           
<span class="keyword1" id="NormalisationGenericProofs-aux7aa"><span class="command">lemma</span></span> aux7aa<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">poo</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>    2 <span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span><span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    3 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> True allNetsDistinct_def aux5c list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> twoNetsDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> <span class="quoted">"3"</span> False allNetsDistinct_def aux5d list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> twoNetsDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-ANDConcEnd"><span class="command">lemma</span></span> ANDConcEnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> allNetsDistinct <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span><span class="main">;</span> singleCombinators <span class="free">xs</span><span class="main">⟧</span> <span class="main">⟹</span> 
                   allNetsDistinct <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubset<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-WP1ConcEnd"><span class="command">lemma</span></span> WP1ConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy1 <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-NDComm"><span class="command">lemma</span></span> NDComm<span class="main">:</span> <span class="quoted"><span class="quoted">"netsDistinct <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> netsDistinct <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> netsDistinct_def in_subnet_def<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed1_sorted"><span class="command">lemma</span></span> wellformed1_sorted<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wp1<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> DenyAll"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons set_sort False waux2 wellformed_eq 
          wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="NormalisationGenericProofs-wellformed1_sortedQ"><span class="command">lemma</span></span> wellformed1_sortedQ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wp1<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> DenyAll"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons set_qsort False waux2 wellformed_eq 
          wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-SC1"><span class="command">lemma</span></span> SC1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span>singleCombinators <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SCSubset<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> SR1Subset<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC2"><span class="command">lemma</span></span> SC2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span>singleCombinators <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SCSubset<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> RS2Set<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC3"><span class="command">lemma</span></span> SC3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SCSubset<span class="main">)</span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC3Q"><span class="command">lemma</span></span> SC3Q<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SCSubset<span class="main">)</span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationGenericProofs-aND_RS1"><span class="command">lemma</span></span> aND_RS1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> 
                      allNetsDistinct <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SC_RS1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SR1Subset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aND_RS2"><span class="command">lemma</span></span> aND_RS2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> 
                      allNetsDistinct <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubset<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SC2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> RS2Set<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aND_sort"><span class="command">lemma</span></span> aND_sort<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span>  
                       allNetsDistinct <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubset<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SC3<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
    
    
<span class="keyword1" id="NormalisationGenericProofs-aND_sortQ"><span class="command">lemma</span></span> aND_sortQ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span>  
                       allNetsDistinct <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aNDSubset<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> SC3Q<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-inRS2"><span class="command">lemma</span></span> inRS2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> set <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> RS2Set <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-distinct_RS2"><span class="command">lemma</span></span> distinct_RS2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟶</span> 
                                       distinct <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPaireq"><span class="command">lemma</span></span> setPaireq<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  doubleton_eq_iff<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-position_positive"><span class="command">lemma</span></span> position_positive<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> position <span class="free">a</span> <span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-pos_noteq"><span class="command">lemma</span></span> pos_noteq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> 
   <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟶</span> position <span class="free">a</span> <span class="free">l</span> <span class="main">≤</span> position <span class="free">b</span> <span class="free">l</span> <span class="main">⟶</span> position <span class="free">b</span> <span class="free">l</span> <span class="main">≤</span> position <span class="free">c</span> <span class="free">l</span> <span class="main">⟶</span> 
   <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">R</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps One_nat_def Suc_le_mono le_antisym 
        length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat.inject position.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        position_positive set_ConsD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-setPair_noteq"><span class="command">lemma</span></span> setPair_noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPair_noteq_allow"><span class="command">lemma</span></span> setPair_noteq_allow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="free">d</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-order_trans"><span class="command">lemma</span></span> order_trans<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>in_list <span class="free">x</span> <span class="free">l</span><span class="main">;</span> in_list <span class="free">y</span> <span class="free">l</span><span class="main">;</span> in_list <span class="free">z</span> <span class="free">l</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> 
  singleCombinators <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">;</span> smaller <span class="free">x</span> <span class="free">y</span> <span class="free">l</span><span class="main">;</span> smaller <span class="free">y</span> <span class="free">z</span> <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span> 
  smaller <span class="free">x</span> <span class="free">z</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPaireq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPaireq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPair_noteq setPair_noteq_allow<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPair_noteq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> pos_noteq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPair_noteq_allow<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> pos_noteq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> disjI2<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> setPair_noteq_allow<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sortedConcStart"><span class="command">lemma</span></span> sortedConcStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">aa</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> in_list <span class="free">a</span> <span class="free">l</span> <span class="main">⟶</span> in_list <span class="free">aa</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span><span class="main">⟶</span> 
  singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟶</span> singleCombinators <span class="main">[</span><span class="free">aa</span><span class="main">]</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> 
  sorted <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> p ps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-singleCombinatorsStart"><span class="command">lemma</span></span> singleCombinatorsStart<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> 
                                     singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_is_smaller"><span class="command">lemma</span></span> sorted_is_smaller<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> in_list <span class="free">a</span> <span class="free">l</span> <span class="main">⟶</span> in_list <span class="free">b</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span>  
  singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> smaller <span class="free">a</span> <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc sortedConcStart<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sortedConcEnd"><span class="command">lemma</span></span> sortedConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> in_list <span class="free">a</span> <span class="free">l</span> <span class="main">⟶</span> 
                                   all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟶</span> 
                                   singleCombinators <span class="free">p</span>  <span class="main">⟶</span> sorted <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc sortedConcStart<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-in_set_in_list"><span class="command">lemma</span></span> in_set_in_list<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span><span class="main">⟶</span> in_list <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_Consb"><span class="command">lemma</span></span> sorted_Consb<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> 
    <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> smaller <span class="free">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="main">(</span>sorted <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_Cons"><span class="command">lemma</span></span> sorted_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">;</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
              <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> smaller <span class="free">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>sorted <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_Consb<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singleCombinatorsConc singleCombinatorsStart sortedConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> sorted_is_smaller<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc singleCombinatorsStart in_set_in_list<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-smaller_antisym"><span class="command">lemma</span></span> smaller_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> smaller <span class="free">a</span> <span class="free">b</span> <span class="free">l</span><span class="main">;</span> in_list <span class="free">a</span> <span class="free">l</span><span class="main">;</span> in_list <span class="free">b</span> <span class="free">l</span><span class="main">;</span> 
                        singleCombinators<span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">⟧</span> <span class="main">⟹</span>  
                        smaller <span class="free">b</span> <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPaireq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-set_insort_insert"><span class="command">lemma</span></span> set_insort_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-all_in_listSubset"><span class="command">lemma</span></span> all_in_listSubset<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="free">b</span> <span class="free">l</span> <span class="main">⟶</span>singleCombinators <span class="free">a</span> <span class="main">⟶</span> 
                                      set <span class="free">a</span> <span class="main">⊆</span> set <span class="free">b</span> <span class="main">⟶</span> all_in_list <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_in_list singleCombinatorsConc<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-singleCombinators_insort"><span class="command">lemma</span></span> singleCombinators_insort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span> singleCombinators <span class="free">xs</span><span class="main">⟧</span> <span class="main">⟹</span> 
                                 singleCombinators <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.set_insort aux0_0 aux0_1 aux0_5 list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-all_in_list_insort"><span class="command">lemma</span></span> all_in_list_insort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>all_in_list <span class="free">xs</span> <span class="free">l</span><span class="main">;</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> 
                           in_list <span class="free">x</span> <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span>  all_in_list <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> all_in_listSubset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singleCombinatorsConc singleCombinatorsStart
      singleCombinators_insort<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_insort_insert<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_ConsA"><span class="command">lemma</span></span> sorted_ConsA<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">;</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
              <span class="main">(</span>sorted <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> smaller <span class="free">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sorted_Cons<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-is_in_insort"><span class="command">lemma</span></span> is_in_insort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NormalisationGenericProofs.set_insort<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_insorta"><span class="command">lemma</span></span> sorted_insorta<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   2 <span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>   3 <span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   4 <span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   5 <span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   6 <span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_in_insort sorted_ConsA set_insort singleCombinators_insort 
        singleCombinatorsConc sortedConcEnd all_in_list_insort<span class="main">)</span> <span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"smaller <span class="free">x</span> <span class="skolem">a</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.set_insort NormalisationGenericProofs.sorted_Cons 
        all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_in_list_insort aux0_1 insert_iff singleCombinatorsConc 
        singleCombinatorsStart singleCombinators_insort<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="NormalisationGenericProofs-sorted_insortb"><span class="command">lemma</span></span> sorted_insortb<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> distinct <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> 
   singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟶</span> singleCombinators <span class="free">xs</span> <span class="main">⟶</span> sorted <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>      all_in_list <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
              distinct <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>  singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟹</span>
              singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> sorted <span class="main">(</span>insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> Cons.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> sorted_Cons all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  singleCombinatorsConc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Cons.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_Consb<span class="main">)</span>    
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> all_in_listSubset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_list <span class="free">x</span> <span class="free">l</span> <span class="main">⟹</span> all_in_list <span class="skolem">xs</span> <span class="free">l</span> <span class="main">⟹</span> all_in_list <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟹</span>
                       singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
                       FWNormalisationCore.sorted <span class="main">(</span>FWNormalisationCore.insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
                       singleCombinators <span class="main">(</span>FWNormalisationCore.insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> singleCombinators_insort<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>FWNormalisationCore.insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NormalisationGenericProofs.set_insort_insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟹</span>
                       singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
                      singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> FWNormalisationCore.insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SCConca singleCombinatorsConc singleCombinatorsStart  
          singleCombinators_insort<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FWNormalisationCore.sorted <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
                       singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟹</span>  singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
                       in_list <span class="free">x</span> <span class="free">l</span> <span class="main">⟹</span>  in_list <span class="skolem">a</span> <span class="free">l</span> <span class="main">⟹</span> all_in_list <span class="skolem">xs</span> <span class="free">l</span> <span class="main">⟹</span>
                       <span class="main">¬</span> smaller <span class="free">x</span> <span class="skolem">a</span> <span class="free">l</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>FWNormalisationCore.insort <span class="free">x</span> <span class="skolem">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> 
                      smaller <span class="skolem">a</span> <span class="skolem">y</span> <span class="free">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.set_insort in_set_in_list insert_iff 
          singleCombinatorsConc singleCombinatorsStart smaller_antisym 
          sorted_is_smaller<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-sorted_insort"><span class="command">lemma</span></span> sorted_insort<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span><span class="main">;</span> distinct<span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">;</span>
                     singleCombinators <span class="free">xs</span><span class="main">⟧</span> <span class="main">⟹</span>
                  sorted <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> sorted <span class="free">xs</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_insorta sorted_insortb<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-distinct_insort"><span class="command">lemma</span></span> distinct_insort<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>insort <span class="free">x</span> <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> distinct <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_insort<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-distinct_sort"><span class="command">lemma</span></span> distinct_sort<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>sort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span> distinct <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_insort<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-sort_is_sorted"><span class="command">lemma</span></span> sort_is_sorted<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> distinct <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> sorted <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> NormalisationGenericProofs.distinct_sort 
      NormalisationGenericProofs.set_sort SC3 all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_in_listSubset 
      distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_subset_Cons singleCombinatorsConc singleCombinatorsStart 
      sort.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sorted_insortb<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smaller_sym"><span class="command">lemma</span></span> smaller_sym<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="free">l</span> <span class="main">⟶</span> smaller <span class="free">a</span> <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC_sublist"><span class="command">lemma</span></span> SC_sublist<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">]</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCSubset<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-all_in_list_sublist"><span class="command">lemma</span></span> all_in_list_sublist<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span> <span class="main">⟶</span> all_in_list <span class="free">xs</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> all_in_listSubset SC_sublist<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC_sublist2"><span class="command">lemma</span></span> SC_sublist2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span> <span class="main">⟶</span> singleCombinators <span class="main">(</span><span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCSubset<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-all_in_list_sublist2"><span class="command">lemma</span></span> all_in_list_sublist2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span> <span class="main">⟶</span> all_in_list <span class="free">xs</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="free">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">]</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> all_in_listSubset SC_sublist2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-all_in_listAppend"><span class="command">lemma</span></span> all_in_listAppend<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span><span class="free">ys</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-distinct_sortQ"><span class="command">lemma</span></span> distinct_sortQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">xs</span> <span class="main">⟶</span> all_in_list <span class="free">xs</span> <span class="free">l</span> <span class="main">⟶</span> distinct <span class="free">xs</span> <span class="main">⟶</span> distinct <span class="main">(</span>qsort <span class="free">xs</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qsort.induct<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SC_sublist2 singleCombinatorsConc all_in_list_sublist2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        
<span class="keyword1" id="NormalisationGenericProofs-singleCombinatorsAppend"><span class="command">lemma</span></span> singleCombinatorsAppend<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> singleCombinators <span class="main">(</span><span class="free">ys</span><span class="main">)</span> <span class="main">⟶</span> singleCombinators <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>       
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_append1"><span class="command">lemma</span></span> sorted_append1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">xs</span> <span class="free">l</span>  <span class="main">⟶</span> singleCombinators <span class="free">xs</span> <span class="main">⟶</span>
   all_in_list <span class="free">ys</span> <span class="free">l</span>  <span class="main">⟶</span> singleCombinators <span class="free">ys</span> <span class="main">⟶</span> 
  <span class="main">(</span>sorted <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> 
  <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> sorted <span class="free">ys</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> smaller <span class="bound">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.sorted_Cons all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_in_listAppend aux0_1 
      aux0_4 singleCombinatorsAppend singleCombinatorsConc singleCombinatorsStart<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_append2"><span class="command">lemma</span></span> sorted_append2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">xs</span> <span class="free">l</span><span class="main">⟶</span> singleCombinators <span class="free">xs</span> <span class="main">⟶</span>
   all_in_list <span class="free">ys</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="free">ys</span> <span class="main">⟶</span> 
   <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> sorted <span class="free">ys</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> smaller <span class="bound">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
  <span class="main">(</span>sorted <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationGenericProofs.sorted_Cons all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_in_listAppend aux0_1 
      aux0_4 singleCombinatorsAppend singleCombinatorsConc singleCombinatorsStart<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sorted_append"><span class="command">lemma</span></span> sorted_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">xs</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="free">xs</span> <span class="main">⟶</span>
   all_in_list <span class="free">ys</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="free">ys</span> <span class="main">⟶</span> 
   <span class="main">(</span>sorted <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span>sorted <span class="free">xs</span> <span class="free">l</span> <span class="main">&amp;</span> sorted <span class="free">ys</span> <span class="free">l</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span><span class="main">.</span> smaller <span class="bound">x</span> <span class="bound">y</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_append1<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_append2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sort_is_sortedQ"><span class="command">lemma</span></span> sort_is_sortedQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span>  <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> sorted <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> qsort.induct<span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span> <span class="main">⟶</span>
                 singleCombinators <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">⟶</span> 
                 sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                 all_in_list <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span> <span class="main">⟶</span>
                 singleCombinators <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="main">⟶</span> 
                 sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                 all_in_list<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟶</span>  singleCombinators<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">⟶</span> sorted <span class="main">(</span>qsort<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SC_sublist all_in_list_sublist all_in_list_sublist2 
        singleCombinatorsConc SC_sublist2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sorted_append<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_list <span class="skolem">x</span> <span class="skolem">l</span> <span class="main">∧</span> all_in_list <span class="skolem">xs</span> <span class="skolem">l</span> <span class="main">⟹</span> 
                       singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> 
                       all_in_list <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_in_list_sublist singleCombinatorsConc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_list <span class="skolem">x</span> <span class="skolem">l</span> <span class="main">∧</span> all_in_list <span class="skolem">xs</span> <span class="skolem">l</span> <span class="main">⟹</span> 
                       singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> 
                       singleCombinators <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SC_sublist all_in_list_sublist SC_sublist2
          all_in_list_sublist2 sorted_Cons sorted_append not_le<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SC3Q SC_sublist2 singleCombinatorsConc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       in_list <span class="skolem">x</span> <span class="skolem">l</span> <span class="main">∧</span> all_in_list <span class="skolem">xs</span> <span class="skolem">l</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> 
                       all_in_list <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_in_list.simps<span class="main">(</span>2<span class="main">)</span> all_in_list_sublist singleCombinatorsConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       in_list <span class="skolem">x</span> <span class="skolem">l</span> <span class="main">∧</span> all_in_list <span class="skolem">xs</span> <span class="skolem">l</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span> 
                       singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> SC_sublist aux0_1 singleCombinatorsConc singleCombinatorsStart <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       in_list <span class="skolem">x</span> <span class="skolem">l</span> <span class="main">∧</span> all_in_list <span class="skolem">xs</span> <span class="skolem">l</span> <span class="main">⟹</span>
                       singleCombinators <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟹</span>
                       FWNormalisationCore.sorted <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">∧</span>
                       FWNormalisationCore.sorted <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x'</span><span class="main">∈</span>set <span class="main">(</span>qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> 
                                <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> smaller <span class="skolem">x</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">]</span> <span class="skolem">l</span><span class="main">)</span><span class="main">.</span> smaller <span class="bound">x'</span> <span class="bound">y</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SC_sublist all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          all_in_list_sublist aux0_1 mem_Collect_eq set_filter set_qsort 
          singleCombinatorsConc singleCombinatorsStart sorted_Consb<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0 aux0_6 in_set_in_list singleCombinatorsConc 
          singleCombinatorsStart smaller_antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> NormalisationGenericProofs.order_trans aux0_0 
          aux0_6 in_set_in_list 
          singleCombinatorsConc singleCombinatorsStart smaller_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="NormalisationGenericProofs-inSet_not_MT"><span class="command">lemma</span></span> inSet_not_MT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-RS1n_assoc"><span class="command">lemma</span></span> RS1n_assoc<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span>  removeShadowRules1_alternative <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span>
                  removeShadowRules1_alternative <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def aux114<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS1n_nMT"><span class="command">lemma</span></span> RS1n_nMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟶</span> removeShadowRules1_alternative <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS1N_DA"><span class="command">lemma</span></span> RS1N_DA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"removeShadowRules1_alternative <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="main">[</span>DenyAll<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>DenyAll<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-WP1n_DA_notinSet"><span class="command">lemma</span></span> WP1n_DA_notinSet<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>
                                     DenyAll <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-mt_sym"><span class="command">lemma</span></span> mt_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">a</span> <span class="main">∩</span> dom <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> dom <span class="free">b</span> <span class="main">∩</span> dom <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-DAnotTL"><span class="command">lemma</span></span> DAnotTL<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> wellformed_policy1 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAll<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-AND_tl"><span class="command">lemma</span></span> AND_tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ANDConc<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-distinct_tl"><span class="command">lemma</span></span> distinct_tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟶</span> distinct <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-SC_tl"><span class="command">lemma</span></span> SC_tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> singleCombinators <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-Conc_not_MT"><span class="command">lemma</span></span> Conc_not_MT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_tl"><span class="command">lemma</span></span> wp1_tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> wellformed_policy1 <span class="free">p</span> <span class="main">⟶</span> wellformed_policy1 <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> waux2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_eq"><span class="command">lemma</span></span> wp1_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> wellformed_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> waux2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-wellformed1_alternative_sorted"><span class="command">lemma</span></span> wellformed1_alternative_sorted<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1n_RS2"><span class="command">lemma</span></span> wp1n_RS2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span> wellformed_policy1_strong <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-RS2_NMT"><span class="command">lemma</span></span> RS2_NMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> removeShadowRules2 <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">a</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_alternative_not_mt"><span class="command">lemma</span></span> wp1_alternative_not_mt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-AIL1"><span class="command">lemma</span></span> AIL1<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span>
                               all_in_list <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1ID"><span class="command">lemma</span></span> wp1ID<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-dRD"><span class="command">lemma</span></span> dRD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationGenericProofs-AILrd"><span class="command">lemma</span></span> AILrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-AILiD"><span class="command">lemma</span></span> AILiD<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCrd"><span class="command">lemma</span></span> SCrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span><span class="main">⟶</span> singleCombinators<span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCRiD"><span class="command">lemma</span></span> SCRiD<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span>
                                singleCombinators<span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-WP1rd"><span class="command">lemma</span></span> WP1rd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span> wellformed_policy1_strong <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDrd"><span class="command">lemma</span></span> ANDrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> aNDSubset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDiD"><span class="command">lemma</span></span> ANDiD<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span> <span class="main">⟶</span>  allNetsDistinct <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ANDConc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-mr_iD"><span class="command">lemma</span></span> mr_iD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span>  <span class="main">⟶</span> <span class="free">matching_rule</span> <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="free">matching_rule</span> <span class="free">x</span> <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-WP1iD"><span class="command">lemma</span></span> WP1iD<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>
                                wellformed_policy1_strong <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-DAiniD"><span class="command">lemma</span></span> DAiniD<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-p2lNmt"><span class="command">lemma</span></span> p2lNmt<span class="main">:</span> <span class="quoted"><span class="quoted">"policy2list <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> policy2list.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-AIL2"><span class="command">lemma</span></span> AIL2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-SCConc"><span class="command">lemma</span></span> SCConc<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">x</span> <span class="main">⟹</span>  singleCombinators <span class="free">y</span> <span class="main">⟹</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">@</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aux0_5<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0 aux0_4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 	
    
<span class="keyword1" id="NormalisationGenericProofs-SCp2l"><span class="command">lemma</span></span> SCp2l<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCConc<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-subnetAux"><span class="command">lemma</span></span> subnetAux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dd</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span>  <span class="free">Dd</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-soadisj"><span class="command">lemma</span></span> soadisj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> subnetsOfAdr <span class="free">a</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> subnetsOfAdr <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnetsOfAdr_def netsDistinct_def<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-not_member"><span class="command">lemma</span></span> not_member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">⊕</span><span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> member <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-soadisj2"><span class="command">lemma</span></span> soadisj2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> subnetsOfAdr <span class="bound">a</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> subnetsOfAdr <span class="bound">a</span> <span class="main">⟶</span> <span class="main">¬</span> netsDistinct <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnetsOfAdr_def netsDistinct_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ndFalse1"><span class="command">lemma</span></span> ndFalse1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span> <span class="main">⟶</span> netsDistinct <span class="bound">a</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="free">D</span> <span class="main">⟹</span> 
   <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="free">D</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> soadisj<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> soadisj2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ndFalse2"><span class="command">lemma</span></span> ndFalse2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span> <span class="main">⟶</span> netsDistinct <span class="bound">b</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟹</span>
                 <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> subnetsOfAdr <span class="free">D</span> <span class="main">⟹</span>
                 <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> subnetsOfAdr <span class="free">D</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> soadisj<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> soadisj2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-tndFalse"><span class="command">lemma</span></span> tndFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span> <span class="main">⟶</span> twoNetsDistinct <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span><span class="free">D</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="free">D</span><span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span> subnetsOfAdr <span class="free">F</span> 
    <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ndFalse1 ndFalse2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> soadisj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-sepnMT"><span class="command">lemma</span></span> sepnMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span>  <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sepDA"><span class="command">lemma</span></span> sepDA<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span> <span class="main">⟶</span> DenyAll <span class="main">∉</span> set <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span>  <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setnMT"><span class="command">lemma</span></span> setnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">a</span> <span class="main">=</span> set <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sortnMT"><span class="command">lemma</span></span> sortnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> sort <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sort setnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-idNMT"><span class="command">lemma</span></span> idNMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> insertDenies <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-OTNoTN"><span class="command">lemma</span></span> OTNoTN<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" OnlyTwoNets <span class="free">p</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>  onlyTwoNets <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a p<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI  conjI<span class="main"><span class="keyword3">,</span></span>  <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-first_isIn"><span class="command">lemma</span></span> first_isIn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span>first_destNet <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sdnets2"><span class="command">lemma</span></span> sdnets2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span>
   sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>first_destNet <span class="free">x</span><span class="main">,</span> first_srcNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> 
            <span class="main">⟹</span> <span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> first_isIn<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span>
               sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span>first_destNet <span class="free">x</span><span class="main">,</span> first_srcNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-alternativelistconc1"><span class="command">lemma</span></span> alternativelistconc1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-alternativelistconc2"><span class="command">lemma</span></span> alternativelistconc2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDA"><span class="command">lemma</span></span> noDA<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">xs</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="main">¬</span> member DenyAll <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-isInAlternativeList"><span class="command">lemma</span></span> isInAlternativeList<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">∨</span> <span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-netlistaux"><span class="command">lemma</span></span> netlistaux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>  <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-firstInNet"><span class="command">lemma</span></span> firstInNet<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟶</span>  first_destNet <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Combinators.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> netlistaux<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-firstInNeta"><span class="command">lemma</span></span> firstInNeta<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟶</span>  first_srcNet <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Combinators.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> netlistaux<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
    
<span class="keyword1" id="NormalisationGenericProofs-disjComm"><span class="command">lemma</span></span> disjComm<span class="main">:</span> <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> disjSD_2 <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjSD_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI  impI  conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> tNDComm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> tNDComm twoNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-disjSD2aux"><span class="command">lemma</span></span> disjSD2aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">b</span> <span class="main">⟹</span>
  disjSD_2 <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span>
            DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span>
           <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> disjComm<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> disjComm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjSD_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> first_isIn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDA1eq"><span class="command">lemma</span></span> noDA1eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rename_tac</span> a p<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDA1C"><span class="command">lemma</span></span> noDA1C<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> noDenyAll1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> noDA1eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-disjSD_2IDa"><span class="command">lemma</span></span> disjSD_2IDa<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span>
   <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span>
   <span class="main">¬</span> member DenyAll <span class="free">y</span> <span class="main">⟹</span> 
   <span class="free">a</span> <span class="main">=</span> first_srcNet <span class="free">x</span> <span class="main">⟹</span> 
   <span class="free">b</span> <span class="main">=</span> first_destNet <span class="free">x</span> <span class="main">⟹</span> 
   disjSD_2 <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">b</span> <span class="free">a</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>disjSD2aux<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDAID"><span class="command">lemma</span></span> noDAID<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> noDenyAll <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-isInIDo"><span class="command">lemma</span></span> isInIDo<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span>  <span class="main">⟶</span> <span class="free">s</span> <span class="main">∈</span> set <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃!</span> <span class="bound">a</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span>
   <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_destNet <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a p<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-id_aux1"><span class="command">lemma</span></span> id_aux1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span>
      DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">s</span><span class="main">∈</span> set <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="free">s</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a p<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-id_aux2"><span class="command">lemma</span></span> id_aux2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟹</span>
   <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> disjSD_2 <span class="free">a</span> <span class="bound">s</span> <span class="main">⟹</span>
   <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span>
   DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> 
   DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">s</span> <span class="main">∈</span> set <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   disjSD_2 <span class="free">a</span> <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> 
   DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">s</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjComm disjSD2aux isInIDo noDA<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-id_aux4"><span class="command">lemma</span></span> id_aux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> disjSD_2 <span class="free">a</span> <span class="bound">s</span> <span class="main">⟹</span> 
   <span class="free">s</span> <span class="main">∈</span> set <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span> 
   disjSD_2 <span class="free">a</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span>
          DenyAllFromTo <span class="main">(</span>first_srcNet <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="bound">a</span><span class="main">)</span> <span class="main">⊕</span>
          DenyAllFromTo <span class="main">(</span>first_destNet <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="bound">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="bound">a</span> <span class="main">∧</span>
          <span class="bound">a</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">a</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> id_aux2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> isInIDo <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sepNetsID"><span class="command">lemma</span></span> sepNetsID<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> separated <span class="free">p</span> <span class="main">⟶</span> separated <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> noDA1C <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjSD_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjSD_2IDa<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> id_aux4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> noDA noDAID<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-aNDDA"><span class="command">lemma</span></span> aNDDA<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct<span class="main">(</span>DenyAll<span class="main">#</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-OTNConc"><span class="command">lemma</span></span> OTNConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟶</span>  OnlyTwoNets <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-first_bothNetsd"><span class="command">lemma</span></span> first_bothNetsd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span> first_bothNet <span class="free">x</span> <span class="main">=</span> <span class="main">{</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-bNaux"><span class="command">lemma</span></span> bNaux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">y</span> <span class="main">⟹</span>
   first_bothNet <span class="free">x</span> <span class="main">=</span> first_bothNet <span class="free">y</span> <span class="main">⟹</span>
   <span class="main">{</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_bothNetsd<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPair"><span class="command">lemma</span></span> setPair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> setPaireq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPair1"><span class="command">lemma</span></span> setPair1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">d</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_empty_right Un_insert_right insert_absorb2 setPaireq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPair4"><span class="command">lemma</span></span> setPair4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-otnaux1"><span class="command">lemma</span></span> otnaux1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="NormalisationGenericProofs-OTNIDaux4"><span class="command">lemma</span></span> OTNIDaux4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-setPair5"><span class="command">lemma</span></span> setPair5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-otnaux"><span class="command">lemma</span></span> otnaux<span class="main">:</span> <span class="quoted"><span class="quoted">"   
  <span class="main">⟦</span>first_bothNet <span class="free">x</span> <span class="main">=</span> first_bothNet <span class="free">y</span><span class="main">;</span> <span class="main">¬</span> member DenyAll <span class="free">x</span><span class="main">;</span> <span class="main">¬</span> member DenyAll <span class="free">y</span><span class="main">;</span> 
   onlyTwoNets <span class="free">y</span><span class="main">;</span> onlyTwoNets <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> 
   onlyTwoNets <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> onlyTwoNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">}</span> <span class="main">=</span>
                     <span class="main">{</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"first_srcNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_isIn singletonE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_isIn singletonE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">,</span>
                                    <span class="main">(</span>first_destNet <span class="free">x</span><span class="main">,</span> first_srcNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"first_srcNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> OTNIDaux4 insert_commute <span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair5<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_isIn singletonE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sdnets2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">)</span><span class="main">,</span>
                                 <span class="main">(</span>first_destNet <span class="free">y</span><span class="main">,</span> first_srcNet <span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"first_srcNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> OTNIDaux4 insert_commute <span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair4<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sdnets2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singletonE first_isIn<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">x</span><span class="main">,</span> first_destNet <span class="free">x</span><span class="main">)</span><span class="main">,</span>
                                 <span class="main">(</span>first_destNet <span class="free">x</span><span class="main">,</span> first_srcNet <span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">y</span><span class="main">,</span> first_destNet <span class="free">y</span><span class="main">)</span><span class="main">,</span>
                                <span class="main">(</span>first_destNet <span class="free">y</span><span class="main">,</span> first_srcNet <span class="free">y</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"first_srcNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> otnaux1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">y</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">y</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"first_srcNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> OTNIDaux4 insert_commute<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> setPair4<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sdnets2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bNaux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-OTNSepaux"><span class="command">lemma</span></span> OTNSepaux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"onlyTwoNets <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> OnlyTwoNets <span class="free">z</span> <span class="main">⟶</span> OnlyTwoNets <span class="main">(</span>separate <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span>  <span class="main">¬</span> member DenyAll <span class="free">y</span> <span class="main">⟹</span>
    noDenyAll <span class="free">z</span> <span class="main">⟹</span> onlyTwoNets <span class="free">a</span> <span class="main">⟹</span> OnlyTwoNets <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> first_bothNet <span class="free">a</span> <span class="main">=</span> first_bothNet <span class="free">y</span> <span class="main">⟹</span> 
    OnlyTwoNets <span class="main">(</span>separate <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> otnaux<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OTNoTN<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> member.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> onlyTwoNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> OTNConc<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-OTNSEp"><span class="command">lemma</span></span> OTNSEp<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> OnlyTwoNets <span class="free">p</span>  <span class="main">⟶</span>  OnlyTwoNets <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OTNSepaux noDA1eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-nda"><span class="command">lemma</span></span> nda<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> noDenyAll <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-nDAcharn"><span class="command">lemma</span></span> nDAcharn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">.</span> <span class="main">¬</span> member DenyAll <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-nDAeqSet"><span class="command">lemma</span></span> nDAeqSet<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> noDenyAll <span class="free">p</span> <span class="main">=</span> noDenyAll <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nDAcharn<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-nDASCaux"><span class="command">lemma</span></span> nDASCaux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span>  <span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>  <span class="main">¬</span> member DenyAll <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> SCnotConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-nDASC"><span class="command">lemma</span></span> nDASC<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span>  noDenyAll1 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> nDASCaux nDAcharn nda singleCombinatorsConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDAAll"><span class="command">lemma</span></span> noDAAll<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> memberP DenyAll <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-memberPsep"><span class="command">lemma</span></span> memberPsep<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"memberP <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> memberP <span class="free">x</span> <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span>  <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDAsep"><span class="command">lemma</span></span> noDAsep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟹</span> noDenyAll <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>noDAAll<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> memberPsep<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-noDA1sep"><span class="command">lemma</span></span> noDA1sep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> noDAsep<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-isInAlternativeLista"><span class="command">lemma</span></span> isInAlternativeLista<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>  <span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-isInAlternativeListb"><span class="command">lemma</span></span> isInAlternativeListb<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>  <span class="free">aa</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDSepaux"><span class="command">lemma</span></span> ANDSepaux<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> isInAlternativeList<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-netlistalternativeSeparateaux"><span class="command">lemma</span></span> netlistalternativeSeparateaux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"net_list_aux <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">@</span> net_list_aux <span class="free">z</span> <span class="main">=</span> net_list_aux <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-netlistalternativeSeparate"><span class="command">lemma</span></span> netlistalternativeSeparate<span class="main">:</span> <span class="quoted"><span class="quoted">"net_list_aux <span class="free">p</span> <span class="main">=</span> net_list_aux <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> netlistalternativeSeparateaux<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDSepaux2"><span class="command">lemma</span></span>  ANDSepaux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"allNetsDistinct<span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>separate<span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span><span class="free">x</span><span class="main">#</span>separate<span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> isInAlternativeList netlistalternativeSeparate netlistaux<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDSep"><span class="command">lemma</span></span> ANDSep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct<span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConc aNDDA<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConc ANDSepaux ANDSepaux2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConc ANDSepaux ANDSepaux2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConc ANDSepaux ANDSepaux2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-wp1_alternativesep"><span class="command">lemma</span></span> wp1_alternativesep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span> wellformed_policy1_strong <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sepDA separate.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> wp1n_tl<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-noDAsort"><span class="command">lemma</span></span> noDAsort<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> NormalisationGenericProofs.set_sort nDAeqSet <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">list</span> 
    <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟹</span> noDenyAll <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟹</span> noDenyAll1 <span class="main">(</span>insort <span class="skolem">a</span> <span class="main">(</span>sort <span class="skolem">list</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"insort <span class="skolem">a</span> <span class="main">(</span>sort <span class="skolem">list</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> NormalisationGenericProofs.set_insort NormalisationGenericProofs.set_sort 
          list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> nDAeqSet noDA1eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-OTNSC"><span class="command">lemma</span></span> OTNSC<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> OnlyTwoNets <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a p<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> onlyTwoNets_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-fMTaux"><span class="command">lemma</span></span> fMTaux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd insert_commute insert_not_empty<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-fl2"><span class="command">lemma</span></span> fl2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"firstList <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span> <span class="main">=</span> firstList <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> separate.induct<span class="main">)</span> <span class="operator">simp_all</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-fl3"><span class="command">lemma</span></span> fl3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"NetsCollected <span class="free">p</span> <span class="main">⟶</span> <span class="main">(</span>first_bothNet <span class="free">x</span> <span class="main">≠</span> firstList <span class="free">p</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">p</span><span class="main">.</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> NetsCollected <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>
        
<span class="keyword1" id="NormalisationGenericProofs-sortedConc"><span class="command">lemma</span></span> sortedConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" sorted <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span>  sorted <span class="free">p</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smalleraux2"><span class="command">lemma</span></span> smalleraux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> 
   smaller <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
  <span class="main">¬</span> smaller <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bothNet.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pos_noteq smaller.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smalleraux2a"><span class="command">lemma</span></span> smalleraux2a<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> 
   smaller <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
  <span class="main">¬</span> smaller <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> eq_imp_le pos_noteq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smalleraux2b"><span class="command">lemma</span></span> smalleraux2b<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span>
   smaller <span class="main">(</span>AllowPortFromTo  <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">y</span> <span class="free">l</span> <span class="main">⟹</span> 
  <span class="main">¬</span> smaller <span class="free">y</span> <span class="main">(</span>AllowPortFromTo  <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> eq_imp_le pos_noteq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smalleraux2c"><span class="command">lemma</span></span> smalleraux2c<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">⟹</span><span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span><span class="main">∈</span>set <span class="free">l</span><span class="main">⟹</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">q</span> <span class="main">⟹</span> 
    smaller <span class="main">(</span>AllowPortFromTo  <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">y</span> <span class="free">l</span> <span class="main">⟹</span> <span class="main">¬</span> smaller <span class="free">y</span> <span class="main">(</span>AllowPortFromTo  <span class="free">c</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> pos_noteq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-smalleraux3"><span class="command">lemma</span></span> smalleraux3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">y</span> <span class="main">∈</span> set <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> bothNet <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> bothNet <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"smaller <span class="free">a</span> <span class="free">b</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> smaller <span class="free">b</span> <span class="free">a</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms DenyAll DenyAllFromTo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms  DenyAllFromTo  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span>›</span></span>  bothNet.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> smalleraux2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms DenyAllFromTo AllowPortFromTo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> eq_imp_le pos_noteq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms AllowPortFromTo DenyAll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo DenyAllFromTo bothNet.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> smalleraux2a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main">(</span><span class="operator">metis</span> AllowPortFromTo <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">p</span>›</span></span> 
          bothNet.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> smalleraux2c<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-smalleraux3a"><span class="command">lemma</span></span> smalleraux3a<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> in_list <span class="free">b</span> <span class="free">l</span> <span class="main">⟹</span> in_list <span class="free">a</span> <span class="free">l</span> <span class="main">⟹</span>  
   bothNet <span class="free">a</span> <span class="main">≠</span> bothNet <span class="free">b</span> <span class="main">⟹</span> smaller <span class="free">a</span> <span class="free">b</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟹</span>
    singleCombinators <span class="main">[</span><span class="free">b</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">¬</span> smaller <span class="free">b</span> <span class="free">a</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> smalleraux3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-posaux"><span class="command">lemma</span></span> posaux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"position <span class="free">a</span> <span class="free">l</span> <span class="main">&lt;</span> position <span class="free">b</span> <span class="free">l</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-posaux6"><span class="command">lemma</span></span> posaux6<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟶</span> position <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span>  position <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> position_positive<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-notSmallerTransaux"><span class="command">lemma</span></span> notSmallerTransaux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span> <span class="free">r</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span>
  singleCombinators <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">⟹</span>  singleCombinators <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">⟹</span>  singleCombinators <span class="main">[</span><span class="free">r</span><span class="main">]</span> <span class="main">⟹</span>
  <span class="main">¬</span> smaller <span class="free">y</span> <span class="free">x</span> <span class="free">l</span> <span class="main">⟹</span> smaller <span class="free">x</span> <span class="free">y</span> <span class="free">l</span> <span class="main">⟹</span> smaller <span class="free">x</span> <span class="free">r</span> <span class="free">l</span> <span class="main">⟹</span> smaller <span class="free">y</span> <span class="free">r</span> <span class="free">l</span> <span class="main">⟹</span> 
   in_list <span class="free">x</span> <span class="free">l</span> <span class="main">⟹</span> in_list <span class="free">y</span> <span class="free">l</span> <span class="main">⟹</span> in_list <span class="free">r</span> <span class="free">l</span> <span class="main">⟹</span> <span class="main">¬</span> smaller <span class="free">r</span> <span class="free">x</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-notSmallerTrans"><span class="command">lemma</span></span> notSmallerTrans<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> <span class="free">r</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> singleCombinators <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span> <span class="main">⟶</span> 
  <span class="main">¬</span> smaller <span class="free">y</span> <span class="free">x</span> <span class="free">l</span> <span class="main">⟶</span> sorted <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">z</span> <span class="main">⟶</span> 
  all_in_list <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">y</span><span class="main">#</span><span class="free">z</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">¬</span> smaller <span class="free">r</span> <span class="free">x</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notSmallerTransaux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singleCombinatorsConc singleCombinatorsStart<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SCSubset equalityE remdups.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_remdups
                    singleCombinatorsConc singleCombinatorsStart<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sorted.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> in_set_in_list singleCombinatorsConc
                  singleCombinatorsStart sortedConcStart sorted_is_smaller<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sorted_Cons all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                 singleCombinatorsConc<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> in_set_in_list<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-NCSaux1"><span class="command">lemma</span></span>  NCSaux1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span>  all_in_list <span class="free">p</span> <span class="free">l</span><span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> 
  sorted <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">≠</span> firstList <span class="free">p</span> <span class="main">⟶</span>
  DenyAllFromTo <span class="free">u</span> <span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bothNet.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> first_bothNet.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"in_list <span class="skolem">a</span> <span class="free">l</span> <span class="main">∧</span> all_in_list <span class="skolem">list</span> <span class="free">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4 <span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">a</span> <span class="free">l</span> <span class="main">∧</span> sorted <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="free">l</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5 <span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">u</span> <span class="free">v</span> <span class="main">∈</span> set <span class="skolem">list</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 6 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="skolem">a</span> <span class="main">∧</span> noDenyAll <span class="skolem">list</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>Combinators<span class="main">)</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> in_set_in_list <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_ConsA<span class="main">)</span>
        
    <span class="keyword1"><span class="command">have</span></span> ** <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="skolem">a</span> <span class="main">⟹</span>  
                       <span class="main">¬</span> smaller <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators<span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  notSmallerTrans<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> smalleraux3a<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0 first_bothNet.elims list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="skolem">a</span> <span class="main">⟹</span>  <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  3  <span class="quoted">"*"</span> <span class="quoted">"**"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-posaux3"><span class="command">lemma</span></span> posaux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟶</span> position <span class="free">a</span> <span class="free">l</span> <span class="main">≠</span> position <span class="free">b</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> position_positive<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-posaux4"><span class="command">lemma</span></span> posaux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">⟶</span> <span class="free">a</span><span class="main">≠</span> DenyAll <span class="main">⟶</span> <span class="free">b</span> <span class="main">≠</span> DenyAll <span class="main">⟶</span> in_list <span class="free">a</span> <span class="free">l</span> <span class="main">⟶</span>in_list <span class="free">b</span> <span class="free">l</span> <span class="main">⟶</span>
    smaller <span class="free">a</span> <span class="free">b</span>  <span class="free">l</span><span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>bothNet <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>bothNet <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> 
    position <span class="free">x</span> <span class="free">l</span> <span class="main">&lt;=</span> position <span class="free">y</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  DenyAllFromTo
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_imp_le  <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Conc <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">e</span> <span class="skolem">f</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-NCSaux2"><span class="command">lemma</span></span>  NCSaux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span>singleCombinators <span class="free">p</span> <span class="main">⟶</span>
   sorted <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> firstList <span class="free">p</span> <span class="main">⟶</span>
   AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>  <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">list</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> *  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span>  in_list <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> all_in_list <span class="skolem">list</span> <span class="free">l</span> <span class="main">⟹</span>
                   singleCombinators <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟹</span>  AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∈</span> set <span class="skolem">list</span> <span class="main">⟹</span> 
                   smaller <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> sorted <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
                   smaller <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> in_set_in_list <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">using</span></span> NormalisationGenericProofs.sorted_Cons all_in_list.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                   
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∈</span> set <span class="skolem">list</span> <span class="main">⟹</span>
                    in_list <span class="skolem">aa</span> <span class="free">l</span> <span class="main">⟹</span>   all_in_list <span class="skolem">list</span> <span class="free">l</span> <span class="main">⟹</span> 
                    in_list <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> in_set_in_list<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> smaller <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> l <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">l</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> posaux<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"position <span class="main">(</span>first_bothNet <span class="skolem">aa</span><span class="main">)</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> basic_trans_rules<span class="main"><span class="main">(</span></span>22<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x x'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">x'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.not_eq_order_implies_strict posaux6<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.not_eq_order_implies_strict posaux6<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.not_eq_order_implies_strict posaux6<span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> basic_trans_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> posaux4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> posaux3<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> posaux4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sorted_is_smaller<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> posaux4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>       
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sorted_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ** bothNet.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> in_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> posaux6<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-NCSaux3"><span class="command">lemma</span></span>  NCSaux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span>  all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span>singleCombinators <span class="free">p</span> <span class="main">⟶</span> 
  sorted <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">w</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> firstList <span class="free">p</span> <span class="main">⟶</span>
  DenyAllFromTo <span class="free">u</span> <span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> impI conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">list</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="skolem">aa</span> <span class="main">∧</span> noDenyAll <span class="skolem">list</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  3 <span class="main">:</span> <span class="quoted"><span class="quoted">"in_list <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> all_in_list <span class="skolem">list</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  5 <span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> sorted <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  6 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">u</span> <span class="free">v</span> <span class="main">∈</span> set <span class="skolem">list</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> smaller <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> notSmallerTrans<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> smalleraux3a<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">l</span>"</span></span>        
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"in_list <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> in_set_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sorted_is_smaller<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"in_list <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> in_set_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> singleCombinatorsConc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-NCSaux4"><span class="command">lemma</span></span>  NCSaux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noDenyAll <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟶</span>  all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> 
 sorted <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> firstList <span class="free">p</span> <span class="main">⟶</span>
 AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">list</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="skolem">aa</span> <span class="main">∧</span> noDenyAll <span class="skolem">list</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∈</span> set <span class="free">l</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  3 <span class="main">:</span> <span class="quoted"><span class="quoted">"in_list <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> all_in_list <span class="skolem">list</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  5 <span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="skolem">aa</span> <span class="free">l</span> <span class="main">∧</span> sorted <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  6 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∈</span> set <span class="skolem">list</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> smaller <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> notSmallerTrans<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> smalleraux3a<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span>        
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"in_list <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> in_set_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> sorted_is_smaller<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"in_list <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> in_set_in_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> order_trans<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> smaller.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"in_list <span class="main">(</span>AllowPortFromTo <span class="free">u</span> <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> in_set_in_list <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bothNet.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> in_list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        singleCombinators.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> sorted_ConsA<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationGenericProofs-NetsCollectedSorted"><span class="command">lemma</span></span> NetsCollectedSorted<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> sorted <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span>  NetsCollected <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> noDA1C<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> sortedConc<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">l</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  3<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>   5<span class="main">:</span> <span class="quoted"><span class="quoted">"NetsCollected <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NetsCollected <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fl3<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> <span class="quoted">"aa"</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> DenyAll›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> fMTaux noDA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">x21</span> <span class="skolem">x22</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> firstList <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 7 <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>                
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> DenyAllFromTo <span class="skolem">x21</span> <span class="skolem">x22</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NCSaux1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NCSaux2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> SCnotConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">x31</span> <span class="skolem">x32</span> <span class="skolem">x33</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> firstList <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 7 <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>                
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> 1 2 3 4 6 7 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> AllowPortFromTo <span class="skolem">x31</span> <span class="skolem">x32</span> <span class="skolem">x33</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NCSaux3<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NCSaux4<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> SCnotConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">x41</span> <span class="skolem">x42</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> 3 4   <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x41</span> <span class="main">⊕</span> <span class="skolem">x42</span>›</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-NetsCollectedSort"><span class="command">lemma</span></span> NetsCollectedSort<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span>noDenyAll1 <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span>
                          singleCombinators <span class="free">p</span> <span class="main">⟹</span> NetsCollected <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> l <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">l</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NetsCollectedSorted<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> noDAsort<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> all_in_listSubset<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sort_is_sorted<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-fBNsep"><span class="command">lemma</span></span> fBNsep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">z</span><span class="main">.</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>separate <span class="free">z</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-fBNsep1"><span class="command">lemma</span></span> fBNsep1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">z</span><span class="main">.</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span> <span class="main">⟶</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>separate <span class="free">z</span><span class="main">)</span><span class="main">.</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1" id="NormalisationGenericProofs-NetsCollectedSepauxa"><span class="command">lemma</span></span> NetsCollectedSepauxa<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">≠</span>firstList <span class="free">z</span> <span class="main">⟹</span>  noDenyAll1 <span class="free">z</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">z</span><span class="main">.</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">≠</span>first_bothNet <span class="bound">a</span> <span class="main">⟹</span> NetsCollected <span class="free">z</span> <span class="main">⟹</span>  
   NetsCollected <span class="main">(</span>separate <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">}</span> <span class="main">≠</span> firstList <span class="main">(</span>separate <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span>   <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>separate <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">{</span><span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fBNsep<span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationGenericProofs-NetsCollectedSepaux"><span class="command">lemma</span></span> NetsCollectedSepaux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"first_bothNet <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>Combinators<span class="main">)</span> <span class="main">≠</span> first_bothNet <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">y</span> <span class="main">∧</span> noDenyAll <span class="free">z</span> <span class="main">⟹</span>  
   <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">z</span><span class="main">.</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> first_bothNet <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> NetsCollected <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span>
   NetsCollected <span class="main">(</span>separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> first_bothNet <span class="free">x</span> <span class="main">≠</span> firstList <span class="main">(</span>separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   first_bothNet <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>Combinators<span class="main">)</span> <span class="main">≠</span> first_bothNet <span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span>Combinators<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fBNsep1<span class="main">)</span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-NetsCollectedSep"><span class="command">lemma</span></span> NetsCollectedSep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> NetsCollected <span class="free">p</span> <span class="main">⟶</span>  NetsCollected <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span> 
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fMTaux noDA noDA1eq noDAsep<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> NetsCollectedSepaux fl3 noDA1eq noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> noDA1eq noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> NetsCollectedSepaux fl3 noDA1eq noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> noDA1eq noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NetsCollectedSepaux fl3 noDA1eq noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-OTNaux"><span class="command">lemma</span></span> OTNaux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">a</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">∨</span>   <span class="main">(</span><span class="free">x</span> <span class="main">=</span> first_destNet <span class="free">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> onlyTwoNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">aa</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span>first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singletonE first_isIn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span><span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span>first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sdnets2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sdnets_charn"><span class="command">lemma</span></span> sdnets_charn<span class="main">:</span> <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span>
sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span>first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> 
sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> onlyTwoNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">aa</span> <span class="bound">b</span><span class="main">.</span> sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> singletonE first_isIn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span>first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span>first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sdnets2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-first_bothNet_charn"><span class="command">lemma</span></span> first_bothNet_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟶</span> first_bothNet <span class="free">a</span> <span class="main">=</span> <span class="main">{</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-sdnets_noteq"><span class="command">lemma</span></span> sdnets_noteq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">a</span> <span class="main">⟹</span> onlyTwoNets <span class="free">aa</span> <span class="main">⟹</span> first_bothNet <span class="free">a</span> <span class="main">≠</span> first_bothNet <span class="free">aa</span> <span class="main">⟹</span> 
   <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">aa</span> <span class="main">⟹</span> sdnets <span class="free">a</span> <span class="main">≠</span> sdnets <span class="free">aa</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> first_bothNet_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> first_bothNet_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> OTNaux first_isIn insert_absorb2 insert_commute<span class="main">)</span>

<span class="keyword1" id="NormalisationGenericProofs-fbn_noteq"><span class="command">lemma</span></span> fbn_noteq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">a</span> <span class="main">⟹</span>  onlyTwoNets <span class="free">aa</span> <span class="main">⟹</span>  first_bothNet <span class="free">a</span> <span class="main">≠</span> first_bothNet <span class="free">aa</span> <span class="main">⟹</span>
    <span class="main">¬</span> member DenyAll <span class="free">a</span> <span class="main">⟹</span>  <span class="main">¬</span> member DenyAll <span class="free">aa</span> <span class="main">⟹</span>  allNetsDistinct <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">aa</span><span class="main">]</span> <span class="main">⟹</span>
    first_srcNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span> <span class="main">∨</span> first_srcNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span> <span class="main">∨</span> 
    first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span> <span class="main">∨</span> first_destNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNet_charn<span class="main">)</span>    
    
<span class="keyword1" id="NormalisationGenericProofs-NCisSD2aux"><span class="command">lemma</span></span> NCisSD2aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="main">:</span> <span class="quoted"><span class="quoted">"onlyTwoNets <span class="free">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3 <span class="main">:</span> <span class="quoted"><span class="quoted">"first_bothNet <span class="free">a</span> <span class="main">≠</span> first_bothNet <span class="free">aa</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">aa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">" allNetsDistinct <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">aa</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">a</span> <span class="free">aa</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjSD_2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span>  sdnets_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> sdnets_noteq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span>  fbn_noteq <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">aa</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def twoNetsDistinct_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ab</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ab</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">ab</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">ab</span><span class="main">∈</span>set<span class="main">(</span>net_list_aux<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">aa</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span>set<span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">aa</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> netsDistinct <span class="bound">ab</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">aa</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    9<span class="main">:</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span>
              sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   10<span class="main">:</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span>
              sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">,</span> first_srcNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   11<span class="main">:</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">≠</span> sdnets <span class="free">aa</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   12<span class="main">:</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">⟶</span> first_srcNet <span class="free">a</span> <span class="main">=</span> first_destNet <span class="free">aa</span> <span class="main">⟶</span> 
              first_destNet <span class="free">aa</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span>netsDistinct <span class="skolem">ab</span> <span class="skolem">c</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>netsDistinct <span class="skolem">ab</span> <span class="skolem">d</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"netsDistinct <span class="skolem">ab</span> <span class="skolem">c</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">d</span>"</span></span>         
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span>       7 8 9 10 11 12<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span><span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd insert_commute<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span>  4 5 firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd <span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd insert_commute<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>        
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">assume</span></span>  14 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span> <span class="main">∨</span> <span class="skolem">ab</span> <span class="main">=</span> first_destNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">aa</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     15 <span class="main">:</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     16 <span class="main">:</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">,</span> first_srcNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     17 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> sdnets <span class="free">aa</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     18 <span class="main">:</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">⟶</span> first_srcNet <span class="free">a</span> <span class="main">=</span> first_destNet <span class="free">aa</span> <span class="main">⟶</span> first_destNet <span class="free">aa</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     19 <span class="main">:</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">a</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     20 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">⟶</span> <span class="skolem">d</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" netsDistinct <span class="skolem">ab</span> <span class="skolem">c</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 20 OTNaux<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> first_destNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd insert_commute<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 OTNaux<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 OTNaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 20 OTNaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> first_destNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 14 firstInNet alternativelistconc2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 14 firstInNeta alternativelistconc2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 3 4 5 first_bothNetsd  insert_commute<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 OTNaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 2 5 14 OTNaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"netsDistinct <span class="skolem">ab</span> <span class="skolem">d</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6 7 8 9 10 11 12<span class="main">)</span>           
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd insert_commute<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd insert_commute<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta alternativelistconc2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNet alternativelistconc2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd<span class="main">)</span>    
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword3"><span class="command">assume</span></span> 13<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">ab</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">ab</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">ab</span><span class="main">∈</span>set<span class="main">(</span>net_list_aux<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">aa</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> set<span class="main">(</span>net_list_aux<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">aa</span><span class="main">]</span><span class="main">)</span>
                             <span class="main">⟶</span> netsDistinct <span class="bound">ab</span> <span class="bound">b</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    14 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span> <span class="main">∨</span> 
                        <span class="skolem">ab</span> <span class="main">=</span> first_destNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> sdnets <span class="free">aa</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    15 <span class="main">:</span> <span class="quoted"><span class="quoted">" sdnets <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> 
                                    <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    16 <span class="main">:</span> <span class="quoted"><span class="quoted">" sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> 
                        sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">,</span> 
                                     <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">,</span> first_srcNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    17 <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> 
                         <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> sdnets <span class="free">aa</span> "</span></span>
      <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">a</span> <span class="main">⟹</span> netsDistinct <span class="skolem">ab</span> <span class="skolem">d</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> 1 2 3 4 5 6   13 14 15 16 17<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sdnets <span class="free">aa</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd insert_commute<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNeta alternativelistconc2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> firstInNet alternativelistconc2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> first_bothNetsd<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">,</span> first_destNet <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">,</span> first_srcNet <span class="free">a</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span>
                        <span class="main">{</span><span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">,</span> first_destNet <span class="free">aa</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>first_destNet <span class="free">aa</span><span class="main">,</span> first_srcNet <span class="free">aa</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>    21<span class="main">:</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">a</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"netsDistinct <span class="skolem">ab</span> <span class="skolem">d</span> <span class="main">∨</span> netsDistinct <span class="skolem">b</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> first_srcNet <span class="free">aa</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> first_destNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">a</span> <span class="main">≠</span> first_destNet <span class="free">aa</span>"</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 7 firstInNeta firstInNet alternativelistconc2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 20 insert_commute<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 13 14  firstInNeta alternativelistconc2<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"first_destNet <span class="free">aa</span> <span class="main">≠</span> first_destNet <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 4 5 13 14  firstInNet alternativelistconc2<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ab</span> <span class="main">=</span> first_srcNet <span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span>  20<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"first_srcNet <span class="free">a</span> <span class="main">≠</span> first_srcNet <span class="free">aa</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span>  20<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 21<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_srcNet <span class="free">aa</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  2 3 4 5 7 14 OTNaux 
              firstInNet firstInNeta first_bothNetsd isInAlternativeList<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 2 4 5 7 20 14 OTNaux doubleton_eq_iff firstInNet 
              firstInNeta isInAlternativeList<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-ANDaux3"><span class="command">lemma</span></span> ANDaux3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">a</span> <span class="main">∈</span> set <span class="main">(</span>net_list_aux <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isInAlternativeList<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-ANDaux2"><span class="command">lemma</span></span> ANDaux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> allNetsDistinct <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ANDaux3 isInAlternativeList netlistaux<span class="main">)</span>
    
<span class="keyword1" id="NormalisationGenericProofs-NCisSD2"><span class="command">lemma</span></span> NCisSD2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">a</span>     <span class="main">⟹</span>  OnlyTwoNets <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
  NetsCollected2 <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> NetsCollected <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
  noDenyAll <span class="main">(</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
  disjSD_2 <span class="free">a</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ANDaux2 FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> NCisSD2aux NetsCollected.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      NetsCollected2.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> OTNConc OTNoTN empty_iff empty_set list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> noDA<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-separatedNC"><span class="command">lemma</span></span> separatedNC<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="free">p</span> <span class="main">⟶</span> NetsCollected2 <span class="free">p</span> <span class="main">⟶</span> NetsCollected <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="free">p</span> <span class="main">⟶</span>  
   allNetsDistinct <span class="free">p</span>  <span class="main">⟶</span> separated <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set set<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="skolem">p</span> <span class="main">⟶</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span> NetsCollected <span class="skolem">p</span> <span class="main">⟶</span> noDenyAll1 <span class="skolem">p</span> <span class="main">⟶</span> 
          allNetsDistinct <span class="skolem">p</span> <span class="main">⟶</span> separated <span class="skolem">p</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">≠</span> DenyAll <span class="main">⟹</span>  OnlyTwoNets <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span>
          first_bothNet <span class="skolem">a</span> <span class="main">≠</span> firstList <span class="skolem">p</span> <span class="main">∧</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">aa</span><span class="main">∈</span>set <span class="skolem">p</span><span class="main">.</span> first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="bound">aa</span><span class="main">)</span> <span class="main">∧</span> NetsCollected <span class="skolem">p</span> <span class="main">⟶</span>
          noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">⟶</span> 
          disjSD_2 <span class="skolem">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> separated <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> OTNConc<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> noDA1C<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI  allI impI  NCisSD2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> ANDConc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set set<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> Combinators "</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set set<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="skolem">p</span> <span class="main">⟶</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span> NetsCollected <span class="skolem">p</span> <span class="main">⟶</span> noDenyAll1 <span class="skolem">p</span> <span class="main">⟶</span> 
          allNetsDistinct <span class="skolem">p</span> <span class="main">⟶</span> separated <span class="skolem">p</span> <span class="main">⟹</span>  <span class="skolem">a</span> <span class="main">=</span> DenyAll <span class="main">⟹</span>  OnlyTwoNets <span class="skolem">p</span> <span class="main">⟶</span>
          <span class="main">{}</span><span class="main">≠</span>firstList <span class="skolem">p</span> <span class="main">∧</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="skolem">p</span><span class="main">.</span> <span class="main">{}</span><span class="main">≠</span>first_bothNet <span class="bound">a</span><span class="main">)</span><span class="main">∧</span>NetsCollected <span class="skolem">p</span> <span class="main">⟶</span>
          noDenyAll <span class="skolem">p</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span>DenyAll <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">⟶</span> disjSD_2 DenyAll <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> separated <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ANDConc disjSD_2_def noDA1eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-separatedNC'"><span class="command">lemma</span></span> separatedNC'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="free">p</span> <span class="main">⟶</span> NetsCollected2 <span class="free">p</span> <span class="main">⟶</span> NetsCollected <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="free">p</span> <span class="main">⟶</span>  
   allNetsDistinct <span class="free">p</span>  <span class="main">⟶</span> separated <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span> 
    <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span>  first_bothNet <span class="skolem">a</span> <span class="main">≠</span> firstList <span class="skolem">p</span> <span class="main">∧</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">aa</span><span class="main">∈</span>set <span class="skolem">p</span><span class="main">.</span> first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="bound">aa</span><span class="main">)</span> <span class="main">∧</span> NetsCollected <span class="skolem">p</span> <span class="main">⟶</span>
                      noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> 
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">⟶</span> disjSD_2 <span class="skolem">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> separated <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> Cons.hyps <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> DenyAll›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> OTNConc<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ANDConc disjSD_2_def noDA1eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span>  first_bothNet <span class="skolem">a</span> <span class="main">≠</span> firstList <span class="skolem">p</span> <span class="main">∧</span> NetsCollected2 <span class="skolem">p</span> <span class="main">⟶</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">aa</span><span class="main">∈</span>set <span class="skolem">p</span><span class="main">.</span> first_bothNet <span class="skolem">a</span> <span class="main">≠</span> first_bothNet <span class="bound">aa</span><span class="main">)</span> <span class="main">∧</span> NetsCollected <span class="skolem">p</span> <span class="main">⟶</span>
                      noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> allNetsDistinct <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">⟶</span> 
                      disjSD_2 <span class="skolem">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> separated <span class="skolem">p</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> Cons.hyps <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> DenyAll›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NetsCollected.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NetsCollected2.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separatedNC<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationGenericProofs-NC2Sep"><span class="command">lemma</span></span> NC2Sep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> NetsCollected2 <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators list"</span></span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fMTaux firstList.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fl2 noDA1eq noDenyAll.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> separate.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fl2 noDA1eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fl2 noDA1eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">va</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> Combinators"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fl2 noDA1eq<span class="main">)</span>         
<span class="keyword1"><span class="command">qed</span></span>         
  
<span class="keyword1" id="NormalisationGenericProofs-separatedSep"><span class="command">lemma</span></span> separatedSep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"OnlyTwoNets <span class="free">p</span> <span class="main">⟶</span> NetsCollected2 <span class="free">p</span>   <span class="main">⟶</span> NetsCollected <span class="free">p</span> <span class="main">⟶</span> 
   noDenyAll1 <span class="free">p</span>  <span class="main">⟶</span> allNetsDistinct <span class="free">p</span>  <span class="main">⟶</span> separated <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ANDSep NC2Sep NetsCollectedSep OTNSEp noDA1sep separatedNC<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationGenericProofs-rADnMT"><span class="command">lemma</span></span> rADnMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span> removeAllDuplicates <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>
        
<span class="keyword1" id="NormalisationGenericProofs-remDupsNMT"><span class="command">lemma</span></span> remDupsNMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> remdups <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> remdups_eq_nil_iff<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationGenericProofs-sets_distinct1"><span class="command">lemma</span></span> sets_distinct1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sets_distinct2"><span class="command">lemma</span></span> sets_distinct2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sets_distinct5"><span class="command">lemma</span></span> sets_distinct5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationGenericProofs-sets_distinct6"><span class="command">lemma</span></span> sets_distinct6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div><div id="NormalisationIntegerPortProof">
<div class="head">
<h1>Theory NormalisationIntegerPortProof</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normalisation Proofs: Integer Port›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  NormalisationIntegerPortProof
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NormalisationGenericProofs">NormalisationGenericProofs</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Normalisation proofs which are specific to the IntegerPort address representation. 
›</span></span> 

<span class="keyword1" id="NormalisationIntegerPortProof-ConcAssoc"><span class="command">lemma</span></span> ConcAssoc<span class="main">:</span> <span class="quoted"><span class="quoted">"C<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> C<span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-aux26"><span class="command">lemma</span></span> aux26<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> 
             dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas twoNetsDistinct_def netsDistinct_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="NormalisationIntegerPortProof-wp2_aux"><span class="command">lemma</span></span> wp2_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy2 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> 
                             wellformed_policy2 <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1" id="NormalisationIntegerPortProof-Cdom2"><span class="command">lemma</span></span> Cdom2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-wp2Conc"><span class="command">lemma</span></span> wp2Conc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy2 <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> wellformed_policy2 <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-DAimpliesMR_E"><span class="command">lemma</span></span> DAimpliesMR_E<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> denyAllDom<span class="main">)</span>


<span class="keyword1" id="NormalisationIntegerPortProof-DAimplieMR"><span class="command">lemma</span></span> DAimplieMR<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DAimpliesMR_E<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-MRList1"><span class="command">lemma</span></span> MRList1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-MRList2"><span class="command">lemma</span></span> MRList2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">c</span><span class="main">@</span><span class="free">b</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-MRList3"><span class="command">lemma</span></span> MRList3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">xa</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CConcEnd"><span class="command">lemma</span></span> CConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"C <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟶</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span>"</span></span>
 <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C.simps<span class="main">)</span>

    
<span class="keyword1" id="NormalisationIntegerPortProof-CConcStartaux"><span class="command">lemma</span></span> CConcStartaux<span class="main">:</span> <span class="quoted"><span class="quoted">" C <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="main">(</span>C <span class="free">aa</span> <span class="main">++</span> C <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="free">aa</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CConcStart"><span class="command">lemma</span></span> CConcStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> None <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">xs</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2FWpolicy.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mrNnt"><span class="command">lemma</span></span> mrNnt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mr_is_C"><span class="command">lemma</span></span> mr_is_C<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
   <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStart applied_rule_rev_def mrNnt option.exhaust<span class="main">)</span>


<span class="keyword1" id="NormalisationIntegerPortProof-CConcStart2"><span class="command">lemma</span></span> CConcStart2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> CConcStart<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CConcEnd1"><span class="command">lemma</span></span> CConcEnd1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">@</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="free">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lCdom2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> CConcStart2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CConcEnd2"><span class="command">lemma</span></span> CConcEnd2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="free">a</span> <span class="free">x</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-bar3"><span class="command">lemma</span></span> bar3<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">xa</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> CConcStart eq_Nil_appendI l2p_aux2 option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CeqEnd"><span class="command">lemma</span></span> CeqEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="skolem">xa</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd2 MRList2 mr_is_C <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd1 CConcStart2 Nil_is_append_conv bar3 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> MRList2 eq_Nil_appendI mr_is_C <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-CConcStartA"><span class="command">lemma</span></span> CConcStartA<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-domConc"><span class="command">lemma</span></span> domConc<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-CeqStart"><span class="command">lemma</span></span> CeqStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟶</span> <span class="free">b</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟶</span> C<span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>C<span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2FWpolicy.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2FWpolicyconc PLemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_if_mr_eq2"><span class="command">lemma</span></span> C_eq_if_mr_eq2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">r</span><span class="main">⌋</span> <span class="main">⟹</span>
   applied_rule_rev C <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">r</span><span class="main">⌋</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_is_C<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-nMRtoNone"><span class="command">lemma</span></span> nMRtoNone<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_if_mr_eq"><span class="command">lemma</span></span> C_eq_if_mr_eq<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> 
  C <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nMRtoNone<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nMRtoNone<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C_eq_if_mr_eq2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-notmatching_notdom"><span class="command">lemma</span></span> notmatching_notdom<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> Some <span class="free">a</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo3a"><span class="command">lemma</span></span> foo3a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>  <span class="free">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∉</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> notmatching_notdom<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MRList2 MRList3 append_Cons option.inject<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo3D"><span class="command">lemma</span></span> foo3D<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> DenyAll <span class="main">#</span> <span class="free">ps</span> <span class="main">⟹</span> 
   applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⌊</span>DenyAll<span class="main">⌋</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAll"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> foo3a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo4"><span class="command">lemma</span></span> foo4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">.</span><span class="bound">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo5b"><span class="command">lemma</span></span> foo5b<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-mr_first"><span class="command">lemma</span></span> mr_first<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">b</span> <span class="main">#</span> <span class="free">c</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">b</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foo5b<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mr_charn"><span class="command">lemma</span></span> mr_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>   <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span>  
   applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> applied_rule_rev_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo8"><span class="command">lemma</span></span> foo8<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
   <span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mrConcEnd"><span class="command">lemma</span></span> mrConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟶</span>  applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span> 


<span class="keyword1" id="NormalisationIntegerPortProof-wp3tl"><span class="command">lemma</span></span> wp3tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="free">p</span> <span class="main">⟶</span> wellformed_policy3 <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-wp3Conc"><span class="command">lemma</span></span> wp3Conc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy3 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo98"><span class="command">lemma</span></span> foo98<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">aa</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> applied_rule_rev_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">xa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-mrMTNone"><span class="command">lemma</span></span> mrMTNone<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">[]</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-DAAux"><span class="command">lemma</span></span> DAAux<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C DenyAll<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def PolicyCombinators.PolicyCombinators C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mrSet"><span class="command">lemma</span></span> mrSet<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> applied_rule_rev_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1" id="NormalisationIntegerPortProof-mr_not_Conc"><span class="command">lemma</span></span> mr_not_Conc<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> Some <span class="main">(</span><span class="free">a</span><span class="main">⊕</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  mrSet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mrSet<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> SCnotConc<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="NormalisationIntegerPortProof-foo25"><span class="command">lemma</span></span> foo25<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy3 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mr_in_dom"><span class="command">lemma</span></span> mr_in_dom<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>


<span class="keyword1" id="NormalisationIntegerPortProof-wp3EndMT"><span class="command">lemma</span></span> wp3EndMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">xs</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>  AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>
   dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> wp3Conc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo29"><span class="command">lemma</span></span> foo29<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo28"><span class="command">lemma</span></span> foo28<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
   wellformed_policy3 <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>   <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> foo29 C.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> wp3EndMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo28a"><span class="command">lemma</span></span> foo28a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-allow_deny_dom"><span class="command">lemma</span></span> allow_deny_dom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1" id="NormalisationIntegerPortProof-DenyAllowDisj"><span class="command">lemma</span></span> DenyAllowDisj<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
   dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>  <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 allow_deny_dom<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo31"><span class="command">lemma</span></span> foo31<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> 
       <span class="bound">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAll <span class="main">⟹</span>
   set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
   <span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span><span class="main">=</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAll"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-wp1_auxa"><span class="command">lemma</span></span> wp1_auxa<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span><span class="main">⟹</span><span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DAimpliesMR_E<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> wp1_aux1aa<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-deny_dom"><span class="command">lemma</span></span> deny_dom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> aux6<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domTrans"><span class="command">lemma</span></span> domTrans<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">b</span> <span class="main">⟹</span> dom <span class="free">b</span> <span class="main">∩</span> dom <span class="free">c</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> dom <span class="free">a</span> <span class="main">∩</span> dom <span class="free">c</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-DomInterAllowsMT"><span class="command">lemma</span></span> DomInterAllowsMT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>  <span class="main">⟹</span> 
dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">po</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> domTrans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domComm aux26 tNDComm<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-DomInterAllowsMT_Ports"><span class="command">lemma</span></span> DomInterAllowsMT_Ports<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">po</span> <span class="main">⟹</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span> <span class="operator">auto</span>



<span class="keyword1" id="NormalisationIntegerPortProof-wellformed_policy3_charn"><span class="command">lemma</span></span> wellformed_policy3_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> distinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> 
   wellformed_policy1 <span class="free">p</span> <span class="main">⟶</span> wellformed_policy2 <span class="free">p</span>  <span class="main">⟶</span> wellformed_policy3 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span>   
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc ANDConc waux2 wp2Conc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a list
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.elims DomInterAllowsMT DomInterAllowsMT_Ports aux0_0 aux7aa inf_commute<span class="main">)</span> <span class="comment1">(* slow *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-DistinctNetsDenyAllow"><span class="command">lemma</span></span> DistinctNetsDenyAllow<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">b</span> <span class="free">c</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
  AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
  allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
  <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> allNetsDistinct_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> Int_commute ND0aux1 ND0aux3 NDComm aux26 twoNetsDistinct_def ND0aux2 ND0aux4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-DistinctNetsAllowAllow"><span class="command">lemma</span></span> DistinctNetsAllowAllow<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">b</span> <span class="free">c</span> <span class="free">poo</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
    AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
    allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
    dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">b</span> <span class="free">c</span> <span class="free">poo</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
    <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">poo</span> <span class="main">=</span> <span class="free">po</span>"</span></span> 
<span class="keyword1"><span class="command">unfolding</span></span> allNetsDistinct_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> DomInterAllowsMT DomInterAllowsMT_Ports ND0aux3 ND0aux4 NDComm 
    twoNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-WP2RS2"><span class="command">lemma</span></span> WP2RS2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy2 <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>   
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> wp_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy2 <span class="main">(</span>removeShadowRules2 <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons ANDConc distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> wp_xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> wp_xs Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> DenyAllFromTo aux aux7 tNDComm deny_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span>  wp_xs  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> aux26 AllowPortFromTo Cons<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> aux aux7a tNDComm<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singleCombinators.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-AD_aux"><span class="command">lemma</span></span> AD_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>  DenyAllFromTo <span class="free">c</span> <span class="free">d</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>
   allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>  singleCombinators <span class="free">p</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">⟹</span> 
   dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aux26<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    
<span class="keyword1" id="NormalisationIntegerPortProof-sorted_WP2"><span class="command">lemma</span></span> sorted_WP2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> distinct <span class="free">p</span> <span class="main">⟶</span> 
            allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> wellformed_policy2 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  Cons
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  Cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI allI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> deny_dom<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>  aux7 tNDComm ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI  conjI allI aux26<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>  y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="improper">aa</span> <span class="improper">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="improper">aa</span> <span class="improper">b</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main">)</span> 	
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> sorted_is_smaller<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bothNet.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>  in_set_in_list<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> aux7 tNDComm ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-wellformed2_sorted"><span class="command">lemma</span></span> wellformed2_sorted<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
   singleCombinators <span class="free">p</span> <span class="main">⟹</span> wellformed_policy2 <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_WP2<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> sort_is_sorted<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> all_in_listSubset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SC3 singleCombinatorsConc sorted_insort<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-wellformed2_sortedQ"><span class="command">lemma</span></span> wellformed2_sortedQ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>all_in_list <span class="free">p</span> <span class="free">l</span><span class="main">;</span> distinct <span class="free">p</span><span class="main">;</span> allNetsDistinct <span class="free">p</span><span class="main">;</span>
                         singleCombinators <span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> wellformed_policy2 <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sorted_WP2<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> sort_is_sortedQ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> all_in_listSubset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SC3Q singleCombinatorsConc distinct_sortQ<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_DenyAll"><span class="command">lemma</span></span> C_DenyAll<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAll<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS1n"><span class="command">lemma</span></span> C_eq_RS1n<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C<span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules1_alternative <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">)</span><span class="keyword1"><span class="command">print_cases</span></span>  
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rSR1_eq removeShadowRules1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">list</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> rSR1_eq removeShadowRules1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xs
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> removeShadowRules1_alternative_def
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> CConcEnd2 CConcStart C_DenyAll RS1n_nMT aux114 
          domIff removeShadowRules1_alternative_def 
          removeShadowRules1_alternative_rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS1"><span class="command">lemma</span></span> C_eq_RS1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>  C<span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rSR1_eq C_eq_RS1n<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-EX_MR_aux"><span class="command">lemma</span></span> EX_MR_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span>DenyAll <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> Some DenyAll <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-EX_MR"><span class="command">lemma</span></span> EX_MR <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">⌊</span>DenyAll<span class="main">⌋</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> DenyAll <span class="main">#</span> <span class="free">ps</span> <span class="main">⟹</span> 
 applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="main">≠</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mrConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAimpliesMR_E list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_in_set list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_Some_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mr_not_DA"><span class="command">lemma</span></span> mr_not_DA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">s</span> <span class="main">⟹</span>
   applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⌊</span>DenyAllFromTo <span class="free">a</span> <span class="free">ab</span><span class="main">⌋</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span>
   applied_rule_rev C <span class="free">x</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">⌊</span>DenyAll<span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> wp1n_tl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">ab</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">a</span> <span class="free">ab</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wp1n_tl foo98 wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> mrSet r_not_DA_in_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mr_in_dom<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domsMT_notND_DD"><span class="command">lemma</span></span> domsMT_notND_DD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deny_dom twoNetsDistinct_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domsMT_notND_DD2"><span class="command">lemma</span></span> domsMT_notND_DD2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> deny_dom twoNetsDistinct_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domsMT_notND_DD3"><span class="command">lemma</span></span> domsMT_notND_DD3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">¬</span> netsDistinct <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>domsMT_notND_DD<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domsMT_notND_DD4"><span class="command">lemma</span></span> domsMT_notND_DD4<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>domsMT_notND_DD2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-NetsEq_if_sameP_DD"><span class="command">lemma</span></span> NetsEq_if_sameP_DD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>  <span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span>  <span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> 
   <span class="free">v</span> <span class="main">=</span> DenyAllFromTo <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">u</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ND0aux1 ND0aux2 domsMT_notND_DD3 domsMT_notND_DD4 <span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-rule_charn1"><span class="command">lemma</span></span> rule_charn1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> aND<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mr_is_allow<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> SC<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> inDom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAll<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAll<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AD_aux DenyAllFromTo SC aND domInterMT inDom inp mrSet mr_in_dom mr_is_allow<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> AllowPortFromTo DistinctNetsAllowAllow aND domInterMT 
        inDom inp  mrSet mr_in_dom mr_is_allow<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIntegerPortProof-none_MT_rulessubset"><span class="command">lemma</span></span> none_MT_rulessubset<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">a</span> <span class="main">⟶</span> set <span class="free">b</span> <span class="main">⊆</span> set <span class="free">a</span> <span class="main">⟶</span> none_MT_rules C <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> notMTnMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-nMTSort"><span class="command">lemma</span></span> nMTSort<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">p</span> <span class="main">⟹</span> none_MT_rules C <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sort nMTeqSet<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-nMTSortQ"><span class="command">lemma</span></span> nMTSortQ<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">p</span> <span class="main">⟹</span> none_MT_rules C <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sortQ nMTeqSet<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-wp3char"><span class="command">lemma</span></span> wp3char<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">xs</span> <span class="main">∧</span> C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">=</span><span class="main">∅</span> <span class="main">∧</span> wellformed_policy3<span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
 AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domNMT wp3Conc<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-wp3charn"><span class="command">lemma</span></span> wp3charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> domAllow<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     wp3<span class="main">:</span>      <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>             <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wp3Conc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DenyAllowDisj domAllow<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-rule_charn2"><span class="command">lemma</span></span> rule_charn2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> aND<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp1<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> SC<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp3<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> allow_in_list<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x_in_dom_allow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="skolem">ys</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd SCConcEnd WP1ConcEnd foo25<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inSet_not_MT<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DenyAll snoc    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAnotTL DenyAll inSet_not_MT policy2list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domInterMT  wp3EndMT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd DenyAllFromTo SCConcEnd WP1ConcEnd foo25<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domInterMT  wp3EndMT<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd AllowPortFromTo SCConcEnd WP1ConcEnd foo25 x_in_dom_allow<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Conc snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc aux0_0 in_set_conv_decomp<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIntegerPortProof-rule_charn3"><span class="command">lemma</span></span> rule_charn3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" wellformed_policy1 <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span>
   wellformed_policy3 <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⌊</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">⌋</span> <span class="main">⟹</span> 
   AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rule_charn2 dom_def<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationIntegerPortProof-rule_charn4"><span class="command">lemma</span></span> rule_charn4<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wp1<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> aND<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> SC<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp3<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="free">p</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> DA<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> mr<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rinp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xindom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DenyAll assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
        u <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NetsEq_if_sameP_DD<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> mrSet<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> mr_in_dom<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C  <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rule_charn3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCnotConc<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc aux0_0<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-foo31a"><span class="command">lemma</span></span> foo31a<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span><span class="main">=</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span><span class="main">=</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span><span class="main">=</span>DenyAll <span class="main">⟹</span>
    set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAll"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIntegerPortProof-aux4"><span class="command">lemma</span></span> aux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux0_4 empty_iff empty_set insert_iff list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> mrSet mreq_end3<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-mrDA_tl"><span class="command">lemma</span></span> mrDA_tl<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> mr_DA<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp1n<span class="main">:</span>  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>          <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aux4 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">DenyAll</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wp1n_tl mr_DA wp1n<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet wp1n<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-rule_charnDAFT"><span class="command">lemma</span></span> rule_charnDAFT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>  allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>  singleCombinators <span class="free">p</span> <span class="main">⟹</span>
    wellformed_policy3 <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">⌊</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">⌋</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AND_tl Combinators.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> SC_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mrConcEnd rule_charn4 waux2 wellformed_policy1_charn wp1_aux1aa wp1_eq wp3tl<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> wp1n_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="NormalisationIntegerPortProof-mrDenyAll_is_unique"><span class="command">lemma</span></span> mrDenyAll_is_unique<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wellformed_policy1_strong <span class="free">p</span><span class="main">;</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll<span class="main">;</span>
   <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAll"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">p</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> foo3a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wp1n_tl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span>  C_eq_Sets_mr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sets_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> SC<span class="main">:</span>          <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp1_p<span class="main">:</span>       <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp1_s<span class="main">:</span>       <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp3_p<span class="main">:</span>       <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="free">p</span>"</span></span>       
    <span class="keyword2"><span class="keyword">and</span></span> wp3_s<span class="main">:</span>       <span class="quoted"><span class="quoted">"wellformed_policy3 <span class="free">s</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> aND<span class="main">:</span>         <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>        
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> None 
  <span class="keyword1"><span class="command">have</span></span> DA<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wp1_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_aux1aa<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> notDA<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> None <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DAimplieMR<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">contradiction</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_p wp1n_tl<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_s wp1n_tl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tl_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> WP1n_DA_notinSet sets_eq foo2
          wellformed_policy1_charn wp1_aux1aa wp1_eq wp1_p wp1_s<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>  <span class="keyword3"><span class="command">case</span></span> DenyAll
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_DenyAll<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DenyAll Some<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> x_notin_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wp1_p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mrDenyAll_is_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> x_notin_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tl_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_DenyAll<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some DenyAll"</span></span> <span class="keyword1"><span class="command">using</span></span> tl_s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mr_first<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_DenyAll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DenyAllFromTo Some<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> DA_notin_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet wp1_p<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> mr_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Combinators.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> DenyAllFromTo Some mrConcEnd tl_p<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> dom_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wp1_p aND SC wp3_p mr_p_is_DAFT
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rule_charnDAFT<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> dom_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tl_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> DAFT_in_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mr_tl_p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo mrSet mr_p_is_DAFT tl_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_dom_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_p_is_DAFT DenyAllFromTo mr_in_dom<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_tl_s_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DAFT_in_tl_s dom_tl_s  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  mr_charn<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tl_s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  DA_notin_tl DenyAllFromTo EX_MR mrDA_tl 
            not_Some_eq tl_eq wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_DAFT <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> wp1s<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_eq wp1_s<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_A<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AllowPortFromTo Some<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> A_in_s<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∈</span> set <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sets_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mrSet<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_dom_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_p_is_A AllowPortFromTo mr_in_dom<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> SCs<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC sets_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCSubset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ANDs<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aND sets_eq SC
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> aNDSetsEq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_A<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A_in_s wp1s mr_p_is_A aND SCs wp3_s x_in_dom_A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rule_charn2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Some mr_not_Conc SC<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_Sets"><span class="command">lemma</span></span> C_eq_Sets<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span>  wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>  wellformed_policy1_strong <span class="free">s</span> <span class="main">⟹</span>
   wellformed_policy3 <span class="free">p</span> <span class="main">⟹</span>  wellformed_policy3 <span class="free">s</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">s</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C_eq_if_mr_eq C_eq_Sets_mr <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_sorted"><span class="command">lemma</span></span> C_eq_sorted<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>
    wellformed_policy3 <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>FWNormalisationCore.sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C_eq_Sets <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nMTSort wellformed1_alternative_sorted 
      wellformed_policy3_charn  wp1_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_sortedQ"><span class="command">lemma</span></span> C_eq_sortedQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>
   wellformed_policy3 <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> C_eq_Sets <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nMTSortQ wellformed1_alternative_sorted distinct_sortQ
      wellformed_policy3_charn wp1_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_qsort wellformed1_sortedQ wellformed_eq wp1_aux1aa<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS2_mr"><span class="command">lemma</span></span> C_eq_RS2_mr<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span><span class="main">=</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons DenyAll mreq_end2<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons DenyAllFromTo mreq_end2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo Cons
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev C <span class="free">x</span> <span class="skolem">ys</span> <span class="main">=</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mrconcNone<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> allow_deny_dom<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> mrNoneMT<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo mrconc<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False Cons AllowPortFromTo
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> AllowPortFromTo Cons mreq_end2<span class="main">)</span> <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons mreq_end2 removeShadowRules2.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_None"><span class="command">lemma</span></span> C_eq_None<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">--&gt;</span> applied_rule_rev C <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟶</span>  C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa xs
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_None2"><span class="command">lemma</span></span> C_eq_None2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> applied_rule_rev C <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> <span class="main">⊥</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_eq_None<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS2"><span class="command">lemma</span></span> C_eq_RS2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RS2_mr C_eq_if_mr_eq wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wp1n_RS2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-none_MT_rulesRS2"><span class="command">lemma</span></span> none_MT_rulesRS2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">p</span> <span class="main">⟹</span> none_MT_rules C <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RS2Set none_MT_rulessubset<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-CconcNone"><span class="command">lemma</span></span> CconcNone<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 list2FWpolicyconc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_add_dom_app_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inSet_not_MT list2FWpolicyconc set_empty2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-none_MT_rulesrd"><span class="command">lemma</span></span> none_MT_rulesrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">p</span> <span class="main">⟶</span> none_MT_rules C <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-DARS3"><span class="command">lemma</span></span> DARS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span><span class="main">⟶</span>DenyAll <span class="main">∉</span> set <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-DAnMT"><span class="command">lemma</span></span> DAnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C DenyAll<span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def C.simps PolicyCombinators.PolicyCombinators<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-DAnMT2"><span class="command">lemma</span></span> DAnMT2<span class="main">:</span> <span class="quoted"><span class="quoted">"C DenyAll <span class="main">≠</span> Map.empty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAAux dom_eq_empty_conv empty_iff<span class="main">)</span> 

<span class="keyword1" id="NormalisationIntegerPortProof-wp1n_RS3"><span class="command">lemma</span></span> wp1n_RS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>  wellformed_policy1_strong <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DARS3 DAnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-AILRS3"><span class="command">lemma</span></span> AILRS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-SCRS3"><span class="command">lemma</span></span> SCRS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> singleCombinators<span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-RS3subset"><span class="command">lemma</span></span> RS3subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span>  <span class="main">⊆</span> set <span class="free">p</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-ANDRS3"><span class="command">lemma</span></span> ANDRS3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RS3subset SCRS3 aNDSubset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NormalisationIntegerPortProof-nlpaux"><span class="command">lemma</span></span> nlpaux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-notindom"><span class="command">lemma</span></span> notindom<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 domIff empty_iff empty_set l2p_aux<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_rd"><span class="command">lemma</span></span> C_eq_rd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 False list2FWpolicyconc<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> False domIff list2FWpolicyconc nlpaux notindom<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>remdups <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 False list2FWpolicyconc remdups_eq_nil_iff<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domIff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>remdups <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> False list2FWpolicyconc nlpaux remdups_eq_nil_iff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domIff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-nMT_domMT"><span class="command">lemma</span></span> nMT_domMT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> not_MT C  <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CconcNone domIff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS3_aux"><span class="command">lemma</span></span> C_eq_RS3_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"not_MT C  <span class="free">p</span> <span class="main">⟹</span>  C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"not_MT C  <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CconcNone True not_MTimpnotMT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules C <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 NMPrm l2p_aux not_MTimpnotMT<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domIff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span>  dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules C <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> l2p_aux l2p_aux2 nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domIff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons False
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons False <span class="quoted"><span class="quoted">‹<span class="main">¬</span> not_MT C <span class="skolem">ys</span>›</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SR3nMT l2p_aux list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nMT_domMT nlpaux<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>       

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_id"><span class="command">lemma</span></span> C_eq_id<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>  C<span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C_eq_if_mr_eq <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> mr_iD<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RS3"><span class="command">lemma</span></span> C_eq_RS3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"not_MT C  <span class="free">p</span> <span class="main">⟹</span> C<span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules C <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> C_eq_RS3_aux<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-NMPrd"><span class="command">lemma</span></span> NMPrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"not_MT C  <span class="free">p</span> <span class="main">⟶</span> not_MT C  <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> NMPcharn<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-NMPDA"><span class="command">lemma</span></span> NMPDA<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> not_MT C  <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAnMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-NMPiD"><span class="command">lemma</span></span> NMPiD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"not_MT C  <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD NMPDA<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-list2FWpolicy2list"><span class="command">lemma</span></span> list2FWpolicy2list<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>list2FWpolicy<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>C <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cdom2 CeqEnd CeqStart domIff nlpaux p2lNmt<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> C_eq_Lemmas <span class="main">=</span> none_MT_rulesRS2 none_MT_rulesrd  SCp2l  wp1n_RS2  wp1ID NMPiD wp1_eq
                     wp1alternative_RS1 p2lNmt list2FWpolicy2list wellformed_policy3_charn waux2 

<span class="keyword1"><span class="command">lemmas</span></span> C_eq_subst_Lemmas <span class="main">=</span> C_eq_sorted C_eq_sortedQ C_eq_RS2 C_eq_rd C_eq_RS3 C_eq_id 

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_All_untilSorted"><span class="command">lemma</span></span> C_eq_All_untilSorted<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>FWNormalisationCore.sort
          <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
             <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_sorted<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_rd<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_id<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_All_untilSortedQ"><span class="command">lemma</span></span> C_eq_All_untilSortedQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
             <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_sortedQ<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_rd<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_id<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_All_untilSorted_withSimps"><span class="command">lemma</span></span> C_eq_All_untilSorted_withSimps<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>FWNormalisationCore.sort
          <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
              <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas C_eq_subst_Lemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_All_untilSorted_withSimpsQ"><span class="command">lemma</span></span> C_eq_All_untilSorted_withSimpsQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">⟹</span>all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
             <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas C_eq_subst_Lemmas<span class="main">)</span>
    

<span class="keyword1" id="NormalisationIntegerPortProof-InDomConc"><span class="command">lemma</span></span> InDomConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span>  dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a' p  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def C.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-not_in_member"><span class="command">lemma</span></span> not_in_member<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"member <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def C.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-src_in_sdnets"><span class="command">lemma</span></span> src_in_sdnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> subnetsOfAdr <span class="main">(</span>src <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>fst_set <span class="main">(</span>sdnets <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_set_def subnetsOfAdr_def PLemmas fst_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="skolem">x2</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subnetAux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas fst_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-dest_in_sdnets"><span class="command">lemma</span></span> dest_in_sdnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span>  subnetsOfAdr <span class="main">(</span>dest <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>snd_set <span class="main">(</span>sdnets <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_set_def subnetsOfAdr_def PLemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="skolem">x2</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subnetAux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-sdnets_in_subnets"><span class="command">lemma</span></span> sdnets_in_subnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span> dom <span class="main">(</span>C <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>sdnets <span class="free">x</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span>src <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span>dest <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas subnetsOfAdr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas subnetsOfAdr_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-disjSD_no_p_in_both"><span class="command">lemma</span></span> disjSD_no_p_in_both<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>   
  <span class="quoted"><span class="quoted">"disjSD_2 <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> member DenyAll <span class="free">y</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> dom<span class="main">(</span>C <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> dom<span class="main">(</span>C <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> 
  False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> D <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"src <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"dest <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tndFalse<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dest_in_sdnets src_in_sdnets sdnets_in_subnets disjSD_2_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-list2FWpolicy_eq"><span class="command">lemma</span></span> list2FWpolicy_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> C <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConcAssoc l2p_aux list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-dom_sep"><span class="command">lemma</span></span> dom_sep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy<span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA domIff l2p_aux2 list2FWpolicyconc not_Cons_self <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc_not_MT domIff list2FWpolicy_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> InDomConc domIff list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list2FWpolicyconc nlpaux sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">va</span><span class="main">}</span> <span class="main">=</span> first_bothNet <span class="skolem">y</span> <span class="main">⟹</span>
                <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">va</span><span class="main">}</span> <span class="main">≠</span> first_bothNet <span class="skolem">y</span> <span class="main">⟹</span>
              <span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C<span class="main">(</span>list2FWpolicy<span class="main">(</span>separate<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA domIff  l2p_aux2 list2FWpolicyconc not_Cons_self <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 domIff l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def C.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 domIff l2p_aux list2FWpolicy.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nlpaux sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_bothNet <span class="skolem">v</span> <span class="main">=</span> first_bothNet <span class="skolem">y</span> <span class="main">⟹</span> 
                <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">⊕</span> <span class="skolem">va</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">⊕</span> <span class="skolem">va</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  ** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first_bothNet <span class="skolem">v</span> <span class="main">≠</span> first_bothNet <span class="skolem">y</span> <span class="main">⟹</span> 
                <span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> * **<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">⊕</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartA ConcAssoc domIff list2FWpolicy2list list2FWpolicyconc  p2lNmt<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc_not_MT domIff list2FWpolicy_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Conc_not_MT InDomConc domIff nlpaux sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIntegerPortProof-domdConcStart"><span class="command">lemma</span></span> domdConcStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-sep_dom2_aux"><span class="command">lemma</span></span> sep_dom2_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicy_eq p2lNmt<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-sep_dom2_aux2"><span class="command">lemma</span></span> sep_dom2_aux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA InDomConc domdConcStart list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicyconc<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-sep_dom2"><span class="command">lemma</span></span> sep_dom2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy<span class="main">(</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> separate.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_dom2_aux sep_dom2_aux2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-sepDom"><span class="command">lemma</span></span> sepDom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> dom_sep<span class="main"><span class="keyword3">|</span></span><span class="operator">erule</span> sep_dom2<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_s_ext"><span class="command">lemma</span></span> C_eq_s_ext<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span>  <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">a</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> l2p_aux2 separate.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 list2FWpolicyconc sepDom sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sepDom<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nlpaux sepDom<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sepDom<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not_Cons_self sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> list2FWpolicy_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sepnMT<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not_Cons_self sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> list2FWpolicy_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sepnMT<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> not_Cons_self sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> list2FWpolicy_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sepnMT<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_s"><span class="command">lemma</span></span> C_eq_s<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> C_eq_s_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-sortnMTQ"><span class="command">lemma</span></span> sortnMTQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> qsort <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sortQ setnMT<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> C_eq_Lemmas_sep <span class="main">=</span>
       C_eq_Lemmas sortnMT sortnMTQ RS2_NMT NMPrd not_MTimpnotMT 

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_until_separated"><span class="command">lemma</span></span> C_eq_until_separated<span class="main">:</span>
  <span class="quoted"><span class="quoted">" DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>separate
          <span class="main">(</span>FWNormalisationCore.sort
            <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
               <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_All_untilSorted_withSimps C_eq_s wellformed1_alternative_sorted wp1ID wp1n_RS2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_until_separatedQ"><span class="command">lemma</span></span> C_eq_until_separatedQ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>separate <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
             <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_All_untilSorted_withSimpsQ C_eq_s sortnMTQ wp1ID wp1n_RS2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domID"><span class="command">lemma</span></span> domID<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                           <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C<span class="main">(</span>list2FWpolicy<span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps dom_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> InDomConc idNMT <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>               
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">src</span> <span class="skolem">dest</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span> <span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>  
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">src</span> <span class="skolem">dest</span> <span class="skolem">port</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc _ _<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">src</span> <span class="skolem">dest</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> domIff CConcStartA list2FWpolicyconc nlpaux Cdom2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">src</span> <span class="skolem">dest</span> <span class="skolem">port</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> domIff CConcStartA list2FWpolicyconc nlpaux Cdom2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc _ _<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> CConcStartA Cdom2 domIff domdConcStart<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1" id="NormalisationIntegerPortProof-DA_is_deny"><span class="command">lemma</span></span> DA_is_deny<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">b</span> <span class="free">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">⊕</span>DenyAllFromTo <span class="free">b</span> <span class="free">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-iDdomAux"><span class="command">lemma</span></span> iDdomAux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DenyAllFromTo Cons
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DA_is_deny<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo InDomConc <span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo  idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span>
                                DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                C <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DA_is_deny<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo domdConcStart<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons AllowPortFromTo
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo InDomConc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo Cdom2 idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span>
                                DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                C <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo CConcStartA ConcAssoc idNMT  list2FWpolicyconc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span>
                                <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 Conc Cons InDomConc idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span> 
                                   <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> DenyAllFromTo<span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span>
                                   <span class="main">⊕</span> <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                 C <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span>
                                   DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span>  <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"C<span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span>
                                  <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span>
                                  <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                                 C<span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> 
                                   DenyAllFromTo<span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Conc ConcAssoc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>         
  

<span class="keyword1" id="NormalisationIntegerPortProof-iD_isD"><span class="command">lemma</span></span> iD_isD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
   C <span class="main">(</span>DenyAll <span class="main">⊕</span> list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C DenyAll <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 PLemmas<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> deny_all_def iDdomAux<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nlpaux<span class="main">)</span>


<span class="keyword1" id="NormalisationIntegerPortProof-inDomConc"><span class="command">lemma</span></span> inDomConc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span><span class="main">∉</span>dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span><span class="main">;</span> <span class="free">x</span><span class="main">∉</span>dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>
                 <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domdConcStart<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-domsdisj"><span class="command">lemma</span></span> domsdisj<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>  <span class="bound">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="free">y</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> domdConcStart list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
        
<span class="keyword1" id="NormalisationIntegerPortProof-isSepaux"><span class="command">lemma</span></span> isSepaux<span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> noDenyAll <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> separated <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> 
                DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span>
                     DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> domsdisj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Combinators.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> disjSD2aux disjSD_no_p_in_both noDA<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-none_MT_rulessep"><span class="command">lemma</span></span> none_MT_rulessep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules C <span class="free">p</span> <span class="main">⟶</span> none_MT_rules C <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps map_add_le_mapE map_le_antisym<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-dom_id"><span class="command">lemma</span></span> dom_id<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll<span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> separated<span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∉</span>dom<span class="main">(</span>C<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span>dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> isSepaux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> idNMT <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> noDAID <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> id_aux4 noDA1eq sepNetsID <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> notindom<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_iD_aux2"><span class="command">lemma</span></span> C_eq_iD_aux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> separated <span class="free">p</span><span class="main">⟶</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>
  C<span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons DenyAll <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 domID idNMT list2FWpolicyconc noDA1eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAll iD_isD idNMT list2FWpolicyconc nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc DenyAllFromTo<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 domID idNMT l2p_aux noDA1eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Combinators.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> dom_id domdConcStart
          noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo domIff dom_def domdConcStart l2p_aux l2p_aux2 nlpaux<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc AllowPortFromTo<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 domID idNMT list2FWpolicyconc noDA1eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Combinators.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> dom_id domdConcStart noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc l2p_aux list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nlpaux<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons Conc 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc Conc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 domID idNMT list2FWpolicyconc noDA1eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span><span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 domIff idNMT list2FWpolicyconc nlpaux<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> dom_id noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inDomConc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_iD"><span class="command">lemma</span></span> C_eq_iD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"separated <span class="free">p</span> <span class="main">⟹</span> noDenyAll1 <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> CConcStartA C_eq_iD_aux2 DAAux wp1_alternative_not_mt wp1n_tl<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-noDAsortQ"><span class="command">lemma</span></span> noDAsortQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a list<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a list
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nDAeqSet set_sortQ <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> noDA1eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"noDenyAll <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil nDAeqSet qsort.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_sortQ<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-NetsCollectedSortQ"><span class="command">lemma</span></span> NetsCollectedSortQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span>noDenyAll1 <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span>  singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   NetsCollected <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NetsCollectedSorted SC3Q all_in_list.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> all_in_list.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> all_in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
      all_in_listAppend all_in_list_sublist noDAsortQ qsort.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> qsort.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
      singleCombinatorsConc sort_is_sortedQ<span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> CLemmas <span class="main">=</span>  nMTSort nMTSortQ none_MT_rulesRS2 none_MT_rulesrd
                  noDAsort noDAsortQ nDASC wp1_eq  wp1ID  
                  SCp2l ANDSep   wp1n_RS2 
                  OTNSEp OTNSC noDA1sep wp1_alternativesep wellformed_eq 
                  wellformed1_alternative_sorted  
                    

<span class="keyword1"><span class="command">lemmas</span></span> C_eqLemmas_id <span class="main">=</span> CLemmas  NC2Sep NetsCollectedSep 
                       NetsCollectedSort NetsCollectedSortQ separatedNC

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_Until_InsertDenies"><span class="command">lemma</span></span> C_eq_Until_InsertDenies<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>insertDenies
          <span class="main">(</span>separate
            <span class="main">(</span>FWNormalisationCore.sort
              <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
                  <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_iD<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eqLemmas_id<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_until_separated<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_Until_InsertDeniesQ"><span class="command">lemma</span></span> C_eq_Until_InsertDeniesQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   C<span class="main">(</span>list2FWpolicy
       <span class="main">(</span>insertDenies
          <span class="main">(</span>separate <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
              <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_iD<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eqLemmas_id<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WP1rd set_qsort wellformed1_sortedQ wellformed_eq wp1ID wp1_alternativesep wp1_aux1aa wp1n_RS2 wp1n_RS3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_until_separatedQ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RD_aux"><span class="command">lemma</span></span> C_eq_RD_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>removeDuplicates <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 domIff nlpaux not_in_member<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RAD_aux"><span class="command">lemma</span></span> C_eq_RAD_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RD_aux<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="main">(</span>list2FWpolicy <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cdom2 Cons.hyps domIff l2p_aux rADnMT<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RD_aux Cons.hyps domIff list2FWpolicyconc nlpaux rADnMT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_RAD"><span class="command">lemma</span></span> C_eq_RAD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="free">p</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> C_eq_RAD_aux<span class="main">)</span>
<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_compile"><span class="command">lemma</span></span> C_eq_compile<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>removeAllDuplicates
          <span class="main">(</span>insertDenies
            <span class="main">(</span>separate
              <span class="main">(</span>FWNormalisationCore.sort
                <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
                    <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RAD<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> idNMT<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eqLemmas_id<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_Until_InsertDenies<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_compileQ"><span class="command">lemma</span></span> C_eq_compileQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>list2FWpolicy
       <span class="main">(</span>removeAllDuplicates
         <span class="main">(</span>insertDenies
           <span class="main">(</span>separate
             <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules C 
                  <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RAD<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> idNMT<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WP1rd sepnMT sortnMTQ wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wp1ID wp1n_RS2 wp1n_RS3<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_Until_InsertDeniesQ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalize"><span class="command">lemma</span></span> C_eq_normalize<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
 all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">(</span>Nets_List <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
 C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalize_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_compile<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalizeQ"><span class="command">lemma</span></span> C_eq_normalizeQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
   all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizeQ <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalizeQ_def C_eq_compileQ<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSubset3"><span class="command">lemma</span></span> domSubset3<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAll <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAll<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas split_tupled_all <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSubset4"><span class="command">lemma</span></span> domSubset4<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">dn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits <span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSubset5"><span class="command">lemma</span></span> domSubset5<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">y</span> <span class="free">x</span> <span class="free">dn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits <span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSubset1"><span class="command">lemma</span></span> domSubset1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">one</span> <span class="free">two</span> <span class="free">dn</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allow_all_def deny_all_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSubset2"><span class="command">lemma</span></span> domSubset2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">two</span> <span class="free">one</span> <span class="free">dn</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  dom <span class="main">(</span>C <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> allow_all_def deny_all_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-ConcAssoc2"><span class="command">lemma</span></span> ConcAssoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-ConcAssoc3"><span class="command">lemma</span></span> ConcAssoc3<span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-RS3_NMT"><span class="command">lemma</span></span> RS3_NMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> rm_MT_rules C <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-norm_notMT"><span class="command">lemma</span></span> norm_notMT<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalize <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS2_NMT RS3_NMT idNMT normalize_def rADnMT sepnMT sortnMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-norm_notMTQ"><span class="command">lemma</span></span> norm_notMTQ<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalizeQ <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS2_NMT RS3_NMT idNMT normalizeQ_def rADnMT sepnMT sortnMTQ<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> domDA <span class="main">=</span> NormalisationIntegerPortProof.domSubset3 <span class="comment1">(* legacy *)</span>

<span class="keyword1"><span class="command">lemmas</span></span> domain_reasoning <span class="main">=</span> domDA ConcAssoc2 domSubset1 domSubset2 
                          domSubset3 domSubset4  domSubset5 domSubsetDistr1
                          domSubsetDistr2 domSubsetDistrA domSubsetDistrD coerc_assoc ConcAssoc 
                          ConcAssoc3

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas help with the normalisation›</span></span>
<span class="keyword1" id="NormalisationIntegerPortProof-list2policyR_Start"><span class="command">lemma</span></span> list2policyR_Start<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span>
                 C <span class="main">(</span>list2policyR <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> C <span class="free">a</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">#</span> <span class="free">list</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list2policyR.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C.simps dom_def map_add_def<span class="main">)</span> 

<span class="keyword1" id="NormalisationIntegerPortProof-list2policyR_End"><span class="command">lemma</span></span> list2policyR_End<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span>
        C <span class="main">(</span>list2policyR <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>C <span class="free">a</span> <span class="main">⨁</span> list2policy <span class="main">(</span>map C <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps dom_def map_add_def list2policy_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-l2polR_eq_el"><span class="command">lemma</span></span> l2polR_eq_el<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C<span class="main">(</span>list2policyR <span class="free">N</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  <span class="main">(</span>list2policy <span class="main">(</span>map C <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list2policy_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">N</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domStart list2policy_def<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR_Start<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps dom_def map_add_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-l2polR_eq"><span class="command">lemma</span></span> l2polR_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> C<span class="main">(</span> list2policyR <span class="free">N</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>list2policy <span class="main">(</span>map C <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def l2polR_eq_el <span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-list2FWpolicys_eq_el"><span class="command">lemma</span></span> list2FWpolicys_eq_el<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span>  C <span class="main">(</span>list2policyR <span class="free">Filter</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Filter</span></span><span class="main">)</span> <span class="keyword1"><span class="command">print_cases</span></span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>C <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR_Start<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> l2polR_eq list2policyR_End nlpaux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-list2FWpolicys_eq"><span class="command">lemma</span></span> list2FWpolicys_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span> C <span class="main">(</span>list2policyR <span class="free">Filter</span><span class="main">)</span> <span class="main">=</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> list2FWpolicys_eq_el<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-list2FWpolicys_eq_sym"><span class="command">lemma</span></span> list2FWpolicys_eq_sym<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>C <span class="main">(</span>list2policyR <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  C <span class="main">(</span>list2FWpolicy <span class="free">Filter</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicys_eq rev_is_Nil_conv rev_rev_ident<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq"><span class="command">lemma</span></span> p_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>  list2policy <span class="main">(</span>map C <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l2polR_eq list2FWpolicys_eq_sym rev.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq2"><span class="command">lemma</span></span> p_eq2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalize <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C<span class="main">(</span>list2FWpolicy<span class="main">(</span>normalize <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span> <span class="main">⟶</span> 
   list2policy<span class="main">(</span>map C <span class="main">(</span>rev<span class="main">(</span>normalize <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq2Q"><span class="command">lemma</span></span> p_eq2Q<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalizeQ <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>  C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizeQ <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span> <span class="main">⟶</span>
   list2policy <span class="main">(</span>map C <span class="main">(</span>rev <span class="main">(</span>normalizeQ <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-list2listNMT"><span class="command">lemma</span></span> list2listNMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>map <span class="free">sem</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="NormalisationIntegerPortProof-Norm_Distr2"><span class="command">lemma</span></span> Norm_Distr2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>list2policy <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Norm_Distr_2<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-NATDistr"><span class="command">lemma</span></span> NATDistr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">=</span> C <span class="main">(</span>list2policyR <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">NAT</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    list2policy <span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> map C <span class="free">N</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2polR_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Norm_Distr_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalize_manual"><span class="command">lemma</span></span> C_eq_normalize_manual<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
 C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_order <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_manual_order_def C_eq_compile<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq2_manualQ"><span class="command">lemma</span></span> p_eq2_manualQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalize_manual_orderQ <span class="free">x</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C<span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderQ <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span> <span class="main">⟶</span>
   list2policy <span class="main">(</span>map C <span class="main">(</span>rev <span class="main">(</span>normalize_manual_orderQ <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-norm_notMT_manualQ"><span class="command">lemma</span></span> norm_notMT_manualQ<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalize_manual_orderQ <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS2_NMT RS3_NMT idNMT normalize_manual_orderQ_def rADnMT sepnMT sortnMTQ<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalize_manualQ"><span class="command">lemma</span></span> C_eq_normalize_manualQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderQ <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_manual_orderQ_def C_eq_compileQ<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq2_manual"><span class="command">lemma</span></span> p_eq2_manual<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalize_manual_order <span class="free">x</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_order <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span> <span class="main">⟶</span>
   list2policy <span class="main">(</span>map C <span class="main">(</span>rev <span class="main">(</span>normalize_manual_order <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> C <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-norm_notMT_manual"><span class="command">lemma</span></span> norm_notMT_manual<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalize_manual_order <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RS2_NMT idNMT normalize_manual_order_def rADnMT sepnMT sortnMT wp1ID<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As an example, how this theorems can be used for a concrete normalisation instantiation. 
›</span></span>

<span class="keyword1" id="NormalisationIntegerPortProof-normalizeNAT"><span class="command">lemma</span></span> normalizeNAT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span>
   all_in_list <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">NAT</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> C <span class="free">Filter</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   list2policy <span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> map C <span class="main">(</span>rev <span class="main">(</span>FWNormalisationCore.normalize <span class="free">Filter</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> 
       <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_normalize NATDistr list2FWpolicys_eq_sym norm_notMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-domSimpl"><span class="command">lemma</span></span> domSimpl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> DenyAll<span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>C <span class="main">(</span>DenyAll<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The followin theorems can be applied when prepending the usual normalisation with an 
  additional step and using another semantical interpretation function. This is a general recipe 
  which can be applied whenever one nees to combine several normalisation strategies. 
›</span></span> 

<span class="keyword1" id="NormalisationIntegerPortProof-CRotate_eq_rotateC"><span class="command">lemma</span></span> CRotate_eq_rotateC<span class="main">:</span> <span class="quoted"><span class="quoted">"CRotate <span class="free">p</span> <span class="main">=</span> C <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rotatePolicy.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps map_add_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-DAinRotate"><span class="command">lemma</span></span> DAinRotate<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> p1 p2 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="skolem">p1</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIntegerPortProof-DAUniv"><span class="command">lemma</span></span> DAUniv<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>CRotate <span class="main">(</span><span class="free">P</span> <span class="main">⊕</span> DenyAll<span class="main">)</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CRotate.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> CRotate.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CRotate_eq_rotateC DAAux PLemmas<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> UNIV_eq_I domSubset3<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-p_eq2R"><span class="command">lemma</span></span> p_eq2R<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>rotatePolicy <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> C<span class="main">(</span>list2FWpolicy<span class="main">(</span>normalize <span class="main">(</span>rotatePolicy <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CRotate <span class="free">x</span> <span class="main">⟶</span>
   list2policy <span class="main">(</span>map C <span class="main">(</span>rev <span class="main">(</span>normalize <span class="main">(</span>rotatePolicy <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CRotate <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalizeRotate"><span class="command">lemma</span></span> C_eq_normalizeRotate<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   all_in_list <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>list2FWpolicy
        <span class="main">(</span>removeAllDuplicates
          <span class="main">(</span>insertDenies
            <span class="main">(</span>separate
              <span class="main">(</span>sort<span class="main">(</span>removeShadowRules2<span class="main">(</span>remdups<span class="main">(</span>rm_MT_rules C 
                        <span class="main">(</span>insertDeny<span class="main">(</span>removeShadowRules1<span class="main">(</span>policy2list<span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>Nets_List <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   CRotate <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CRotate_eq_rotateC C_eq_compile DAinRotate<span class="main">)</span>

<span class="keyword1" id="NormalisationIntegerPortProof-C_eq_normalizeRotate2"><span class="command">lemma</span></span> C_eq_normalizeRotate2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   allNetsDistinct <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   all_in_list <span class="main">(</span>policy2list <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   C <span class="main">(</span>list2FWpolicy <span class="main">(</span>FWNormalisationCore.normalize <span class="main">(</span>rotatePolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> CRotate <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> C_eq_normalizeRotate<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NormalisationIPPProofs">
<div class="head">
<h1>Theory NormalisationIPPProofs</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normalisation Proofs: Integer Protocol›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  NormalisationIPPProofs
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NormalisationIntegerPortProof">NormalisationIntegerPortProof</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Normalisation proofs which are specific to the IntegerProtocol address representation. 
›</span></span> 

<span class="keyword1" id="NormalisationIPPProofs-ConcAssoc"><span class="command">lemma</span></span> ConcAssoc<span class="main">:</span> <span class="quoted"><span class="quoted">"Cp<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> Cp<span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-aux26"><span class="command">lemma</span></span> aux26<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>twoNetsDistinct_def netsDistinct_def PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-wp2_aux"><span class="command">lemma</span></span> wp2_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy2Pr <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy2Pr <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-Cdom2"><span class="command">lemma</span></span> Cdom2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> Cp <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-wp2Conc"><span class="command">lemma</span></span> wp2Conc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy2Pr <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> wellformed_policy2Pr <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DAimpliesMR_E"><span class="command">lemma</span></span> DAimpliesMR_E<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cp.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> denyAllDom<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DAimplieMR"><span class="command">lemma</span></span> DAimplieMR<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DAimpliesMR_E<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-MRList1"><span class="command">lemma</span></span> MRList1<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-MRList2"><span class="command">lemma</span></span> MRList2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">c</span><span class="main">@</span><span class="free">b</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-MRList3"><span class="command">lemma</span></span> MRList3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom<span class="main">(</span>Cp <span class="free">xa</span><span class="main">)</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">#</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CConcEnd"><span class="command">lemma</span></span> CConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Cp <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="free">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Cp.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CConcStartaux"><span class="command">lemma</span></span> CConcStartaux<span class="main">:</span> <span class="quoted"><span class="quoted">"Cp <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="main">(</span>Cp <span class="free">aa</span> <span class="main">++</span> Cp <span class="free">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="free">aa</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CConcStart"><span class="command">lemma</span></span> CConcStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> Cp <span class="free">a</span> <span class="free">x</span> <span class="main">=</span> None <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">xs</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list2FWpolicy.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mrNnt"><span class="command">lemma</span></span> mrNnt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mr_is_C"><span class="command">lemma</span></span> mr_is_C<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd <span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStart applied_rule_rev_def mrNnt option.exhaust<span class="main">)</span>
      
<span class="keyword1" id="NormalisationIPPProofs-CConcStart2"><span class="command">lemma</span></span> CConcStart2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> CConcStart<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CConcEnd1"><span class="command">lemma</span></span> CConcEnd1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">@</span><span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">q</span><span class="main">@</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">q</span><span class="main">@</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lCdom2<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> CConcStart2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CConcEnd2"><span class="command">lemma</span></span> CConcEnd2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="free">a</span> <span class="free">x</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Cp.simps<span class="main">)</span>
      
<span class="keyword1" id="NormalisationIPPProofs-bar3"><span class="command">lemma</span></span> bar3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">xa</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">xa</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> CConcStart eq_Nil_appendI l2p_aux2 option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CeqEnd"><span class="command">lemma</span></span> CeqEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp<span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp<span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xa</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">xa</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcEnd2 MRList2 mr_is_C <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> snoc.hyps CConcEnd1 CConcStart2 Nil_is_append_conv bar3 <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MRList2 eq_Nil_appendI mr_is_C <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-CConcStartA"><span class="command">lemma</span></span> CConcStartA<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list2FWpolicy.induct<span class="main">)</span>   <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domConc"><span class="command">lemma</span></span> domConc<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-CeqStart"><span class="command">lemma</span></span> CeqStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">b</span><span class="main">@</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list2FWpolicy.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2FWpolicyconc PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_if_mr_eq2"><span class="command">lemma</span></span> C_eq_if_mr_eq2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span><span class="main">≠</span><span class="main">[]</span> <span class="main">⟹</span>
   <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_is_C<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-nMRtoNone"><span class="command">lemma</span></span> nMRtoNone<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xa</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snoc.hyps applied_rule_rev_def dom_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_if_mr_eq"><span class="command">lemma</span></span> C_eq_if_mr_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>  
  <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nMRtoNone<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nMRtoNone<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> C_eq_if_mr_eq2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-notmatching_notdom"><span class="command">lemma</span></span> notmatching_notdom<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> Some <span class="free">a</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-foo3a"><span class="command">lemma</span></span> foo3a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>  <span class="free">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">∉</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xa</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">@</span> <span class="free">b</span> <span class="main">#</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> notmatching_notdom<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_eq_appendI NormalisationIPPProofs.MRList2 NormalisationIPPProofs.MRList3 
        append_Nil option.inject snoc.hyps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-foo3D"><span class="command">lemma</span></span> foo3D<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">=</span>DenyAll<span class="main">#</span><span class="free">ps</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll <span class="main">⟹</span> <span class="free">r</span><span class="main">∈</span>set <span class="free">ps</span> <span class="main">⟹</span> 
   <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAll"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> foo3a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo4"><span class="command">lemma</span></span> foo4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">.</span><span class="bound">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo5b"><span class="command">lemma</span></span> foo5b<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-mr_first"><span class="command">lemma</span></span> mr_first<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">c</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">b</span><span class="main">#</span><span class="free">c</span> <span class="main">⟹</span> 
   applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foo5b<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mr_charn"><span class="command">lemma</span></span> mr_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span>  
   applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>applied_rule_rev_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-foo8"><span class="command">lemma</span></span> foo8<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
   <span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">s</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mrConcEnd"><span class="command">lemma</span></span> mrConcEnd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟶</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="NormalisationIPPProofs-wp3tl"><span class="command">lemma</span></span> wp3tl<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="free">p</span> <span class="main">⟶</span> wellformed_policy3Pr <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a as
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-wp3Conc"><span class="command">lemma</span></span> wp3Conc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy3Pr <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1" id="NormalisationIPPProofs-foo98"><span class="command">lemma</span></span> foo98<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">aa</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> applied_rule_rev_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xa</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">xa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-mrMTNone"><span class="command">lemma</span></span> mrMTNone<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">[]</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DAAux"><span class="command">lemma</span></span> DAAux<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp DenyAll<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def PolicyCombinators.PolicyCombinators Cp.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mrSet"><span class="command">lemma</span></span> mrSet<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">r</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  applied_rule_rev_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span> <span class="operator">simp_all</span>
    
<span class="keyword1" id="NormalisationIPPProofs-mr_not_Conc"><span class="command">lemma</span></span> mr_not_Conc<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> Some <span class="main">(</span><span class="free">a</span><span class="main">⊕</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  mrSet <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mrSet <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> SCnotConc<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationIPPProofs-foo25"><span class="command">lemma</span></span> foo25<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> wellformed_policy3Pr <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-mr_in_dom"><span class="command">lemma</span></span> mr_in_dom<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    
    
<span class="keyword1" id="NormalisationIPPProofs-wp3EndMT"><span class="command">lemma</span></span> wp3EndMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">xs</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>  AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>
   dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NormalisationIPPProofs.wp3Conc aux0_4 inf_commute list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      wellformed_policy3Pr.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo29"><span class="command">lemma</span></span> foo29<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo28"><span class="command">lemma</span></span> foo28<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">∈</span>set <span class="free">p</span> <span class="main">⟹</span> dom<span class="main">(</span>Cp<span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> 
   <span class="main">(</span>wellformed_policy3Pr<span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">x</span> <span class="main">≠</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> foo29 Cp.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> wp3EndMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo28a"><span class="command">lemma</span></span> foo28a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-allow_deny_dom"><span class="command">lemma</span></span> allow_deny_dom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span> <span class="operator">auto</span> 
    
<span class="keyword1" id="NormalisationIPPProofs-DenyAllowDisj"><span class="command">lemma</span></span> DenyAllowDisj<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
   dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>  <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 allow_deny_dom<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-foo31"><span class="command">lemma</span></span> foo31<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> 
         <span class="main">(</span><span class="bound">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAll<span class="main">)</span> <span class="main">⟹</span> 
   set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span><span class="main">∈</span>set <span class="free">s</span> <span class="main">∧</span> <span class="free">x</span><span class="main">∈</span>dom<span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">r</span><span class="main">=</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span><span class="main">=</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAll<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-wp1_auxa"><span class="command">lemma</span></span> wp1_auxa<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span><span class="main">⟹</span><span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> DAimpliesMR_E<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> wp1_aux1aa<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-deny_dom"><span class="command">lemma</span></span> deny_dom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> aux6<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domTrans"><span class="command">lemma</span></span> domTrans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>dom <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">b</span><span class="main">;</span> dom<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> dom<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">∩</span> dom<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DomInterAllowsMT"><span class="command">lemma</span></span> DomInterAllowsMT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" twoNetsDistinct <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp<span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom<span class="main">(</span>Cp<span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">po</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> domTrans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domComm aux26 tNDComm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_eqI<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DomInterAllowsMT_Ports"><span class="command">lemma</span></span> DomInterAllowsMT_Ports<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">po</span> <span class="main">⟹</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> twoNetsDistinct_def netsDistinct_def PLemmas<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_eqI<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-wellformed_policy3_charn"><span class="command">lemma</span></span> wellformed_policy3_charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> distinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> 
   wellformed_policy1 <span class="free">p</span> <span class="main">⟶</span> wellformed_policy2Pr <span class="free">p</span>  <span class="main">⟶</span> wellformed_policy3Pr <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> singleCombinatorsConc ANDConc waux2 wp2Conc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b c d r 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DomInterAllowsMT aux7aa DomInterAllowsMT_Ports<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0 <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-DistinctNetsDenyAllow"><span class="command">lemma</span></span> DistinctNetsDenyAllow<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">b</span> <span class="free">c</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>
  dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟹</span>
  <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute ND0aux1 ND0aux3 NDComm aux26 twoNetsDistinct_def ND0aux2 ND0aux4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-DistinctNetsAllowAllow"><span class="command">lemma</span></span> DistinctNetsAllowAllow<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">b</span> <span class="free">c</span> <span class="free">poo</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> 
  allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> dom<span class="main">(</span>Cp<span class="main">(</span>AllowPortFromTo <span class="free">b</span> <span class="free">c</span> <span class="free">poo</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom<span class="main">(</span>Cp<span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> 
  <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">poo</span> <span class="main">=</span> <span class="free">po</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DomInterAllowsMT DomInterAllowsMT_Ports ND0aux3 ND0aux4 NDComm  twoNetsDistinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-WP2RS2"><span class="command">lemma</span></span> WP2RS2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy2Pr <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> wp_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy2Pr <span class="main">(</span>removeShadowRules2 <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons ANDConc distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singleCombinatorsConc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> wp_xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> wp_xs Cons  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> DenyAllFromTo aux aux7 tNDComm deny_dom<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span>  wp_xs 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> aux26 AllowPortFromTo Cons<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> aux aux7a tNDComm<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singleCombinators.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-AD_aux"><span class="command">lemma</span></span> AD_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> DenyAllFromTo <span class="free">c</span> <span class="free">d</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> 
   allNetsDistinct  <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">⟹</span>
   dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aux26<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main">)</span> <span class="operator">auto</span> 
    
<span class="keyword1" id="NormalisationIPPProofs-sorted_WP2"><span class="command">lemma</span></span> sorted_WP2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sorted <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> distinct <span class="free">p</span> <span class="main">⟶</span> allNetsDistinct <span class="free">p</span> <span class="main">⟶</span> singleCombinators <span class="free">p</span> <span class="main">⟶</span> 
   wellformed_policy2Pr <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span>  Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span>  Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI conjI allI impI deny_dom<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> aux7 tNDComm ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> <span class="quoted">"aa"</span> <span class="quoted">"b"</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aux26<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> aa b
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="skolem">aa</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tND<span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"smaller <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">(</span>DenyAllFromTo <span class="skolem">aa</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">l</span>"</span></span><span class="main">)</span> 	
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> sorted_is_smaller<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bothNet.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> in_set_in_list<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> aux7 tNDComm ANDConc singleCombinatorsConc sortedConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-wellformed2_sorted"><span class="command">lemma</span></span> wellformed2_sorted<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy2Pr <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_sort set_sort sorted_WP2 SC3 aND_sort all_in_listSubset order_refl sort_is_sorted<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-wellformed2_sortedQ"><span class="command">lemma</span></span> wellformed2_sortedQ<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy2Pr <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sorted_WP2 SC3Q aND_sortQ all_in_listSubset distinct_sortQ set_sortQ sort_is_sortedQ subsetI<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_DenyAll"><span class="command">lemma</span></span> C_DenyAll<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAll<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS1n"><span class="command">lemma</span></span> C_eq_RS1n<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules1_alternative <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rSR1_eq removeShadowRules1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rSR1_eq removeShadowRules1.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removeShadowRules1_alternative_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> snoc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> xa<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> DenyAll"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"removeShadowRules1_alternative <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
          s <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>removeShadowRules1_alternative <span class="skolem">xs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> RS1n_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS1"><span class="command">lemma</span></span> C_eq_RS1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules1 <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rSR1_eq C_eq_RS1n<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-EX_MR_aux"><span class="command">lemma</span></span> EX_MR_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>DenyAll <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> Some DenyAll <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
    
<span class="keyword1" id="NormalisationIPPProofs-EX_MR"><span class="command">lemma</span></span> EX_MR <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">(</span>Some DenyAll<span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="free">ps</span> <span class="main">⟹</span> 
   <span class="main">(</span>applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>DenyAll<span class="main">#</span><span class="free">ps</span><span class="main">)</span> <span class="main">≠</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mrConcEnd<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAimpliesMR_E list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_in_set list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_Some_eq<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-mr_not_DA"><span class="command">lemma</span></span> mr_not_DA<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">s</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">ab</span><span class="main">)</span> <span class="main">⟹</span>
    set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span> <span class="main">≠</span> Some DenyAll"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> wp1n_tl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Combinators.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> foo98          
      mrSet mr_in_dom WP1n_DA_notinSet set_ConsD wp1n_tl<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-domsMT_notND_DD"><span class="command">lemma</span></span> domsMT_notND_DD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps aux6 twoNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domsMT_notND_DD2"><span class="command">lemma</span></span> domsMT_notND_DD2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps aux6 twoNetsDistinct_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domsMT_notND_DD3"><span class="command">lemma</span></span> domsMT_notND_DD3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> domsMT_notND_DD<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domsMT_notND_DD4"><span class="command">lemma</span></span> domsMT_notND_DD4<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> netsDistinct <span class="free">b</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> domsMT_notND_DD2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-NetsEq_if_sameP_DD"><span class="command">lemma</span></span> NetsEq_if_sameP_DD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> <span class="free">u</span><span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> allNetsDistinct_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main">(</span><span class="operator">metis</span> allNetsDistinct_def ND0aux1 ND0aux2 domsMT_notND_DD3 domsMT_notND_DD4 <span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-rule_charn1"><span class="command">lemma</span></span> rule_charn1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> aND         <span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     mr_is_allow <span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     SC          <span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     inp         <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     inDom       <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAll<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAll<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo NormalisationIPPProofs.AD_aux NormalisationIPPProofs.mrSet 
        NormalisationIPPProofs.mr_in_dom SC aND domInterMT inDom inp mr_is_allow<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> AllowPortFromTo NormalisationIPPProofs.DistinctNetsAllowAllow 
        NormalisationIPPProofs.mrSet NormalisationIPPProofs.mr_in_dom aND domInterMT inDom 
        inp mr_is_allow<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aux0_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-none_MT_rulessubset"><span class="command">lemma</span></span> none_MT_rulessubset<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">a</span> <span class="main">⟶</span> set <span class="free">b</span> <span class="main">⊆</span> set <span class="free">a</span> <span class="main">⟶</span> none_MT_rules Cp <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> notMTnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-nMTSort"><span class="command">lemma</span></span> nMTSort<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">p</span> <span class="main">⟹</span> none_MT_rules Cp <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sort nMTeqSet<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-nMTSortQ"><span class="command">lemma</span></span> nMTSortQ<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">p</span> <span class="main">⟹</span> none_MT_rules Cp <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_sortQ nMTeqSet<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-wp3char"><span class="command">lemma</span></span> wp3char<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">xs</span> <span class="main">∧</span>  Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span> <span class="main">=</span> Map.empty <span class="main">∧</span> 
                            wellformed_policy3Pr <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> 
                             AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> domNMT wp3Conc<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-wp3charn"><span class="command">lemma</span></span> wp3charn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> domAllow<span class="main">:</span>     <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     wp3<span class="main">:</span>          <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> allowNotInList<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wp3Conc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DenyAllowDisj domAllow<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-rule_charn2"><span class="command">lemma</span></span> rule_charn2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> aND<span class="main">:</span>        <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp1<span class="main">:</span>            <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> SC<span class="main">:</span>             <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wp3<span class="main">:</span>            <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> allow_in_list<span class="main">:</span>  <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> x_in_dom_allow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>               <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="skolem">ys</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="free">c</span> <span class="free">d</span> <span class="free">po</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd SCConcEnd WP1ConcEnd foo25<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inSet_not_MT<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DenyAll snoc    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAnotTL DenyAll inSet_not_MT policy2list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domInterMT  wp3EndMT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd DenyAllFromTo SCConcEnd WP1ConcEnd foo25<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domInterMT  wp3EndMT<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ANDConcEnd AllowPortFromTo SCConcEnd WP1ConcEnd foo25 x_in_dom_allow<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Conc snoc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc aux0_0 in_set_conv_decomp<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-rule_charn3"><span class="command">lemma</span></span> rule_charn3<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
  wellformed_policy3Pr <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟹</span> 
  AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NormalisationIPPProofs.rule_charn2 domI<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-rule_charn4"><span class="command">lemma</span></span> rule_charn4<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wp1<span class="main">:</span>    <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     aND<span class="main">:</span>    <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     SC<span class="main">:</span>     <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp3<span class="main">:</span>    <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="free">p</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span>     DA<span class="main">:</span>     <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>     mr<span class="main">:</span>     <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     rinp<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     xindom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DenyAll assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
        u <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="skolem">c</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> NetsEq_if_sameP_DD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> mrSet<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> mr_in_dom<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp  <span class="main">(</span>AllowPortFromTo <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rule_charn3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCnotConc<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Conc aux0_0<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-foo31a"><span class="command">lemma</span></span> foo31a<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="bound">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="bound">r</span> <span class="main">=</span> DenyAll<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span>  <span class="free">r</span> <span class="main">∈</span> set <span class="free">s</span>  <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="free">r</span> <span class="main">=</span> AllowPortFromTo <span class="free">a</span> <span class="free">b</span> <span class="free">po</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">r</span> <span class="main">=</span> DenyAll<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIPPProofs-aux4"><span class="command">lemma</span></span> aux4<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">⟶</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-mrDA_tl"><span class="command">lemma</span></span> mrDA_tl<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> mr_DA<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp1n<span class="main">:</span>  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>          <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> aux4 <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">DenyAll</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wp1n_tl mr_DA wp1n<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet wp1n<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-rule_charnDAFT"><span class="command">lemma</span></span> rule_charnDAFT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy3Pr <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">r</span> <span class="main">=</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ANDConc Combinators.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NormalisationIPPProofs.mrConcEnd 
      NormalisationIPPProofs.rule_charn4 NormalisationIPPProofs.wp3Conc WP1n_DA_notinSet 
      singleCombinatorsConc waux2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> wp1n_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIPPProofs-mrDenyAll_is_unique"><span class="command">lemma</span></span> mrDenyAll_is_unique<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"DenyAll"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">p</span>"</span></span>  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> foo3a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wp1n_tl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span>  C_eq_Sets_mr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sets_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     SC<span class="main">:</span>      <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp1_p<span class="main">:</span>   <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp1_s<span class="main">:</span>   <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wp3_p<span class="main">:</span>   <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="free">p</span>"</span></span>       
    <span class="keyword2"><span class="keyword">and</span></span>     wp3_s<span class="main">:</span>   <span class="quoted"><span class="quoted">"wellformed_policy3Pr <span class="free">s</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span>     aND<span class="main">:</span>     <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">p</span>"</span></span>          
  <span class="keyword2"><span class="keyword">shows</span></span>            <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> None 
  <span class="keyword1"><span class="command">have</span></span> DA<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wp1_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_aux1aa<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> notDA<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> None <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DAimplieMR<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">contradiction</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_p wp1n_tl<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> DenyAll<span class="main">#</span><span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_s wp1n_tl<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tl_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> WP1n_DA_notinSet sets_eq foo2
          wellformed_policy1_charn wp1_aux1aa wp1_eq wp1_p wp1_s<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">case</span></span> DenyAll
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_DenyAll<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some DenyAll"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DenyAll Some<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> x_notin_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wp1_p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mrDenyAll_is_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> x_notin_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tl_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_DenyAll<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some DenyAll"</span></span> <span class="keyword1"><span class="command">using</span></span> tl_s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mr_first<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_DenyAll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DenyAllFromTo Some<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> DA_notin_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WP1n_DA_notinSet wp1_p<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> mr_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Combinators.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> DenyAllFromTo Some mrConcEnd tl_p<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> dom_tl_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> 
                        <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wp1_p aND SC wp3_p mr_p_is_DAFT
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rule_charnDAFT<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> dom_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> 
                         <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tl_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> DAFT_in_tl_s<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mr_tl_p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo mrSet mr_p_is_DAFT tl_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_dom_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_p_is_DAFT DenyAllFromTo mr_in_dom<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_tl_s_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>tl <span class="free">s</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DAFT_in_tl_s dom_tl_s  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_charn<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_DAFT<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tl_s
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  DA_notin_tl DenyAllFromTo EX_MR mrDA_tl 
            not_Some_eq tl_eq wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_DAFT <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> wp1s<span class="main">:</span> <span class="quoted"><span class="quoted">"wellformed_policy1 <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wp1_eq wp1_s<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> mr_p_is_A<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AllowPortFromTo Some<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> A_in_s<span class="main">:</span> <span class="quoted"><span class="quoted">"AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∈</span> set <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sets_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mrSet<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> x_in_dom_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mr_p_is_A AllowPortFromTo mr_in_dom<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> SCs<span class="main">:</span> <span class="quoted"><span class="quoted">"singleCombinators <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SC sets_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SCSubset<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ANDs<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aND sets_eq SC
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> aNDSetsEq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> mr_s_is_A<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="free">s</span> <span class="main">=</span> Some <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A_in_s wp1s mr_p_is_A aND SCs wp3_s x_in_dom_A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rule_charn2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mr_p_is_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Some mr_not_Conc SC<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_Sets"><span class="command">lemma</span></span> C_eq_Sets<span class="main">:</span> 
<span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">s</span> <span class="main">⟹</span>
 wellformed_policy3Pr <span class="free">p</span> <span class="main">⟹</span> wellformed_policy3Pr <span class="free">s</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">=</span> set <span class="free">s</span> <span class="main">⟹</span>
 Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>  <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">s</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_Sets_mr C_eq_if_mr_eq  wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_sorted"><span class="command">lemma</span></span> C_eq_sorted<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span>
   wellformed_policy1_strong <span class="free">p</span><span class="main">⟹</span> wellformed_policy3Pr <span class="free">p</span><span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>sort <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="main">(</span><span class="operator">meson</span> distinct_sort set_sort C_eq_Sets wellformed2_sorted wellformed_policy3_charn SC3 aND_sort 
      wellformed1_alternative_sorted wp1_eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_sortedQ"><span class="command">lemma</span></span> C_eq_sortedQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span>  wellformed_policy3Pr <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span>
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> C_eq_Sets wellformed2_sortedQ wellformed_policy3_charn SC3Q aND_sortQ distinct_sortQ 
      set_sortQ wellformed1_sorted_auxQ wellformed_eq wp1_aux1aa<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS2_mr"><span class="command">lemma</span></span> C_eq_RS2_mr<span class="main">:</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span><span class="main">=</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons DenyAll mreq_end2<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons DenyAllFromTo mreq_end2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo Cons
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"applied_rule_rev Cp <span class="free">x</span> <span class="skolem">ys</span> <span class="main">=</span> None"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mrconcNone<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> applied_rule_rev_def <span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> allow_deny_dom<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> mrNoneMT<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo mrconc<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False Cons AllowPortFromTo
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> AllowPortFromTo Cons mreq_end2<span class="main">)</span> <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons mreq_end2 removeShadowRules2.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_None"><span class="command">lemma</span></span> C_eq_None<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> applied_rule_rev Cp <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> None <span class="main">⟶</span>  Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> applied_rule_rev_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">xa</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> snoc.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStart2 option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil domIff l2p_aux2 option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>    
  
<span class="keyword1" id="NormalisationIPPProofs-C_eq_None2"><span class="command">lemma</span></span> C_eq_None2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>  applied_rule_rev Cp <span class="free">x</span> <span class="free">a</span> <span class="main">=</span> None  <span class="main">⟹</span>  applied_rule_rev Cp <span class="free">x</span> <span class="free">b</span> <span class="main">=</span> None <span class="main">⟹</span>
  <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_eq_None<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS2"><span class="command">lemma</span></span> C_eq_RS2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> 
  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RS2_mr C_eq_if_mr_eq RS2_NMT wp1_alternative_not_mt<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-none_MT_rulesRS2"><span class="command">lemma</span></span> none_MT_rulesRS2<span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">p</span> <span class="main">⟹</span> none_MT_rules Cp <span class="main">(</span>removeShadowRules2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RS2Set none_MT_rulessubset<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-CconcNone"><span class="command">lemma</span></span> CconcNone<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 list2FWpolicyconc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_add_dom_app_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inSet_not_MT list2FWpolicyconc set_empty2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-none_MT_rulesrd"><span class="command">lemma</span></span> none_MT_rulesrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">p</span> <span class="main">⟶</span> none_MT_rules Cp <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DARS3"><span class="command">lemma</span></span> DARS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"DenyAll <span class="main">∉</span> set <span class="free">p</span><span class="main">⟶</span>DenyAll <span class="main">∉</span> set <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DAnMT"><span class="command">lemma</span></span> DAnMT<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp DenyAll<span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps PolicyCombinators.PolicyCombinators<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-DAnMT2"><span class="command">lemma</span></span> DAnMT2<span class="main">:</span> <span class="quoted"><span class="quoted">"Cp DenyAll <span class="main">≠</span> Map.empty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DAAux dom_eq_empty_conv empty_iff<span class="main">)</span> 

<span class="keyword1" id="NormalisationIPPProofs-wp1n_RS3"><span class="command">lemma</span></span> wp1n_RS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟶</span>  wellformed_policy1_strong <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DAnMT<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DARS3<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-AILRS3"><span class="command">lemma</span></span> AILRS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟶</span> all_in_list <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-SCRS3"><span class="command">lemma</span></span> SCRS3<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟶</span> singleCombinators<span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-RS3subset"><span class="command">lemma</span></span> RS3subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span>  <span class="main">⊆</span> set <span class="free">p</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-ANDRS3"><span class="command">lemma</span></span> ANDRS3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"singleCombinators <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="free">p</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> aNDSubset<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>RS3subset<span class="main">)</span>
  
<span class="keyword1" id="NormalisationIPPProofs-nlpaux"><span class="command">lemma</span></span> nlpaux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> Cp <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_add_dom_app_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-notindom"><span class="command">lemma</span></span> notindom<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>  <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> conjI impI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 List.set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> domIff insert_absorb list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicyconc set_empty<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>      

<span class="keyword1" id="NormalisationIPPProofs-C_eq_rd"><span class="command">lemma</span></span> C_eq_rd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 nlpaux notindom domIff l2p_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cdom2 nlpaux domIff l2p_aux remDupsNMT<span class="main">)</span>   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-nMT_domMT"><span class="command">lemma</span></span> nMT_domMT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> not_MT Cp  <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CconcNone domIff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
            
<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS3_aux"><span class="command">lemma</span></span> C_eq_RS3_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"not_MT Cp  <span class="free">p</span> <span class="main">⟹</span>  Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"not_MT Cp  <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CconcNone True not_MTimpnotMT<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules Cp <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Cons_eq_appendI NMPrm CeqEnd append_Nil not_MTimpnotMT<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domIff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span>  dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules Cp <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> l2p_aux l2p_aux2 nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domIff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons False
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons False <span class="quoted"><span class="quoted">‹<span class="main">¬</span> not_MT Cp <span class="skolem">ys</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"rm_MT_rules Cp <span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> l2p_aux nlpaux<span class="main">)</span>    
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> nMT_domMT<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SR3nMT<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>       

<span class="keyword1" id="NormalisationIPPProofs-C_eq_id"><span class="command">lemma</span></span> C_eq_id<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wellformed_policy1_strong <span class="free">p</span> <span class="main">⟹</span> Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> insertDeny.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wp1n_tl<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_RS3"><span class="command">lemma</span></span> C_eq_RS3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"not_MT Cp  <span class="free">p</span> <span class="main">⟹</span>  Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>rm_MT_rules Cp <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> C_eq_RS3_aux<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-NMPrd"><span class="command">lemma</span></span> NMPrd<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"not_MT Cp  <span class="free">p</span> <span class="main">⟶</span> not_MT Cp  <span class="main">(</span>remdups <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> NMPcharn<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-NMPDA"><span class="command">lemma</span></span> NMPDA<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span> not_MT Cp  <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAnMT<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-NMPiD"><span class="command">lemma</span></span> NMPiD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"not_MT Cp  <span class="main">(</span>insertDeny <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> DAiniD <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> NMPDA<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-list2FWpolicy2list"><span class="command">lemma</span></span> list2FWpolicy2list<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 CeqEnd domIff p2lNmt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CeqStart domIff p2lNmt nlpaux<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemmas</span></span> C_eq_Lemmas <span class="main">=</span> none_MT_rulesRS2 none_MT_rulesrd  SCp2l wp1n_RS2  wp1ID NMPiD waux2
                     wp1alternative_RS1 p2lNmt list2FWpolicy2list wellformed_policy3_charn  wp1_eq

<span class="keyword1"><span class="command">lemmas</span></span> C_eq_subst_Lemmas <span class="main">=</span> C_eq_sorted C_eq_sortedQ C_eq_RS2 C_eq_rd C_eq_RS3 C_eq_id 

<span class="keyword1" id="NormalisationIPPProofs-C_eq_All_untilSorted"><span class="command">lemma</span></span> C_eq_All_untilSorted<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>sort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny 
                           <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_sorted<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_rd<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_id<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_All_untilSortedQ"><span class="command">lemma</span></span> C_eq_All_untilSortedQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span> set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
    Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>qsort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny 
                            <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_sortedQ<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_rd<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RS3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_id<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_All_untilSorted_withSimps"><span class="command">lemma</span></span> C_eq_All_untilSorted_withSimps<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>  all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
 allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
 Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span>sort<span class="main">(</span>removeShadowRules2<span class="main">(</span>remdups<span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny
                      <span class="main">(</span>removeShadowRules1<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
 Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas C_eq_subst_Lemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_All_untilSorted_withSimpsQ"><span class="command">lemma</span></span> C_eq_All_untilSorted_withSimpsQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>  all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
 allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
 Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span>qsort<span class="main">(</span>removeShadowRules2<span class="main">(</span>remdups<span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny
                       <span class="main">(</span>removeShadowRules1  <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
 Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_Lemmas C_eq_subst_Lemmas<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-InDomConc"><span class="command">lemma</span></span> InDomConc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                               <span class="free">x</span> <span class="main">∈</span>  dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a p
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-not_in_member"><span class="command">lemma</span></span> not_in_member<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"member <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-src_in_sdnets"><span class="command">lemma</span></span> src_in_sdnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> subnetsOfAdr <span class="main">(</span>src <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>fst_set <span class="main">(</span>sdnets <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_set_def subnetsOfAdr_def PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">x2</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subnetAux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-dest_in_sdnets"><span class="command">lemma</span></span> dest_in_sdnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> subnetsOfAdr <span class="main">(</span>dest <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>snd_set <span class="main">(</span>sdnets <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_set_def subnetsOfAdr_def PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x1 x2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">x2</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subnetAux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-sdnets_in_subnets"><span class="command">lemma</span></span> sdnets_in_subnets<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> member DenyAll <span class="free">x</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>sdnets <span class="free">x</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span>src <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> subnetsOfAdr <span class="main">(</span>dest <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Combinators.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas subnetsOfAdr_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x1 x2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas subnetsOfAdr_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-disjSD_no_p_in_both"><span class="command">lemma</span></span> disjSD_no_p_in_both<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>   
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>disjSD_2 <span class="free">x</span> <span class="free">y</span><span class="main">;</span> <span class="main">¬</span> member DenyAll <span class="free">x</span><span class="main">;</span> <span class="main">¬</span> member DenyAll <span class="free">y</span><span class="main">;</span>  
   <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">x</span><span class="main">)</span><span class="main">;</span> <span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sdnets <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sdnets <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> D <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"src <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> F <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"dest <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> tndFalse<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dest_in_sdnets src_in_sdnets sdnets_in_subnets disjSD_2_def<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-list2FWpolicy_eq"><span class="command">lemma</span></span> list2FWpolicy_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">zs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Cp <span class="main">(</span><span class="free">x</span> <span class="main">⊕</span> list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ConcAssoc l2p_aux list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-dom_sep"><span class="command">lemma</span></span> dom_sep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> mp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA domIff l2p_aux2 list2FWpolicyconc not_Cons_self <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 domIff l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span><span class="main">#</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> InDomConc sepnMT list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span><span class="main">#</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA domIff  l2p_aux2 list2FWpolicyconc not_Cons_self <span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 InDomConc domIff l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_def Cp.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc_not_MT InDomConc sepnMT<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domIff nlpaux<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">⊕</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartA ConcAssoc domIff list2FWpolicy2list list2FWpolicyconc p2lNmt<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="main">(</span><span class="skolem">v</span> <span class="main">⊕</span> <span class="skolem">va</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps dom_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> InDomConc list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>sepnMT<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 ConcAssoc domIff<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> InDomConc domIff l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domIff nlpaux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-domdConcStart"><span class="command">lemma</span></span> domdConcStart<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-sep_dom2_aux"><span class="command">lemma</span></span> sep_dom2_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicy_eq p2lNmt<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-sep_dom2_aux2"><span class="command">lemma</span></span> sep_dom2_aux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">#</span> separate <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">y</span> <span class="main">#</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA InDomConc domdConcStart list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicy.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list2FWpolicyconc<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-sep_dom2"><span class="command">lemma</span></span> sep_dom2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> separate.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_dom2_aux sep_dom2_aux2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-sepDom"><span class="command">lemma</span></span> sepDom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> dom_sep<span class="main"><span class="keyword3">|</span></span><span class="operator">erule</span> sep_dom2<span class="main">)</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_s_ext"><span class="command">lemma</span></span> C_eq_s_ext<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span>  <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">a</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 list2FWpolicyconc sepDom sepnMT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sepDom<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nlpaux sepDom list2FWpolicyconc sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> UPFDefs<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list2FWpolicyconc sepnMT<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Conc_not_MT Cdom2 list2FWpolicy_eq nlpaux sepDom l2p_aux sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">vb</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> UPFDefs<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list2FWpolicyconc sepnMT<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Conc_not_MT Cdom2  nlpaux domIff l2p_aux sepnMT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">v</span> <span class="skolem">va</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> UPFDefs<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> l2p_aux sepnMT<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ConcAssoc PLemmas<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> UPFDefs<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        list2FWpolicyconc sepnMT<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_s"><span class="command">lemma</span></span> C_eq_s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_s_ext<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> sortnMTQ <span class="main">=</span> NormalisationIntegerPortProof.C_eq_Lemmas_sep<span class="main">(</span>14<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> C_eq_Lemmas_sep <span class="main">=</span> C_eq_Lemmas sortnMT sortnMTQ RS2_NMT NMPrd not_MTimpnotMT 

<span class="keyword1" id="NormalisationIPPProofs-C_eq_until_separated"><span class="command">lemma</span></span> C_eq_until_separated<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
 Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>separate <span class="main">(</span>sort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp
            <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
 Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_All_untilSorted_withSimps C_eq_s wellformed1_alternative_sorted wp1ID wp1n_RS2<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_until_separatedQ"><span class="command">lemma</span></span> C_eq_until_separatedQ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>
   allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
     Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span>separate<span class="main">(</span>qsort<span class="main">(</span>
           removeShadowRules2<span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp
                 <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
     Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_All_untilSorted_withSimpsQ C_eq_s setnMT wp1ID wp1n_RS2<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-domID"><span class="command">lemma</span></span> domID<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>Cp<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp<span class="main">(</span>list2FWpolicy<span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps dom_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom<span class="main">(</span>Cp<span class="main">(</span>list2FWpolicy <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> InDomConc idNMT<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>               
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">src</span> <span class="skolem">dest</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>  
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">src</span> <span class="skolem">dest</span> <span class="skolem">port</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc _ _<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main">(</span><span class="operator">rule</span> InDomConc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">src</span> <span class="skolem">dest</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> domIff CConcStartA list2FWpolicyconc nlpaux Cdom2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">src</span> <span class="skolem">dest</span> <span class="skolem">port</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> domIff CConcStartA list2FWpolicyconc nlpaux Cdom2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc _ _<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Cdom2 Conc<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> ConcAssoc domIff domdConcStart<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-DA_is_deny"><span class="command">lemma</span></span> DA_is_deny<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">b</span> <span class="free">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">⊕</span>DenyAllFromTo <span class="free">b</span> <span class="free">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-iDdomAux"><span class="command">lemma</span></span> iDdomAux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> DenyAllFromTo Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DA_is_deny<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo InDomConc <span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo  idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span>
                                    DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                Cp <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DA_is_deny DenyAllFromTo domdConcStart<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAllFromTo l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons AllowPortFromTo
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo InDomConc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo Cdom2 idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span>
                                                    DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span> 
                                                    AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                 Cp <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo CConcStartA ConcAssoc idNMT list2FWpolicyconc nlpaux<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> 
                                             DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 Conc Cons InDomConc idNMT list2FWpolicyconc<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> 
                                                   DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">⊕</span> 
                                                   <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">#</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                                 Cp <span class="main">(</span><span class="main">(</span>DenyAllFromTo<span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span>  <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span>
                                      DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_srcNet  <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp<span class="main">(</span><span class="main">(</span>DenyAllFromTo<span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> 
                                     DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">⊕</span> <span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> 
                                 Cp<span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span><span class="main">⊕</span> 
                                     DenyAllFromTo <span class="main">(</span>first_destNet <span class="skolem">a</span><span class="main">)</span>  <span class="main">(</span>first_srcNet <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> "</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 1 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> CConcStartA Conc ConcAssoc nlpaux<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>         

<span class="keyword1" id="NormalisationIPPProofs-iD_isD"><span class="command">lemma</span></span> iD_isD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
   Cp <span class="main">(</span>DenyAll <span class="main">⊕</span> list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp DenyAll <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cdom2 iDdomAux deny_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> NormalisationIPPProofs.nlpaux 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="NormalisationIPPProofs-inDomConc"><span class="command">lemma</span></span> inDomConc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span>dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∉</span>dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domdConcStart<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-domsdisj"><span class="command">lemma</span></span> domsdisj<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>  <span class="bound">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="free">y</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_tupled_all<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps inDomConc list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-isSepaux"><span class="command">lemma</span></span> isSepaux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> noDenyAll <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> separated <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>  <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span>
                DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span>  <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> A <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet  <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span>
                      DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet  <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> domsdisj<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xa s
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> p <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x <span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>DenyAllFromTo <span class="main">(</span>first_srcNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span>
                               DenyAllFromTo <span class="main">(</span>first_destNet <span class="free">a</span><span class="main">)</span> <span class="main">(</span>first_srcNet  <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> disjSD_no_p_in_both<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> disjSD2aux noDA <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> noDA 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-none_MT_rulessep"><span class="command">lemma</span></span> none_MT_rulessep<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"none_MT_rules Cp <span class="free">p</span> <span class="main">⟶</span> none_MT_rules Cp <span class="main">(</span>separate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> separate.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps map_add_le_mapE map_le_antisym<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-dom_id"><span class="command">lemma</span></span> dom_id<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> separated <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span>
   <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> isSepaux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> idNMT <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> noDAID <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> id_aux4 noDA1eq sepNetsID <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NormalisationIPPProofs.Cdom2 domIff<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_iD_aux2"><span class="command">lemma</span></span> C_eq_iD_aux2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> separated <span class="free">p</span><span class="main">⟶</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>
  Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp<span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> DenyAll <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons DenyAll <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 domID idNMT list2FWpolicyconc noDA1eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> DenyAll iD_isD idNMT list2FWpolicyconc nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc DenyAllFromTo<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> noDA1eq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo idNMT list2FWpolicyconc<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domID<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">⊕</span> DenyAllFromTo <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">⊕</span>
                          DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">#</span> insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Some <span class="main">(</span>deny <span class="main">()</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
                           Cp <span class="main">(</span><span class="main">(</span>DenyAllFromTo <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicyconc nlpaux<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo iD_isD iDdomAux idNMT list2FWpolicyconc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 DenyAllFromTo domIff idNMT list2FWpolicyconc nlpaux<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> AllowPortFromTo Cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">|</span></span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc AllowPortFromTo<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> noDA1eq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 AllowPortFromTo idNMT list2FWpolicyconc<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domID<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>AllowPortFromTo <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo Cdom2 ConcAssoc l2p_aux2 list2FWpolicyconc nlpaux<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Combinators.distinct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> NormalisationIPPProofs.dom_id noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> AllowPortFromTo domdConcStart<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Conc <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons Conc  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> impI allI conjI<span class="main"><span class="keyword3">|</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 ConcAssoc Conc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> mp<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> noDA1eq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> idNMT<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domID<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 Conc idNMT list2FWpolicyconc<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 Conc domIff idNMT list2FWpolicyconc <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span><span class="skolem">a</span> <span class="main">⊕</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> idNMT<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 Conc ConcAssoc list2FWpolicyconc nlpaux<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> FWNormalisationCore.member.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> NormalisationIPPProofs.dom_id noDenyAll.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> separated.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Conc domdConcStart<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_iD"><span class="command">lemma</span></span> C_eq_iD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"separated <span class="free">p</span> <span class="main">⟹</span> noDenyAll1 <span class="free">p</span> <span class="main">⟹</span> wellformed_policy1_strong <span class="free">p</span>  <span class="main">⟹</span> 
   Cp<span class="main">(</span>list2FWpolicy <span class="main">(</span>insertDenies <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> CConcStartA C_eq_iD_aux2 DAAux wp1_alternative_not_mt wp1n_tl<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-noDAsortQ"><span class="command">lemma</span></span> noDAsortQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="free">p</span> <span class="main">⟶</span> noDenyAll1 <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword3"><span class="command">assume</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> DenyAll"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noDenyAll1<span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟶</span> 
               noDenyAll1<span class="main">(</span>qsort<span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">list</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">a</span> <span class="bound">y</span> <span class="free">l</span><span class="main">]</span> <span class="free">l</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">list</span> <span class="main">.</span> smaller <span class="skolem">a</span> <span class="bound">y</span> <span class="free">l</span><span class="main">]</span> <span class="free">l</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> noDAsortQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">assume</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> DenyAll"</span></span>
    <span class="keyword1"><span class="command">have</span></span> ** <span class="main">:</span> <span class="quoted"><span class="quoted">"noDenyAll1 <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟹</span> noDenyAll <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>*<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noDenyAll1<span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟶</span> 
               noDenyAll1<span class="main">(</span>qsort<span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">list</span> <span class="main">.</span> <span class="main">¬</span> smaller <span class="skolem">a</span> <span class="bound">y</span> <span class="free">l</span><span class="main">]</span> <span class="free">l</span> <span class="main">@</span> <span class="skolem">a</span> <span class="main">#</span> qsort <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">list</span> <span class="main">.</span> smaller <span class="skolem">a</span> <span class="bound">y</span> <span class="free">l</span><span class="main">]</span> <span class="free">l</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> noDA1eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> **<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil nDAeqSet qsort.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_sortQ<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-NetsCollectedSortQ"><span class="command">lemma</span></span> NetsCollectedSortQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"distinct <span class="free">p</span> <span class="main">⟹</span>noDenyAll1 <span class="free">p</span> <span class="main">⟹</span> all_in_list <span class="free">p</span> <span class="free">l</span> <span class="main">⟹</span> singleCombinators <span class="free">p</span> <span class="main">⟹</span> 
   NetsCollected <span class="main">(</span>qsort <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> C_eqLemmas_id<span class="main"><span class="main">(</span></span>22<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> CLemmas <span class="main">=</span>  nMTSort nMTSortQ none_MT_rulesRS2 none_MT_rulesrd
                  noDAsort noDAsortQ nDASC wp1_eq  wp1ID    SCp2l ANDSep   wp1n_RS2 
                  OTNSEp OTNSC noDA1sep wp1_alternativesep wellformed_eq 
                  wellformed1_alternative_sorted  

<span class="keyword1"><span class="command">lemmas</span></span> C_eqLemmas_id <span class="main">=</span> CLemmas  NC2Sep NetsCollectedSep 
                       NetsCollectedSort NetsCollectedSortQ separatedNC
<span class="keyword1" id="NormalisationIPPProofs-C_eq_Until_InsertDenies"><span class="command">lemma</span></span> C_eq_Until_InsertDenies<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">⟹</span> 
    Cp <span class="main">(</span>list2FWpolicy<span class="main">(</span><span class="main">(</span>insertDenies<span class="main">(</span>separate<span class="main">(</span>sort<span class="main">(</span>removeShadowRules2 
            <span class="main">(</span>remdups<span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_iD<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eqLemmas_id<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> C_eq_until_separated<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_Until_InsertDeniesQ"><span class="command">lemma</span></span> C_eq_Until_InsertDeniesQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list  <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
   allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
     Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span><span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>qsort  <span class="main">(</span>removeShadowRules2 
          <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
     Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_iD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eqLemmas_id<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WP1rd set_qsort wellformed1_sortedQ wellformed_eq wp1ID wp1_alternativesep 
      wp1_aux1aa wp1n_RS2 wp1n_RS3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_until_separatedQ<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_RD_aux"><span class="command">lemma</span></span> C_eq_RD_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>removeDuplicates <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cdom2 domIff nlpaux not_in_member<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Cp.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> CConcStartaux Cdom2 domIff<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_RAD_aux"><span class="command">lemma</span></span> C_eq_RAD_aux<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RD_aux<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="main">(</span>list2FWpolicy <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> list2FWpolicyconc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rADnMT<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Cdom2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NormalisationIPPProofs.Cdom2 domIff<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RD_aux nlpaux domIff list2FWpolicyconc rADnMT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_RAD"><span class="command">lemma</span></span> C_eq_RAD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="free">p</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> C_eq_RAD_aux<span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_compile"><span class="command">lemma</span></span> C_eq_compile<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
 allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate 
          <span class="main">(</span>sort <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny 
                   <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_eq_RAD C_eq_Until_InsertDenies removeAllDuplicates.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_compileQ"><span class="command">lemma</span></span> C_eq_compileQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll<span class="main">∈</span>set<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> all_in_list<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span>  allNetsDistinct<span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>removeAllDuplicates <span class="main">(</span>insertDenies <span class="main">(</span>separate <span class="main">(</span>qsort 
                         <span class="main">(</span>removeShadowRules2 <span class="main">(</span>remdups <span class="main">(</span>rm_MT_rules Cp <span class="main">(</span>insertDeny 
                               <span class="main">(</span>removeShadowRules1 <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C_eq_RAD<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> idNMT<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WP1rd sepnMT sortnMTQ wellformed_policy1_strong.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wp1ID wp1n_RS2 wp1n_RS3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> C_eq_Until_InsertDeniesQ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NormalisationIPPProofs-C_eq_normalizePr"><span class="command">lemma</span></span> C_eq_normalizePr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
 all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
 Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizePr <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalizePrQ_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_compile normalizePr_def<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_normalizePrQ"><span class="command">lemma</span></span> C_eq_normalizePrQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
 all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> 
 Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizePrQ <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalizePrQ_def
  <span class="keyword1"><span class="command">using</span></span> C_eq_compileQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="NormalisationIPPProofs-domSubset3"><span class="command">lemma</span></span> domSubset3<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAll <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAll<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas split_tupled_all <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domSubset4"><span class="command">lemma</span></span> domSubset4<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">dn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domSubset5"><span class="command">lemma</span></span> domSubset5<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">y</span> <span class="free">x</span> <span class="free">dn</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">y</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domSubset1"><span class="command">lemma</span></span> domSubset1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">one</span> <span class="free">two</span> <span class="free">dn</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas allow_all_def deny_all_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span>  <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domSubset2"><span class="command">lemma</span></span> domSubset2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">two</span> <span class="free">one</span> <span class="free">dn</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  dom <span class="main">(</span>Cp <span class="main">(</span>DenyAllFromTo <span class="free">one</span> <span class="free">two</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">two</span> <span class="free">one</span> <span class="main">⊕</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas  allow_all_def deny_all_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits decision.splits<span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1" id="NormalisationIPPProofs-ConcAssoc2"><span class="command">lemma</span></span> ConcAssoc2<span class="main">:</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">B</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-ConcAssoc3"><span class="command">lemma</span></span> ConcAssoc3<span class="main">:</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span><span class="free">X</span> <span class="main">⊕</span> <span class="free">Y</span> <span class="main">⊕</span> <span class="free">A</span> <span class="main">⊕</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-RS3_NMT"><span class="command">lemma</span></span> RS3_NMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟶</span>
    rm_MT_rules Cp <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-norm_notMT"><span class="command">lemma</span></span> norm_notMT<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalizePr <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalizePrQ_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS3_NMT RS2_NMT idNMT normalizePr_def rADnMT sepnMT sortnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-norm_notMTQ"><span class="command">lemma</span></span> norm_notMTQ<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalizePrQ <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalizePrQ_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS3_NMT sortnMTQ RS2_NMT idNMT rADnMT sepnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domDA"><span class="command">lemma</span></span> domDA<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span>DenyAll <span class="main">⊕</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAll<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> domSubset3<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemmas</span></span> domain_reasoningPr <span class="main">=</span> domDA ConcAssoc2 domSubset1 domSubset2 
  domSubset3 domSubset4  domSubset5 domSubsetDistr1
  domSubsetDistr2 domSubsetDistrA domSubsetDistrD coerc_assoc ConcAssoc 
  ConcAssoc3
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas help with the normalisation›</span></span>
<span class="keyword1" id="NormalisationIPPProofs-list2policyR_Start"><span class="command">lemma</span></span> list2policyR_Start<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟶</span>
                 Cp <span class="main">(</span>list2policyR <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Cp <span class="free">a</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">#</span> <span class="free">list</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list2policyR.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cp.simps dom_def map_add_def<span class="main">)</span> 
    
<span class="keyword1" id="NormalisationIPPProofs-list2policyR_End"><span class="command">lemma</span></span> list2policyR_End<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∉</span> dom <span class="main">(</span>Cp <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span>
        Cp <span class="main">(</span>list2policyR <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>Cp <span class="free">a</span> <span class="main">⨁</span> list2policy <span class="main">(</span>map Cp <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps dom_def map_add_def list2policy_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-l2polR_eq_el"><span class="command">lemma</span></span> l2polR_eq_el<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
 Cp<span class="main">(</span> list2policyR <span class="free">N</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  <span class="main">(</span>list2policy <span class="main">(</span>map Cp <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> Cons.hyps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list2policy_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list2policyR_End list2policyR_Start domStart list2policy_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-l2polR_eq"><span class="command">lemma</span></span> l2polR_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> Cp<span class="main">(</span> list2policyR <span class="free">N</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>list2policy <span class="main">(</span>map Cp <span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list2policy_def l2polR_eq_el <span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-list2FWpolicys_eq_el"><span class="command">lemma</span></span> list2FWpolicys_eq_el<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span>  Cp <span class="main">(</span>list2policyR <span class="free">Filter</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span>  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Filter</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a list
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dom <span class="main">(</span>Cp <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> list2policyR_Start<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2policyR <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Cp <span class="main">(</span>list2policyR <span class="skolem">list</span><span class="main">)</span> <span class="free">p</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="skolem">list</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="skolem">list</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CConcStart2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">list</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cp.simps dom_def map_add_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="NormalisationIPPProofs-list2FWpolicys_eq"><span class="command">lemma</span></span> list2FWpolicys_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span>
  Cp <span class="main">(</span>list2policyR <span class="free">Filter</span><span class="main">)</span> <span class="main">=</span>  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> list2FWpolicys_eq_el<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-list2FWpolicys_eq_sym"><span class="command">lemma</span></span> list2FWpolicys_eq_sym<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Filter</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟹</span>
  Cp <span class="main">(</span>list2policyR <span class="main">(</span>rev <span class="free">Filter</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  Cp <span class="main">(</span>list2FWpolicy <span class="free">Filter</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list2FWpolicys_eq rev_is_Nil_conv rev_rev_ident<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-p_eq"><span class="command">lemma</span></span> p_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> 
 list2policy <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="main">(</span>list2FWpolicy <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l2polR_eq list2FWpolicys_eq_sym rev.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-p_eq2"><span class="command">lemma</span></span> p_eq2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalizePr <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> 
  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizePr <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span> <span class="main">⟶</span>
 list2policy <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="main">(</span>normalizePr <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-p_eq2Q"><span class="command">lemma</span></span> p_eq2Q<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalizePrQ <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> 
  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalizePrQ <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span> <span class="main">⟶</span>
 list2policy <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="main">(</span>normalizePrQ <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-list2listNMT"><span class="command">lemma</span></span> list2listNMT<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>map <span class="free">sem</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-Norm_Distr2"><span class="command">lemma</span></span> Norm_Distr2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>list2policy <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span>list2policy <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">Q</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="free">r</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Norm_Distr_2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-NATDistr"><span class="command">lemma</span></span> NATDistr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">=</span> Cp <span class="main">(</span>list2policyR <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">F</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> 
   <span class="main">(</span>list2policy <span class="main">(</span>  <span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span>map Cp <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> 
    <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l2polR_eq<span class="main">)</span>  <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> Norm_Distr_2<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_normalize_manual"><span class="command">lemma</span></span> C_eq_normalize_manual<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderPr <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalize_manual_orderPr_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>C_eq_compile<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-p_eq2_manualQ"><span class="command">lemma</span></span> p_eq2_manualQ<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"normalize_manual_orderPrQ <span class="free">x</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> 
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderPrQ <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span> <span class="main">⟶</span>
   list2policy <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="main">(</span>normalize_manual_orderPrQ <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-norm_notMT_manualQ"><span class="command">lemma</span></span> norm_notMT_manualQ<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalize_manual_orderPrQ <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAiniD RS3_NMT sortnMTQ RS2_NMT idNMT normalize_manual_orderPrQ_def rADnMT sepnMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-C_eq_normalizePr_manualQ"><span class="command">lemma</span></span> C_eq_normalizePr_manualQ<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   allNetsDistinct <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span>
   all_in_list <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="free">l</span> <span class="main">⟹</span> 
   Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderPrQ <span class="free">p</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_manual_orderPrQ_def C_eq_compileQ<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-p_eq2_manual"><span class="command">lemma</span></span> p_eq2_manual<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize_manual_orderPr <span class="free">x</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> 
  Cp <span class="main">(</span>list2FWpolicy <span class="main">(</span>normalize_manual_orderPr <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span> <span class="main">⟶</span>
 list2policy <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="main">(</span>normalize_manual_orderPr <span class="free">x</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Cp <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_eq<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-norm_notMT_manual"><span class="command">lemma</span></span> norm_notMT_manual<span class="main">:</span> <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> normalize_manual_orderPr <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> normalize_manual_orderPr_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idNMT rADnMT wellformed1_alternative_sorted wp1ID wp1_alternativesep wp1n_RS2<span class="main">)</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As an example, how this theorems can be used for a concrete normalisation instantiation. 
›</span></span>
  
<span class="keyword1" id="NormalisationIPPProofs-normalizePrNAT"><span class="command">lemma</span></span> normalizePrNAT<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"DenyAll <span class="main">∈</span> set <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span> 
   allNetsDistinct <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span>  
   all_in_list <span class="main">(</span>policy2list <span class="free">Filter</span><span class="main">)</span> <span class="main">(</span>Nets_List <span class="free">Filter</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> Cp <span class="free">Filter</span><span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> 
   list2policy <span class="main">(</span><span class="main">(</span><span class="free">NAT</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span>map Cp <span class="main">(</span>rev <span class="main">(</span>normalizePr <span class="free">Filter</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(⨂<span class="hidden">⇩</span><sub>2</sub>)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_eq_normalizePr NATDistr list2FWpolicys_eq_sym norm_notMT<span class="main">)</span>
    
<span class="keyword1" id="NormalisationIPPProofs-domSimpl"><span class="command">lemma</span></span> domSimpl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>Cp <span class="main">(</span><span class="free">A</span> <span class="main">⊕</span> DenyAll<span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>Cp <span class="main">(</span>DenyAll<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ElementaryRules">
<div class="head">
<h1>Theory ElementaryRules</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Elementary Firewall Policy Transformation Rules›</span></span> 
<span class="keyword1"><span class="command">theory</span></span> 
  ElementaryRules
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#FWNormalisationCore">FWNormalisationCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This theory contains those elementary transformation rules which are presented in the ICST 
  2010 paper~\cite{brucker.ea:firewall:2010}. They are not used elsewhere.
›</span></span>
  
<span class="keyword1" id="ElementaryRules-elem1"><span class="command">lemma</span></span> elem1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span>AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">p</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
    
<span class="keyword1" id="ElementaryRules-elem2"><span class="command">lemma</span></span> elem2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C.simps<span class="main">)</span> 
    
<span class="keyword1" id="ElementaryRules-elem3"><span class="command">lemma</span></span> elem3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span>AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">a</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> 
  C <span class="main">(</span>AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">b</span> <span class="main">⊕</span> AllowPortFromTo <span class="free">x</span> <span class="free">y</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="ElementaryRules-elem4"><span class="command">lemma</span></span> elem4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> DenyAll<span class="main">)</span> <span class="main">=</span> C DenyAll"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
<span class="keyword1" id="ElementaryRules-elem5"><span class="command">lemma</span></span> elem5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"C <span class="main">(</span>DenyAllFromTo <span class="free">x</span> <span class="free">y</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span>DenyAllFromTo <span class="free">u</span> <span class="free">v</span> <span class="main">⊕</span> DenyAllFromTo <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas<span class="main">)</span>
    
    
<span class="keyword1" id="ElementaryRules-elem6"><span class="command">lemma</span></span> elem6<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"dom <span class="main">(</span>C <span class="free">a</span><span class="main">)</span> <span class="main">∩</span> dom <span class="main">(</span>C <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> C <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_add_comm<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FWNormalisation">
<div class="head">
<h1>Theory FWNormalisation</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Firewall Policy Normalisation›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  FWNormalisation
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#NormalisationIPPProofs">NormalisationIPPProofs</a>
    <a href="#ElementaryRules">ElementaryRules</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LTL_alike">
<div class="head">
<h1>Theory LTL_alike</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Termporal Combinators›</span></span>
<span class="keyword1"><span class="command">theory</span></span>
  LTL_alike 
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In the following, we present a small embbeding of temporal combinators, that may help to 
  formulate typical temporal properties in traces and protocols concisely. It is based on 
  \emph{finite} lists, therefore the properties of this logic are not fully compatible with  
  LTL based on Kripke-structures. For the purpose of this demonstration, however, the difference 
  does not matter.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nxt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">N</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">nxt</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">nxt</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Predicate $p$ holds at first position.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">«</span>_<span class="keyword1">»</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">atom</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">atom</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LTL_alike-holds_mono"><span class="command">lemma</span></span> holds_mono <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">always</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">□</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">always</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">always</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">always</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Always is a generalization of the \verb+list_all+ combinator from the List-library; if arguing 
  locally, this paves the way to a wealth of library lemmas. 
›</span></span>
<span class="keyword1" id="LTL_alike-always_is_listall"><span class="command">lemma</span></span> always_is_listall <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> list_all <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eventually</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">♢</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">eventually</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">eventually</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">eventually</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Eventually is a generalization of the \verb+list_ex+ combinator from the List-library; if arguing 
  locally, this paves the way to a wealth of library lemmas. 
›</span></span>
<span class="keyword1" id="LTL_alike-eventually_is_listex"><span class="command">lemma</span></span> eventually_is_listex <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">♢</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> list_ex <span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The next two constants will help us later in defining the state transitions. The constant 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>before›</span></span></span></span> is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>True›</span></span></span></span> if for all elements which appear before the first element 
  for which  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> holds, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> must hold.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">before</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Analogously there is an operator <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>not_before›</span></span></span></span> which returns
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>True›</span></span></span></span> if for all elements which appear before the first
  element for which <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> holds, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> must not hold.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">not_before</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free">not_before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">not_before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">not_before</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LTL_alike-not_before_superfluous"><span class="command">lemma</span></span> not_before_superfluous<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"not_before <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> before <span class="main">(</span>Not <span class="keyword1">o</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹General "before":›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">until</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">U</span>"</span> 66<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">until</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">until</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">s</span> <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This leads to this amazingly tricky proof:›</span></span>
<span class="keyword1" id="LTL_alike-before_vs_until"><span class="command">lemma</span></span> before_vs_until<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>before <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">□</span><span class="main">«</span><span class="free">p</span><span class="main">»</span><span class="main">)</span> <span class="keyword1">U</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">q</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="improper">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">q</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>List.neq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>List.neq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">list</span><span class="main">.</span><span class="main">(</span><span class="free">q</span> <span class="bound">a</span> <span class="main">∨</span> <span class="free">p</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">aa</span> <span class="main">#</span> <span class="bound">list</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">aa</span> <span class="main">#</span> <span class="bound">list</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">#</span> <span class="improper">aa</span> <span class="main">#</span> <span class="improper">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">#</span> <span class="improper">s</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">list</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">a</span> <span class="main">#</span> <span class="bound">aa</span> <span class="main">#</span> <span class="bound">list</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span>
                         <span class="main">⟹</span> <span class="main">(</span><span class="free">q</span> <span class="bound">a</span> <span class="main">∨</span> <span class="free">p</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">aa</span> <span class="main">#</span> <span class="bound">list</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">□</span> <span class="main">«</span><span class="free">p</span><span class="main">»</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">«</span><span class="free">q</span><span class="main">»</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>List.neq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>List.neq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x xs
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> B<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> D<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="StatefulCore">
<div class="head">
<h1>Theory StatefulCore</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stateful Protocols: Foundations›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  StatefulCore 
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="#PacketFilter">../PacketFilter/PacketFilter</a>"</span> 
    <a href="#LTL_alike">LTL_alike</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The simple system of a stateless packet filter is not enough to model all common real-world 
  scenarios. Some protocols need further actions in order to be secured.  A prominent example is 
  the File Transfer Protocol (FTP), which is a popular means to move files across the Internet. 
  It behaves quite differently from most other application layer protocols as it uses a two-way 
  connection establishment which opens a dynamic port. A stateless packet filter would only have 
  the possibility to either always open all the possible dynamic ports or not to allow that 
  protocol at all. Neither of these options is satisfactory. In the first case, all ports above
  1024 would have to be opened which introduces a big security hole in the system, in the second 
  case users wouldn't be very happy. A firewall which tracks the state of the TCP connections on 
  a system does not help here either, as the opening and closing of the ports takes place on the 
  application layer. Therefore, a firewall needs to have some knowledge of the application 
  protocols being run and track the states of these protocols. We next model this behaviour.

  The key point of our model is the idea that a policy remains the same as before: a mapping from 
  packet to packet out. We still specify for every packet, based on its source and destination 
  address, the expected action.  The only thing that changes now is that this mapping is allowed 
  to change over time. This indicates that our test data will not consist of single packets but 
  rather of sequences thereof. 

  At first we hence need a state. It is a tuple from some memory to be refined later and the 
  current policy. 
›</span></span>
  
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWState <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span>"</span></span>  



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Having a state, we need of course some state transitions. Such
  a transition can happen every time a new packet arrives. State
  transitions can be modelled using a state-exception monad.  
›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWStateTransitionP <span class="main">=</span>
             <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> packet <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> packet <span class="main">↦</span> unit<span class="main">)</span> decision<span class="main">,</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWState<span class="main">)</span> MON<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>E</sub>"</span></span>
             
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWStateTransition <span class="main">=</span> 
             <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> packet <span class="main">×</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWState<span class="main">)</span> <span class="main">⇀</span> <span class="main">(</span><span class="tfree">'α</span><span class="main">,</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> FWState"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The memory could be modelled as a list of accepted packets.›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> history <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'β</span><span class="main">,</span><span class="tfree">'γ</span><span class="main">)</span> packet list"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">packet_with_id</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">packet_with_id</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">packet_with_id</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">packet_with_id</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">packet_with_id</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ids1</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ids</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ids</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>NetworkCore.id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">ids</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">ids</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">applyPolicy</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'i</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'i</span> <span class="main">↦</span> <span class="tfree">'o</span><span class="main">)</span><span class="main">)</span> <span class="main">↦</span> <span class="tfree">'o</span>"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">applyPolicy</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FTP">
<div class="head">
<h1>Theory FTP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2017 Université Paris-Sud, France
 *               2015-2017 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The File Transfer Protocol (ftp)›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  FTP
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#StatefulCore">StatefulCore</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The protocol syntax›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The File Transfer Protocol FTP is a well known example of a protocol which uses dynamic ports and
  is therefore a natural choice to use as an example for our model. 

  We model only a simplified version of the FTP protocol over IntegerPort addresses, still 
  containing all messages that matter for our purposes. It consists of the following four messages:
  \begin{enumerate} 
    \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>init›</span></span></span></span>: The client contacts the server indicating
          his wish to get some data.
    \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ftp_port_request p›</span></span></span></span>: The client, usually after having
          received an acknowledgement of the server, indicates a port
          number on which he wants to receive the data.
    \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ftp_ftp_data›</span></span></span></span>: The server sends the requested data over
          the new channel. There might be an arbitrary number of such
          messages, including zero.
      \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ftp_close›</span></span></span></span>: The client closes the connection. The
          dynamic port gets closed again.
  \end{enumerate}

  The content field of a packet therefore now consists of either one of those four messages or a 
  default one.  
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span>  msg <span class="main">=</span> ftp_init  <span class="main">|</span> ftp_port_request <span class="quoted">port</span> <span class="main">|</span> ftp_data <span class="main">|</span> ftp_close <span class="main">|</span> ftp_other

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We now also make use of the ID field of a packet. It is used as session ID and we make the 
  assumption that they are all unique among different protocol runs.

  At first, we need some predicates which check if a packet is a specific FTP message and has the 
  correct session ID. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span>packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">is_init</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_init<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_ftp_port_request</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id  <span class="main">⇒</span> port <span class="main">⇒</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_ftp_port_request</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">port</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_port_request <span class="bound">port</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_ftp_data</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_ftp_data</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_data<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_ftp_close</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_ftp_close</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span>  <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_close<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">port_open</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> history <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">port_open</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">L</span> <span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>not_before <span class="main">(</span>is_ftp_close <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>is_ftp_port_request <span class="bound">a</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">L</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_ftp_other</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg <span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">is_ftp_other</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_other<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">are_ftp_other</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">are_ftp_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_ftp_other <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free">are_ftp_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">are_ftp_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The protocol policy specification›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We now have to model the respective state transitions. It is important to note that state 
  transitions themselves allow all packets which are allowed by the policy, not only those which 
  are allowed by the protocol. Their only task is to change the policy. As an alternative, we could 
  have decided that they only allow packets which follow the protocol (e.g. come on the correct 
  ports), but this should in our view rather be reflected in the policy itself.

  Of course, not every message changes the policy. In such cases, we do not have to model different 
  cases, one is enough. In our example, only messages 2 and 4 need special transitions. The default 
  says that if the policy accepts the packet, it is added to the history, otherwise it is simply 
  dropped. The policy remains the same in both cases.  
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">last_opened_port</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> <span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> undefined"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTP_STA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="comment1">(* FTP_PORT_REQUEST *)</span>
   <span class="quoted"><span class="quoted">"<span class="free">FTP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="keyword1">if</span> before<span class="main">(</span>Not <span class="keyword1">o</span> is_ftp_close <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">(</span>is_init <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">log</span></span></span> <span class="main">∧</span>
           dest_port <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> 
        <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span> 
                   <span class="main">(</span>allow_from_to_port <span class="free"><span class="bound"><span class="entity">pr</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">else</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="comment1">(* FTP_PORT_CLOSURE *)</span> 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span>   <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> port_open <span class="free"><span class="bound"><span class="entity">log</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> dest_port <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> 
        <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span> 
                   deny_from_to_port <span class="main">(</span>last_opened_port <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span>
       <span class="keyword1">else</span>  Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">log</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">pol</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

 <span class="comment1">(* DEFAULT *)</span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTP_STA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span>snd <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span>    <span class="entity">FTP_STD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FTP_STD</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TRPolicy</span> <span class="main">::</span><span class="quoted"><span class="quoted">"    <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span>packet <span class="main">×</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span>history <span class="main">×</span> <span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span>packet <span class="main">↦</span> unit<span class="main">)</span>
                        <span class="main">↦</span> <span class="main">(</span>unit             <span class="main">×</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span>history <span class="main">×</span> <span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span>packet <span class="main">↦</span> unit<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">TRPolicy</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>FTP_STA<span class="main">,</span>FTP_STD<span class="main">)</span> <span class="main">⨂<span class="hidden">⇩</span><sub>∇</sub></span> applyPolicy<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TRPolicy<span class="hidden">⇩</span><sub>M</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub></span>
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">TRPolicy<span class="hidden">⇩</span><sub>M</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> policy2MON<span class="main">(</span>TRPolicy<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If required to contain the policy in the output›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TRPolicy<span class="hidden">⇩</span><sub>M</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub>'</span> 
  <span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">TRPolicy<span class="hidden">⇩</span><sub>M</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub>'</span> <span class="main">=</span> policy2MON <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o_f</span>  TRPolicy <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Now we specify our test scenario in more detail. We could test:
  \begin{itemize}
    \item one correct FTP-Protocol run,
    \item several runs after another,
    \item several runs interleaved,
    \item an illegal protocol run, or
    \item several illegal protocol runs.
  \end{itemize}

  We only do the the simplest case here: one correct protocol run.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  There are four different states which are modelled as a datatype.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> ftp_states <span class="main">=</span> S0 <span class="main">|</span> S1 <span class="main">|</span> S2 <span class="main">|</span> S3

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following constant is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>True›</span></span></span></span> for all sets which are correct FTP runs for a given 
  source and destination address, ID, and data-port number.  
›</span></span>


<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">is_ftp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ftp_states <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>  <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span>
            <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">is_ftp</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>S3<span class="main">)</span>"</span></span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_ftp</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">21</span>  <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">id</span><span class="main">,</span><span class="bound">sr</span><span class="main">,</span><span class="bound">de</span><span class="main">,</span><span class="bound">co</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">id</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="main">(</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>ftp_states.S2 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_init <span class="main">∧</span> <span class="free">is_ftp</span> S3 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>ftp_states.S1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_port_request <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span>  <span class="free">is_ftp</span> S2 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>ftp_states.S1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span><span class="main">=</span> ftp_data <span class="main">∧</span> <span class="free">is_ftp</span> S1 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>ftp_states.S0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_close  <span class="main">∧</span> <span class="free">is_ftp</span> S1 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">is_single_ftp_run</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> src <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> dest <span class="main">⇒</span> id <span class="main">⇒</span> port  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span> history set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>      <span class="quoted"><span class="quoted">"<span class="free">is_single_ftp_run</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>is_ftp S0 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following constant then returns a set of all the historys which denote such a normal 
  behaviour FTP run, again for a given source and destination address, ID, and data-port. 

  The following definition returns the set of all possible interleaving of two correct FTP protocol 
  runs. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">ftp_2_interleaved</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> src <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> dest <span class="main">⇒</span> id <span class="main">⇒</span> port  <span class="main">⇒</span>
               adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> src <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> dest <span class="main">⇒</span> id <span class="main">⇒</span> port  <span class="main">⇒</span>
            <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>msg<span class="main">)</span> history set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ftp_2_interleaved</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>is_ftp S0 <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">(</span>packet_with_id <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span>is_ftp S0 <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">d2</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">(</span>packet_with_id <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="FTP-subnetOf_lemma"><span class="command">lemma</span></span> subnetOf_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">c</span><span class="main">::</span>int<span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>subnet_of <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">::</span>port<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnet_of_int_def<span class="main">)</span>

<span class="keyword1" id="FTP-subnetOf_lemma2"><span class="command">lemma</span></span> subnetOf_lemma2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>subnet_of <span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">,</span> <span class="free">b</span><span class="main">::</span>port<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span>  <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnet_of_int_def<span class="main">)</span>

<span class="keyword1" id="FTP-subnetOf_lemma3"><span class="command">lemma</span></span> subnetOf_lemma3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> subnet_of <span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">,</span> <span class="free">b</span><span class="main">::</span>port<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span>  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnet_of_int_def<span class="main">)</span>

<span class="keyword1" id="FTP-subnetOf_lemma4"><span class="command">lemma</span></span> subnetOf_lemma4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>subnet_of <span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">,</span> <span class="free">b</span><span class="main">::</span>port<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">::</span>port<span class="main">)</span> <span class="main">∈</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnet_of_int_def<span class="main">)</span>

<span class="keyword1" id="FTP-port_open_lemma"><span class="command">lemma</span></span> port_open_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Ex <span class="main">(</span>port_open <span class="main">[]</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>port<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> port_open_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> FTPLemmas <span class="main">=</span>  TRPolicy_def applyPolicy_def policy2MON_def 
                    Let_def in_subnet_def src_def
                    dest_def  subnet_of_int_def 
                    is_init_def p_accept_def port_open_def is_ftp_data_def is_ftp_close_def 
                    is_ftp_port_request_def content_def PortCombinators
                    exI subnetOf_lemma subnetOf_lemma2 subnetOf_lemma3 subnetOf_lemma4 
                    NetworkCore.id_def adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas port_open_lemma
                    bind_SE_def unit_SE_def valid_SE_def
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FTP_WithPolicy">
<div class="head">
<h1>Theory FTP_WithPolicy</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹FTP enriched with a security policy›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  FTP_WithPolicy
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#FTP">FTP</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹FTP where the policy is part of the output.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">POL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>   <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">POL</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Variant 2 takes the policy into the output›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTP_STP</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>id <span class="main">⇀</span> port<span class="main">)</span><span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> msg<span class="main">)</span> FWStateTransitionP"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
<span class="comment1">(* FTP_PORT_REQUEST *)</span>
 <span class="quoted"><span class="quoted">"<span class="free">FTP_STP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> p_accept <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span> <span class="keyword1">then</span>
  Some <span class="main">(</span>allow <span class="main">(</span>POL <span class="main">(</span><span class="main">(</span>allow_from_to_port <span class="free"><span class="bound"><span class="entity">pr</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
 <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">↦</span><span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>allow_from_to_port <span class="free"><span class="bound"><span class="entity">pr</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>       
  <span class="keyword1">else</span> <span class="main">(</span>Some <span class="main">(</span>deny <span class="main">(</span>POL <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* FTP_CLOSE *)</span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTP_STP</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>p_accept <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span> <span class="keyword1">then</span> 
 <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">of</span> 
  Some <span class="bound">pr</span> <span class="main">⇒</span>
       Some<span class="main">(</span>allow <span class="main">(</span>POL <span class="main">(</span>deny_from_to_port <span class="bound">pr</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
        <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">:=</span>None<span class="main">)</span><span class="main">,</span>
        deny_from_to_port <span class="bound">pr</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span>
 <span class="main">|</span>None <span class="main">⇒</span>Some<span class="main">(</span>allow <span class="main">(</span>POL <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span>
       <span class="keyword1">else</span> Some <span class="main">(</span>deny <span class="main">(</span>POL <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ports</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(* DEFAULT *)</span>
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTP_STP</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">if</span> p_accept <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> 
                   <span class="keyword1">then</span> Some <span class="main">(</span>allow <span class="main">(</span>POL <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> 
                   <span class="keyword1">else</span> Some <span class="main">(</span>deny <span class="main">(</span>POL <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="VOIP">
<div class="head">
<h1>Theory VOIP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A simple voice-over-ip model›</span></span>
<span class="keyword1"><span class="command">theory</span></span> VOIP
  <span class="keyword2"><span class="keyword">imports</span></span>  <a href="#StatefulCore">StatefulCore</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

  After the FTP-Protocol which was rather simple we show the strength
  of the model with a more current and especially much more
  complicated example, namely Voice over IP (VoIP). VoIP is
  standardized by the ITU-T under the name H.323, which can be seen as
  an "umbrella standard" which aggregates standards for multimedia
  conferencing over packet-based networks. H.323 poses many problems
  to firewalls. These problems include:
  \begin{itemize}
    \item An H.323 call is made up of many different simultaneous
          connections.
    \item Most connections are made to dynamic ports.
    \item The addresses and port numbers are exchanged within
          the data stream of the next higher connection. 
    \item Calls can be initiated from outside the firewall.
  \end{itemize}

  Again we only consider a simplified VoIP scenario with the following
  seven messages which are grouped into four subprotocols:
  \begin{itemize}
    \item Registration and Admission (H.225, port 1719): The caller
          contacts its gatekeeper with a call request. The gatekeeper
          either rejects or confirms the request, returning the
          address of the callee in the latter case.
  
          \begin{itemize}
            \item Admission Request (ARQ)
            \item Admission Reject (ARJ)
            \item Admission Confirm (ACF) <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span>
          \end{itemize}
    \item Call Signaling (Q.931, port 1720) The caller and the callee 
          agree on the dynamic ports over which the call will take 
          place.  
          \begin{itemize}
            \item Setup <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>port›</span></span></span></span>
            \item Connect <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>port›</span></span></span></span>
          \end{itemize}
    \item Stream (dynamic ports). The call itself. In reality, several 
          connections are used here.
    \item Fin (port 1720).
  \end{itemize}


  The two main differences to FTP are:
  \begin{itemize}
    \item In VoIP, we deal with three different entities: the caller, 
          the callee, and the gatekeeper.
    \item We do not know in advance which entity will close the 
          connection.
  \end{itemize}
  
  We model the protocol as seen from a firewall at the caller, namely
  we are not interested in the messages from the callee to its
  gatekeeper. Incoming calls are not modelled either, they would
  require a different set of state transitions.  
›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The content of a packet now consists of one of the seven messages or
  a default one. It is parameterized with the type of the address that
  the gatekeeper returns.
›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> voip_msg <span class="main">=</span>  ARQ
                     <span class="main">|</span> ACF <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> 
                     <span class="main">|</span> ARJ
                     <span class="main">|</span> Setup <span class="quoted">port</span> 
                     <span class="main">|</span> Connect <span class="quoted">port</span> 
                     <span class="main">|</span> Stream 
                     <span class="main">|</span> Fin 
                     <span class="main">|</span> other
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As before, we need operators which check if a packet contains a
  specific content and ID, respectively if such a packet has appeared
  in the trace. 
›</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_arq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"NetworkCore.id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> <span class="tfree">'b</span> voip_msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">is_arq</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>NetworkCore.id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> ARQ<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_fin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> <span class="tfree">'b</span> voip_msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_fin</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Fin<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_connect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> <span class="tfree">'b</span> voip_msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_connect</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_setup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> <span class="tfree">'b</span> voip_msg<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_setup</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We need also an operator <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ports_open›</span></span></span></span> to get access to the two
  dynamic ports.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">ports_open</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">×</span> port <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> <span class="tfree">'a</span> voip_msg<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ports_open</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>not_before <span class="main">(</span>is_fin <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>is_setup <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                             not_before <span class="main">(</span>is_fin <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>is_connect <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>




<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As we do not know which entity closes the connection, we define an
  operator which checks if the closer is the caller.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> 
  <span class="entity">src_is_initiator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span> voip_msg<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                                            <span class="main">(</span><span class="main">∃</span> <span class="bound">port</span><span class="main">.</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Setup <span class="bound">port</span><span class="main">)</span> <span class="main">∧</span> 
                                            <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                                        <span class="main">(</span><span class="free">src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The first state transition is for those messages which do not change
  the policy. In this scenario, this only happens for the Stream
  messages. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnet_of_adr</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">subnet_of_adr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">VOIP_STA</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>address voip_msg<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> FWStateTransition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 
<span class="comment1">(*
    If the policy accepts the ARQ packet, we have to assure that we
    will accept the returning packet of the gatekeeper (on port 1719)
*)</span>
 <span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARQ<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> ARQ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
  <span class="main">(</span>allow_from_to_port <span class="main">(</span><span class="numeral">1719</span><span class="main">::</span>port<span class="main">)</span><span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*
  And if the gatekeeper answers, no matter if it's a good or bad
  answer, we can close the channel again. If the answer was positive
  (ACF), we allow the caller to contact the callee and get contacted
  by him over port 1720. 
*)</span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>not_before <span class="main">(</span>is_fin <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>is_arq <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span>
                            <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
                 deny_from_to_port <span class="main">(</span><span class="numeral">14</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">else</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ACF <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ACF <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>   
  allow_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of_adr <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">⨁</span>
  allow_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of_adr <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span> <span class="main">⨁</span>
  deny_from_to_port <span class="main">(</span><span class="numeral">1719</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⨁</span> 
  <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
  In the Setup message, the caller specifies the port on which he
  wants the connection to take place so we need to open it for
  incoming VoIP messages. 
*)</span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
 allow_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 
<span class="comment1">(*
  The same happens after the Connect message of the callee. 
*)</span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
   allow_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
                
<span class="comment1">(*
  In the FIN message, we have to close all the previously opened
  ports. This works as in the FTP close message, only a little bit
  more complicated. 
*)</span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span> <span class="bound">p1</span> <span class="bound">p2</span><span class="main">.</span> ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>
           <span class="main">(</span><span class="keyword1">if</span> src_is_initiator <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span>
           <span class="keyword1">then</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
<span class="main">(</span>deny_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>int<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

           <span class="keyword1">else</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
<span class="main">(</span>deny_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>int<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

       <span class="keyword1">else</span>
           <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 

<span class="comment1">(* The default action for all other packets *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">VOIP_STA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                          Some <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> "</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">VOIP_STD</span>  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">VOIP_STD</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">VOIP_TRPolicy</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">VOIP_TRPolicy</span> <span class="main">=</span> policy2MON <span class="main">(</span> 
   <span class="main">(</span><span class="main">(</span>VOIP_STA<span class="main">,</span>VOIP_STD<span class="main">)</span> <span class="main">⨂<span class="hidden">⇩</span><sub>∇</sub></span> applyPolicy<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  For a full protocol run, six states are needed. 
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> voip_states <span class="main">=</span> S0 <span class="main">|</span> S1 <span class="main">|</span> S2 <span class="main">|</span> S3 <span class="main">|</span> S4 <span class="main">|</span> S5

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_voip›</span></span></span></span> checks if a trace corresponds to a
  legal VoIP protocol, given the IP-addresses of the three entities,
  the ID, and the two dynamic ports. 
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_voip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"voip_states <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span>
                port <span class="main">⇒</span>  <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">is_voip</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S5<span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">is_voip</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">id</span><span class="main">,</span><span class="bound">sr</span><span class="main">,</span><span class="bound">de</span><span class="main">,</span><span class="bound">co</span><span class="main">)</span><span class="main">.</span> 
 <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">id</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> 
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S4 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ARQ <span class="main">∧</span>
    <span class="free">is_voip</span> S5 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ARJ <span class="main">∧</span>
    <span class="free">is_voip</span> S4 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S3 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ACF <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span>
    <span class="free">is_voip</span> S4 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S2 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Setup <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">∧</span>
    <span class="free">is_voip</span> S3 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Connect <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">∧</span>
    <span class="free">is_voip</span> S2 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Stream <span class="main">∧</span>
    <span class="free">is_voip</span> S1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Stream <span class="main">∧</span>
    <span class="free">is_voip</span> S1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Fin <span class="main">∧</span>
    <span class="free">is_voip</span> S1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> S0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Fin <span class="main">∧</span>
    <span class="free">is_voip</span> S1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Finally, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>NB_voip›</span></span></span></span> returns the set of protocol traces which
  correspond to a correct protocol run given the three addresses, the
  ID, and the two dynamic ports.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">NB_voip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> id  <span class="main">⇒</span> port <span class="main">⇒</span> port <span class="main">⇒</span>
              <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> history set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NB_voip</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>is_voip S0 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FTPVOIP">
<div class="head">
<h1>Theory FTPVOIP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹FTP and VoIP Protocol›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  FTPVOIP
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#FTP_WithPolicy">FTP_WithPolicy</a> <a href="#VOIP">VOIP</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span>  ftpvoip <span class="main">=</span>  ARQ
                     <span class="main">|</span> ACF <span class="quoted">int</span> 
                     <span class="main">|</span> ARJ
                     <span class="main">|</span> Setup <span class="quoted">port</span> 
                     <span class="main">|</span> Connect <span class="quoted">port</span> 
                     <span class="main">|</span> Stream 
                     <span class="main">|</span> Fin 
                     <span class="main">|</span> ftp_init 
                     <span class="main">|</span> ftp_port_request <span class="quoted">port</span> 
                     <span class="main">|</span> ftp_data 
                     <span class="main">|</span> ftp_close 
                     <span class="main">|</span> other


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We now also make use of the ID field of a packet. It is used as session ID and we make the 
  assumption that they are all unique among different protocol runs.

  At first, we need some predicates which check if a packet is a specific FTP message and has 
  the correct session ID. 
›</span></span>
 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FTPVOIP_is_init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip <span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_init</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_init<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FTPVOIP_is_port_request</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id  <span class="main">⇒</span> port <span class="main">⇒</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_port_request</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">port</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_port_request <span class="bound">port</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FTPVOIP_is_data</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_data</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_data<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FTPVOIP_is_close</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_close</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span>  <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> ftp_close<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">FTPVOIP_port_open</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> history <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_port_open</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">L</span> <span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>not_before <span class="main">(</span>FTPVOIP_is_close <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>FTPVOIP_is_port_request <span class="bound">a</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">L</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FTPVOIP_is_other</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip <span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_other</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>id <span class="bound">p</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">∧</span> content <span class="bound">p</span> <span class="main">=</span> other<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTPVOIP_are_other</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_are_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>FTPVOIP_is_other <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free">FTPVOIP_are_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_are_other</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">last_opened_port</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> <span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">last_opened_port</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> undefined"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTPVOIP_FTP_STA</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="comment1">(* FTP_PORT_REQUEST *)</span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_FTP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="keyword1">if</span> not_before  <span class="main">(</span>FTPVOIP_is_close <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>FTPVOIP_is_init <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span> <span class="main">∧</span>
           dest_port <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> <span class="keyword1">then</span>
                          Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span> <span class="main">++</span> 
                             <span class="main">(</span>allow_from_to_port <span class="free"><span class="bound"><span class="entity">pr</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_port_request <span class="free"><span class="bound"><span class="entity">pr</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 
  <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_FTP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span>   <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> FTPVOIP_port_open <span class="free"><span class="bound"><span class="entity">InL</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> dest_port <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> 
        <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span> <span class="main">++</span> 
                 deny_from_to_port <span class="main">(</span>last_opened_port <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span>  Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftp_close<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* DEFAULT *)</span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_FTP_STA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span>snd <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span>   <span class="entity">FTPVOIP_FTP_STD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_FTP_STD</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> 
 


<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FTPVOIP_is_arq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"NetworkCore.id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_arq</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>NetworkCore.id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> ARQ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FTPVOIP_is_fin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_fin</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Fin<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FTPVOIP_is_connect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_connect</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FTPVOIP_is_setup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>adr<span class="main">,</span> ftpvoip<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_setup</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We need also an operator <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ports_open›</span></span></span></span> to get access to the two
  dynamic ports.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
   <span class="entity">FTPVOIP_ports_open</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> port <span class="main">×</span> port <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_ports_open</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>not_before <span class="main">(</span>FTPVOIP_is_fin <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>FTPVOIP_is_setup <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                             not_before <span class="main">(</span>FTPVOIP_is_fin <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>FTPVOIP_is_connect <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  As we do not know which entity closes the connection, we define an
  operator which checks if the closer is the caller.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> 
  <span class="entity">FTPVOIP_src_is_initiator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>ftpvoip<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                                            <span class="main">(</span><span class="main">∃</span> <span class="bound">port</span><span class="main">.</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Setup <span class="bound">port</span><span class="main">)</span> <span class="main">∧</span> 
                                            <span class="main">(</span><span class="main">(</span>fst <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                                        <span class="main">(</span><span class="free">FTPVOIP_src_is_initiator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FTPVOIP_subnet_of_adr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_subnet_of_adr</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTPVOIP_VOIP_STA</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARQ<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> ARQ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
  <span class="main">(</span>allow_from_to_port <span class="main">(</span><span class="numeral">1719</span><span class="main">::</span>port<span class="main">)</span><span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>not_before <span class="main">(</span>FTPVOIP_is_fin <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>FTPVOIP_is_arq <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span>
                            <span class="keyword1">then</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
                 deny_from_to_port <span class="main">(</span><span class="numeral">14</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">else</span> Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ARJ<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ACF <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ACF <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>   
  allow_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of_adr <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">⨁</span>
  allow_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of_adr <span class="free"><span class="bound"><span class="entity">callee</span></span></span><span class="main">)</span> <span class="main">⨁</span>
  deny_from_to_port <span class="main">(</span><span class="numeral">1719</span><span class="main">::</span>port<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⨁</span> 
  <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Setup <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
 allow_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> ftpvoip.Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>ftpvoip.Connect <span class="free"><span class="bound"><span class="entity">port</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> 
   allow_from_to_port <span class="free"><span class="bound"><span class="entity">port</span></span></span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span> <span class="bound">p1</span> <span class="bound">p2</span><span class="main">.</span> FTPVOIP_ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>
           <span class="main">(</span><span class="keyword1">if</span> FTPVOIP_src_is_initiator <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span>
           <span class="keyword1">then</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
<span class="main">(</span>deny_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>int<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> FTPVOIP_ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> FTPVOIP_ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

           <span class="keyword1">else</span> <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span>  
<span class="main">(</span>deny_from_to_port <span class="main">(</span><span class="numeral">1720</span><span class="main">::</span>int<span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>fst <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> FTPVOIP_ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span>
<span class="main">(</span>deny_from_to_port <span class="main">(</span>snd <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> FTPVOIP_ports_open <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span>subnet_of <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⨁</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

       <span class="keyword1">else</span>
           <span class="main">(</span>Some <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>Fin<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 

<span class="comment1">(* The default action for all other packets *)</span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STA</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                          Some <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">policy</span></span></span><span class="main">)</span><span class="main">)</span> "</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTPVOIP_VOIP_STD</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_VOIP_STD</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FTP_VOIP_STA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">FTP_VOIP_STA</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> Some <span class="bound">x</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="main">(</span>FTPVOIP_FTP_STA <span class="keyword1">⨂<span class="hidden">⇩</span><sub>S</sub></span> FTPVOIP_VOIP_STA <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FTP_VOIP_STD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history<span class="main">,</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>  ftpvoip<span class="main">)</span> FWStateTransition"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">FTP_VOIP_STD</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> Some <span class="bound">x</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="main">(</span>FTPVOIP_FTP_STD <span class="keyword1">⨂<span class="hidden">⇩</span><sub>S</sub></span> FTPVOIP_VOIP_STD <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FTPVOIP_TRPolicy</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_TRPolicy</span> <span class="main">=</span> policy2MON <span class="main">(</span> 
   <span class="main">(</span><span class="main">(</span><span class="main">(</span>FTP_VOIP_STA<span class="main">,</span>FTP_VOIP_STD<span class="main">)</span> <span class="main">⨂<span class="hidden">⇩</span><sub>∇</sub></span> applyPolicy<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> FTPVOIP_ST_simps <span class="main">=</span> Let_def in_subnet_def src_def dest_def
subnet_of_int_def id_def FTPVOIP_port_open_def
 FTPVOIP_is_init_def FTPVOIP_is_data_def FTPVOIP_is_port_request_def FTPVOIP_is_close_def p_accept_def content_def  PortCombinators exI
 NetworkCore.id_def adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas

<span class="keyword1"><span class="command">datatype</span></span> ftp_states2 <span class="main">=</span> FS0 <span class="main">|</span> FS1 <span class="main">|</span> FS2 <span class="main">|</span> FS3
<span class="keyword1"><span class="command">datatype</span></span> voip_states2 <span class="main">=</span> V0 <span class="main">|</span> V1 <span class="main">|</span> V2 <span class="main">|</span> V3 <span class="main">|</span> V4 <span class="main">|</span> V5

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The constant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_voip›</span></span></span></span> checks if a trace corresponds to a
  legal VoIP protocol, given the IP-addresses of the three entities,
  the ID, and the two dynamic ports. 
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">FTPVOIP_is_voip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"voip_states2 <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span>
                port <span class="main">⇒</span>  <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_voip</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V5<span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_voip</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">id</span><span class="main">,</span><span class="bound">sr</span><span class="main">,</span><span class="bound">de</span><span class="main">,</span><span class="bound">co</span><span class="main">)</span><span class="main">.</span> 
 <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">id</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> 
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V4 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ARQ <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V5 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ARJ <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V4 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V3 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1719</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ACF <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V4 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V2 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Setup <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V3 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Connect <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V2 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Stream <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Stream <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Fin <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span>
<span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> V0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="numeral">1720</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> Fin <span class="main">∧</span>
    <span class="free">FTPVOIP_is_voip</span> V1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Finally, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>NB_voip›</span></span></span></span> returns the set of protocol traces which
  correspond to a correct protocol run given the three addresses, the
  ID, and the two dynamic ports.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">FTPVOIP_NB_voip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> id  <span class="main">⇒</span> port <span class="main">⇒</span> port <span class="main">⇒</span>
              <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_NB_voip</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>FTPVOIP_is_voip V0 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span>
  <span class="entity">FTPVOIP_is_ftp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ftp_states2 <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>  <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> <span class="main">⇒</span> id <span class="main">⇒</span> port <span class="main">⇒</span>
            <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_ftp</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>FS3<span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_is_ftp</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="numeral">21</span>  <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">id</span><span class="main">,</span><span class="bound">sr</span><span class="main">,</span><span class="bound">de</span><span class="main">,</span><span class="bound">co</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">id</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="main">(</span>
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>FS2 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_init <span class="main">∧</span> <span class="free">FTPVOIP_is_ftp</span> FS3 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>FS1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_port_request <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span>  <span class="free">FTPVOIP_is_ftp</span> FS2 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>FS1 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">co</span><span class="main">=</span> ftp_data <span class="main">∧</span> <span class="free">FTPVOIP_is_ftp</span> FS1 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">∨</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">=</span>FS0 <span class="main">∧</span> <span class="bound">sr</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">de</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="bound">co</span> <span class="main">=</span> ftp_close  <span class="main">∧</span> <span class="free">FTPVOIP_is_ftp</span> FS1 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">InL</span></span></span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">FTPVOIP_NB_ftp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> src <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> dest <span class="main">⇒</span> id <span class="main">⇒</span> port  <span class="main">⇒</span> <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">FTPVOIP_NB_ftp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>FTPVOIP_is_ftp FS0 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">ftp_voip_interleaved</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> src <span class="main">⇒</span> adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> dest <span class="main">⇒</span> id <span class="main">⇒</span> port  <span class="main">⇒</span>
                           address <span class="main">⇒</span> address <span class="main">⇒</span> address <span class="main">⇒</span> id  <span class="main">⇒</span> port <span class="main">⇒</span> port <span class="main">⇒</span>
                           <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> ftpvoip<span class="main">)</span> history set"</span></span> 

<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ftp_voip_interleaved</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">vd</span></span></span> <span class="free"><span class="bound"><span class="entity">vg</span></span></span> <span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="free"><span class="bound"><span class="entity">vp1</span></span></span> <span class="free"><span class="bound"><span class="entity">vp2</span></span></span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>FTPVOIP_is_ftp FS0 <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">d1</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="main">(</span>packet_with_id <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span>FTPVOIP_is_voip V0 <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">vd</span></span></span> <span class="free"><span class="bound"><span class="entity">vg</span></span></span> <span class="free"><span class="bound"><span class="entity">vi</span></span></span> <span class="free"><span class="bound"><span class="entity">vp1</span></span></span> <span class="free"><span class="bound"><span class="entity">vp2</span></span></span> <span class="main">(</span>packet_with_id <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">vi</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="StatefulFW">
<div class="head">
<h1>Theory StatefulFW</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stateful Network Protocols›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  StatefulFW
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="#FTPVOIP">FTPVOIP</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="UPF-Firewall">
<div class="head">
<h1>Theory UPF-Firewall</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹UPF Firewall›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  <span class="quoted">"UPF-Firewall"</span>
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="#PacketFilter">PacketFilter/PacketFilter</a>"</span> 
    <span class="quoted">"<a href="#NAT">NAT/NAT</a>"</span>
    <span class="quoted">"<a href="#FWNormalisation">FWNormalisation/FWNormalisation</a>"</span>
    <span class="quoted">"<a href="#StatefulFW">StatefulFW/StatefulFW</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This is the main entry point for specifications of firewall policies. 
›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DMZDatatype">
<div class="head">
<h1>Theory DMZDatatype</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹DMZ Datatype›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  DMZDatatype
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This is the fourth scenario, slightly more complicated than the previous one, as we now also 
  model specific servers within one network. Therefore, we could not use anymore the modelling 
  using datatype synonym, but only use the one where an address is modelled as an
  integer (with ports). 

  Just for comparison, this theory is the same scenario with datatype synonym anyway, but with four 
  distinct networks instead of one contained in another. As there is no corresponding network model 
  included, we need to define a custom one.  
›</span></span>
  
<span class="keyword1"><span class="command">datatype</span></span> Adr <span class="main">=</span> Intranet <span class="main">|</span> Internet <span class="main">|</span> Mail <span class="main">|</span> Web <span class="main">|</span> DMZ
<span class="keyword1"><span class="command">instance</span></span> Adr<span class="main">::</span><span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> port <span class="main">=</span> <span class="quoted">int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> Networks <span class="main">=</span> <span class="quoted"><span class="quoted">"Adr <span class="main">×</span> port"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">intranet</span><span class="main">::</span><span class="quoted"><span class="quoted">"Networks net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intranet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span> Intranet<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dmz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Networks net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dmz</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span> DMZ<span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Networks net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mail</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span>Mail<span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">web</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Networks net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">web</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span>Web<span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Networks net"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span> Internet<span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">Intranet_mail_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks <span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Intranet_mail_port</span> <span class="main">=</span> <span class="main">(</span>allow_from_ports_to <span class="main">{</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">14</span><span class="main">}</span> intranet mail<span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Intranet_Internet_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Intranet_Internet_port</span> <span class="main">=</span> allow_from_ports_to <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">90</span><span class="main">}</span> intranet internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet_web_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet_web_port</span> <span class="main">=</span> <span class="main">(</span>allow_from_ports_to <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">90</span><span class="main">}</span> internet web<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet_mail_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet_mail_port</span> <span class="main">=</span>  <span class="main">(</span>allow_all_from_port_to internet <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> dmz<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">policyPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks<span class="main">,</span> DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policyPort</span> <span class="main">=</span> deny_all <span class="main">++</span> 
                  Intranet_Internet_port <span class="main">++</span> 
                  Intranet_mail_port <span class="main">++</span>  
                  Internet_mail_port <span class="main">++</span> 
                  Internet_web_port"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We only want to create test cases which are sent between the three main networks: e.g. not 
  between the mailserver and the dmz. Therefore, the constraint looks as follows. \
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Networks<span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> internet <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> internet<span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> intranet <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> intranet<span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> dmz <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> dmz<span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> PolicyLemmas <span class="main">=</span>   dmz_def internet_def intranet_def mail_def web_def 
  Internet_web_port_def Internet_mail_port_def
  Intranet_Internet_port_def Intranet_mail_port_def 
  src_def dest_def src_port dest_port in_subnet_def
  
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DMZInteger">
<div class="head">
<h1>Theory DMZInteger</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹DMZ: Integer›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  DMZInteger
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This scenario is slightly more complicated than the SimpleDMZ
one, as we now also model specific servers within one
network. Therefore, we cannot use anymore the modelling using
datatype synonym, but only use the one where an address is modelled as an
integer (with ports).

The scenario is the following:

\begin{labeling}{Networks:}
\item[Networks:]
  \begin{itemize}
  \item Intranet (Company intern network)
  \item DMZ (demilitarised zone, servers, etc), containing
     at least two distinct servers ``mail'' and ``web''
  \item Internet (``all others'') 
  \end{itemize}
\item[Policy:]
  \begin{itemize}
  \item allow http(s) from Intranet to Internet
  \item deny all trafic from Internet to Intranet
  \item allo imaps and smtp from intranet to mailserver
  \item allow smtp from Internet to mailserver
  \item allow http(s) from Internet to webserver 
  \item deny everything else
  \end{itemize}
  
\end{labeling}
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">intranet</span><span class="main">::</span><span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intranet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">dmz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dmz</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&gt;</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&lt;</span> <span class="numeral">11</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mail</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">7</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">web</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">web</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">8</span> <span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span>  <span class="main">¬</span> <span class="main">(</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&gt;</span> <span class="numeral">6</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">&lt;</span> <span class="numeral">11</span><span class="main">)</span><span class="main">)</span>   <span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">Intranet_mail_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Intranet_mail_port</span> <span class="main">=</span> <span class="main">(</span>allow_from_to_ports <span class="main">{</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">14</span><span class="main">}</span> intranet mail<span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Intranet_Internet_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Intranet_Internet_port</span> <span class="main">=</span> allow_from_to_ports <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">90</span><span class="main">}</span> intranet internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet_web_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet_web_port</span> <span class="main">=</span> <span class="main">(</span>allow_from_to_ports <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">90</span><span class="main">}</span> internet web<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet_mail_port</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet_mail_port</span> <span class="main">=</span>  <span class="main">(</span>allow_all_from_port_to internet <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> dmz <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">policyPort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policyPort</span> <span class="main">=</span> deny_all <span class="main">++</span> 
                  Intranet_Internet_port <span class="main">++</span> 
                  Intranet_mail_port <span class="main">++</span>  
                  Internet_mail_port <span class="main">++</span> 
                  Internet_web_port"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We only want to create test cases which are sent between the three main networks:
   e.g. not between the mailserver and the dmz. Therefore, the constraint looks as follows. 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> internet <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> internet<span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> intranet <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> intranet<span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> dmz <span class="main">⟶</span> <span class="main">¬</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> dmz<span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> PolicyLemmas <span class="main">=</span>  policyPort_def  dmz_def internet_def intranet_def mail_def web_def 
  Intranet_Internet_port_def Intranet_mail_port_def Internet_web_port_def 
  Internet_mail_port_def src_def dest_def IntegerPort.src_port
  in_subnet_def IntegerPort.dest_port
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DMZ">
<div class="head">
<h1>Theory DMZ</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A Simple DMZ Setup›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  DMZ
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#DMZDatatype">DMZDatatype</a>
    <a href="#DMZInteger">DMZInteger</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Voice_over_IP">
<div class="head">
<h1>Theory Voice_over_IP</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Voice over IP›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Voice_over_IP
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In this theory we generate the test data for correct runs of the FTP protocol. As usual, we 
  start with definining the networks and the policy. We use a rather simple policy which allows 
  only FTP connections starting from the Intranet and going to the Internet, and deny everything 
  else. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">intranet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intranet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="numeral">4</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">gatekeeper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gatekeeper</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span><span class="numeral">4</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">voip_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>address voip_msg<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">voip_policy</span> <span class="main">=</span> <span class="keyword1">A<span class="hidden">⇩</span><sub>U</sub></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The next two constants check if an address is in the Intranet or in the Internet respectively.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">is_in_intranet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address  <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_in_intranet</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">is_gatekeeper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_gatekeeper</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">is_in_internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"address <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_in_internet</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&gt;</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The next definition is our starting state: an empty trace and the just defined policy.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="quoted">"<span class="entity">σ_0_voip</span>"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> history <span class="main">×</span>
                 <span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> FWPolicy"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>                                     
  <span class="quoted"><span class="quoted">"<span class="free">σ_0_voip</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>voip_policy<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Next we state the conditions we have on our trace: a normal behaviour FTP run from the intranet 
  to some server in the internet on port 21.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">accept_voip</span>"</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> address voip_msg<span class="main">)</span> history <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">accept_voip</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span>   <span class="main">(</span><span class="main">∃</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">g</span> <span class="bound">i</span> <span class="bound">p1</span> <span class="bound">p2</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> NB_voip <span class="bound">c</span> <span class="bound">s</span> <span class="bound">g</span> <span class="bound">i</span> <span class="bound">p1</span> <span class="bound">p2</span> <span class="main">∧</span> is_in_intranet <span class="bound">c</span> 
                                              <span class="main">∧</span> is_in_internet <span class="bound">s</span>
                                              <span class="main">∧</span> is_gatekeeper <span class="bound">g</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">packet_with_id</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">packet_with_id</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">packet_with_id</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">packet_with_id</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">packet_with_id</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The depth of the test case generation corresponds to the maximal length of generated traces,  
  4 is the minimum to get a full FTP protocol run.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ids1</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">ids1</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ST_simps <span class="main">=</span> Let_def valid_SE_def unit_SE_def bind_SE_def
 subnet_of_int_def  p_accept_def content_def
 is_in_intranet_def is_in_internet_def intranet_def internet_def exI
 subnetOf_lemma subnetOf_lemma2 subnetOf_lemma3 subnetOf_lemma4 voip_policy_def
 NetworkCore.id_def  is_arq_def is_fin_def
 is_connect_def is_setup_def ports_open_def subnet_of_adr_def
 VOIP.NB_voip_def σ_0_voip_def PLemmas VOIP_TRPolicy_def
 policy2MON_def applyPolicy_def 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Transformation01">
<div class="head">
<h1>Theory Transformation01</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transformation Example 1›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Transformation01
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FWLink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FWLink</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">any</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">any</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="numeral">5</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">i4</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i4</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">}</span><span class="main">}</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">i27</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i27</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">}</span><span class="main">}</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">eth_intern</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eth_intern</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">eth_private</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eth_private</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="comment1">(* Mandatory: Global *)</span>
  <span class="entity">MG2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MG2</span> <span class="main">=</span> AllowPortFromTo i27 any <span class="main">1</span> <span class="main">⊕</span> 
       AllowPortFromTo i27 any <span class="numeral">2</span> <span class="main">⊕</span>
       AllowPortFromTo i27 any <span class="numeral">3</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MG3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MG3</span> <span class="main">=</span> AllowPortFromTo any FWLink <span class="main">1</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MG4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MG4</span> <span class="main">=</span> AllowPortFromTo FWLink FWLink <span class="numeral">4</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MG7</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MG7</span> <span class="main">=</span> AllowPortFromTo FWLink i4 <span class="numeral">6</span> <span class="main">⊕</span>
       AllowPortFromTo FWLink i4 <span class="numeral">7</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">MG8</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">MG8</span> <span class="main">=</span> AllowPortFromTo FWLink i4 <span class="numeral">6</span> <span class="main">⊕</span>
       AllowPortFromTo FWLink i4 <span class="numeral">7</span>"</span></span>
  
  <span class="comment1">(* Default Global *)</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DG3</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span>port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DG3</span> <span class="main">=</span> AllowPortFromTo any any <span class="numeral">7</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Policy</span> <span class="main">=</span> DenyAll <span class="main">⊕</span> MG8 <span class="main">⊕</span>  MG7 <span class="main">⊕</span> MG4 <span class="main">⊕</span> MG3 <span class="main">⊕</span> MG2 <span class="main">⊕</span> DG3"</span></span>   

<span class="keyword1"><span class="command">lemmas</span></span> PolicyLemmas <span class="main">=</span>  Policy_def
  FWLink_def
  any_def
  i27_def
  i4_def
  eth_intern_def
  eth_private_def
  MG2_def MG3_def MG4_def MG7_def MG8_def  
  DG3_def

<span class="keyword1"><span class="command">lemmas</span></span> PolicyL <span class="main">=</span>  MG2_def MG3_def MG4_def MG7_def MG8_def DG3_def Policy_def

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> i27<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">¬</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> i27<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span>  i4<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">¬</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> i4<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span>  eth_intern<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">¬</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> eth_intern<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span>  eth_private<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">¬</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> eth_private<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                   
<span class="keyword1"><span class="command">consts</span></span> fixID <span class="main">::</span> <span class="quoted">id</span>
<span class="keyword1"><span class="command">consts</span></span> fixContent <span class="main">::</span> <span class="quoted">DummyContent</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fixElements</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fixID <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fixContent<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> fixDefs <span class="main">=</span> fixElements_def NetworkCore.id_def NetworkCore.content_def



<span class="keyword1" id="Transformation01-sets_distinct1"><span class="command">lemma</span></span> sets_distinct1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-sets_distinct2"><span class="command">lemma</span></span> sets_distinct2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-sets_distinct3"><span class="command">lemma</span></span> sets_distinct3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-sets_distinct4"><span class="command">lemma</span></span> sets_distinct4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-aux"><span class="command">lemma</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">c</span><span class="main">;</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">d</span><span class="main">;</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1" id="Transformation01-sets_distinct5"><span class="command">lemma</span></span> sets_distinct5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">s</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sets_distinct3<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> aux<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Transformation01-sets_distinct6"><span class="command">lemma</span></span> sets_distinct6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="bound">a</span> <span class="main">=</span> <span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sets_distinct5<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Transformation01-distinctNets"><span class="command">lemma</span></span> distinctNets<span class="main">:</span> <span class="quoted"><span class="quoted">"FWLink <span class="main">≠</span>  any <span class="main">∧</span> FWLink <span class="main">≠</span>  i4 <span class="main">∧</span> FWLink <span class="main">≠</span>  i27 <span class="main">∧</span> FWLink <span class="main">≠</span>  eth_intern <span class="main">∧</span> FWLink <span class="main">≠</span>   eth_private <span class="main">∧</span> 
any <span class="main">≠</span>  FWLink <span class="main">∧</span> any <span class="main">≠</span>  i4 <span class="main">∧</span> any <span class="main">≠</span>  i27 <span class="main">∧</span> any <span class="main">≠</span>  eth_intern <span class="main">∧</span> any <span class="main">≠</span>  eth_private <span class="main">∧</span> i4 <span class="main">≠</span>  FWLink <span class="main">∧</span> 
i4 <span class="main">≠</span>  any <span class="main">∧</span> i4 <span class="main">≠</span>  i27 <span class="main">∧</span> i4 <span class="main">≠</span>  eth_intern <span class="main">∧</span> i4 <span class="main">≠</span>  eth_private <span class="main">∧</span> i27 <span class="main">≠</span>  FWLink <span class="main">∧</span> i27 <span class="main">≠</span>  any <span class="main">∧</span> 
i27 <span class="main">≠</span>  i4 <span class="main">∧</span> i27 <span class="main">≠</span>  eth_intern <span class="main">∧</span> i27 <span class="main">≠</span>  eth_private <span class="main">∧</span> eth_intern <span class="main">≠</span>  FWLink <span class="main">∧</span> eth_intern <span class="main">≠</span>  any <span class="main">∧</span> 
eth_intern <span class="main">≠</span>  i4 <span class="main">∧</span> eth_intern <span class="main">≠</span>  i27 <span class="main">∧</span> eth_intern <span class="main">≠</span>  eth_private <span class="main">∧</span> eth_private <span class="main">≠</span>  FWLink <span class="main">∧</span> 
eth_private <span class="main">≠</span>  any <span class="main">∧</span> eth_private <span class="main">≠</span>  i4 <span class="main">∧</span> eth_private <span class="main">≠</span>  i27 <span class="main">∧</span> eth_private <span class="main">≠</span>  eth_intern"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyLemmas sets_distinct1 sets_distinct2 sets_distinct3 sets_distinct4 
                sets_distinct5 sets_distinct6<span class="main">)</span>

<span class="keyword1" id="Transformation01-aux5"><span class="command">lemma</span></span> aux5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="free">a</span><span class="main">;</span> <span class="free">y</span><span class="main">≠</span><span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span>  <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-aux2"><span class="command">lemma</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation01-ANDex"><span class="command">lemma</span></span> ANDex<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span>policy2list Policy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyL allNetsDistinct_def distinctNets<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas PolicyLemmas netsDistinct_def sets_distinct5 sets_distinct6<span class="main">)</span>
    
<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">numberOfRules</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">numberOfRules</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">numberOfRulesList</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">numberOfRulesList</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>numberOfRules <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">numberOfRulesList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numberOfRulesList</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 

<span class="keyword1" id="Transformation01-all_in_list"><span class="command">lemma</span></span> all_in_list<span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span>policy2list Policy<span class="main">)</span> <span class="main">(</span>Nets_List Policy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyL<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Nets_List_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bothNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> distinctNets<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> normalizeUnfold <span class="main">=</span>   normalize_def Policy_def Nets_List_def bothNets_def aux aux2 bothNets_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Transformation02">
<div class="head">
<h1>Theory Transformation02</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Transforamtion Example 2›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Transformation02
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FWLink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FWLink</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">any</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">any</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="numeral">5</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">i4_32</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i4_32</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">}</span><span class="main">}</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">i10_32</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">i10_32</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">}</span><span class="main">}</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">eth_intern</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eth_intern</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">eth_private</span><span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eth_private</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">D1a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D1a</span> <span class="main">=</span> AllowPortFromTo eth_intern any <span class="main">1</span> <span class="main">⊕</span> 
       AllowPortFromTo eth_intern any <span class="numeral">2</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">D1b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D1b</span> <span class="main">=</span> AllowPortFromTo eth_private any <span class="main">1</span> <span class="main">⊕</span>
       AllowPortFromTo eth_private any <span class="numeral">2</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">D2a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D2a</span> <span class="main">=</span> AllowPortFromTo  any i4_32 <span class="numeral">21</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">D2b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D2b</span> <span class="main">=</span> AllowPortFromTo any i10_32 <span class="numeral">21</span> <span class="main">⊕</span> 
       AllowPortFromTo any i10_32 <span class="numeral">43</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">,</span> port<span class="main">)</span> Combinators"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Policy</span> <span class="main">=</span> DenyAll <span class="main">⊕</span> D2b <span class="main">⊕</span> D2a <span class="main">⊕</span> D1b <span class="main">⊕</span> D1a"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> PolicyLemmas <span class="main">=</span> Policy_def D1a_def D1b_def D2a_def D2b_def 
  
<span class="keyword1"><span class="command">lemmas</span></span> PolicyL <span class="main">=</span>  Policy_def
  FWLink_def
  any_def
  i10_32_def
  i4_32_def
  eth_intern_def
  eth_private_def
  D1a_def D1b_def D2a_def D2b_def 
                    
<span class="keyword1"><span class="command">consts</span></span> fixID <span class="main">::</span> <span class="quoted">id</span>
<span class="keyword1"><span class="command">consts</span></span> fixContent <span class="main">::</span> <span class="quoted">DummyContent</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fixElements</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>id <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fixID <span class="main">∧</span> content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fixContent<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> fixDefs <span class="main">=</span> fixElements_def NetworkCore.id_def NetworkCore.content_def

<span class="keyword1" id="Transformation02-sets_distinct1"><span class="command">lemma</span></span> sets_distinct1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation02-sets_distinct2"><span class="command">lemma</span></span> sets_distinct2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">m</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation02-sets_distinct3"><span class="command">lemma</span></span> sets_distinct3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Transformation02-sets_distinct4"><span class="command">lemma</span></span> sets_distinct4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Transformation02-aux"><span class="command">lemma</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">c</span><span class="main">;</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">d</span><span class="main">;</span> <span class="free">c</span> <span class="main">=</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Transformation02-sets_distinct5"><span class="command">lemma</span></span> sets_distinct5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">s</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sets_distinct3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span><span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> aux<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
<span class="keyword1" id="Transformation02-sets_distinct6"><span class="command">lemma</span></span> sets_distinct6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="free">g</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">,</span> <span class="bound">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">.</span>  <span class="bound">a</span> <span class="main">=</span> <span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sets_distinct5<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Transformation02-distinctNets"><span class="command">lemma</span></span> distinctNets<span class="main">:</span> <span class="quoted"><span class="quoted">"FWLink <span class="main">≠</span> any <span class="main">∧</span> FWLink <span class="main">≠</span> i4_32 <span class="main">∧</span> FWLink <span class="main">≠</span> i10_32 <span class="main">∧</span>
FWLink <span class="main">≠</span> eth_intern <span class="main">∧</span> FWLink <span class="main">≠</span> eth_private <span class="main">∧</span> any <span class="main">≠</span> FWLink <span class="main">∧</span> any <span class="main">≠</span>
i4_32 <span class="main">∧</span> any <span class="main">≠</span> i10_32 <span class="main">∧</span> any <span class="main">≠</span> eth_intern <span class="main">∧</span> any <span class="main">≠</span> eth_private <span class="main">∧</span> i4_32 <span class="main">≠</span>
FWLink <span class="main">∧</span> i4_32 <span class="main">≠</span> any <span class="main">∧</span> i4_32 <span class="main">≠</span> i10_32 <span class="main">∧</span> i4_32 <span class="main">≠</span> eth_intern <span class="main">∧</span> i4_32 <span class="main">≠</span>
eth_private <span class="main">∧</span> i10_32 <span class="main">≠</span> FWLink <span class="main">∧</span> i10_32 <span class="main">≠</span> any <span class="main">∧</span> i10_32 <span class="main">≠</span> i4_32 <span class="main">∧</span> i10_32
<span class="main">≠</span> eth_intern <span class="main">∧</span> i10_32 <span class="main">≠</span> eth_private <span class="main">∧</span> eth_intern <span class="main">≠</span> FWLink <span class="main">∧</span> eth_intern
<span class="main">≠</span> any <span class="main">∧</span> eth_intern <span class="main">≠</span> i4_32 <span class="main">∧</span> eth_intern <span class="main">≠</span> i10_32 <span class="main">∧</span> eth_intern <span class="main">≠</span>
eth_private <span class="main">∧</span> eth_private <span class="main">≠</span> FWLink <span class="main">∧</span> eth_private <span class="main">≠</span> any <span class="main">∧</span> eth_private <span class="main">≠</span>
i4_32 <span class="main">∧</span> eth_private <span class="main">≠</span> i10_32 <span class="main">∧</span> eth_private <span class="main">≠</span> eth_intern "</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyL sets_distinct1 sets_distinct2 sets_distinct3
      sets_distinct4 sets_distinct5 sets_distinct6<span class="main">)</span> 
    
<span class="keyword1" id="Transformation02-aux5"><span class="command">lemma</span></span> aux5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="free">a</span><span class="main">;</span> <span class="free">y</span><span class="main">≠</span><span class="free">b</span><span class="main">;</span> <span class="main">(</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span>  <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Transformation02-aux2"><span class="command">lemma</span></span> aux2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Transformation02-ANDex"><span class="command">lemma</span></span> ANDex<span class="main">:</span> <span class="quoted"><span class="quoted">"allNetsDistinct <span class="main">(</span>policy2list Policy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyLemmas allNetsDistinct_def distinctNets<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyL<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PLemmas PolicyL netsDistinct_def sets_distinct5 sets_distinct6 sets_distinct1
                 sets_distinct2<span class="main">)</span>
    
<span class="keyword1"><span class="command">fun</span></span> <span class="main">(</span>sequential<span class="main">)</span> <span class="entity">numberOfRules</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">numberOfRules</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⊕</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numberOfRules</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">numberOfRulesList</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">numberOfRulesList</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>numberOfRules <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">numberOfRulesList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numberOfRulesList</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  
<span class="keyword1" id="Transformation02-all_in_list"><span class="command">lemma</span></span> all_in_list<span class="main">:</span> <span class="quoted"><span class="quoted">"all_in_list <span class="main">(</span>policy2list Policy<span class="main">)</span> <span class="main">(</span>Nets_List Policy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolicyLemmas<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Nets_List_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bothNets_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> distinctNets<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">lemmas</span></span> normalizeUnfold <span class="main">=</span>   normalize_def PolicyL Nets_List_def bothNets_def aux aux2 bothNets_def sets_distinct1 sets_distinct2 sets_distinct3 sets_distinct4 sets_distinct5 sets_distinct6  aux5 aux2

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Transformation">
<div class="head">
<h1>Theory Transformation</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Demonstrating Policy Transformations›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  Transformation
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#Transformation01">Transformation01</a>
    <a href="#Transformation02">Transformation02</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div><div id="NAT-FW">
<div class="head">
<h1>Theory NAT-FW</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example: NAT›</span></span> 
<span class="keyword1"><span class="command">theory</span></span> 
  <span class="quoted">"NAT-FW"</span>
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnet1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">subnet1</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">256</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subnet2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">subnet2</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">500</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">1256</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">accross_subnets</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">≡</span> 
 <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> subnet1 <span class="main">∧</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> subnet2<span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> subnet2 <span class="main">∧</span> <span class="main">(</span>dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> subnet1<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span> DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">filter</span> <span class="main">=</span> allow_from_port_to <span class="main">(</span><span class="main">1</span><span class="main">::</span>port<span class="main">)</span> subnet1 subnet2 <span class="main">++</span>
             allow_from_port_to <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>port<span class="main">)</span> subnet1 subnet2 <span class="main">++</span>
             allow_from_port_to <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>port<span class="main">)</span> subnet1 subnet2 <span class="main">++</span> deny_all"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
 <span class="entity">nat_0</span>  <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">nat_0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">A<span class="hidden">⇩</span><sub>f</sub></span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy0 <span class="main">=</span>filter_def nat_0_def 
                      NATLemmas 
                      ProtocolPortCombinators.ProtocolCombinators 
                      adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas
                      packet_defs accross_subnets_def
                      subnet1_def subnet2_def

<span class="keyword1"><span class="command">lemmas</span></span> subnets <span class="main">=</span> subnet1_def subnet2_def 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr11</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr11</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr21</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr21</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">502</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">503</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_1</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_1</span> <span class="main">=</span> nat_0 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr11 Adr21<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_1</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_1 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy1 <span class="main">=</span> UnfoldPolicy0 nat_1_def Adr11_def Adr21_def policy_1_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr12</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr12</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">4</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">6</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr22</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr22</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">504</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">506</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_2</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_2</span> <span class="main">=</span> nat_1 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr12 Adr22<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_2</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_2</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_2 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy2 <span class="main">=</span> UnfoldPolicy1 nat_2_def Adr12_def Adr22_def policy_2_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr13</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr13</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">6</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">9</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr23</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr23</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">506</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">509</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_3</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_3</span> <span class="main">=</span> nat_2 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr13 Adr23<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_3</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_3</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_3 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy3 <span class="main">=</span> UnfoldPolicy2 nat_3_def Adr13_def Adr23_def policy_3_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr14</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr14</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">8</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">12</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr24</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr24</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">508</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">512</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_4</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_4</span> <span class="main">=</span> nat_3 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr14 Adr24<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_4</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_4</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_4 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy4 <span class="main">=</span> UnfoldPolicy3 nat_4_def Adr14_def Adr24_def policy_4_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr15</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr15</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">10</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">15</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr25</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr25</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">510</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">515</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_5</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_5</span> <span class="main">=</span> nat_4 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr15 Adr25<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_5</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_5</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_5 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy5 <span class="main">=</span> UnfoldPolicy4 nat_5_def Adr15_def Adr25_def policy_5_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr16</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr16</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">12</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">18</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr26</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr26</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">512</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">518</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_6</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_6</span> <span class="main">=</span> nat_5 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr16 Adr26<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_6</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_6</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_6 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy6 <span class="main">=</span> UnfoldPolicy5 nat_6_def Adr16_def Adr26_def policy_6_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr17</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr17</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">14</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">21</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr27</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr27</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">514</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">521</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_7</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_7</span> <span class="main">=</span> nat_6 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr17 Adr27<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_7</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_7</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_7 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy7 <span class="main">=</span> UnfoldPolicy6 nat_7_def Adr17_def Adr27_def policy_7_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr18</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr18</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">16</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">24</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr28</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr28</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">516</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">524</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_8</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_8</span> <span class="main">=</span> nat_7 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr18 Adr28<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_8</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_8</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_8 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy8 <span class="main">=</span> UnfoldPolicy7 nat_8_def Adr18_def Adr28_def policy_8_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr19</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr19</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">18</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">27</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr29</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr29</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">518</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">527</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_9</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_9</span> <span class="main">=</span> nat_8 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr19 Adr29<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_9</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_9</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_9 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy9 <span class="main">=</span> UnfoldPolicy8 nat_9_def Adr19_def Adr29_def policy_9_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr110</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Adr110</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">20</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">30</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Adr210</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Adr210</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">&gt;</span> <span class="numeral">520</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="numeral">530</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_10</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">nat_10</span> <span class="main">=</span> nat_9 <span class="main">++</span> <span class="main">(</span>srcPat2pool_IntPort Adr110 Adr210<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy_10</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">policy_10</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">o_f</span> 
 <span class="main">(</span><span class="main">(</span>nat_10 <span class="main">⨂<span class="hidden">⇩</span><sub>2</sub></span> filter<span class="main">)</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> UnfoldPolicy10 <span class="main">=</span> UnfoldPolicy9 nat_10_def Adr110_def Adr210_def policy_10_def

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PersonalFirewallInt">
<div class="head">
<h1>Theory PersonalFirewallInt</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Personal Firewall: Integer›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PersonalFirewallInt
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The most basic firewall scenario; there is a personal PC on one side and the Internet on the 
  other.  There are two policies: the first one allows all traffic from the PC to the Internet and 
  denies all coming into the PC. The second policy only allows specific ports from the PC. This 
  scenario comes in three variants: the first one specifies the allowed protocols directly, the 
  second together  with their respective port numbers, the third one only with the port numbers.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Definitions of the subnets 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PC</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub> net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC<span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Definitions of the policies 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">strictPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strictPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_all_from_to PC Internet"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">PortPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_from_ports_to <span class="main">{</span>http<span class="main">,</span>smtp<span class="main">,</span>ftp<span class="main">}</span> PC Internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PortPolicyBig</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicyBig</span> <span class="main">=</span> deny_all <span class="main">++</span> 
                 allow_from_port_to http PC Internet <span class="main">++</span> 
                 allow_from_port_to smtp PC Internet <span class="main">++</span> 
                 allow_from_port_to ftp PC Internet"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> policyLemmas <span class="main">=</span> strictPolicy_def PortPolicy_def PC_def
  Internet_def PortPolicyBig_def src_def dest_def
  adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub>Lemmas content_def
  PortCombinators in_subnet_def PortPolicyBig_def id_def
  
<span class="keyword1"><span class="command">declare</span></span> Ports <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">add</span></span></span></span></span></span><span class="main">]</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wellformed_packet</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>adr<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>p</sub><span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wellformed_packet</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> data<span class="main">)</span>"</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PersonalFirewallIpv4">
<div class="head">
<h1>Theory PersonalFirewallIpv4</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Personal Firewall IPv4›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PersonalFirewallIpv4
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The most basic firewall scenario; there is a personal PC on one side and the Internet on the 
  other. There are two policies: the first one allows all traffic from the PC to the Internet and 
  denies all coming into the PC. The second policy only allows specific ports from the PC. This 
  scenario comes in three variants: the first one specifies the allowed protocols directly, the 
  second together with their respective port numbers, the third one only with the port numbers.
›</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Definitions of the subnets 
›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">PC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4 net<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PC</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ipv4 net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4<span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC<span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Definitions of the policies 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">strictPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strictPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_all_from_to PC Internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PortPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_from_ports_to <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">21</span><span class="main">}</span> PC Internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PortPolicyBig</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipv4<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicyBig</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_from_port_to <span class="main">(</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">)</span> PC Internet<span class="main">++</span> allow_from_port_to <span class="main">(</span><span class="numeral">24</span><span class="main">::</span>port<span class="main">)</span> PC Internet<span class="main">++</span> allow_from_port_to <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> PC Internet"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> policyLemmas <span class="main">=</span> strictPolicy_def PortPolicy_def PC_def
  Internet_def PortPolicyBig_def src_def dest_def
  IPv4.src_port
  IPv4.dest_port PolicyCombinators
  PortCombinators in_subnet_def PortPolicyBig_def
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PersonalFirewallDatatype">
<div class="head">
<h1>Theory PersonalFirewallDatatype</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Personal Firewall: Datatype›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PersonalFirewallDatatype
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="UPF-Firewall.html">../../UPF-Firewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The most basic firewall scenario; there is a personal PC on one side and the Internet on the 
  other. There are two policies: the first one allows all traffic from the PC to the Internet and 
  denies all coming into the PC. The second policy only allows specific ports from the PC. This 
  scenario comes in three variants: the first one specifies the allowed protocols directly, the 
  second together with their respective port numbers, the third one only with the port numbers.  
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> Adr <span class="main">=</span> pc <span class="main">|</span> internet
  
<span class="keyword1"><span class="command">type_synonym</span></span> DatatypeTwoNets <span class="main">=</span> <span class="quoted"><span class="quoted">"Adr <span class="main">×</span> int"</span></span>
  
<span class="keyword1"><span class="command">instance</span></span> Adr<span class="main">::</span><span class="quoted">adr</span> <span class="keyword1"><span class="command">..</span></span>
    
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"DatatypeTwoNets net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PC</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> pc<span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Internet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"DatatypeTwoNets net"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Internet</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> internet<span class="main">}</span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">not_in_same_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DatatypeTwoNets<span class="main">,</span>DummyContent<span class="main">)</span> packet <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">not_in_same_net</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>src <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> Internet <span class="main">⟶</span> dest <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊏</span> PC<span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Definitions of the policies 

  In fact, the short definitions wouldn't have to be written down - they
  are the automatically simplified versions of their big counterparts.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">strictPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DatatypeTwoNets<span class="main">,</span>DummyContent<span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strictPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_all_from_to PC Internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PortPolicy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DatatypeTwoNets<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicy</span> <span class="main">=</span> deny_all <span class="main">++</span> allow_from_ports_to <span class="main">{</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">,</span><span class="numeral">24</span><span class="main">,</span><span class="numeral">21</span><span class="main">}</span> PC Internet"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PortPolicyBig</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DatatypeTwoNets<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> FWPolicy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PortPolicyBig</span> <span class="main">=</span>  
                 allow_from_port_to <span class="main">(</span><span class="numeral">80</span><span class="main">::</span>port<span class="main">)</span> PC Internet <span class="main">⨁</span> 
                 allow_from_port_to <span class="main">(</span><span class="numeral">24</span><span class="main">::</span>port<span class="main">)</span> PC Internet <span class="main">⨁</span> 
                 allow_from_port_to <span class="main">(</span><span class="numeral">21</span><span class="main">::</span>port<span class="main">)</span> PC Internet <span class="main">⨁</span> 
                 deny_all"</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> policyLemmas <span class="main">=</span> strictPolicy_def PortPolicy_def PC_def Internet_def PortPolicyBig_def src_def 
                      PolicyCombinators PortCombinators in_subnet_def
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PersonalFirewall">
<div class="head">
<h1>Theory PersonalFirewall</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Personal Firewall›</span></span>
<span class="keyword1"><span class="command">theory</span></span> 
  PersonalFirewall
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#PersonalFirewallInt">PersonalFirewallInt</a>
    <a href="#PersonalFirewallIpv4">PersonalFirewallIpv4</a>
    <a href="#PersonalFirewallDatatype">PersonalFirewallDatatype</a>
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Examples">
<div class="head">
<h1>Theory Examples</h1>
</div>
<pre class="source"><span class="comment1">(*****************************************************************************
 * Copyright (c) 2005-2010 ETH Zurich, Switzerland
 *               2008-2015 Achim D. Brucker, Germany
 *               2009-2016 Université Paris-Sud, France
 *               2015-2016 The University of Sheffield, UK
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *****************************************************************************)</span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
<span class="keyword1"><span class="command">theory</span></span>  
  Examples
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="#DMZ">DMZ/DMZ</a>"</span>
    <span class="quoted">"<a href="#Voice_over_IP">Voice_over_IP/Voice_over_IP</a>"</span>
    <span class="quoted">"<a href="#Transformation">Transformation/Transformation</a>"</span>
    <span class="quoted">"<a href="NAT-FW.html">NAT-FW/NAT-FW</a>"</span>
    <span class="quoted">"<a href="#PersonalFirewall">PersonalFirewall/PersonalFirewall</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
  
</pre>
</div>