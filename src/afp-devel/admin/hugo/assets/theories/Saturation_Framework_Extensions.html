<div id="Soundness">
<div class="head">
<h1>Theory Soundness</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Soundness
    Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2020
    Author:      Jasmin Blanchette &lt;j.c.blanchette at vu.nl&gt;, 2014, 2017, 2020
    Author:      Dmitriy Traytel &lt;traytel at inf.ethz.ch&gt;, 2014
    Author:      Anders Schlichtkrull &lt;andschl at dtu.dk&gt;, 2017
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Soundness
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Saturation_Framework/Calculus.html">Saturation_Framework.Calculus</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Although consistency-preservation usually suffices, soundness is a more precise concept and is
sometimes useful.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> sound_inference_system <span class="main">=</span> inference_system <span class="main">+</span> consequence_relation <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    sound<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span> <span class="main">⟹</span> set <span class="main">(</span>prems_of <span class="free">ι</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="free">ι</span><span class="main">}</span>›</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Soundness-Inf_consist_preserving"><span class="command">lemma</span></span> Inf_consist_preserving<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">N</span> <span class="main">∪</span> concl_of <span class="main">`</span> Inf_from <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main"><span class="free">⊨</span></span> concl_of <span class="main">`</span> Inf_from <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sound <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def image_def Bex_def mem_Collect_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> all_formulas_entailed entails_trans mem_Collect_eq subset_entailed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> n_cons entails_trans_strong <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The limit of a derivation based on a redundancy criterion is satisfiable if and only if the initial
set is satisfiable. This material is partly based on Section 4.1 of Bachmair and Ganzinger's
\emph{Handbook} chapter, but adapted to the saturation framework of Waldmann et al.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> calculus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The next three lemmas correspond to Lemma 4.2:
›</span></span>

<span class="keyword1" id="Soundness-Red_F_Sup_subset_Red_F_Liminf"><span class="command">lemma</span></span> Red_F_Sup_subset_Red_F_Liminf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span> <span class="main">⟹</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Liminf_llist_subset_Sup_llist Red_in_Sup Un_absorb1 calculus.Red_F_of_Red_F_subset
      calculus_axioms double_diff sup_ge2<span class="main">)</span>

<span class="keyword1" id="Soundness-Red_I_Sup_subset_Red_I_Liminf"><span class="command">lemma</span></span> Red_I_Sup_subset_Red_I_Liminf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span> <span class="main">⟹</span> <span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Liminf_llist_subset_Sup_llist Red_I_of_Red_F_subset Red_in_Sup double_diff subset_refl<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Proof idea due to Uwe Waldmann:
›</span></span>

<span class="keyword1" id="Soundness-unsat_limit_iff"><span class="command">lemma</span></span> unsat_limit_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    chain_red<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    chain_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main"><span class="free">(⊨)</span></span> <span class="free">Ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span> <span class="main">⟷</span> lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> Liminf_llist <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Liminf_llist_subset_Sup_llist subset_entailed<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> Sup_llist <span class="free">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> lnth <span class="free">Ns</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> chain_ent chain_not_lnull lhd_conv_lnth subset_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_ile_eq chain_ent chain_lnth_rel entails_trans less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Sup_llist_def <span class="keyword1"><span class="command">using</span></span> entail_unions <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> entails_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lhd <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chain_ent chain_not_lnull entails_trans lhd_subset_Sup_llist subset_entailed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Sup_llist <span class="free">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_F_Bot entail_set_all_formulas <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="free">Ns</span> <span class="main">-</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Diff_idemp Diff_mono Diff_subset Liminf_llist_subset_Sup_llist
        Red_F_Sup_subset_Red_F_Liminf Red_F_of_subset Red_in_Sup antisym_conv chain_red double_diff
        entail_set_all_formulas order_refl order_trans subset_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="free">Ns</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_subset entails_trans subset_entailed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some easy consequences:›</span></span>

<span class="keyword1" id="Soundness-Red_F_limit_Sup"><span class="command">lemma</span></span> Red_F_limit_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span> <span class="main">⟹</span> <span class="free">Red_F</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_F</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Liminf_llist_subset_Sup_llist Red_F_of_Red_F_subset Red_F_of_subset Red_in_Sup
      double_diff order_refl subset_antisym<span class="main">)</span>

<span class="keyword1" id="Soundness-Red_I_limit_Sup"><span class="command">lemma</span></span> Red_I_limit_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(⊳)</span> <span class="free">Ns</span> <span class="main">⟹</span> <span class="free">Red_I</span> <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="free">Red_I</span> <span class="main">(</span>Sup_llist <span class="free">Ns</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Liminf_llist_subset_Sup_llist Red_I_of_Red_F_subset Red_I_of_subset Red_in_Sup
      double_diff order_refl subset_antisym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Standard_Redundancy_Criterion">
<div class="head">
<h1>Theory Standard_Redundancy_Criterion</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Counterexample-Reducing Inference Systems and the Standard Redundancy Criterion
    Author:      Jasmin Blanchette &lt;j.c.blanchette at vu.nl&gt;, 2014, 2017, 2020
    Author:      Dmitriy Traytel &lt;traytel at inf.ethz.ch&gt;, 2014
    Author:      Anders Schlichtkrull &lt;andschl at dtu.dk&gt;, 2017
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Counterexample-Reducing Inference Systems and the Standard Redundancy Criterion›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Standard_Redundancy_Criterion
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Saturation_Framework/Calculus.html">Saturation_Framework.Calculus</a>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset_Order.html">HOL-Library.Multiset_Order</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The standard redundancy criterion can be defined uniformly for all inference systems equipped with
a compact consequence relation. The essence of the refutational completeness argument can be carried
out abstractly for counterexample-reducing inference systems, which enjoy a ``smallest
counterexample'' property. This material is partly based on Section 4.2 of Bachmair and Ganzinger's
\emph{Handbook} chapter, but adapted to the saturation framework of Waldmann et al.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Counterexample-Reducing Inference Systems›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">main_prem_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'f</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">main_prem_of</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> last <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">side_prems_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="tfree">'f</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">side_prems_of</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> butlast <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-set_prems_of"><span class="command">lemma</span></span> set_prems_of<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="free">ι</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> prems_of <span class="free">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span>main_prem_of <span class="free">ι</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>side_prems_of <span class="free">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> Un_insert_right append_Nil2 append_butlast_last_id list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_append<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> counterex_reducing_inference_system <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> consequence_relation
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">::</span> wellorder<span class="main">)</span> inference set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Inf_counterex_reducing<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="free">Bot</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">D</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">≤</span> <span class="bound">C</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> main_prem_of <span class="bound">ι</span> <span class="main">=</span> <span class="free">D</span> <span class="main">∧</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="free">I_of</span> <span class="free">N</span>
         <span class="main"><span class="free">⊨</span></span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> concl_of <span class="bound">ι</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-ex_min_counterex"><span class="command">lemma</span></span> ex_min_counterex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">::</span> wellorder<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="main">¬</span> <span class="free">I</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="bound">C</span> <span class="main">⟶</span> <span class="free">I</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">D</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms all_formulas_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">C</span></span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="main">¬</span> <span class="free">I</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_eq_minimal<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> wellorder_class.wf c_in<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Theorem 4.4 (generalizes Theorems 3.9 and 3.16):
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> counterex_reducing_inference_system_with_trivial_redundancy <span class="main">=</span>
  counterex_reducing_inference_system _ _ <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> calculus _ <span class="quoted"><span class="free">Inf</span></span> _ <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">::</span> wellorder<span class="main">)</span> inference set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> saturated_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    satur<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_ni_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="free">Bot</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    d_in_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_cex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">D</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="skolem">D</span> <span class="main">⟹</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_min_counterex<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ι_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_cex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_counterex_reducing<span class="main">[</span><span class="operator">OF</span> bot_ni_n<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι_inf Red_I_of_Inf_to_N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> concl_cex concl_lt_d d_min <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An abstract version of Corollary 3.10 does not hold without some conditions, according to Nitpick:
›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> saturated_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    satur<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="free">Bot</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Compactness›</span></span>

<span class="keyword1"><span class="command">locale</span></span> concl_compact_consequence_relation <span class="main">=</span> consequence_relation <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    entails_concl_compact<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">EE</span> <span class="main">⟹</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">CC'</span></span> <span class="main">⊆</span> <span class="free">CC</span><span class="main">.</span> finite <span class="bound">CC'</span> <span class="main">∧</span> <span class="bound">CC'</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-entails_concl_compact_union"><span class="command">lemma</span></span> entails_concl_compact_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    fin_e<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">EE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cd_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="main">∪</span> <span class="free">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">CC'</span></span> <span class="main">⊆</span> <span class="free">CC</span><span class="main">.</span> finite <span class="bound">CC'</span> <span class="main">∧</span> <span class="bound">CC'</span> <span class="main">∪</span> <span class="free">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CCDD'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    cd1_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">CCDD'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cd1_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CCDD'</span> <span class="main">⊆</span> <span class="free">CC</span> <span class="main">∪</span> <span class="free">DD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cd1_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CCDD'</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> entails_concl_compact<span class="main">[</span><span class="operator">OF</span> fin_e cd_ent<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CC'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="main">=</span> <span class="skolem">CCDD'</span> <span class="main">-</span> <span class="free">DD</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="main">⊆</span> <span class="free">CC</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">using</span></span> cd1_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">CC'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">using</span></span> cd1_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="main">∪</span> <span class="free">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="free">EE</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">using</span></span> cd1_ent
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_Diff_cancel2 Un_upper1 entails_trans subset_entailed<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Standard Redundancy Criterion›</span></span>

<span class="keyword1"><span class="command">locale</span></span> calculus_with_standard_redundancy <span class="main">=</span>
  inference_system <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> concl_compact_consequence_relation <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">entails</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">::</span> wellorder<span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">entails</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Inf_has_prem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span> <span class="main">⟹</span> prems_of <span class="free">ι</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    Inf_reductive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span> <span class="main">⟹</span> concl_of <span class="free">ι</span> <span class="main">&lt;</span> main_prem_of <span class="free">ι</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">redundant_infer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">redundant_infer</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="bound">DD</span> <span class="main">∪</span> set <span class="main">(</span>side_prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> main_prem_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_I</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> redundant_infer <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">ι</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Red_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set <span class="main">⇒</span> <span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Red_F</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">.</span> <span class="bound">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="bound">C</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results correspond to Lemma 4.5. The lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wlog_non_Red_F›</span></span></span></span> generalizes the core of
the argument.
›</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_of_subset"><span class="command">lemma</span></span> Red_F_of_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> Red_F <span class="free">N</span> <span class="main">⊆</span> Red_F <span class="free">N'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-wlog_non_Red_F"><span class="command">lemma</span></span> wlog_non_Red_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    dd0_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">DD0</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd0_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">DD0</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd0_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> <span class="free">DD0</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">.</span> <span class="bound">DD</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"finite <span class="skolem">DD1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DD1</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DD1</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> <span class="skolem">DD1</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> entails_concl_compact_union<span class="main">[</span><span class="operator">OF</span> _ dd0_ent<span class="main">]</span> dd0_lt dd0_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD2</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DD2</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> set_mset <span class="skolem">DD2</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> set_mset <span class="skolem">DD2</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_set_mset_mset_set<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> dd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD2</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">DD</span><span class="main">.</span> set_mset <span class="bound">DD</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> set_mset <span class="bound">DD</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> set_mset <span class="bound">DD</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">DD</span><span class="main">.</span> set_mset <span class="bound">DD</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> set_mset <span class="bound">DD</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">DDa</span><span class="main">.</span> set_mset <span class="bound">DDa</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> set_mset <span class="bound">DDa</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="bound">DDa</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">DD</span> <span class="main">≤</span> <span class="bound">DDa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_eq_minimal<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> wf_less_multiset<span class="main">,</span> <span class="operator">OF</span> dd2<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> not_le<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    dd_subs_n<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DD</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ddcc_ent_e<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DD</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">DDa</span><span class="main">.</span> set_mset <span class="bound">DDa</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> set_mset <span class="bound">DDa</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="bound">DDa</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">DD</span> <span class="main">≤</span> <span class="bound">DDa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Da</span> <span class="main">∈#</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">Da</span> <span class="main">∉</span> Red_F <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Da</span>
    <span class="keyword3"><span class="command">assume</span></span>
      da_in_dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Da</span> <span class="main">∈#</span> <span class="skolem">DD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      da_rf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Da</span> <span class="main">∈</span> Red_F <span class="free">N</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DDa0</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">DDa0</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
      <span class="quoted"><span class="quoted">"finite <span class="skolem">DDa0</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">DDa0</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">Da</span><span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">DDa0</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="skolem">Da</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> da_rf <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def mem_Collect_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> entails_concl_compact finite.emptyI finite.insertI subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DDa1</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      dda1_subs_n<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DDa1</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      dda1_ent_da<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DDa1</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">Da</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      dda1_lt_da<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="skolem">DDa1</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="skolem">Da</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_set_mset_mset_set<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">DDa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> multiset"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">DDa</span> <span class="main">=</span> <span class="skolem">DD</span> <span class="main">-</span> <span class="main">{#</span><span class="skolem">Da</span><span class="main">#}</span> <span class="main">+</span> <span class="skolem">DDa1</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DDa</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DDa_def <span class="keyword1"><span class="command">using</span></span> dd_subs_n dda1_subs_n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> contra_subsetD in_diffD subsetI union_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="skolem">DDa</span> <span class="main">∪</span> <span class="free">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> entails_trans_strong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Da</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">metis</span> DDa_def dda1_ent_da entail_union entails_trans order_refl set_mset_union
            subset_entailed<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">smt</span> DDa_def da_in_dd ddcc_ent_e entails_trans insert_DiffM2 set_mset_add_mset_insert
            set_mset_empty set_mset_union subset_entailed sup_assoc sup_commute sup_ge1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈#</span> <span class="skolem">DDa</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dd_lt_d dda1_lt_da da_in_dd <span class="keyword1"><span class="command">unfolding</span></span> DDa_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_DiffM2 order.strict_trans union_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DDa</span> <span class="main">&lt;</span> <span class="skolem">DD</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DDa_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> da_in_dd dda1_lt_da mset_lt_single_right_iff single_subset_iff union_le_diff_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> d_min <span class="keyword1"><span class="command">unfolding</span></span> less_eq_multiset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dd_subs_n ddcc_ent_e dd_lt_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_imp_ex_non_Red_F"><span class="command">lemma</span></span> Red_F_imp_ex_non_Red_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> Red_F <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">CC</span></span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">.</span> <span class="bound">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">C</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">C'</span> <span class="main">∈</span> <span class="bound">CC</span><span class="main">.</span> <span class="bound">C'</span> <span class="main">&lt;</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    dd_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_in<span class="main">[</span><span class="operator">unfolded</span> Red_F_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_non_Red_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">DD</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> dd_sub dd_ent dd_lt<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_subs_Red_F_diff_Red_F"><span class="command">lemma</span></span> Red_F_subs_Red_F_diff_Red_F<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_F <span class="free">N</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
  <span class="keyword3"><span class="command">assume</span></span> c_rf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    cc_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cc_ent_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">C</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cc_lt_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C'</span> <span class="main">∈</span> <span class="skolem">CC</span><span class="main">.</span> <span class="bound">C'</span> <span class="main">&lt;</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_F_imp_ex_non_Red_F<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">CC</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∉</span> Red_F <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cc_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cc_nr<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="skolem">CC</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="free">N</span><span class="main">.</span> <span class="bound">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="bound">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cc_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">-</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="free">N</span><span class="main">.</span> <span class="bound">DD</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> <span class="bound">C</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cc_nr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Red_F <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cc_ent_c cc_lt_c <span class="keyword1"><span class="command">unfolding</span></span> Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_eq_Red_F_diff_Red_F"><span class="command">lemma</span></span> Red_F_eq_Red_F_diff_Red_F<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_F <span class="free">N</span> <span class="main">=</span> Red_F <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_F_of_subset Red_F_subs_Red_F_diff_Red_F set_eq_subset<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results correspond to Lemma 4.6. It also uses <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wlog_non_Red_F›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_of_subset"><span class="command">lemma</span></span> Red_I_of_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">N'</span> <span class="main">⟹</span> Red_I <span class="free">N</span> <span class="main">⊆</span> Red_I <span class="free">N'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def redundant_infer_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_subs_Red_I_diff_Red_F"><span class="command">lemma</span></span> Red_I_subs_Red_I_diff_Red_F<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_I <span class="free">N</span> <span class="main">⊆</span> Red_I <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> ι_ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CC</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="main">=</span> set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> main_prem_of <span class="skolem">ι</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> concl_of <span class="skolem">ι</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    dd_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_ent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">∪</span> <span class="skolem">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">E</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι_ri <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def redundant_infer_def CC_def D_def E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DDa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DDa</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DDa</span> <span class="main">∪</span> <span class="skolem">CC</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">E</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D'</span> <span class="main">∈</span> <span class="skolem">DDa</span><span class="main">.</span> <span class="bound">D'</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wlog_non_Red_F<span class="main">[</span><span class="operator">OF</span> dd_sub dd_ent dd_lt_d<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι_ri <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def redundant_infer_def CC_def D_def E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_eq_Red_I_diff_Red_F"><span class="command">lemma</span></span> Red_I_eq_Red_I_diff_Red_F<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_I <span class="free">N</span> <span class="main">=</span> Red_I <span class="main">(</span><span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset Red_I_of_subset Red_I_subs_Red_I_diff_Red_F subset_antisym<span class="main">)</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_to_Inf"><span class="command">lemma</span></span> Red_I_to_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"Red_I <span class="free">N</span> <span class="main">⊆</span> <span class="free">Inf</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_of_Red_F_subset"><span class="command">lemma</span></span> Red_F_of_Red_F_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N'</span> <span class="main">⊆</span> Red_F <span class="free">N</span> <span class="main">⟹</span> Red_F <span class="free">N</span> <span class="main">⊆</span> Red_F <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_mono Red_F_eq_Red_F_diff_Red_F Red_F_of_subset order_refl<span class="main">)</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_of_Red_F_subset"><span class="command">lemma</span></span> Red_I_of_Red_F_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N'</span> <span class="main">⊆</span> Red_F <span class="free">N</span> <span class="main">⟹</span> Red_I <span class="free">N</span> <span class="main">⊆</span> Red_I <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="free">N'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_mono Red_I_eq_Red_I_diff_Red_F Red_I_of_subset order_refl<span class="main">)</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_model"><span class="command">lemma</span></span> Red_F_model<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span> <span class="main">⟹</span> <span class="free">M</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffI Red_F_imp_ex_non_Red_F entail_set_all_formulas entails_trans
      subset_entailed<span class="main">)</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_F_Bot"><span class="command">lemma</span></span> Red_F_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> <span class="free">Bot</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">-</span> Red_F <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="free">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Red_F_model entails_trans subset_entailed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Standard_Redundancy_Criterion-Red_I_of_Inf_to_N"><span class="command">lemma</span></span> Red_I_of_Inf_to_N<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    in_ι<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_in<span class="main">:</span> <span class="quoted"><span class="quoted">"concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="free">ι</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> redundant_infer <span class="free">N</span> <span class="free">ι</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> redundant_infer_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Inf_reductive empty_iff empty_subsetI entail_union in_ι insert_iff
        insert_subset subset_entailed subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Red_I_def concl_in in_ι<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following corresponds to Theorems 4.7 and 4.8:
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> calculus <span class="quoted"><span class="free">Bot</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⊨)</span></span>"</span></span> <span class="quoted">Red_I</span> <span class="quoted">Red_F</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> Red_I_to_Inf<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> Red_F_Bot<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> Red_F_of_subset<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fact</span> Red_I_of_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> Red_F_of_Red_F_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> Red_I_of_Red_F_subset<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fact</span> Red_I_of_Inf_to_N<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> counterex_reducing_calculus_with_standard_redundancy <span class="main">=</span>
  calculus_with_standard_redundancy <span class="quoted"><span class="free">Inf</span></span> <span class="main">+</span> counterex_reducing_inference_system _ _ <span class="quoted"><span class="free">Inf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">::</span> wellorder<span class="main">)</span> inference set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refutational Completeness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result loosely corresponds to Theorem 4.9.
›</span></span>

<span class="keyword1" id="Standard_Redundancy_Criterion-saturated_model"><span class="command">lemma</span></span> saturated_model<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    satur<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_ni_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="free">Bot</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'f</span></span></span> <span class="keyword2"><span class="keyword">where</span></span>
    d_in_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_cex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="skolem">D</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="skolem">D</span> <span class="main">⟹</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_min_counterex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ι_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ι_mprem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> main_prem_of <span class="skolem">ι</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    sprem_subs_n<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    sprem_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_cex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    concl_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Inf_counterex_reducing<span class="main">[</span><span class="operator">OF</span> bot_ni_n<span class="main">]</span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> satur<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> saturated_def Inf_from_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ι_in set_prems_of Inf_has_prem<span class="main">)</span>
      <span class="main">(</span><span class="operator">use</span> ι_mprem d_in_n sprem_subs_n  <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Red_I_without_red_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    dd_subs_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_cc_ent_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">∪</span> set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">C</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Red_I_def redundant_infer_def ι_mprem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> dd_subs_n dd_lt_d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="skolem">DD</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_min <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_min_counterex subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> entails_trans dd_cc_ent_d entail_union sprem_true <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> concl_cex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A more faithful abstract version of Theorem 4.9 does not hold without some conditions, according to
Nitpick:
›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> saturated_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    satur<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main"><span class="free">⊨</span></span> <span class="free">Bot</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="free">Bot</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Clausal_Calculus">
<div class="head">
<h1>Theory Clausal_Calculus</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Clausal Calculi
    Author:      Jasmin Blanchette &lt;j.c.blanchette at vu.nl&gt;, 2020
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Clausal Calculi›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Clausal_Calculus
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Ordered_Resolution_Prover/Unordered_Ground_Resolution.html">Ordered_Resolution_Prover.Unordered_Ground_Resolution</a>
    <a href="Soundness.html">Soundness</a>
    <a href="Standard_Redundancy_Criterion.html">Standard_Redundancy_Criterion</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Various results about consequence relations, counterexample-reducing inference systems, and
the standard redundancy criteria are specialized and customized for clauses as opposed to arbitrary
formulas.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setup›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To avoid confusion, we use the symbol <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊫›</span></span></span></span> (with or without subscripts) for the ``models''
and entailment relations on clauses and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊨›</span></span></span></span> for the abstract concept of consequence.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">true_lit_thick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interp <span class="main">⇒</span> <span class="tfree">'a</span> literal <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫l</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">⊫l</span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">⊨l</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">true_cls_thick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interp <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="free">⊫</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⊨</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">true_clss_thick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interp <span class="main">⇒</span> <span class="tfree">'a</span> clause set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫s</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">⊫s</span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">⊨s</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">true_cls_mset_thick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interp <span class="main">⇒</span> <span class="tfree">'a</span> clause multiset <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫m</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1"><span class="free">⊫m</span></span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">⊨m</span> <span class="free"><span class="bound"><span class="entity">𝒞</span></span></span>"</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> true_lit <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨l</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_cls <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_clss <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨s</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_cls_mset <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨m</span>"</span> 50<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Consequence Relation›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">entails_clss</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫e</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1"><span class="free">⊫e</span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="main">⟶</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span>"</span></span>

<span class="keyword1" id="Clausal_Calculus-entails_iff_unsatisfiable_single"><span class="command">lemma</span></span> entails_iff_unsatisfiable_single<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="free">E</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">¬</span> satisfiable <span class="main">(</span><span class="free">CC</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="free">E</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">_</span> <span class="main">(</span><span class="main">_</span> <span class="main">∪</span> <span class="var">?NegD</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> c_ent_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">I</span> <span class="keyword1">⊫s</span> <span class="free">CC</span> <span class="main">∪</span> <span class="var">?NegD</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span>
    <span class="keyword1"><span class="command">using</span></span> c_ent_e<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def true_cls_def true_lit_def if_distribR if_bool_eq_conj
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ball_Un is_pos_neg_not_is_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span><span class="free">CC</span> <span class="main">∪</span> <span class="var">?NegD</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span><span class="free">CC</span> <span class="main">∪</span> <span class="var">?NegD</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">I</span> <span class="keyword1">⊫s</span> <span class="free">CC</span> <span class="main">∪</span> <span class="var">?NegD</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="free">E</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def true_cls_def true_lit_def if_distribR if_bool_eq_conj
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ball_Un is_pos_neg_not_is_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Clausal_Calculus-entails_iff_unsatisfiable"><span class="command">lemma</span></span> entails_iff_unsatisfiable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="keyword1">⊫e</span> <span class="free">EE</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">EE</span><span class="main">.</span> <span class="main">¬</span> satisfiable <span class="main">(</span><span class="free">CC</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="bound">E</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">EE</span><span class="main">.</span> <span class="free">CC</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="bound">E</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> entails_iff_unsatisfiable_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> consequence_relation <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N2</span> <span class="skolem">N1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> <span class="skolem">N2</span><span class="main">.</span> <span class="skolem">N1</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="keyword1">⊫e</span> <span class="skolem">N2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> true_clss_singleton <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_clss_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> true_clss_mono<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> concl_compact_consequence_relation <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> wellorder<span class="main">)</span> clause set"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">CC</span> <span class="skolem">EE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    fin_e<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">EE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c_ent_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CC</span> <span class="keyword1">⊫e</span> <span class="skolem">EE</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="skolem">EE</span><span class="main">.</span> <span class="main">¬</span> satisfiable <span class="main">(</span><span class="skolem">CC</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="bound">E</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_ent_e<span class="main">[</span><span class="operator">unfolded</span> entails_iff_unsatisfiable<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="skolem">EE</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="skolem">CC</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="bound">E</span><span class="main">}</span><span class="main">.</span> finite <span class="bound">DD</span> <span class="main">∧</span> <span class="main">¬</span> satisfiable <span class="bound">DD</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> clausal_logic_compact<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD_of</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    d_of<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="skolem">EE</span><span class="main">.</span> <span class="skolem">DD_of</span> <span class="bound">E</span> <span class="main">⊆</span> <span class="skolem">CC</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="bound">E</span><span class="main">}</span> <span class="main">∧</span> finite <span class="main">(</span><span class="skolem">DD_of</span> <span class="bound">E</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">¬</span> satisfiable <span class="main">(</span><span class="skolem">DD_of</span> <span class="bound">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">CC'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">E</span> <span class="main">∈</span> <span class="skolem">EE</span><span class="main">.</span> <span class="skolem">DD_of</span> <span class="bound">E</span> <span class="main">-</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="bound">E</span><span class="main">}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="main">⊆</span> <span class="skolem">CC</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">using</span></span> d_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> c'_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">CC'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">using</span></span> d_of fin_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">CC'</span> <span class="keyword1">⊫e</span> <span class="skolem">EE</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> entails_iff_unsatisfiable
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
    <span class="keyword3"><span class="command">assume</span></span> e_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> <span class="skolem">EE</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DD_of</span> <span class="skolem">E</span> <span class="main">⊆</span> <span class="skolem">CC'</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="skolem">E</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_in d_of <span class="keyword1"><span class="command">unfolding</span></span> CC'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span><span class="skolem">DD_of</span> <span class="skolem">E</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_in d_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span><span class="skolem">CC'</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{#</span><span class="main">-</span> <span class="bound">L</span><span class="main">#}</span> <span class="main">|</span><span class="bound">L</span><span class="main">.</span> <span class="bound">L</span> <span class="main">∈#</span> <span class="skolem">E</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> unsatisfiable_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">DD_of</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">E</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">CC'</span></span> <span class="main">⊆</span> <span class="skolem">CC</span><span class="main">.</span> finite <span class="bound">CC'</span> <span class="main">∧</span> <span class="bound">CC'</span> <span class="keyword1">⊫e</span> <span class="skolem">EE</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Counterexample-Reducing Inference Systems›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">clss_of_interp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> literal multiset set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">clss_of_interp</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">{#</span><span class="main">(</span><span class="keyword1">if</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">then</span> Pos <span class="keyword1">else</span> Neg<span class="main">)</span> <span class="bound">A</span><span class="main">#}</span> <span class="main">|</span><span class="bound">A</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1" id="Clausal_Calculus-true_clss_of_interp_iff_equal"><span class="command">lemma</span></span> true_clss_of_interp_iff_equal<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="keyword1">⊫s</span> clss_of_interp <span class="free">I</span> <span class="main">⟷</span> <span class="free">J</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> clss_of_interp_def true_clss_def true_cls_def true_lit_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Clausal_Calculus-entails_iff_models"><span class="command">lemma</span></span> entails_iff_models<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"clss_of_interp <span class="free">I</span> <span class="keyword1">⊫e</span> <span class="free">CC</span> <span class="main">⟷</span> <span class="free">I</span> <span class="keyword1">⊫s</span> <span class="free">CC</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">locale</span></span> clausal_counterex_reducing_inference_system <span class="main">=</span> inference_system <span class="quoted"><span class="free">Inf</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> wellorder<span class="main">)</span> clause inference set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">J_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> interp"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> clausal_Inf_counterex_reducing<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∉</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">J_of</span> <span class="free">N</span> <span class="main">⊫</span> <span class="free">D</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">J_of</span> <span class="free">N</span> <span class="main">⊫</span> <span class="bound">C</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">≤</span> <span class="bound">C</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> main_prem_of <span class="bound">ι</span> <span class="main">=</span> <span class="free">D</span> <span class="main">∧</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span>
       <span class="free">J_of</span> <span class="free">N</span> <span class="keyword1">⊫s</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">J_of</span> <span class="free">N</span> <span class="main">⊫</span> concl_of <span class="bound">ι</span> <span class="main">∧</span> concl_of <span class="bound">ι</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">I_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">I_of</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">≡</span> clss_of_interp <span class="main">(</span><span class="free">J_of</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Clausal_Calculus-Inf_counterex_reducing"><span class="command">lemma</span></span> Inf_counterex_reducing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    bot_ni_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∩</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_in_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_ent_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I_of <span class="free">N</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="free">D</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="main">¬</span> I_of <span class="free">N</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="bound">C</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">D</span> <span class="main">≤</span> <span class="bound">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> main_prem_of <span class="bound">ι</span> <span class="main">=</span> <span class="free">D</span> <span class="main">∧</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span>
    <span class="main">∧</span> I_of <span class="free">N</span> <span class="keyword1">⊫e</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> I_of <span class="free">N</span> <span class="keyword1">⊫e</span> <span class="main">{</span>concl_of <span class="bound">ι</span><span class="main">}</span> <span class="main">∧</span> concl_of <span class="bound">ι</span> <span class="main">&lt;</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bot_ni_n clausal_Inf_counterex_reducing d_in_n d_min n_ent_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> counterex_reducing_inference_system <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span> <span class="quoted"><span class="free">Inf</span></span> <span class="quoted">I_of</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">fact</span> Inf_counterex_reducing<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Counterexample-Reducing Calculi Equipped with a Standard Redundancy Criterion›</span></span>

<span class="keyword1"><span class="command">locale</span></span> clausal_counterex_reducing_calculus_with_standard_redundancy <span class="main">=</span>
  calculus_with_standard_redundancy <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span> <span class="main">+</span>
  clausal_counterex_reducing_inference_system <span class="quoted"><span class="free">Inf</span></span> <span class="quoted"><span class="free">J_of</span></span>
  <span class="keyword2"><span class="keyword">for</span></span>
    <span class="free">Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> wellorder<span class="main">)</span> clause inference set"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">J_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> counterex_reducing_calculus_with_standard_redundancy <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span> <span class="quoted">I_of</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Clausal_Calculus-clausal_saturated_model"><span class="command">lemma</span></span> clausal_saturated_model<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟹</span> <span class="main">{#}</span> <span class="main">∉</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">J_of</span> <span class="free">N</span> <span class="keyword1">⊫s</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> saturated_model<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> clausal_saturated_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"saturated <span class="free">N</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">{#}</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> clausal_saturated_model <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FO_Ordered_Resolution_Prover_Revisited">
<div class="head">
<h1>Theory FO_Ordered_Resolution_Prover_Revisited</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Application of the Saturation Framework to Bachmair and Ganzinger's RP
    Author:      Sophie Tourret &lt;stourret at mpi-inf.mpg.de&gt;, 2018-2020
    Author:      Jasmin Blanchette &lt;j.c.blanchette at vu.nl&gt;, 2020
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Application of the Saturation Framework to Bachmair and Ganzinger's \textsf{RP}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FO_Ordered_Resolution_Prover_Revisited
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Ordered_Resolution_Prover/FO_Ordered_Resolution_Prover.html">Ordered_Resolution_Prover.FO_Ordered_Resolution_Prover</a>
    <a href="../Saturation_Framework/Given_Clause_Architectures.html">Saturation_Framework.Given_Clause_Architectures</a>
    <a href="Clausal_Calculus.html">Clausal_Calculus</a>
    <a href="Soundness.html">Soundness</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main results about Bachmair and Ganzinger's \textsf{RP} prover, as established in
Section 4.3 of their \emph{Handbook} chapter and formalized by Schlichtkrull et al., are re-proved
here using the saturation framework of Waldmann et al.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setup›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> true_lit <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨l</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_cls <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_clss <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨s</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> true_cls_mset <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊨m</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">hide_type</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Inference_System.inference

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Inference_System.Infer Inference_System.main_prem_of
  Inference_System.side_prems_of Inference_System.prems_of Inference_System.concl_of
  Inference_System.concls_of Inference_System.infer_from

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> old_inference <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Inference_System.inference"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_Infer</span> <span class="main">≡</span> Inference_System.Infer"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_side_prems_of</span> <span class="main">≡</span> Inference_System.side_prems_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_main_prem_of</span> <span class="main">≡</span> Inference_System.main_prem_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_concl_of</span> <span class="main">≡</span> Inference_System.concl_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_prems_of</span> <span class="main">≡</span> Inference_System.prems_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_concls_of</span> <span class="main">≡</span> Inference_System.concls_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">old_infer_from</span> <span class="main">≡</span> Inference_System.infer_from"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> old_infer_from_def <span class="main">=</span> Inference_System.infer_from_def


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Library›</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-set_zip_replicate_right"><span class="command">lemma</span></span> set_zip_replicate_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>zip <span class="free">xs</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ground Layer›</span></span>

<span class="keyword1"><span class="command">context</span></span> FO_resolution_prover
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> RP <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↝</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> RP <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↝RP</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> gr<span class="main">:</span> ground_resolution_with_selection <span class="quoted"><span class="quoted">"S_M <span class="free">S</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> selection_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">fact</span> S_M_selects_subseteq S_M_selects_neg_lits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">G_Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">G_Inf</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{</span>Infer <span class="main">(</span><span class="bound">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">DA</span><span class="main">]</span><span class="main">)</span> <span class="bound">E</span> <span class="main">|</span><span class="bound">CAs</span> <span class="bound">DA</span> <span class="bound">AAs</span> <span class="bound">As</span> <span class="bound">E</span><span class="main">.</span> gr.ord_resolve <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">CAs</span> <span class="bound">DA</span> <span class="bound">AAs</span> <span class="bound">As</span> <span class="bound">E</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-G_Inf_have_prems"><span class="command">lemma</span></span> G_Inf_have_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> G_Inf <span class="free">M</span> <span class="main">⟹</span> prems_of <span class="free">ι</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> G_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-G_Inf_reductive"><span class="command">lemma</span></span> G_Inf_reductive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> G_Inf <span class="free">M</span> <span class="main">⟹</span> concl_of <span class="free">ι</span> <span class="main">&lt;</span> main_prem_of <span class="free">ι</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> G_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gr.ord_resolve_reductive<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> G<span class="main">:</span> sound_inference_system <span class="quoted"><span class="quoted">"G_Inf <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> G_Inf <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span>
    <span class="keyword3"><span class="command">assume</span></span> I_ent_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="keyword1">⊫s</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      the_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"gr.ord_resolve <span class="free">M</span> <span class="skolem">CAs</span> <span class="main">(</span>main_prem_of <span class="skolem">ι</span><span class="main">)</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      CAs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CAs</span> <span class="main">=</span> side_prems_of <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">unfolding</span></span> G_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊫</span> concl_of <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gr.ord_resolve_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="skolem">CAs</span></span> <span class="quoted"><span class="quoted">"main_prem_of <span class="skolem">ι</span>"</span></span> <span class="quoted"><span class="skolem">AAs</span></span> <span class="quoted"><span class="skolem">As</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span>"</span></span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> I_ent_prems G_Inf_have_prems i_in insert_is_Un set_mset_mset set_prems_of
          true_clss_insert true_clss_set_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inference.prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> G<span class="main">:</span> clausal_counterex_reducing_inference_system <span class="quoted"><span class="quoted">"G_Inf <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"gr.INTERP <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">D</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∉</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="main">⊫</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">¬</span> gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="main">⊫</span> <span class="bound">C</span> <span class="main">⟹</span> <span class="skolem">D</span> <span class="main">≤</span> <span class="bound">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    cas_in<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">CAs</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_mod_cas<span class="main">:</span> <span class="quoted"><span class="quoted">"gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="keyword1">⊫m</span> mset <span class="skolem">CAs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ca_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">CA</span><span class="main">.</span> <span class="bound">CA</span> <span class="main">∈</span> set <span class="skolem">CAs</span> <span class="main">⟹</span> gr.production <span class="free">M</span> <span class="skolem">N</span> <span class="bound">CA</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    e_res<span class="main">:</span> <span class="quoted"><span class="quoted">"gr.ord_resolve <span class="free">M</span> <span class="skolem">CAs</span> <span class="skolem">D</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_nmod_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="main">⊫</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    e_lt_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gr.ord_resolve_counterex_reducing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">=</span> Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">D</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> G_Inf <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def G_Inf_def <span class="keyword1"><span class="command">using</span></span> e_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prems_of <span class="skolem">ι</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"main_prem_of <span class="skolem">ι</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">using</span></span> cas_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="keyword1">⊫s</span> set <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">using</span></span> n_mod_cas ca_prod <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gr.productive_imp_INTERP true_clss_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="main">⊫</span> concl_of <span class="skolem">ι</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">using</span></span> n_nmod_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def <span class="keyword1"><span class="command">using</span></span> e_lt_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> G_Inf <span class="free">M</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> main_prem_of <span class="bound">ι</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">∧</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span> <span class="main">∧</span>
    gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="keyword1">⊫s</span> set <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> gr.INTERP <span class="free">M</span> <span class="skolem">N</span> <span class="main">⊫</span> concl_of <span class="bound">ι</span> <span class="main">∧</span> concl_of <span class="bound">ι</span> <span class="main">&lt;</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> G<span class="main">:</span> clausal_counterex_reducing_calculus_with_standard_redundancy <span class="quoted"><span class="quoted">"G_Inf <span class="free">M</span>"</span></span>
  <span class="quoted"><span class="quoted">"gr.INTERP <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> G_Inf_have_prems<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> G_Inf_reductive<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> G<span class="main">:</span> statically_complete_calculus <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"G_Inf <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫e)</span>"</span></span> <span class="quoted"><span class="quoted">"G.Red_I <span class="free">M</span>"</span></span> <span class="quoted">G.Red_F</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">use</span> G.clausal_saturated_complete <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹First-Order Layer›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> clause set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_F</span> <span class="main">≡</span> grounding_of_cls›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">𝒢_Fset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_Fset</span> <span class="main">≡</span> grounding_of_clss›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> 𝒢_F_def <span class="main">=</span> grounding_of_cls_def
<span class="keyword1"><span class="command">lemmas</span></span> 𝒢_Fset_def <span class="main">=</span> grounding_of_clss_def

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">𝒢_I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause inference <span class="main">⇒</span> <span class="tfree">'a</span> clause inference set›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_I</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">=</span> <span class="main">{</span>Infer <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="keyword1">⋅⋅cl</span> <span class="bound">ρs</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">⋅</span> <span class="bound">ρ</span><span class="main">)</span> <span class="main">|</span><span class="bound">ρ</span> <span class="bound">ρs</span><span class="main">.</span>
     is_ground_subst_list <span class="bound">ρs</span> <span class="main">∧</span> is_ground_subst <span class="bound">ρ</span>
     <span class="main">∧</span> Infer <span class="main">(</span>prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="keyword1">⋅⋅cl</span> <span class="bound">ρs</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">⋅</span> <span class="bound">ρ</span><span class="main">)</span> <span class="main">∈</span> G_Inf <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">𝒢_I_opt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> clause set <span class="main">⇒</span> <span class="tfree">'a</span> clause inference <span class="main">⇒</span> <span class="tfree">'a</span> clause inference set option›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">𝒢_I_opt</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> Some <span class="main">(</span>𝒢_I <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F_Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">F_Inf</span> <span class="main">=</span> <span class="main">{</span>Infer <span class="main">(</span><span class="bound">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">DA</span><span class="main">]</span><span class="main">)</span> <span class="bound">E</span> <span class="main">|</span> <span class="bound">CAs</span> <span class="bound">DA</span> <span class="bound">AAs</span> <span class="bound">As</span> <span class="bound">σ</span> <span class="bound">E</span><span class="main">.</span> ord_resolve_rename <span class="free">S</span> <span class="bound">CAs</span> <span class="bound">DA</span> <span class="bound">AAs</span> <span class="bound">As</span> <span class="bound">σ</span> <span class="bound">E</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-F_Inf_have_prems"><span class="command">lemma</span></span> F_Inf_have_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∈</span> F_Inf <span class="main">⟹</span> prems_of <span class="free">ι</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> F_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">interpretation</span></span> F<span class="main">:</span> lifting_intersection <span class="quoted">F_Inf</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted">G_Inf</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="keyword1">(⊫e)</span>"</span></span> <span class="quoted">G.Red_I</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> G.Red_F"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> 𝒢_F"</span></span> <span class="quoted">𝒢_I_opt</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">D</span> <span class="bound">C</span> <span class="bound">C'</span><span class="main">.</span> False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"UNIV <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> UNIV_not_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"consequence_relation <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="keyword1">(⊫e)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> consequence_relation_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> tiebreaker_lifting <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> F_Inf <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="keyword1">(⊫e)</span> <span class="main">(</span>G_Inf <span class="bound">M</span><span class="main">)</span> <span class="main">(</span>G.Red_I <span class="bound">M</span><span class="main">)</span> G.Red_F 𝒢_F <span class="main">(</span>𝒢_I_opt <span class="bound">M</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">D</span> <span class="bound">C</span> <span class="bound">C'</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">ι</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>𝒢_I_opt <span class="skolem">M</span> <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> G.Red_I <span class="skolem">M</span> <span class="main">(</span>𝒢_F <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> option.sel
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι'</span> <span class="main">∈</span> 𝒢_I <span class="skolem">M</span> <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ρ</span></span> <span class="skolem"><span class="skolem">ρs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        ι'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι'</span> <span class="main">=</span> Infer <span class="main">(</span>prems_of <span class="skolem">ι</span> <span class="keyword1">⋅⋅cl</span> <span class="skolem">ρs</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι</span> <span class="main">⋅</span> <span class="skolem">ρ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ρ_gr<span class="main">:</span> <span class="quoted"><span class="quoted">"is_ground_subst <span class="skolem">ρ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ρ_infer<span class="main">:</span> <span class="quoted"><span class="quoted">"Infer <span class="main">(</span>prems_of <span class="skolem">ι</span> <span class="keyword1">⋅⋅cl</span> <span class="skolem">ρs</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι</span> <span class="main">⋅</span> <span class="skolem">ρ</span><span class="main">)</span> <span class="main">∈</span> G_Inf <span class="skolem">M</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> 𝒢_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι'</span> <span class="main">∈</span> G.Red_I <span class="skolem">M</span> <span class="main">(</span>𝒢_F <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G.Red_I_def G.redundant_infer_def mem_Collect_eq <span class="keyword1"><span class="command">using</span></span> ι' ρ_gr ρ_infer
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inference.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> G_Inf_reductive empty_iff ground_subst_ground_cls
            grounding_of_cls_ground insert_iff subst_cls_eq_grounding_of_cls_subset_eq
            true_clss_union<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝒢_F_def ex_ground_subst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">notation</span></span> F.entails_𝒢 <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫𝒢e</span>"</span> 50<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-F_entails_𝒢_iff"><span class="command">lemma</span></span> F_entails_𝒢_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊫𝒢e</span> <span class="free">N2</span> <span class="main">⟷</span> <span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="free">N1</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="free">N2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> F.entails_𝒢_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-true_Union_grounding_of_cls_iff"><span class="command">lemma</span></span> true_Union_grounding_of_cls_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="keyword1">⊫s</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">C</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="main">{</span><span class="bound">C</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">|</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span><span class="main">}</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span> <span class="main">⟶</span> <span class="free">I</span> <span class="keyword1">⊫s</span> <span class="free">N</span> <span class="keyword1">⋅cs</span> <span class="bound">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def subst_clss_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">interpretation</span></span> F<span class="main">:</span> sound_inference_system <span class="quoted">F_Inf</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫𝒢e)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> F_Inf"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">η</span>
    <span class="keyword3"><span class="command">assume</span></span>
      I_entails_prems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span> <span class="main">⟶</span> <span class="skolem">I</span> <span class="keyword1">⊫s</span> set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="keyword1">⋅cs</span> <span class="bound">σ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      η_gr<span class="main">:</span> <span class="quoted"><span class="quoted">"is_ground_subst <span class="skolem">η</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      the_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_resolve_rename <span class="free">S</span> <span class="skolem">CAs</span> <span class="main">(</span>main_prem_of <span class="skolem">ι</span><span class="main">)</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">σ</span> <span class="main">(</span>concl_of <span class="skolem">ι</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      CAs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CAs</span> <span class="main">=</span> side_prems_of <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i_in <span class="keyword1"><span class="command">unfolding</span></span> F_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">=</span> mset <span class="main">(</span>side_prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">+</span> <span class="main">{#</span>main_prem_of <span class="skolem">ι</span><span class="main">#}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> F_Inf_have_prems<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_in<span class="main"><span class="main">]</span></span> add.right_neutral append_Cons append_Nil2
          append_butlast_last_id mset.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mset_rev mset_single_iff_right rev_append
          rev_is_Nil_conv union_mset_add_mset_right<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊫</span> concl_of <span class="skolem">ι</span> <span class="main">⋅</span> <span class="skolem">η</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ord_resolve_rename_sound<span class="main">[</span><span class="operator">OF</span> the_inf<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="skolem">η</span></span><span class="main">,</span> <span class="operator">OF</span> _ η_gr<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> CAs prems<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> I_entails_prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_mset_mset set_mset_subst_cls_mset_subst_clss true_clss_set_mset<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inference.prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="keyword1">⊫𝒢e</span> <span class="main">{</span>concl_of <span class="skolem">ι</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F.entails_𝒢_def 𝒢_F_def true_Union_grounding_of_cls_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-G_Inf_overapprox_F_Inf"><span class="command">lemma</span></span> G_Inf_overapprox_F_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> G.Inf_from <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> F.Inf_from <span class="free">M</span><span class="main">.</span> <span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> 𝒢_I <span class="free">M</span> <span class="bound">ι</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> G.Inf_from <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> prems_ι<span class="hidden">⇩</span><sub>0</sub>_in<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_in <span class="keyword1"><span class="command">unfolding</span></span> G.Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_G_Inf <span class="main">=</span> G.Inf_if_Inf_from<span class="main">[</span><span class="operator">OF</span> ι<span class="hidden">⇩</span><sub>0</sub>_in<span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    gr_res<span class="main">:</span> <span class="quoted"><span class="quoted">‹gr.ord_resolve <span class="free">M</span> <span class="skolem">CAs</span> <span class="skolem">DA</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">E</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ι<span class="hidden">⇩</span><sub>0</sub>_is<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> CAs_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">CAs</span> <span class="main">⊆</span> set <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_is subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ground_CAs<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_ground_cls_list <span class="skolem">CAs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems_ι<span class="hidden">⇩</span><sub>0</sub>_in union_grounding_of_cls_ground is_ground_cls_list_def is_ground_clss_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> DA_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> set <span class="main">(</span>prems_of <span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_is <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ground_DA<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_ground_cls <span class="skolem">DA</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems_ι<span class="hidden">⇩</span><sub>0</sub>_in union_grounding_of_cls_ground is_ground_clss_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    grounded_res<span class="main">:</span> <span class="quoted"><span class="quoted">‹ord_resolve <span class="main">(</span>S_M <span class="free">S</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">CAs</span> <span class="skolem">DA</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">σ</span> <span class="skolem">E</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ground_ord_resolve_imp_ord_resolve<span class="main">[</span><span class="operator">OF</span> ground_DA ground_CAs
        gr.ground_resolution_with_selection_axioms gr_res<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> prems_ground<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">DA</span><span class="main">}</span> <span class="main">∪</span> set <span class="skolem">CAs</span> <span class="main">⊆</span> 𝒢_Fset <span class="free">M</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems_ι<span class="hidden">⇩</span><sub>0</sub>_in CAs_in DA_in <span class="keyword1"><span class="command">unfolding</span></span> 𝒢_Fset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ηs</span></span> <span class="skolem"><span class="skolem">η</span></span> <span class="skolem"><span class="skolem">η2</span></span> <span class="skolem"><span class="skolem">CAs0</span></span> <span class="skolem"><span class="skolem">DA0</span></span> <span class="skolem"><span class="skolem">AAs0</span></span> <span class="skolem"><span class="skolem">As0</span></span> <span class="skolem"><span class="skolem">E0</span></span> <span class="skolem"><span class="skolem">τ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ground_n<span class="main">:</span> <span class="quoted"><span class="quoted">"is_ground_subst <span class="skolem">η</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ground_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"is_ground_subst_list <span class="skolem">ηs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ground_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_ground_subst <span class="skolem">η2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ngr_res<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_resolve_rename <span class="free">S</span> <span class="skolem">CAs0</span> <span class="skolem">DA0</span> <span class="skolem">AAs0</span> <span class="skolem">As0</span> <span class="skolem">τ</span> <span class="skolem">E0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    CAs0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">CAs0</span> <span class="keyword1">⋅⋅cl</span> <span class="skolem">ηs</span> <span class="main">=</span> <span class="skolem">CAs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    DA0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DA0</span> <span class="main">⋅</span> <span class="skolem">η</span> <span class="main">=</span> <span class="skolem">DA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E0_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E0</span> <span class="main">⋅</span> <span class="skolem">η2</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    prems_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">DA0</span><span class="main">}</span> <span class="main">∪</span> set <span class="skolem">CAs0</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    len_CAs0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">CAs0</span> <span class="main">=</span> length <span class="skolem">CAs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    len_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ηs</span> <span class="main">=</span> length <span class="skolem">CAs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_resolve_rename_lifting<span class="main">[</span><span class="operator">OF</span> _ grounded_res selection_axioms prems_ground<span class="main">]</span> sel_stable
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">CAs0</span> <span class="main">=</span> length <span class="skolem">ηs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len_CAs0 len_ns <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_is'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Infer <span class="main">(</span><span class="main">(</span><span class="skolem">CAs0</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA0</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⋅⋅cl</span> <span class="main">(</span><span class="skolem">ηs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">η</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">E0</span> <span class="main">⋅</span> <span class="skolem">η2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι<span class="hidden">⇩</span><sub>0</sub>_is <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CAs0_is<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> DA0_is<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> E0_is<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause inference"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">=</span> Infer <span class="main">(</span><span class="skolem">CAs0</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA0</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E0</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> i_F_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> F_Inf›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ι_def F_Inf_def <span class="keyword1"><span class="command">using</span></span> ngr_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ρ</span> <span class="bound">ρs</span><span class="main">.</span> <span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Infer <span class="main">(</span><span class="main">(</span><span class="skolem">CAs0</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA0</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⋅⋅cl</span> <span class="bound">ρs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">E0</span> <span class="main">⋅</span> <span class="bound">ρ</span><span class="main">)</span> <span class="main">∧</span> is_ground_subst_list <span class="bound">ρs</span>
    <span class="main">∧</span> is_ground_subst <span class="bound">ρ</span> <span class="main">∧</span> Infer <span class="main">(</span><span class="main">(</span><span class="skolem">CAs0</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA0</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⋅⋅cl</span> <span class="bound">ρs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">E0</span> <span class="main">⋅</span> <span class="bound">ρ</span><span class="main">)</span> <span class="main">∈</span> G_Inf <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">η2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">ηs</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> <span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">η</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> ground_ns <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
        <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">:</span> ground_n ground_n2 ι<span class="hidden">⇩</span><sub>0</sub>_G_Inf<span class="main">[</span><span class="operator">unfolded</span> ι<span class="hidden">⇩</span><sub>0</sub>_is'<span class="main">]</span>
           <span class="quasi_keyword">simp</span><span class="main">:</span> ι<span class="hidden">⇩</span><sub>0</sub>_is' is_ground_subst_list_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ι<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> 𝒢_I <span class="free">M</span> <span class="skolem">ι</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> 𝒢_I_def ι_def CAs0_is<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> DA0_is<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> E0_is<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι</span> <span class="main">∈</span> F.Inf_from <span class="free">M</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems_in i_F_Inf <span class="keyword1"><span class="command">unfolding</span></span> F.Inf_from_def ι_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> F<span class="main">:</span> statically_complete_calculus <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted">F_Inf</span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊫𝒢e)</span>"</span></span> <span class="quoted">F.Red_I_𝒢</span> <span class="quoted">F.Red_F_𝒢_empty</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> F.stat_ref_comp_to_non_ground_fam_inter<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">M</span><span class="main">.</span> statically_complete_calculus <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">(</span>G_Inf <span class="bound">M</span><span class="main">)</span> <span class="keyword1">(⊫e)</span> <span class="main">(</span>G.Red_I <span class="bound">M</span><span class="main">)</span> G.Red_F"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> G.statically_complete_calculus_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"F.saturated <span class="skolem">N</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F.ground.Inf_from_q <span class="skolem">N</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">ι</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span> <span class="main">∈</span> F.Inf_from <span class="skolem">N</span><span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> 𝒢_I <span class="skolem">N</span> <span class="bound">ι'</span><span class="main">}</span>
    <span class="main">∪</span> G.Red_I <span class="skolem">N</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G_Inf_overapprox_F_Inf <span class="keyword1"><span class="command">unfolding</span></span> F.ground.Inf_from_q_def 𝒢_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Labeled First-Order or Given Clause Layer›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> label <span class="main">=</span> New <span class="main">|</span> Processed <span class="main">|</span> Old

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FL_Infer_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause inference <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> label<span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FL_Infer_of</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">=</span> <span class="main">{</span>Infer <span class="bound">Cls</span> <span class="main">(</span><span class="bound">D</span><span class="main">,</span> New<span class="main">)</span> <span class="main">|</span><span class="bound">Cls</span> <span class="bound">D</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">=</span> Infer <span class="main">(</span>map fst <span class="bound">Cls</span><span class="main">)</span> <span class="bound">D</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FL_Inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> label<span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FL_Inf</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">ι</span> <span class="main">∈</span> F_Inf<span class="main">.</span> FL_Infer_of <span class="bound">ι</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">F_Equiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≐</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">≐</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> generalizes <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">∧</span> generalizes <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">F_Prec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause <span class="main">⇒</span> <span class="tfree">'a</span> clause <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≺⋅</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">≺⋅</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> strictly_generalizes <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">L_Prec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"label <span class="main">⇒</span> label <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏l</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"Old <span class="keyword1"><span class="free">⊏l</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≠</span> Old"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Processed <span class="keyword1"><span class="free">⊏l</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> New"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"New <span class="keyword1"><span class="free">⊏l</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">⟷</span> False"</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-irrefl_L_Prec"><span class="command">lemma</span></span> irrefl_L_Prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l</span> <span class="keyword1">⊏l</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-trans_L_Prec"><span class="command">lemma</span></span> trans_L_Prec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="keyword1">⊏l</span> <span class="free">l2</span> <span class="main">⟹</span> <span class="free">l2</span> <span class="keyword1">⊏l</span> <span class="free">l3</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="keyword1">⊏l</span> <span class="free">l3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">l2</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">l3</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-wf_L_Prec"><span class="command">lemma</span></span> wf_L_Prec<span class="main">:</span> <span class="quoted"><span class="quoted">"wfP <span class="keyword1">(⊏l)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L_Prec.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> L_Prec.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_accp_down wfP_accp_iff<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> FL<span class="main">:</span> given_clause <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted">F_Inf</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span> <span class="quoted">UNIV</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="keyword1">(⊫e)</span>"</span></span> <span class="quoted">G_Inf</span> <span class="quoted">G.Red_I</span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> G.Red_F"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> 𝒢_F"</span></span> <span class="quoted">𝒢_I_opt</span> <span class="quoted">FL_Inf</span> <span class="quoted"><span class="quoted">"<span class="main">(≐)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≺⋅)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(⊏l)</span>"</span></span> <span class="quoted">Old</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equivp <span class="main">(≐)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> equivp_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> generalizes_refl generalizes_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"po_on <span class="main">(≺⋅)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> po_on_def irreflp_on_def transp_on_def
    <span class="keyword1"><span class="command">using</span></span> strictly_generalizes_irrefl strictly_generalizes_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(≺⋅)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wfp_on_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> wf_strictly_generalizes<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"po_on <span class="keyword1">(⊏l)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> po_on_def irreflp_on_def transp_on_def <span class="keyword1"><span class="command">using</span></span> irrefl_L_Prec trans_L_Prec <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="keyword1">(⊏l)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wfp_on_UNIV <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_L_Prec<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C1</span> <span class="skolem">D1</span> <span class="skolem">C2</span> <span class="skolem">D2</span>
  <span class="keyword3"><span class="command">assume</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≐</span> <span class="skolem">D1</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">≐</span> <span class="skolem">D2</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≺⋅</span> <span class="skolem">C2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D1</span> <span class="main">≺⋅</span> <span class="skolem">D2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> antisym size_mset_mono size_subst strictly_generalizes_def generalizes_def
        generalizes_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">C1</span> <span class="skolem">C2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≐</span> <span class="skolem">C2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒢_F <span class="skolem">C1</span> <span class="main">⊆</span> 𝒢_F <span class="skolem">C2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> generalizes_def 𝒢_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> is_ground_comp_subst subst_cls_comp_subst<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="skolem">C2</span> <span class="skolem">C1</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">≺⋅</span> <span class="skolem">C1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒢_F <span class="skolem">C1</span> <span class="main">⊆</span> 𝒢_F <span class="skolem">C2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strictly_generalizes_def generalizes_def 𝒢_F_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> is_ground_comp_subst subst_cls_comp_subst<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> L_Prec Old <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L_Prec.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL_Inf_def FL_Infer_of_def F_Inf_have_prems<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> FL.Prec_FL <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> FL.entails_𝒢_L <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊫𝒢Le</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> FL.derive <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊳L</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> FL.step <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↝GC</span>"</span> 50<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-FL_Red_F_eq"><span class="command">lemma</span></span> FL_Red_F_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"FL.Red_F <span class="free">N</span> <span class="main">=</span>
   <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">C</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊏</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FL.Red_F_def FL.Red_F_𝒢_q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-mem_FL_Red_F_because_G_Red_F"><span class="command">lemma</span></span> mem_FL_Red_F_because_G_Red_F<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Cl</span> <span class="main">∈</span> FL.Red_F <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FL_Red_F_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-mem_FL_Red_F_because_Prec_FL"><span class="command">lemma</span></span> mem_FL_Red_F_because_Prec_FL<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">El</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">El</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">El</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Cl</span> <span class="main">∈</span> FL.Red_F <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FL_Red_F_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Resolution Prover Layer›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> sq<span class="main">:</span> selection <span class="quoted"><span class="quoted">"S_Q <span class="free">Sts</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> S_Q_def <span class="keyword1"><span class="command">using</span></span> S_M_selects_subseteq S_M_selects_neg_lits selection_axioms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> gd<span class="main">:</span> ground_resolution_with_selection <span class="quoted"><span class="quoted">"S_Q <span class="free">Sts</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">interpretation</span></span> src<span class="main">:</span> standard_redundancy_criterion_counterex_reducing <span class="quoted"><span class="quoted">"gd.ord_Γ <span class="free">Sts</span>"</span></span>
  <span class="quoted"><span class="quoted">"ground_resolution_with_selection.INTERP <span class="main">(</span>S_Q <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lclss_of_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> state <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> label<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lclss_of_state</span> <span class="free"><span class="bound"><span class="entity">St</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> New<span class="main">)</span><span class="main">)</span> <span class="main">`</span> N_of_state <span class="free"><span class="bound"><span class="entity">St</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> Processed<span class="main">)</span><span class="main">)</span> <span class="main">`</span> P_of_state <span class="free"><span class="bound"><span class="entity">St</span></span></span>
   <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Q_of_state <span class="free"><span class="bound"><span class="entity">St</span></span></span>"</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-image_hd_lclss_of_state"><span class="command">lemma</span></span> image_hd_lclss_of_state<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> lclss_of_state <span class="free">St</span> <span class="main">=</span> clss_of_state <span class="free">St</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_Un image_comp<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-insert_lclss_of_state"><span class="command">lemma</span></span> insert_lclss_of_state<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span> <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lclss_of_state <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">C</span><span class="main">,</span> Processed<span class="main">)</span> <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span> <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-union_lclss_of_state"><span class="command">lemma</span></span> union_lclss_of_state<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="free">N1</span><span class="main">,</span> <span class="free">P1</span><span class="main">,</span> <span class="free">Q1</span><span class="main">)</span> <span class="main">∪</span> lclss_of_state <span class="main">(</span><span class="free">N2</span><span class="main">,</span> <span class="free">P2</span><span class="main">,</span> <span class="free">Q2</span><span class="main">)</span> <span class="main">=</span>
   lclss_of_state <span class="main">(</span><span class="free">N1</span> <span class="main">∪</span> <span class="free">N2</span><span class="main">,</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span><span class="main">,</span> <span class="free">Q1</span> <span class="main">∪</span> <span class="free">Q2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-mem_lclss_of_state"><span class="command">lemma</span></span> mem_lclss_of_state<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span> <span class="main">∈</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">C</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> Processed<span class="main">)</span> <span class="main">∈</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">C</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span> <span class="main">∈</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">C</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-lclss_Liminf_commute"><span class="command">lemma</span></span> lclss_Liminf_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> lclss_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> New<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap N_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">∪</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> Processed<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap P_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">∪</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap Q_of_state <span class="free">Sts</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def <span class="keyword1"><span class="command">using</span></span> Liminf_llist_lmap_union Liminf_llist_lmap_image
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pair_inject Un_iff disjoint_iff_not_equal imageE inj_onI label.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span>
        llist.map_cong<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def Liminf_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-GC_tautology_step"><span class="command">lemma</span></span> GC_tautology_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tauto<span class="main">:</span> <span class="quoted"><span class="quoted">"Neg <span class="free">A</span> <span class="main">∈#</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"Pos <span class="free">A</span> <span class="main">∈#</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">↝GC</span> lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cθ_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cθ</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">N'</span><span class="main">.</span> 𝒢_F <span class="main">(</span>fst <span class="bound">D</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> in_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Cθ</span> <span class="main">∈</span> 𝒢_F <span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> clause <span class="main">×</span> label<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Cθ</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Cθ</span> <span class="main">=</span> <span class="free">C</span> <span class="main">⋅</span> <span class="skolem">θ</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> in_g <span class="keyword1"><span class="command">unfolding</span></span> 𝒢_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Neg <span class="main">(</span><span class="free">A</span> <span class="keyword1">⋅a</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">Cθ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Pos <span class="main">(</span><span class="free">A</span> <span class="keyword1">⋅a</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">∈#</span> <span class="skolem">Cθ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tauto Neg_Melem_subst_atm_subst_cls Pos_Melem_subst_atm_subst_cls <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="skolem">Cθ</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def true_cls_def true_lit_def if_distrib_fun
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> literal.disc literal.sel singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> G.Red_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FL.step.process<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"lclss_of_state <span class="main"><span class="main">(</span></span><span class="free"><span class="free">N</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">P</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">Q</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">C</span></span><span class="main"><span class="main">,</span></span> New<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> FL.Red_F_𝒢 <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{}</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> mem_FL_Red_F_because_G_Red_F cθ_red<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="free">N</span><span class="main">,</span> <span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> lclss_of_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lclss_of_state_def FL.active_subset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-GC_subsumption_step"><span class="command">lemma</span></span> GC_subsumption_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    d_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Dl</span> <span class="main">∈</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_sub_c<span class="main">:</span> <span class="quoted"><span class="quoted">"strictly_subsumes <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">∨</span> subsumes <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">∧</span> snd <span class="free">Dl</span> <span class="keyword1">⊏l</span> snd <span class="free">Cl</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">Cl</span><span class="main">}</span> <span class="keyword1">↝GC</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> d_sub'_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Cl</span> <span class="main">∈</span> FL.Red_F <span class="main">{</span><span class="free">Dl</span><span class="main">}</span> <span class="main">∨</span> <span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"size <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> sizes_eq<span class="main">:</span> <span class="quoted"><span class="quoted">‹size <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹size <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">⟹</span>
        strictly_subsumes <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">∨</span> subsumes <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">∧</span> snd <span class="free">Dl</span> <span class="keyword1">⊏l</span> snd <span class="free">Cl</span> <span class="main">⟹</span>
        <span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> FL.Prec_FL_def
        <span class="keyword1"><span class="command">unfolding</span></span> generalizes_def strictly_generalizes_def strictly_subsumes_def subsumes_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> size_subst subset_mset.order_refl subseteq_mset_size_eql<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sizes_eq d_sub_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d_ssub_c<span class="main">:</span> <span class="quoted"><span class="quoted">"strictly_subsumes <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_sub_c <span class="keyword1"><span class="command">unfolding</span></span> strictly_subsumes_def subsumes_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> size_subst strict_subset_subst_strictly_subsumes strictly_subsumes_antisym
          subset_mset.antisym_conv2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Cl</span> <span class="main">∈</span> FL.Red_F <span class="main">{</span><span class="free">Dl</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mem_FL_Red_F_because_G_Red_F<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_ssub_c <span class="keyword1"><span class="command">unfolding</span></span> G.Red_F_def strictly_subsumes_def subsumes_def 𝒢_F_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span> <span class="skolem">σ'</span>
        <span class="keyword3"><span class="command">assume</span></span>
          fst_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">⊆#</span> fst <span class="free">Dl</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          fst_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⊆#</span> fst <span class="free">Cl</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          gr_sig<span class="main">:</span> <span class="quoted"><span class="quoted">‹is_ground_subst <span class="skolem">σ'</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⋅</span> <span class="skolem">σ'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">|</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> gr_sig
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> is_ground_comp_subst mem_Collect_eq singletonD subsetI
              subst_cls_comp_subst<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⋅</span> <span class="skolem">σ'</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">I</span> <span class="main">⊫</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fst_in
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subst_cls_mono_mset true_clss_insert true_clss_subclause<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⋅</span> <span class="skolem">σ'</span><span class="main">}</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fst_not_in fst_in gr_sig
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">σ</span><span class="main">.</span> <span class="main">¬</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">⊆#</span> fst <span class="free">Dl</span> <span class="main">⟹</span> fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⊆#</span> fst <span class="free">Cl</span> <span class="main">⟹</span> is_ground_subst <span class="skolem">σ'</span> <span class="main">⟹</span>
            fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⋅</span> <span class="skolem">σ'</span> <span class="main">&lt;</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ'</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False size_subst subset_imp_less_mset subset_mset.le_less subst_subset_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">|</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span><span class="main">}</span><span class="main">.</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="bound">DD</span> <span class="main">⟶</span> <span class="bound">I</span> <span class="main">⊫</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ'</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FL.step.process<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">Cl</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Cl</span> <span class="main">∈</span> FL.Red_F_𝒢 <span class="free">N</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_sub'_c <span class="keyword1"><span class="command">unfolding</span></span> FL_Red_F_eq
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">⟶</span> <span class="bound">D</span> <span class="main">∉</span> 𝒢_F <span class="main">(</span>fst <span class="bound">E</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span>𝒢_F <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Dl</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> 𝒢_F <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> G.Red_F_of_subset SUP_upper d_in subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">D</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">⟶</span> <span class="bound">D</span> <span class="main">∉</span> 𝒢_F <span class="main">(</span>fst <span class="bound">E</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">⟹</span>
        <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> 𝒢_F <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> FL.Prec_FL_def FL.equiv_F_grounding FL.prec_F_grounding UNIV_witness d_in in_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Cl</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">C</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊏</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∨</span> <span class="free">Dl</span> <span class="main">⊏</span> <span class="free">Cl</span> <span class="main">⟹</span>
        <span class="free">Cl</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">C</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">E</span> <span class="main">∈</span> <span class="free">N</span><span class="main">.</span> <span class="bound">E</span> <span class="main">⊏</span> <span class="bound">C</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FL.active_subset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-GC_reduction_step"><span class="command">lemma</span></span> GC_reduction_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    young<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="free">Dl</span> <span class="main">≠</span> Old"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    d_sub_c<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">Dl</span> <span class="main">⊂#</span> fst <span class="free">Cl</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">Cl</span><span class="main">}</span> <span class="keyword1">↝GC</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FL.step.process<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">Cl</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="free"><span class="free">Dl</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Cl</span> <span class="main">∈</span> FL.Red_F <span class="main">{</span><span class="free">Dl</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mem_FL_Red_F_because_G_Red_F<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> 𝒢_F <span class="main">(</span>fst <span class="free">Cl</span><span class="main">)</span><span class="main">.</span> <span class="bound">D</span> <span class="main">∈</span> G.Red_F <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> fst <span class="main">`</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_sub_c <span class="keyword1"><span class="command">unfolding</span></span> G.Red_F_def strictly_subsumes_def subsumes_def 𝒢_F_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">σ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹is_ground_subst <span class="skolem">σ</span>›</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">|</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">&lt;</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> subst_subset_mono<span class="main">[</span><span class="operator">OF</span> d_sub_c<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">σ</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_imp_less_mset<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊫</span> fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="skolem">σ</span> <span class="main">⟶</span> <span class="bound">I</span> <span class="main">⊫</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> subst_subset_mono<span class="main">[</span><span class="operator">OF</span> d_sub_c<span class="main">]</span> true_clss_subclause <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">DD</span></span> <span class="main">⊆</span> <span class="main">{</span>fst <span class="free">Dl</span> <span class="main">⋅</span> <span class="bound">σ</span> <span class="main">|</span><span class="bound">σ</span><span class="main">.</span> is_ground_subst <span class="bound">σ</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="keyword1">⊫s</span> <span class="bound">DD</span> <span class="main">⟶</span> <span class="bound">I</span> <span class="main">⊫</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ</span><span class="main">)</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> fst <span class="free">Cl</span> <span class="main">⋅</span> <span class="skolem">σ</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Cl</span><span class="main">}</span> <span class="main">⊆</span> FL.Red_F <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">Dl</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FL.Red_F_of_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL.active_subset_def young<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-GC_processing_step"><span class="command">lemma</span></span> GC_processing_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span><span class="main">}</span> <span class="keyword1">↝GC</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Processed<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FL.step.process<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">C</span></span><span class="main"><span class="main">,</span></span> New<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">C</span></span><span class="main"><span class="main">,</span></span> Processed<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span> <span class="main">∈</span> FL.Red_F <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Processed<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mem_FL_Red_F_because_Prec_FL<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FL.Prec_FL_def generalizes_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> New<span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> FL.Red_F <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Processed<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FL.Red_F_of_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL.active_subset_def<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-old_inferences_between_eq_new_inferences_between"><span class="command">lemma</span></span> old_inferences_between_eq_new_inferences_between<span class="main">:</span>
  <span class="quoted"><span class="quoted">"old_concl_of <span class="main">`</span> inference_system.inferences_between <span class="main">(</span>ord_FO_Γ <span class="free">S</span><span class="main">)</span> <span class="free">N</span> <span class="free">C</span> <span class="main">=</span>
   concl_of <span class="main">`</span> F.Inf_between <span class="free">N</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">=</span> <span class="var">?f</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
  <span class="keyword3"><span class="command">assume</span></span> e_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> old_concl_of <span class="main">`</span> inference_system.inferences_between <span class="main">(</span>ord_FO_Γ <span class="free">S</span><span class="main">)</span> <span class="free">N</span> <span class="free">C</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    e_res<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_resolve_rename <span class="free">S</span> <span class="skolem">CAs</span> <span class="skolem">DA</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">σ</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cd_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">CAs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">DA</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> set <span class="skolem">CAs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">DA</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_in <span class="keyword1"><span class="command">unfolding</span></span> inference_system.inferences_between_def infer_from_def ord_FO_Γ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> concl_of <span class="main">`</span> F.Inf_between <span class="free">N</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F.Inf_between_alt F.Inf_from_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span> <span class="main">∈</span> F_Inf <span class="main">∧</span> set <span class="main">(</span>prems_of <span class="main">(</span>Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">C</span> <span class="free">N</span> <span class="main">∧</span>
      <span class="free">C</span> <span class="main">∈</span> set <span class="main">(</span>prems_of <span class="main">(</span>Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">E</span> <span class="main">=</span> concl_of <span class="main">(</span>Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_res cd_sub c_in F_Inf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">∈</span> concl_of <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> F_Inf<span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> F_Inf<span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span><span class="main">}</span> <span class="main">∧</span>
      set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Un_insert_right boolean_algebra_cancel.sup0 disjoint_insert mem_Collect_eq image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
  <span class="keyword3"><span class="command">assume</span></span> e_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> concl_of <span class="main">`</span> F.Inf_between <span class="free">N</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">σ</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    e_res<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_resolve_rename <span class="free">S</span> <span class="skolem">CAs</span> <span class="skolem">DA</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">σ</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    cd_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">CAs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">DA</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> set <span class="skolem">CAs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">DA</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_in <span class="keyword1"><span class="command">unfolding</span></span> F.Inf_between_alt F.Inf_from_def F_Inf_def inference_system.Inf_between_alt
      inference_system.Inf_from_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Bex_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∈</span> old_concl_of <span class="main">`</span> inference_system.inferences_between <span class="main">(</span>ord_FO_Γ <span class="free">S</span><span class="main">)</span> <span class="free">N</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inference_system.inferences_between_def infer_from_def ord_FO_Γ_def
    <span class="keyword1"><span class="command">using</span></span> e_res cd_sub c_in
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Bex_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"old_Infer <span class="main">(</span>mset <span class="skolem">CAs</span><span class="main">)</span> <span class="skolem">DA</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-GC_inference_step"><span class="command">lemma</span></span> GC_inference_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    young<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> Old"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_active<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.active_subset <span class="free">M</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    m_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">M</span> <span class="main">⊇</span> old_concl_of <span class="main">`</span> inference_system.inferences_between <span class="main">(</span>ord_FO_Γ <span class="free">S</span><span class="main">)</span>
      <span class="main">(</span>fst <span class="main">`</span> FL.active_subset <span class="free">N</span><span class="main">)</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">l</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">↝GC</span> <span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> FL.step.infer<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">l</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> m_sup'<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">M</span> <span class="main">⊇</span> concl_of <span class="main">`</span> F.Inf_between <span class="main">(</span>fst <span class="main">`</span> FL.active_subset <span class="free">N</span><span class="main">)</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> m_sup <span class="keyword1"><span class="command">unfolding</span></span> old_inferences_between_eq_new_inferences_between <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"F.Inf_between <span class="main">(</span>fst <span class="main">`</span> FL.active_subset <span class="free">N</span><span class="main">)</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span> <span class="main">⊆</span> F.Red_I <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
    <span class="keyword3"><span class="command">assume</span></span> ι_in_if2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> F.Inf_between <span class="main">(</span>fst <span class="main">`</span> FL.active_subset <span class="free">N</span><span class="main">)</span> <span class="main">{</span><span class="free">C</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> ι_in <span class="main">=</span> F.Inf_if_Inf_between<span class="main">[</span><span class="operator">OF</span> ι_in_if2<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m_sup' ι_in_if2 m_sup' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def Collect_mono_iff F.Inf_between_alt<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concl_of <span class="skolem">ι</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> F.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="free">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> F.Red_I_of_Inf_to_N<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ι_in<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> young no_active <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-RP_step_imp_GC_step"><span class="command">lemma</span></span> RP_step_imp_GC_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">St</span> <span class="keyword1">↝RP</span> <span class="free">St'</span> <span class="main">⟹</span> lclss_of_state <span class="free">St</span> <span class="keyword1">↝GC</span> lclss_of_state <span class="free">St'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> RP.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tautology_deletion <span class="skolem">A</span> <span class="skolem">C</span> <span class="skolem">N</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GC_tautology_step<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>forward_subsumption <span class="skolem">D</span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> d_in <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> d_sub_c <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> GC_subsumption_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">D</span><span class="main">,</span> Processed<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> New<span class="main">)</span>"</span></span><span class="main">]</span> d_sub_c
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> GC_subsumption_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">D</span><span class="main">,</span> Old<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> New<span class="main">)</span>"</span></span><span class="main">]</span> d_sub_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>backward_subsumption_P <span class="skolem">D</span> <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> d_in <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> d_ssub_c <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_subsumption_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">D</span><span class="main">,</span> New<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> Processed<span class="main">)</span>"</span></span><span class="main">]</span> d_ssub_c
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>backward_subsumption_Q <span class="skolem">D</span> <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> d_in <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> d_ssub_c <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_subsumption_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">D</span><span class="main">,</span> New<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> Old<span class="main">)</span>"</span></span><span class="main">]</span> d_ssub_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>forward_reduction <span class="skolem">D</span> <span class="skolem">L'</span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">L</span> <span class="skolem">σ</span> <span class="skolem">C</span> <span class="skolem">N</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_reduction_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> New<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">L</span><span class="main">#}</span><span class="main">,</span> New<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>backward_reduction_P <span class="skolem">D</span> <span class="skolem">L'</span> <span class="skolem">N</span> <span class="skolem">L</span> <span class="skolem">σ</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_reduction_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> Processed<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">L</span><span class="main">#}</span><span class="main">,</span> Processed<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>backward_reduction_Q <span class="skolem">D</span> <span class="skolem">L'</span> <span class="skolem">N</span> <span class="skolem">L</span> <span class="skolem">σ</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_reduction_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> Processed<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">L</span><span class="main">#}</span><span class="main">,</span> Old<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>clause_processing <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> GC_processing_step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inference_computation <span class="skolem">N</span> <span class="skolem">Q</span> <span class="skolem">C</span> <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL.active_subset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹old_concls_of <span class="main">(</span>inference_system.inferences_between <span class="main">(</span>ord_FO_Γ <span class="free">S</span><span class="main">)</span>
      <span class="main">(</span>fst <span class="main">`</span> FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">N</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> n inference_system.inferences_between_def image_def mem_Collect_eq
        lclss_of_state_def infer_from_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL.active_subset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹lclss_of_state <span class="main">(</span><span class="main">{}</span><span class="main">,</span> insert <span class="skolem">C</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span> <span class="keyword1">↝GC</span> lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> insert <span class="skolem">C</span> <span class="skolem">Q</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> GC_inference_step<span class="main">[</span><span class="operator">of</span> <span class="quoted">Processed</span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="skolem">N</span><span class="main">,</span> <span class="main">{}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="skolem">P</span><span class="main">,</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">C</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FL.active_subset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-RP_derivation_imp_GC_derivation"><span class="command">lemma</span></span> RP_derivation_imp_GC_derivation<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span> <span class="main">⟹</span> chain <span class="keyword1">(↝GC)</span> <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_lmap RP_step_imp_GC_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-RP_step_imp_derive_step"><span class="command">lemma</span></span> RP_step_imp_derive_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">St</span> <span class="keyword1">↝RP</span> <span class="free">St'</span> <span class="main">⟹</span> lclss_of_state <span class="free">St</span> <span class="keyword1">⊳L</span> lclss_of_state <span class="free">St'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FL.one_step_equiv<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> RP_step_imp_GC_step<span class="main">)</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-RP_derivation_imp_derive_derivation"><span class="command">lemma</span></span> RP_derivation_imp_derive_derivation<span class="main">:</span>
  <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span> <span class="main">⟹</span> chain <span class="keyword1">(⊳L)</span> <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_lmap RP_step_imp_derive_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> RP_sound_new_statement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∈</span> clss_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"clss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"clss_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F.subset_entailed bot_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_hd_lclss_of_state lclss_Liminf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢Le</span> FL.Bot_FL"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FL.labeled_entailment_lifting <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lhd <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢Le</span> FL.Bot_FL"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹FL.entails_𝒢 <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">×</span> UNIV<span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹chain <span class="keyword1">(⊳L)</span> <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> deriv RP_derivation_imp_derive_derivation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹chain FL.entails_𝒢 <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> F_entails_𝒢_iff FL.labeled_entailment_lifting RP_model chain_lmap deriv 𝒢_Fset_def
        image_hd_lclss_of_state<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹FL.entails_𝒢 <span class="main">(</span>lhd <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">×</span> UNIV<span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> FL.unsat_limit_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lclss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢Le</span> FL.Bot_FL"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_not_lnull deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> FL.entails_𝒢_L_def F.entails_𝒢_def lclss_of_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> RP_saturated_if_fair_new_statement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"FL.saturated <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> nnil <span class="main">=</span> chain_not_lnull<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> gc_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> RP_derivation_imp_GC_derivation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> nnil init final
      FL.fair_implies_Liminf_saturated<span class="main">[</span><span class="operator">OF</span> FL.gc_to_red<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc_deriv<span class="main"><span class="main">]</span></span> FL.gc_fair<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc_deriv<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> RP_complete_if_fair_new_statement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    final<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"grounding_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∈</span> Q_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> nnil <span class="main">=</span> chain_not_lnull<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> len <span class="main">=</span> chain_length_pos<span class="main">[</span><span class="operator">OF</span> deriv<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> gc_deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> RP_derivation_imp_GC_derivation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deriv<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> hd_lcls<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> lhd <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> lhd <span class="main">(</span>lmap clss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> len zero_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> hd_unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> lhd <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="keyword1">⊫𝒢e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hd_lcls F_entails_𝒢_iff <span class="keyword1"><span class="command">unfolding</span></span> true_clss_def <span class="keyword1"><span class="command">using</span></span> unsat <span class="keyword1"><span class="command">unfolding</span></span> 𝒢_Fset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> chain_length_pos gc_deriv gr.ex_min_counterex i0_less
        llength_eq_0 llength_lmap llength_lmap llist.map_sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> true_cls_empty true_clss_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">BL</span> <span class="main">∈</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span> <span class="main">×</span> UNIV<span class="main">.</span> <span class="bound">BL</span> <span class="main">∈</span> Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> FL.gc_complete_Liminf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc_deriv<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{#}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">use</span> final hd_unsat <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> init nnil›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Liminf_state_def lclss_Liminf_commute
    <span class="keyword1"><span class="command">using</span></span> final<span class="main">[</span><span class="operator">unfolded</span> FL.passive_subset_def<span class="main">]</span> Liminf_state_def lclss_Liminf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Alternative Derivation of Previous \textsf{RP} Results›</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-old_fair_imp_new_fair"><span class="command">lemma</span></span> old_fair_imp_new_fair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    nnul<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">"fair_state_seq <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    empty_Q0<span class="main">:</span> <span class="quoted"><span class="quoted">"Q_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"FL.passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FL.active_subset <span class="main">(</span>lclss_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nnul empty_Q0 <span class="keyword1"><span class="command">unfolding</span></span> FL.active_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">Sts</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"FL.passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fair
    <span class="keyword1"><span class="command">unfolding</span></span> fair_state_seq_def FL.passive_subset_def lclss_Liminf_commute lclss_of_state_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-old_redundant_infer_iff"><span class="command">lemma</span></span> old_redundant_infer_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"src.redundant_infer <span class="free">N</span> <span class="free">γ</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">DD</span><span class="main">.</span> <span class="bound">DD</span> <span class="main">⊆</span> <span class="free">N</span> <span class="main">∧</span> <span class="bound">DD</span> <span class="main">∪</span> set_mset <span class="main">(</span>old_side_prems_of <span class="free">γ</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span>old_concl_of <span class="free">γ</span><span class="main">}</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="bound">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> old_main_prem_of <span class="free">γ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD0</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DD0</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">DD0</span> <span class="main">∪</span> set_mset <span class="main">(</span>old_side_prems_of <span class="free">γ</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span>old_concl_of <span class="free">γ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">DD0</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> old_main_prem_of <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">DD</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    fin_dd<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">DD</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">⊆</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    dd_un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">DD</span> <span class="main">∪</span> set_mset <span class="main">(</span>old_side_prems_of <span class="free">γ</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span>old_concl_of <span class="free">γ</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    all_dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">D</span> <span class="main">∈</span> <span class="skolem">DD</span><span class="main">.</span> <span class="bound">D</span> <span class="main">&lt;</span> old_main_prem_of <span class="free">γ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> entails_concl_compact_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>old_concl_of <span class="free">γ</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">DD0</span></span> <span class="quoted"><span class="quoted">"set_mset <span class="main">(</span>old_side_prems_of <span class="free">γ</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> src.redundant_infer_def <span class="keyword1"><span class="command">using</span></span> fin_dd dd_in dd_un all_dd
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> finite_set_mset_mset_set true_clss_set_mset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> src.redundant_infer_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">old_infer_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> clause inference <span class="main">⇒</span> <span class="tfree">'a</span> old_inference"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">old_infer_of</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">=</span> old_Infer <span class="main">(</span>mset <span class="main">(</span>side_prems_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>main_prem_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span> <span class="main">(</span>concl_of <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-new_redundant_infer_imp_old_redundant_infer"><span class="command">lemma</span></span> new_redundant_infer_imp_old_redundant_infer<span class="main">:</span>
  <span class="quoted"><span class="quoted">"G.redundant_infer <span class="free">N</span> <span class="free">ι</span> <span class="main">⟹</span> src.redundant_infer <span class="free">N</span> <span class="main">(</span>old_infer_of <span class="free">ι</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> old_redundant_infer_iff G.redundant_infer_def old_infer_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="FO_Ordered_Resolution_Prover_Revisited-saturated_imp_saturated_RP"><span class="command">lemma</span></span> saturated_imp_saturated_RP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    satur<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.saturated <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_passive<span class="main">:</span> <span class="quoted"><span class="quoted">"FL.passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"src.saturated_upto <span class="free">Sts</span> <span class="main">(</span>grounding_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> Liminf_llist <span class="main">(</span>lmap Q_of_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Ql</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">Ql</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> Old<span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>𝒢_F <span class="main">`</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> n_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"N_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    p_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"P_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_passive<span class="main">[</span><span class="operator">unfolded</span> FL.passive_subset_def<span class="main">]</span> Liminf_state_def lclss_Liminf_commute
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> limuls_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap lclss_of_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Ql</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ql_def Q_def <span class="keyword1"><span class="command">using</span></span> Liminf_state_def lclss_Liminf_commute lclss_of_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> clst_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"clss_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_empty p_empty Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Liminf_state_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gflimuls_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">Cl</span> <span class="main">∈</span> <span class="skolem">Ql</span><span class="main">.</span> 𝒢_F <span class="main">(</span>fst <span class="bound">Cl</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ql_def G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gd.inferences_from <span class="free">Sts</span> <span class="skolem">G</span> <span class="main">⊆</span> src.Ri <span class="free">Sts</span> <span class="skolem">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">γ</span>
    <span class="keyword3"><span class="command">assume</span></span> γ_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> gd.inferences_from <span class="free">Sts</span> <span class="skolem">G</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> G.Inf_from <span class="skolem">Q</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      γ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> old_infer_of <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> γ_inf
      <span class="keyword1"><span class="command">unfolding</span></span> gd.inferences_from_def old_infer_from_def G.Inf_from_def old_infer_of_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span>
        g_is<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">γ</span> <span class="main">∈</span> gd.ord_Γ <span class="free">Sts</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        prems_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹set_mset <span class="main">(</span>old_side_prems_of <span class="skolem">γ</span> <span class="main">+</span> <span class="main">{#</span>old_main_prem_of <span class="skolem">γ</span><span class="main">#}</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">CAs</span></span> <span class="skolem"><span class="skolem">DA</span></span> <span class="skolem"><span class="skolem">AAs</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> main_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">DA</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> side_in<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="skolem">CAs</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        g_is2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="skolem">γ</span> <span class="main">=</span> old_Infer <span class="main">(</span>mset <span class="skolem">CAs</span><span class="main">)</span> <span class="skolem">DA</span> <span class="skolem">E</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        ord_res<span class="main">:</span> <span class="quoted"><span class="quoted">‹gd.ord_resolve <span class="free">Sts</span> <span class="skolem">CAs</span> <span class="skolem">DA</span> <span class="skolem">AAs</span> <span class="skolem">As</span> <span class="skolem">E</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_is prems_in <span class="keyword1"><span class="command">unfolding</span></span> gd.ord_Γ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ι_γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι_γ</span> <span class="main">=</span> Infer <span class="main">(</span><span class="skolem">CAs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">DA</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ι_γ</span> <span class="main">∈</span> G_Inf <span class="skolem">Q</span>›</span></span>  <span class="keyword1"><span class="command">using</span></span> Q_of_state.simps g_is g_is2 ord_res Liminf_state_def S_Q_def
        <span class="keyword1"><span class="command">unfolding</span></span> gd.ord_Γ_def G_Inf_def Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>prems_of <span class="skolem">ι_γ</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_is2 prems_in <span class="keyword1"><span class="command">unfolding</span></span> ι_γ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">γ</span> <span class="main">=</span> old_Infer <span class="main">(</span>mset <span class="main">(</span>side_prems_of <span class="skolem">ι_γ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>main_prem_of <span class="skolem">ι_γ</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι_γ</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> g_is2 <span class="keyword1"><span class="command">unfolding</span></span> ι_γ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">ι</span><span class="main">.</span> <span class="bound">ι</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ι</span></span> <span class="main">∈</span> G_Inf <span class="skolem">Q</span><span class="main">.</span> set <span class="main">(</span>prems_of <span class="bound">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">G</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">γ</span> <span class="main">=</span> old_Infer <span class="main">(</span>mset <span class="main">(</span>side_prems_of <span class="bound">ι</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span>main_prem_of <span class="bound">ι</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="bound">ι</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ι'_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι'</span> <span class="main">∈</span> F.Inf_from <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ι_in_ι'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> 𝒢_I <span class="skolem">Q</span> <span class="skolem">ι'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> G_Inf_overapprox_F_Inf ι_inff <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">note</span></span> ι'_inf <span class="main">=</span> F.Inf_if_Inf_from<span class="main">[</span><span class="operator">OF</span> ι'_inff<span class="main">]</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?olds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"replicate <span class="main">(</span>length <span class="main">(</span>prems_of <span class="skolem">ι'</span><span class="main">)</span><span class="main">)</span> Old"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">l0</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ι''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι''</span> <span class="main">=</span> Infer <span class="main">(</span>zip <span class="main">(</span>prems_of <span class="skolem">ι'</span><span class="main">)</span> <span class="var">?olds</span><span class="main">)</span> <span class="main">(</span>concl_of <span class="skolem">ι'</span><span class="main">,</span> <span class="skolem">l0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      ι''_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι''</span> <span class="main">∈</span> FL_Inf"</span></span>
      <span class="keyword1"><span class="command">using</span></span> FL.Inf_F_to_Inf_FL<span class="main">[</span><span class="operator">OF</span> ι'_inf<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?olds</span></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι''</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">Ql</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ι'_inff<span class="main">[</span><span class="operator">unfolded</span> F.Inf_from_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ι'' Ql_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι''</span> <span class="main">∈</span> FL.Inf_from <span class="skolem">Ql</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> FL.Inf_from_def <span class="keyword1"><span class="command">using</span></span> ι''_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι'</span> <span class="main">=</span> FL.to_F <span class="skolem">ι''</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ι'' <span class="keyword1"><span class="command">unfolding</span></span> FL.to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> G.Red_I <span class="skolem">Q</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ι_in_ι'
        FL.sat_inf_imp_ground_red_fam_inter<span class="main">[</span><span class="operator">OF</span> satur<span class="main">,</span> <span class="operator">unfolded</span> limuls_eq gflimuls_eq<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G.redundant_infer <span class="skolem">G</span> <span class="skolem">ι</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> G.Red_I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> γ_red<span class="main">:</span> <span class="quoted"><span class="quoted">"src.redundant_infer <span class="skolem">G</span> <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> γ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> new_redundant_infer_imp_old_redundant_infer<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> gd.ord_Γ <span class="free">Sts</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> γ_inf gd.inferences_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">∈</span> src.Ri <span class="free">Sts</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> src.Ri_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def clst_eq src.saturated_upto_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">smt</span> Diff_subset gd.inferences_from_mono subset_eq 𝒢_Fset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> RP_sound_old_statement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bot_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∈</span> clss_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span>grounding_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> RP_sound_new_statement<span class="main">[</span><span class="operator">OF</span> deriv bot_in<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> F_entails_𝒢_iff 𝒢_Fset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The theorem below is stated differently than the original theorem in \textsf{RP}:
The grounding of the limit might be a strict subset of the limit of the groundings. Because
saturation is neither monotone nor antimonotone, the two results are incomparable. See also
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] grounding_of_state_Liminf_state_subseteq<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> RP_saturated_if_fair_old_statement_altered<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">"fair_state_seq <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    empty_Q0<span class="main">:</span> <span class="quoted"><span class="quoted">"Q_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"src.saturated_upto <span class="free">Sts</span> <span class="main">(</span>grounding_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fair' <span class="main">=</span> old_fair_imp_new_fair<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> deriv<span class="main"><span class="main"><span class="main">]</span></span></span> fair empty_Q0<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> saturated_imp_saturated_RP<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ fair'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> RP_saturated_if_fair_new_statement<span class="main">)</span>
      <span class="main">(</span><span class="operator">rule</span> deriv fair'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> RP_complete_if_fair_old_statement<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝RP)</span> <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    fair<span class="main">:</span> <span class="quoted"><span class="quoted">"fair_state_seq <span class="free">Sts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    empty_Q0<span class="main">:</span> <span class="quoted"><span class="quoted">"Q_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    unsat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> satisfiable <span class="main">(</span>grounding_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{#}</span> <span class="main">∈</span> Q_of_state <span class="main">(</span>Liminf_state <span class="free">Sts</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> RP_complete_if_fair_new_statement<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹𝒢_Fset <span class="main">(</span>N_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="main">∪</span> P_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span> <span class="main">∪</span> Q_of_state <span class="main">(</span>lhd <span class="free">Sts</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊫e</span> <span class="main">{</span><span class="main">{#}</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> unsat <span class="keyword1"><span class="command">unfolding</span></span> F_entails_𝒢_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> deriv old_fair_imp_new_fair<span class="main"><span class="main">[</span></span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">OF</span></span> deriv<span class="main"><span class="main">]</span></span> fair empty_Q0<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Given_Clause_Architectures_Revisited">
<div class="head">
<h1>Theory Given_Clause_Architectures_Revisited</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       New Fairness Proofs for the Given Clause Prover Architectures
    Author:      Jasmin Blanchette &lt;j.c.blanchette at vu.nl&gt;, 2020
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹New Fairness Proofs for the Given Clause Prover Architectures›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Given_Clause_Architectures_Revisited
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Saturation_Framework/Given_Clause_Architectures.html">Saturation_Framework.Given_Clause_Architectures</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The given clause and lazy given clause procedures satisfy key invariants. This
provides an alternative way to prove fairness and hence saturation of the limit.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Given Clause Procedure›</span></span>

<span class="keyword1"><span class="command">context</span></span> given_clause
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gc_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set llist <span class="main">⇒</span> enat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gc_invar</span> <span class="free"><span class="bound"><span class="entity">Ns</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟷</span>
   Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_upto_llist <span class="free"><span class="bound"><span class="entity">Ns</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Sup_upto_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free"><span class="bound"><span class="entity">Ns</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-gc_invar_infinity"><span class="command">lemma</span></span> gc_invar_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    nnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span> <span class="main">⟶</span> gc_invar <span class="free">Ns</span> <span class="main">(</span>enat <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gc_invar <span class="free">Ns</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Liminf_upto_llist_infinity Sup_upto_llist_infinity<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">As</span> <span class="main">=</span> lmap active_subset <span class="free">Ns</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> act_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> Liminf_llist <span class="skolem">As</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> As_def active_subset_def Liminf_set_filter_commute<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">note</span></span> ι_inf <span class="main">=</span> Inf_if_Inf_from<span class="main">[</span><span class="operator">OF</span> ι_inff<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> ι_inff' <span class="main">=</span> ι_inff<span class="main">[</span><span class="operator">unfolded</span> act_ns<span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="skolem">As</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> As_def <span class="keyword1"><span class="command">using</span></span> nnil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> Liminf_llist <span class="skolem">As</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ι_inff'<span class="main">[</span><span class="operator">unfolded</span> Inf_from_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    i_lt_as<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="skolem">As</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    prems_sub_ge_i<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> enat <span class="bound">j</span> <span class="main">&lt;</span> llength <span class="skolem">As</span><span class="main">}</span><span class="main">.</span> lnth <span class="skolem">As</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset_Liminf_llist_imp_exists_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">note</span></span> i_lt_ns <span class="main">=</span> i_lt_as<span class="main">[</span><span class="operator">unfolded</span> As_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> lnth <span class="skolem">As</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prems_sub_ge_i i_lt_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>lnth <span class="free">Ns</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_lt_as ι_inf <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def As_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_upto_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span> <span class="main">(</span>enat <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nnil i_lt_ns invar<span class="main">[</span><span class="operator">unfolded</span> gc_invar_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sup_upto_llist_subset_Sup_llist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-gc_invar_gc_init"><span class="command">lemma</span></span> gc_invar_gc_init<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gc_invar <span class="free">Ns</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms labeled_inf_have_prems <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-gc_invar_gc_step"><span class="command">lemma</span></span> gc_invar_gc_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Si_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    invar<span class="main">:</span> <span class="quoted"><span class="quoted">"gc_invar <span class="free">Ns</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    step<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">Ns</span> <span class="free">i</span> <span class="keyword1">↝GC</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gc_invar <span class="free">Ns</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> step Si_lt invar
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword1"><span class="command">have</span></span> i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Si_lt Suc_ile_eq order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> lim_i<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="free">Ns</span> <span class="main">(</span>enat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> lnth <span class="free">Ns</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lim_Si<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="free">Ns</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lnth <span class="free">Ns</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Si_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>process <span class="skolem">N</span> <span class="skolem">M</span> <span class="skolem">M'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> nSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> m'_pas <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m'_pas <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> active_subset_union boolean_algebra_cancel.sup0 Inf_from_mono
          subset_Un_eq sup_left_idem<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Sup_upto_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span> <span class="main">(</span>enat <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> invar <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def lim_i ni <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> Sup_upto_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def lim_Si nSi <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infer <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">L</span> <span class="skolem">M</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> nSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> l_pas <span class="main">=</span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> m_pas <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
      inff_red <span class="main">=</span> this<span class="main">(</span>5<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> ι_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Fι_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F<span class="main">[</span><span class="operator">folded</span> to_F_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff m_pas <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Fι_inff<span class="main">:</span>
        <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Fι_inf <span class="keyword1"><span class="command">unfolding</span></span> to_F_def Inf_from_def no_labels.Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_upto_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C</span><span class="main">}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Red_I_𝒢 <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inff_red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> labeled_red_inf_eq_red_inf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ι_inf<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Si_lt <span class="keyword1"><span class="command">using</span></span> nSi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Fι_inff <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Inf_from_def no_labels.Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ι_inf l_pas <span class="keyword1"><span class="command">unfolding</span></span> to_F_def Inf_from_def no_labels.Inf_from_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">smt</span> ι_inff<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Inf_from_def<span class="main"><span class="main">]</span></span> active_subset_def imageE image_subset_iff
              in_mono mem_Collect_eq prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> invar l_pas <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def lim_i ni <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def lim_Si nSi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-gc_invar_gc"><span class="command">lemma</span></span> gc_invar_gc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    gc<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gc_invar <span class="free">Ns</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_lt
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>enat <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> gc_invar_gc_init<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc<span class="main"><span class="main">]</span></span> init<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ih <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> Si_lt <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="free">Ns</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Si_lt Suc_ile_eq less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gc_invar_gc_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Si_lt ih<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_lt<span class="main"><span class="main">]</span></span> chain_lnth_rel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc Si_lt<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-gc_fair_new_proof"><span class="command">lemma</span></span> gc_fair_new_proof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    gc<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝GC)</span> <span class="free">Ns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    init<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>lhd <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    lim<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fair <span class="free">Ns</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fair_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="free">Ns</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> lim <span class="keyword1"><span class="command">unfolding</span></span> active_subset_def passive_subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Inf_from_mono empty_Collect_eq mem_Collect_eq subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> Sup_llist <span class="main">(</span>lmap Red_I_𝒢 <span class="free">Ns</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> gc_invar_infinity<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc<span class="main"><span class="main">]</span></span><span class="main">]</span> gc_invar_gc<span class="main">[</span><span class="operator">OF</span> gc init<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> gc_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lazy Given Clause›</span></span>

<span class="keyword1"><span class="command">context</span></span> lazy_given_clause
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">from_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> inference <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> inference set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">from_F</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">ι'</span></span> <span class="main">∈</span> <span class="free">Inf_FL</span><span class="main">.</span> to_F <span class="bound">ι'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lgc_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'f</span> inference set <span class="main">×</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">×</span> <span class="tfree">'l</span><span class="main">)</span> set<span class="main">)</span> llist <span class="main">⇒</span> enat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lgc_invar</span> <span class="free"><span class="bound"><span class="entity">TNs</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">⟷</span>
   Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_upto_llist <span class="main">(</span>lmap snd <span class="free"><span class="bound"><span class="entity">TNs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>
   <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> Liminf_upto_llist <span class="main">(</span>lmap fst <span class="free"><span class="bound"><span class="entity">TNs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">∪</span> Sup_upto_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">TNs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-lgc_invar_infinity"><span class="command">lemma</span></span> lgc_invar_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    nnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="free">TNs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    invar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> enat <span class="bound">i</span> <span class="main">&lt;</span> llength <span class="free">TNs</span> <span class="main">⟶</span> lgc_invar <span class="free">TNs</span> <span class="main">(</span>enat <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lgc_invar <span class="free">TNs</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Liminf_upto_llist_infinity Sup_upto_llist_infinity<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">As</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">As</span> <span class="main">=</span> lmap <span class="main">(</span>active_subset <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> act_ns<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Liminf_llist <span class="skolem">As</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> As_def active_subset_def Liminf_set_filter_commute<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> llist.map_comp <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">note</span></span> ι_inf <span class="main">=</span> Inf_if_Inf_from<span class="main">[</span><span class="operator">OF</span> ι_inff<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> ι_inff' <span class="main">=</span> ι_inff<span class="main">[</span><span class="operator">unfolded</span> act_ns<span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> Sup_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> ι_ni_lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> Liminf_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="skolem">As</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> As_def <span class="keyword1"><span class="command">using</span></span> nnil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> Liminf_llist <span class="skolem">As</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff'<span class="main">[</span><span class="operator">unfolded</span> Inf_from_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        i_lt_as<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="skolem">As</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        prems_sub_ge_i<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> enat <span class="bound">j</span> <span class="main">&lt;</span> llength <span class="skolem">As</span><span class="main">}</span><span class="main">.</span> lnth <span class="skolem">As</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_subset_Liminf_llist_imp_exists_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> ts_nnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> As_def nnil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> Fι_ni_lim<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∉</span> Liminf_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inf ι_ni_lim <span class="keyword1"><span class="command">unfolding</span></span> from_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        i_le_i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        i'_lt_as<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i'</span> <span class="main">&lt;</span> llength <span class="skolem">As</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        Fι_ni_i'<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∉</span> lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="skolem">i'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i_lt_as not_Liminf_llist_imp_exists_index<span class="main">[</span><span class="operator">OF</span> ts_nnil Fι_ni_lim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> As_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> ι_ni_i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> fst <span class="main">(</span>lnth <span class="free">TNs</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Fι_ni_i' i'_lt_as<span class="main">[</span><span class="operator">unfolded</span> As_def<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> from_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i'</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> enat <span class="bound">j</span> <span class="main">&lt;</span> llength <span class="skolem">As</span><span class="main">}</span><span class="main">.</span> lnth <span class="skolem">As</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prems_sub_ge_i i_le_i' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>prems_of <span class="skolem">ι</span><span class="main">)</span> <span class="main">⊆</span> lnth <span class="skolem">As</span> <span class="skolem">i'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i'_lt_as <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>snd <span class="main">(</span>lnth <span class="free">TNs</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i'_lt_as ι_inf <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def As_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ι_in_i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_upto_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="skolem">i'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_ni_i' i'_lt_as<span class="main">[</span><span class="operator">unfolded</span> As_def<span class="main">]</span> invar<span class="main">[</span><span class="operator">unfolded</span> lgc_invar_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Sup_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Sup_upto_llist_subset_Sup_llist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-lgc_invar_lgc_init"><span class="command">lemma</span></span> lgc_invar_lgc_init<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    nnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lnull <span class="free">TNs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_init<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    t_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lgc_invar <span class="free">TNs</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_upto_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    Inf_from <span class="main">{}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nnil n_init <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> fst <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t_init Inf_FL_to_Inf_F <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def from_F_def to_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> fst <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> Red_I_𝒢 <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> Liminf_upto_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>
    <span class="main">∪</span> Sup_upto_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nnil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-lgc_invar_lgc_step"><span class="command">lemma</span></span> lgc_invar_lgc_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    Si_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> llength <span class="free">TNs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    invar<span class="main">:</span> <span class="quoted"><span class="quoted">"lgc_invar <span class="free">TNs</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    step<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="free">TNs</span> <span class="free">i</span> <span class="keyword1">↝LGC</span> lnth <span class="free">TNs</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lgc_invar <span class="free">TNs</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> step Si_lt invar
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Sup_Red_i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Sup_upto_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Sup_Red_Si</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Sup_upto_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">TNs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Si_lt Suc_ile_eq order.strict_implies_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> lim_i<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="free">i</span><span class="main">)</span> <span class="main">=</span> lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lim_Si<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"Liminf_upto_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>enat <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Si_lt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>process <span class="skolem">N1</span> <span class="skolem">N</span> <span class="skolem">M</span> <span class="skolem">N2</span> <span class="skolem">M'</span> <span class="skolem">T</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> tni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> tnSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> n1 <span class="main">=</span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> n2 <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> m_red <span class="main">=</span> this<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
      m'_pas <span class="main">=</span> this<span class="main">(</span>6<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt n1 tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt n2 tnSi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt tnSi<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M'</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m'_pas <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> active_subset_union boolean_algebra_cancel.sup0 Inf_from_mono
          subset_Un_eq sup_left_idem<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> invar <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_i ni ti <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_Si</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sup_upto_llist_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_Si nSi tSi <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>schedule_infer <span class="skolem">T2</span> <span class="skolem">T1</span> <span class="skolem">T'</span> <span class="skolem">N1</span> <span class="skolem">N</span> <span class="skolem">C</span> <span class="skolem">L</span> <span class="skolem">N2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> tni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> tnSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> t2 <span class="main">=</span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> n1 <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> n2 <span class="main">=</span> this<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
      l_pas <span class="main">=</span> this<span class="main">(</span>6<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> t' <span class="main">=</span> this<span class="main">(</span>7<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">L</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt n1 tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt n2 tnSi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">T1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T1</span> <span class="main">∪</span> <span class="skolem">T'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt t2 tnSi<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> ι_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_FL</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff <span class="keyword1"><span class="command">unfolding</span></span> Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Fι_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Inf_FL_to_Inf_F<span class="main">[</span><span class="operator">folded</span> to_F_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="main">(</span><span class="skolem">T1</span> <span class="main">∪</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_Si</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_between <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="skolem">C</span><span class="main">}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="main">(</span><span class="skolem">T1</span> <span class="main">∪</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> t' from_F_def <span class="keyword1"><span class="command">using</span></span> ι_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> <span class="main">(</span>active_subset <span class="skolem">N</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="free">active</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ι_inff Fι_inf <span class="keyword1"><span class="command">unfolding</span></span> to_F_def Inf_from_def no_labels.Inf_from_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∈</span> no_labels.Inf_from <span class="main">(</span>fst <span class="main">`</span> active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> no_labels.Inf_from_def no_labels.Inf_between_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ι_inf <span class="keyword1"><span class="command">unfolding</span></span> to_F_def no_labels.Inf_from_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">smt</span> Inf_from_def Un_insert_right ι_inff active_subset_def
            boolean_algebra_cancel.sup0 imageE image_subset_iff insert_iff mem_Collect_eq
            prod.collapse snd_conv subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="main">(</span><span class="skolem">T1</span> <span class="main">∪</span> <span class="skolem">T'</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> invar<span class="main">[</span><span class="operator">unfolded</span> lgc_invar_def<span class="main">]</span> l_pas <span class="keyword1"><span class="command">unfolding</span></span> lim_i ni ti <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Sup_upto_llist_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_i lim_Si nSi tSi <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>compute_infer <span class="skolem">T1</span> <span class="skolem">T2</span> <span class="skolem">ι'</span> <span class="skolem">N2</span> <span class="skolem">N1</span> <span class="skolem">M</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> tni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> tnSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> t1 <span class="main">=</span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> n2 <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> m_pas <span class="main">=</span> this<span class="main">(</span>5<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
      ι'_red <span class="main">=</span> this<span class="main">(</span>6<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">N1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N1</span> <span class="main">∪</span> <span class="skolem">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt n2 tnSi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">ι'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt t1 tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt tnSi<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span><span class="skolem">N1</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> ι_bef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="main">(</span><span class="skolem">T2</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">ι'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff invar<span class="main">[</span><span class="operator">unfolded</span> lgc_invar_def lim_i ti ni<span class="main">]</span> m_pas <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="skolem">T2</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_Si</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> from_F <span class="skolem">ι'</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> ι_in_ι'<span class="main">:</span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Red_I_𝒢 <span class="main">(</span><span class="skolem">N1</span> <span class="main">∪</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ι'_red from_F_def labeled_red_inf_eq_red_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="var">?Sup_Red_Si</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Si_lt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n2 tnSi<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> ι_bef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_Si tSi nSi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>delete_orphans <span class="skolem">T1</span> <span class="skolem">T2</span> <span class="skolem">T'</span> <span class="skolem">N</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> tni <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> tnSi <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> t1 <span class="main">=</span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> t'_orph <span class="main">=</span> this<span class="main">(</span>4<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> nSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt tnSi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ti<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">T2</span> <span class="main">∪</span> <span class="skolem">T'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_lt t1 tni<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tSi<span class="main">:</span> <span class="quoted"><span class="quoted">"lnth <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">T2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Si_lt tnSi<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
      <span class="keyword3"><span class="command">assume</span></span> ι_inff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> Inf_from <span class="main">(</span>active_subset <span class="skolem">N</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"to_F <span class="skolem">ι</span> <span class="main">∉</span> <span class="skolem">T'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> t'_orph ι_inff in_Inf_from_imp_to_F_in_Inf_from <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="skolem">T'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> from_F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ι</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> <span class="skolem">T2</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?Sup_Red_Si</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ι_inff invar <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_i ni ti <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def lim_Si tSi nSi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-lgc_invar_lgc"><span class="command">lemma</span></span> lgc_invar_lgc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    lgc<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">TNs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_init<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    t_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">TNs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lgc_invar <span class="free">TNs</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_lt
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>enat <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> lgc_invar_lgc_init<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lgc<span class="main"><span class="main">]</span></span> n_init t_init<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enat_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ih <span class="main">=</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> Si_lt <span class="main">=</span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">i</span> <span class="main">&lt;</span> llength <span class="free">TNs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Si_lt Suc_ile_eq less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lgc_invar_lgc_step<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Si_lt ih<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i_lt<span class="main"><span class="main">]</span></span> chain_lnth_rel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lgc Si_lt<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Given_Clause_Architectures_Revisited-lgc_fair_new_proof"><span class="command">lemma</span></span> lgc_fair_new_proof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    lgc<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="keyword1">(↝LGC)</span> <span class="free">TNs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_init<span class="main">:</span> <span class="quoted"><span class="quoted">"active_subset <span class="main">(</span>snd <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    n_lim<span class="main">:</span> <span class="quoted"><span class="quoted">"passive_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    t_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free">Inf_F</span><span class="main">.</span> prems_of <span class="bound">ι</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="bound">ι</span> <span class="main">∈</span> fst <span class="main">(</span>lhd <span class="free">TNs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    t_lim<span class="main">:</span> <span class="quoted"><span class="quoted">"Liminf_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fair <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> fair_def llist.map_comp
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf_from <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊆</span> Inf_from <span class="main">(</span>active_subset <span class="main">(</span>Liminf_llist <span class="main">(</span>lmap snd <span class="free">TNs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_from_mono<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> n_lim passive_subset_def active_subset_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>from_F <span class="main">`</span> Liminf_upto_llist <span class="main">(</span>lmap fst <span class="free">TNs</span><span class="main">)</span> <span class="main">∞</span><span class="main">)</span>
    <span class="main">∪</span> Sup_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lgc_invar_infinity<span class="main">[</span><span class="operator">OF</span> chain_not_lnull<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lgc<span class="main"><span class="main">]</span></span><span class="main">]</span> lgc_invar_lgc<span class="main">[</span><span class="operator">OF</span> lgc n_init t_init<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> lgc_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> Sup_llist <span class="main">(</span>lmap <span class="main">(</span>Red_I_𝒢 <span class="main">∘</span> snd<span class="main">)</span> <span class="free">TNs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> t_lim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>