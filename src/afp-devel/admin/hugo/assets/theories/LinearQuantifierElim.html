<div id="Logic">
<div class="head">
<h1>Theory Logic</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Logic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Logic
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
We start with a generic formalization of quantified logical formulae
using de Bruijn notation. The syntax is parametric in the type of atoms.›</span></span>

<span class="keyword1"><span class="command">declare</span></span> Let_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>atoms<span class="main">:</span> <span class="tfree">'a</span><span class="main">)</span> fm <span class="main">=</span>
  TrueF <span class="main">|</span> FalseF <span class="main">|</span> Atom <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> And <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span> <span class="main">|</span> Or <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span> <span class="main">|</span>
  Neg <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span> <span class="main">|</span> ExQ <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm"</span></span>

<span class="keyword1"><span class="command">notation</span></span> map_fm <span class="main">(</span><span class="quoted">"<span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Imp</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Imp</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> Or <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">AllQ</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">AllQ</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span> Neg<span class="main">(</span>ExQ<span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neg</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">neg</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">=</span>TrueF <span class="keyword1">then</span> FalseF <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">=</span>FalseF <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">and</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">and</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">=</span>TrueF <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">=</span>TrueF <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">=</span>FalseF <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">=</span>FalseF <span class="keyword1">then</span> FalseF <span class="keyword1">else</span> And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">or</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">=</span>FalseF <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">=</span>FalseF <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">=</span>TrueF <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">=</span>TrueF <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_conj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm list <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">list_conj</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> foldr and <span class="free"><span class="bound"><span class="entity">fs</span></span></span> TrueF"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_disj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm list <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">list_disj</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> foldr or <span class="free"><span class="bound"><span class="entity">fs</span></span></span> FalseF"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Disj</span> <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> list_disj <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> atoms_map_fm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> fm.set_map

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">amap_fm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'b</span> fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> TrueF <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> FalseF <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> neg <span class="main">(</span><span class="keyword1"><span class="free">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Logic-amap_fm_list_disj"><span class="command">lemma</span></span> amap_fm_list_disj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="free">h</span> <span class="main">(</span>list_disj <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> list_disj <span class="main">(</span>map <span class="main">(</span><span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="free">h</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>list_disj_def or_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">qfree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qfree</span><span class="main">(</span>ExQ <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">qfree</span><span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">qfree</span><span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">qfree</span><span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">qfree</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1" id="Logic-qfree_and"><span class="command">lemma</span></span> qfree_and<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> qfree <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span> qfree <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> qfree<span class="main">(</span>and <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>

<span class="keyword1" id="Logic-qfree_or"><span class="command">lemma</span></span> qfree_or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> qfree <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;</span> qfree <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟧</span> <span class="main">⟹</span> qfree<span class="main">(</span>or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="Logic-qfree_neg"><span class="command">lemma</span></span> qfree_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> qfree <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>neg_def<span class="main">)</span>

<span class="keyword1" id="Logic-qfree_foldr_Or"><span class="command">lemma</span></span> qfree_foldr_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>foldr Or <span class="free">fs</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>qfree <span class="free">φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> qfree <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Logic-qfree_list_conj"><span class="command">lemma</span></span> qfree_list_conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> qfree <span class="bound">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>list_conj <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fs</span> <span class="skolem">φ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="skolem">fs</span><span class="main">.</span> qfree <span class="bound">φ</span><span class="main">;</span> qfree <span class="skolem">φ</span> <span class="main">⟧</span> <span class="main">⟹</span> qfree<span class="main">(</span>foldr and <span class="skolem">fs</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">fs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_conj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Logic-qfree_list_disj"><span class="command">lemma</span></span> qfree_list_disj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> qfree <span class="bound">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>list_disj <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fs</span> <span class="skolem">φ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="skolem">fs</span><span class="main">.</span> qfree <span class="bound">φ</span><span class="main">;</span> qfree <span class="skolem">φ</span> <span class="main">⟧</span> <span class="main">⟹</span> qfree<span class="main">(</span>foldr or <span class="skolem">fs</span> <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">fs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Logic-qfree_map_fm"><span class="command">lemma</span></span> qfree_map_fm<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="free">f</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> qfree <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Logic-atoms_list_disjE"><span class="command">lemma</span></span> atoms_list_disjE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> atoms<span class="main">(</span>list_disj <span class="free">fs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> atoms <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def Logic.or_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Logic-atoms_list_conjE"><span class="command">lemma</span></span> atoms_list_conjE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> atoms<span class="main">(</span>list_conj <span class="free">fs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> atoms <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_conj_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_conj_def Logic.and_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">dnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dnf</span> TrueF <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">dnf</span> FalseF <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">d1</span> <span class="main">@</span> <span class="bound">d2</span><span class="main">.</span> d1 <span class="main">←</span> <span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> d2 <span class="main">←</span> <span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">dnf</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> <span class="free">dnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nqfree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span><span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span> TrueF <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span> FalseF <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">nqfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free">nqfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">nqfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free">nqfree</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nqfree</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1" id="Logic-nqfree_qfree"><span class="command">lemma</span></span> nqfree_qfree<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Logic-nqfree_map_fm"><span class="command">lemma</span></span> nqfree_map_fm<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="free">f</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> nqfree <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="quoted">"<span class="entity">interpret</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> TrueF <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> FalseF <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∨</span> <span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="main">(</span>ExQ <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">interpret</span> <span class="free"><span class="bound"><span class="entity">h</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Atoms›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The locale ATOM of atoms provides a minimal framework for the
generic formulation of theory-independent algorithms, in particular
quantifier elimination.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ATOM <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">aneg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">anormal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> nqfree_aneg<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree<span class="main">(</span><span class="free">aneg</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> anormal_aneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">anormal</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>atoms<span class="main">(</span><span class="free">aneg</span> <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="free">anormal</span> <span class="bound">b</span>"</span></span>

<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> I<span class="hidden">⇩</span><sub>a</sub>_aneg<span class="main">:</span> <span class="quoted"><span class="quoted">"interpret <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">aneg</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">a</span> <span class="free">xs</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">decr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span> not_dep_decr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">decr</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> anormal_decr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">anormal</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">anormal</span><span class="main">(</span><span class="free">decr</span> <span class="free">a</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> TrueF <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> FalseF <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> <span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">@</span> <span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">I</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≡</span> interpret <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nnf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> And <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg TrueF<span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg FalseF<span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Or <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>And <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">nnf</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">(</span>Neg <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">aneg</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1" id="Logic-nqfree_nnf"><span class="command">lemma</span></span> nqfree_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> nqfree<span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span>
  <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nqfree_aneg and_def or_def<span class="main">)</span>

<span class="keyword1" id="Logic-qfree_nnf"><span class="command">lemma</span></span> qfree_nnf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> qfree <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nqfree_aneg<span class="main">)</span>


<span class="keyword1" id="Logic-I_neg"><span class="command">lemma</span></span> I_neg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>neg <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="main">(</span>Neg <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>neg_def<span class="main">)</span>

<span class="keyword1" id="Logic-I_and"><span class="command">lemma</span></span> I_and<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>and <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="main">(</span>And <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>

<span class="keyword1" id="Logic-I_list_conj"><span class="command">lemma</span></span> I_list_conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"I <span class="main">(</span>list_conj <span class="free">fs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> I <span class="bound">φ</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fs</span> <span class="skolem">φ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>foldr and <span class="skolem">fs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>I <span class="skolem">φ</span> <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="skolem">fs</span><span class="main">.</span> I <span class="bound">φ</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">fs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_conj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Logic-I_or"><span class="command">lemma</span></span> I_or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="main">(</span>Or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="Logic-I_list_disj"><span class="command">lemma</span></span> I_list_disj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"I <span class="main">(</span>list_disj <span class="free">fs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="free">fs</span><span class="main">.</span> I <span class="bound">φ</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">fs</span> <span class="skolem">φ</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>foldr or <span class="skolem">fs</span> <span class="skolem">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>I <span class="skolem">φ</span> <span class="free">xs</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">φ</span> <span class="main">∈</span> set <span class="skolem">fs</span><span class="main">.</span> I <span class="bound">φ</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">fs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Logic-I_nnf"><span class="command">lemma</span></span> I_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I<span class="hidden">⇩</span><sub>a</sub>_aneg<span class="main">)</span>

<span class="keyword1" id="Logic-I_dnf"><span class="command">lemma</span></span> I_dnf<span class="main">:</span>
<span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">∈</span>set <span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="bound">as</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">normal</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> atoms <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">.</span> <span class="free">anormal</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Logic-normal_simps"><span class="command">lemma</span></span> normal_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"normal TrueF"</span></span>
<span class="quoted"><span class="quoted">"normal FalseF"</span></span>
<span class="quoted"><span class="quoted">"normal <span class="main">(</span>Atom <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">anormal</span> <span class="free">a</span>"</span></span>
<span class="quoted"><span class="quoted">"normal <span class="main">(</span>And <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="quoted"><span class="quoted">"normal <span class="main">(</span>Or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="quoted"><span class="quoted">"normal <span class="main">(</span>Neg <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> normal <span class="free">φ</span>"</span></span>
<span class="quoted"><span class="quoted">"normal <span class="main">(</span>ExQ <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> normal <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>normal_def<span class="main">)</span>

<span class="keyword1" id="Logic-normal_aneg"><span class="command">lemma</span></span> normal_aneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">anormal</span> <span class="free">a</span> <span class="main">⟹</span> normal <span class="main">(</span><span class="free">aneg</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>anormal_aneg normal_def<span class="main">)</span>

<span class="keyword1" id="Logic-normal_and"><span class="command">lemma</span></span> normal_and<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"normal <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> normal <span class="main">(</span>and <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Logic.and_def<span class="main">)</span>

<span class="keyword1" id="Logic-normal_or"><span class="command">lemma</span></span> normal_or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"normal <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> normal <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> normal <span class="main">(</span>or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Logic.or_def<span class="main">)</span>

<span class="keyword1" id="Logic-normal_list_disj"><span class="command">lemma</span></span> normal_list_disj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> normal <span class="bound">φ</span> <span class="main">⟹</span> normal <span class="main">(</span>list_disj <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_disj_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Logic-normal_nnf"><span class="command">lemma</span></span> normal_nnf<span class="main">:</span> <span class="quoted"><span class="quoted">"normal <span class="free">φ</span> <span class="main">⟹</span> normal<span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Logic-normal_map_fm"><span class="command">lemma</span></span> normal_map_fm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">anormal</span><span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">anormal</span><span class="main">(</span><span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> normal <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="free">f</span> <span class="free">φ</span><span class="main">)</span> <span class="main">=</span> normal <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1" id="Logic-anormal_nnf"><span class="command">lemma</span></span> anormal_nnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> normal <span class="free">φ</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>atoms<span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span><span class="main">.</span> <span class="free">anormal</span> <span class="bound">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> normal_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>anormal_aneg<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Logic-atoms_dnf"><span class="command">lemma</span></span> atoms_dnf<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> <span class="free">as</span> <span class="main">∈</span> set<span class="main">(</span>dnf <span class="free">φ</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> atoms <span class="free">φ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nqfree.induct<span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Logic-anormal_dnf_nnf"><span class="command">lemma</span></span> anormal_dnf_nnf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">as</span> <span class="main">∈</span> set<span class="main">(</span>dnf<span class="main">(</span>nnf <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> qfree <span class="free">φ</span> <span class="main">⟹</span> normal <span class="free">φ</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="free">anormal</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nnf.induct<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> UnE set_append<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> anormal_aneg atoms_dnf nqfree_aneg<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QE">
<div class="head">
<h1>Theory QE</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Quantifier elimination›</span></span>

<span class="keyword1"><span class="command">theory</span></span> QE
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Logic">Logic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
The generic, i.e.\ theory-independent part of quantifier elimination.
Both DNF and an NNF-based procedures are defined and proved correct.›</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>input<span class="main">)</span> Collect <span class="main">(</span><span class="quoted">"<span class="keyword1">|</span>_<span class="keyword1">|</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹No Equality›</span></span>

<span class="keyword1"><span class="command">context</span></span> ATOM
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹DNF-based›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Taking care of atoms independent of variable 0:›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qelim</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">qf</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">]</span><span class="main">;</span>
      <span class="bound">indep</span> <span class="main">=</span> <span class="main">[</span>Atom<span class="main">(</span><span class="free">decr</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> a<span class="main">←</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="main">¬</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">]</span>
  <span class="keyword1">in</span> and <span class="bound">qf</span> <span class="main">(</span>list_conj <span class="bound">indep</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_dnf_qe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> I<span class="main">(</span><span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent
Note that the exported abbreviation will have as a first parameter
the type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span><span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of values <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>xs›</span></span></span></span> ranges over.›</span></span>

<span class="keyword1" id="QE-I_qelim"><span class="command">lemma</span></span> I_qelim<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_dnf_qe <span class="main">(</span>qelim <span class="free">qe</span><span class="main">)</span> <span class="free">as</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">xs</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span>Not <span class="main">∘</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>qelim <span class="free">qe</span> <span class="free">as</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span>
        <span class="main">(</span>I <span class="main">(</span><span class="free">qe</span> <span class="var">?as0</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>map <span class="free">decr</span> <span class="var">?as1</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="main">_</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qelim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe not_dep_decr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as1</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">decr</span> <span class="bound">a</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as1</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_dep_decr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span><span class="var">?as0</span> <span class="main">@</span> <span class="var">?as1</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ball_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span><span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent The generic DNF-based quantifier elimination procedure:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lift_dnf_qe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> neg<span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>ExQ <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> Disj <span class="main">(</span>dnf<span class="main">(</span>nnf<span class="main">(</span><span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>qelim <span class="free"><span class="bound"><span class="entity">qe</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1" id="QE-qfree_lift_dnf_qe"><span class="command">lemma</span></span> qfree_lift_dnf_qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span>
 <span class="main">⟹</span> qfree<span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qelim_def<span class="main">)</span>

<span class="keyword1" id="QE-qfree_lift_dnf_qe2"><span class="command">lemma</span></span> qfree_lift_dnf_qe2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> lists <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span>
 <span class="main">⟹</span> qfree<span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> in_lists_conv_set<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def qfree_lift_dnf_qe<span class="main">)</span>

<span class="keyword1" id="QE-lem"><span class="command">lemma</span></span> lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="QE-I_lift_dnf_qe"><span class="command">lemma</span></span> I_lift_dnf_qe<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> ExQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms I_qelim lem I_dnf nqfree_nnf qfree_lift_dnf_qe
                  I_nnf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="QE-I_lift_dnf_qe2"><span class="command">lemma</span></span> I_lift_dnf_qe2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> lists <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span> <span class="main">∈</span> lists <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span><span class="main">.</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms in_lists_conv_set<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def I_lift_dnf_qe<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Quantifier elimination with invariant (needed for Presburger):›</span></span>

<span class="keyword1" id="QE-I_qelim_anormal"><span class="command">lemma</span></span> I_qelim_anormal<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> nm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">anormal</span> <span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>qelim <span class="free">qe</span> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span>Not <span class="main">∘</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>qelim <span class="free">qe</span> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span>
        <span class="main">(</span>I <span class="main">(</span><span class="free">qe</span> <span class="var">?as0</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>map <span class="free">decr</span> <span class="var">?as1</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="main">_</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qelim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe nm not_dep_decr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as1</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">decr</span> <span class="bound">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">…</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as0</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="var">?as1</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_dep_decr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span><span class="var">?as0</span> <span class="main">@</span> <span class="var">?as1</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ball_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span><span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 5<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="QE-anormal_atoms_qelim"><span class="command">lemma</span></span> anormal_atoms_qelim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> normal<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> atoms<span class="main">(</span>qelim <span class="free">qe</span> <span class="free">as</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">anormal</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qelim_def and_def normal_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>anormal_decr <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> atoms_list_conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> meta_allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="QE-normal_lift_dnf_qe"><span class="command">lemma</span></span> normal_lift_dnf_qe<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> normal<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"normal <span class="free">φ</span> <span class="main">⟹</span> normal<span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>normal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> ExQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> atoms_list_disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> anormal_atoms_qelim<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>assms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>normal_def qfree_lift_dnf_qe anormal_dnf_nnf assms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>and_def or_def neg_def Ball_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 9<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="QE-I_lift_dnf_qe_anormal"><span class="command">lemma</span></span> I_lift_dnf_qe_anormal<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> normal<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">anormal</span> <span class="bound">a</span> <span class="main">⟹</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">f</span> <span class="main">⟹</span> I <span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> ExQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> normal_lift_dnf_qe<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">qe</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> normal_def<span class="main"><span class="main">]</span></span> anormal_dnf_nnf I_qelim_anormal lem I_dnf nqfree_nnf qfree_lift_dnf_qe I_nnf normal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>normal_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="QE-I_lift_dnf_qe_anormal2"><span class="command">lemma</span></span> I_lift_dnf_qe_anormal2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> lists <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> lists <span class="main">(</span> <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">∩</span> <span class="main">|</span><span class="free">anormal</span><span class="main">|</span> <span class="main">)</span> <span class="main">→</span> <span class="main">|</span>normal<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span> <span class="main">∈</span> lists<span class="main">(</span> <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">∩</span> <span class="main">|</span><span class="free">anormal</span><span class="main">|</span> <span class="main">)</span><span class="main">.</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">f</span> <span class="main">⟹</span> I <span class="main">(</span>lift_dnf_qe <span class="free">qe</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms in_lists_conv_set<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def I_lift_dnf_qe_anormal Int_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹NNF-based›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lift_nnf_qe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fm <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> neg<span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="main">(</span>ExQ <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span><span class="main">(</span>nnf<span class="main">(</span><span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1" id="QE-qfree_lift_nnf_qe"><span class="command">lemma</span></span> qfree_lift_nnf_qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span><span class="main">)</span>
 <span class="main">⟹</span> qfree<span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nqfree_nnf<span class="main">)</span>

<span class="keyword1" id="QE-qfree_lift_nnf_qe2"><span class="command">lemma</span></span> qfree_lift_nnf_qe2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> <span class="main">|</span>nqfree<span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span> <span class="main">⟹</span> qfree<span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def qfree_lift_nnf_qe<span class="main">)</span>

<span class="keyword1" id="QE-I_lift_nnf_qe"><span class="command">lemma</span></span> I_lift_nnf_qe<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> I <span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> I <span class="bound">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> ExQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms nqfree_nnf qfree_lift_nnf_qe I_nnf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="QE-I_lift_nnf_qe2"><span class="command">lemma</span></span> I_lift_nnf_qe2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> <span class="main">|</span>nqfree<span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="main">|</span>nqfree<span class="main">|</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> I <span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> I <span class="bound">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def I_lift_nnf_qe<span class="main">)</span>

<span class="keyword1" id="QE-normal_lift_nnf_qe"><span class="command">lemma</span></span> normal_lift_nnf_qe<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> normal <span class="bound">φ</span> <span class="main">⟹</span> normal<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">φ</span> <span class="main">⟹</span> normal<span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
   <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Logic.neg_def normal_nnf
                  nqfree_nnf qfree_lift_nnf_qe<span class="main">)</span>

<span class="keyword1" id="QE-I_lift_nnf_qe_normal"><span class="command">lemma</span></span> I_lift_nnf_qe_normal<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">φ</span><span class="main">.</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> normal <span class="bound">φ</span> <span class="main">⟹</span> normal<span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs</span> <span class="bound">φ</span><span class="main">.</span> normal <span class="bound">φ</span> <span class="main">⟹</span> nqfree <span class="bound">φ</span> <span class="main">⟹</span> I <span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> I <span class="bound">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">φ</span> <span class="main">⟹</span> I <span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> ExQ <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms nqfree_nnf qfree_lift_nnf_qe I_nnf
                  normal_lift_nnf_qe normal_nnf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="QE-I_lift_nnf_qe_normal2"><span class="command">lemma</span></span> I_lift_nnf_qe_normal2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> <span class="main">|</span>nqfree<span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> <span class="main">|</span>nqfree<span class="main">|</span> <span class="main">∩</span> <span class="main">|</span>normal<span class="main">|</span> <span class="main">→</span> <span class="main">|</span>normal<span class="main">|</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">φ</span> <span class="main">∈</span> <span class="main">|</span>normal<span class="main">|</span> <span class="main">∩</span> <span class="main">|</span>nqfree<span class="main">|</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> I <span class="main">(</span><span class="free">qe</span> <span class="bound">φ</span><span class="main">)</span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> I <span class="bound">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal <span class="free">φ</span> <span class="main">⟹</span> I <span class="main">(</span>lift_nnf_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def I_lift_nnf_qe_normal Int_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹With equality›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹DNF-based quantifier elimination can accommodate equality atoms
in a generic fashion.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ATOM_EQ <span class="main">=</span> ATOM <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">trivial</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> subst<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">eq</span><span class="main">;</span>  <span class="main">¬</span><span class="free">trivial</span> <span class="free">eq</span><span class="main">;</span>  <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">eq</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span>  <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">a</span> <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">eq</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> trivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">trivial</span> <span class="free">eq</span> <span class="main">⟹</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">eq</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> solvable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">eq</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">eq</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> is_triv_self_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">eq</span> <span class="main">⟹</span> <span class="free">trivial</span> <span class="main">(</span><span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">eq</span> <span class="free">eq</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift_eq_qe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> fm<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lift_eq_qe</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="free">trivial</span> <span class="bound">a</span><span class="main">]</span>
  <span class="keyword1">in</span> <span class="keyword1">case</span> <span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="bound">as</span><span class="main">.</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">]</span> <span class="keyword1">of</span>
    <span class="main">[]</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">qe</span></span></span> <span class="bound">as</span>
  <span class="main">|</span> <span class="bound">eq</span> <span class="main">#</span> <span class="bound">eqs</span> <span class="main">⇒</span>
        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ineqs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="bound">as</span><span class="main">.</span> <span class="main">¬</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">]</span>
         <span class="keyword1">in</span> list_conj <span class="main">(</span>map <span class="main">(</span>Atom <span class="main">∘</span> <span class="main">(</span><span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">eq</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">eqs</span> <span class="main">@</span> <span class="bound">ineqs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_lift_eq_qe<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span>
   I <span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I <span class="main">(</span>lift_eq_qe <span class="free">qe</span> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="free">as</span><span class="main">.</span> <span class="main">¬</span> <span class="free">trivial</span> <span class="bound">a</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">a</span><span class="main">←</span><span class="var">?as</span><span class="main">.</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="main">¬</span> <span class="free">trivial</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lift_eq_qe_def dep qe <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span>conj_cong<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> trivial<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">eq</span> _<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">eq</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">eq</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">trivial</span> <span class="skolem">eq</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_eq_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="skolem">eq</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> solvable<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">eq</span> <span class="bound">a</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst<span class="hidden">⇩</span><sub>0</sub><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="skolem">eq</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">trivial</span> <span class="skolem">eq</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>a</sub></span> <span class="skolem">eq</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span> dep<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons dep
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_eq_qe_def<span class="main"><span class="keyword3">,</span></span>
            <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_eq_Cons_iff ball_Un<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trivial is_triv_self_subst<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subst<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lift_dnfeq_qe</span> <span class="main">=</span> lift_dnf_qe <span class="main">∘</span> lift_eq_qe"</span></span>

<span class="keyword1" id="QE-qfree_lift_eq_qe"><span class="command">lemma</span></span> qfree_lift_eq_qe<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">⟹</span> qfree <span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">⟹</span> qfree<span class="main">(</span>lift_eq_qe <span class="free">qe</span> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lift_eq_qe_def ball_Un <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.split<span class="main">)</span>

<span class="keyword1" id="QE-qfree_lift_dnfeq_qe"><span class="command">lemma</span></span> qfree_lift_dnfeq_qe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> qfree<span class="main">(</span>lift_dnfeq_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_dnfeq_qe_def qfree_lift_dnf_qe qfree_lift_eq_qe<span class="main">)</span>

<span class="keyword1" id="QE-I_lift_dnfeq_qe"><span class="command">lemma</span></span> I_lift_dnfeq_qe<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="free">qe</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">.</span> <span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span><span class="main">)</span> <span class="main">⟹</span>
   I <span class="main">(</span>lift_dnfeq_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lift_dnfeq_qe_def I_lift_dnf_qe qfree_lift_eq_qe I_lift_eq_qe<span class="main">)</span>

<span class="keyword1" id="QE-I_lift_dnfeq_qe2"><span class="command">lemma</span></span> I_lift_dnfeq_qe2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">qe</span> <span class="main">∈</span> lists <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">→</span> <span class="main">|</span>qfree<span class="main">|</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">as</span> <span class="main">∈</span> lists<span class="main">(</span> <span class="main">|</span><span class="free">depends<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">∩</span> <span class="main">-</span> <span class="main">|</span><span class="free">solvable<span class="hidden">⇩</span><sub>0</sub></span><span class="main">|</span> <span class="main">)</span><span class="main">.</span> is_dnf_qe <span class="free">qe</span> <span class="bound">as</span><span class="main">)</span> <span class="main">⟹</span>
   I <span class="main">(</span>lift_dnfeq_qe <span class="free">qe</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> in_lists_conv_set<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tvar">?'a</span> <span class="main"><span class="main">=</span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def I_lift_dnfeq_qe Int_def Compl_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DLO">
<div class="head">
<h1>Theory DLO</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"DLO"</span></span>

<span class="keyword1"><span class="command">theory</span></span> DLO
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#QE">QE</a> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Basics"</span></span>

<span class="keyword1"><span class="command">class</span></span> dlo <span class="main">=</span> linorder <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> dense<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> no_ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_lb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> real <span class="main">::</span> <span class="quoted">dlo</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="var">?v</span> <span class="main">∧</span> <span class="var">?v</span> <span class="main">&lt;</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">&lt;</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">r</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">datatype</span></span> atom <span class="main">=</span> Less <span class="quoted">nat</span> <span class="quoted">nat</span> <span class="main">|</span> Eq <span class="quoted">nat</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_Less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_Less</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_Less</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_Eq</span> <span class="main">≡</span> Not <span class="main">∘</span> is_Less"</span></span>

<span class="keyword1" id="DLO-is_Less_iff"><span class="command">lemma</span></span> is_Less_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"is_Less <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Less <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="DLO-is_Eq_iff"><span class="command">lemma</span></span> is_Eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">≠</span> Less <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Eq <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="DLO-not_is_Eq_iff"><span class="command">lemma</span></span> not_is_Eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">≠</span> Eq <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Less <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>dlo list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span><span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span><span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="comment1">(* needed for code generation *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nnf</span> <span class="main">=</span> ATOM.nnf neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qelim</span> <span class="main">=</span> ATOM.qelim depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift_dnf_qe</span> <span class="main">=</span> ATOM.lift_dnf_qe neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift_nnf_qe</span> <span class="main">=</span> ATOM.lift_nnf_qe neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>"</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> nnf qelim lift_dnf_qe lift_nnf_qe

<span class="keyword1"><span class="command">lemmas</span></span> DLO_code_lemmas <span class="main">=</span> nnf_def qelim_def lift_dnf_qe_def lift_nnf_qe_def

<span class="keyword1"><span class="command">interpretation</span></span> DLO<span class="main">:</span>
  ATOM <span class="quoted">neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="quoted">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted">depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted">decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linorder_class.not_less_iff_gr_or_eq
                    linorder_not_less linorder_neq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_Cons'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">folded</span> DLO_code_lemmas<span class="main">,</span> <span class="operator">code</span><span class="main">]</span> <span class="main">=</span>
  DLO.nnf.simps DLO.qelim_def DLO.lift_dnf_qe.simps DLO.lift_dnf_qe.simps

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> DLO.I<span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lbounds</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lbounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">0</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ubounds</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ubounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">0</span> <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ebounds</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ebounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="bound">i</span><span class="main">.</span> Eq <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">0</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">i</span><span class="main">.</span> Eq <span class="main">0</span> <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="DLO-set_lbounds"><span class="command">lemma</span></span> set_lbounds<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lbounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.splits atom.splits<span class="main">)</span>
<span class="keyword1" id="DLO-set_ubounds"><span class="command">lemma</span></span> set_ubounds<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>ubounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ubounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.splits atom.splits<span class="main">)</span>
<span class="keyword1" id="DLO-set_ebounds"><span class="command">lemma</span></span> set_ebounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set<span class="main">(</span>ebounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> Eq <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∨</span> Eq <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ebounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> atom.splits nat.splits<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">LB</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">UB</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">EQ</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="bound">k</span><span class="main">|</span><span class="bound">k</span><span class="main">.</span>
  Eq <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∨</span> Eq <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>


<span class="keyword1" id="DLO-EQ_And"><span class="command">lemma</span></span> EQ_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"EQ <span class="main">(</span>And <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">∪</span> EQ <span class="free">g</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ_def<span class="main">)</span>

<span class="keyword1" id="DLO-EQ_Or"><span class="command">lemma</span></span> EQ_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"EQ <span class="main">(</span>Or <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">∪</span> EQ <span class="free">g</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ_def<span class="main">)</span>

<span class="keyword1" id="DLO-EQ_conv_set_ebounds"><span class="command">lemma</span></span> EQ_conv_set_ebounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">∈</span>set<span class="main">(</span>ebounds<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> EQ_def set_ebounds<span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isubst</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isubst</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isubst</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span>isubst <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>isubst <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span>isubst <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>isubst <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>asubst <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1" id="DLO-I_subst"><span class="command">lemma</span></span> I_subst<span class="main">:</span>
 <span class="quoted"><span class="quoted">"qfree <span class="free">f</span> <span class="main">⟹</span> DLO.I <span class="main">(</span>subst <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">k</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">amin_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Less <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Less <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">amin_inf</span> <span class="main">(</span>Eq <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">min_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">≡</span> <span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> amin_inf"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">aplus_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Less <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Less <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aplus_inf</span> <span class="main">(</span>Eq <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">plus_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="main">≡</span> <span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> aplus_inf"</span></span>

<span class="keyword1" id="DLO-min_inf"><span class="command">lemma</span></span> min_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≤</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> amin_inf.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_Cons' linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> no_lb linorder_not_less order_less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nth_Cons'<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> no_lb linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> no_lb linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="DLO-plus_inf"><span class="command">lemma</span></span> plus_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≥</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dlo_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≥</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">from</span></span> no_ub <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">&gt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≥</span><span class="skolem">w</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&gt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> aplus_inf.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> linorder_not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dlo_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> dlo_bound less_imp_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> dlo_bound less_imp_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>2<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="DLO-LBex"><span class="command">lemma</span></span> LBex<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span>DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">l</span><span class="main">∈</span> LB <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> amin_inf.cases<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth.simps EQ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="DLO-UBex"><span class="command">lemma</span></span> UBex<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span>DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> UB <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> aplus_inf.cases<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth.simps EQ_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="DLO-finite_LB"><span class="command">lemma</span></span> finite_LB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>LB <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span> <span class="main">`</span> set<span class="main">(</span>lbounds<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_lbounds image_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DLO-finite_UB"><span class="command">lemma</span></span> finite_UB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>UB <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UB <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span>  <span class="free">xs</span><span class="main">!</span><span class="bound">k</span><span class="main">)</span> <span class="main">`</span> set<span class="main">(</span>ubounds<span class="main">(</span>DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ubounds image_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DLO-qfree_amin_inf"><span class="command">lemma</span></span> qfree_amin_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>amin_inf <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>amin_inf.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="DLO-qfree_min_inf"><span class="command">lemma</span></span> qfree_min_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qfree_amin_inf<span class="main">)</span>

<span class="keyword1" id="DLO-qfree_aplus_inf"><span class="command">lemma</span></span> qfree_aplus_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>aplus_inf <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>aplus_inf.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="DLO-qfree_plus_inf"><span class="command">lemma</span></span> qfree_plus_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qfree_aplus_inf<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QEdlo">
<div class="head">
<h1>Theory QEdlo</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QEdlo
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DLO">DLO</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"DNF-based quantifier elimination"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">qe_dlo<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom list <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_dlo<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> Less <span class="main">0</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="keyword1">then</span> FalseF <span class="keyword1">else</span>
  <span class="keyword1">let</span> <span class="bound">lbs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">0</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span><span class="main">;</span> <span class="bound">ubs</span> <span class="main">=</span> <span class="main">[</span><span class="bound">j</span><span class="main">.</span> Less <span class="main">0</span> <span class="main">(</span>Suc j<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span><span class="main">;</span>
      <span class="bound">pairs</span> <span class="main">=</span> <span class="main">[</span>Atom<span class="main">(</span>Less <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> i <span class="main">←</span> <span class="bound">lbs</span><span class="main">,</span> j <span class="main">←</span> <span class="bound">ubs</span><span class="main">]</span>
  <span class="keyword1">in</span> list_conj <span class="bound">pairs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_qe_dlo<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> is_Less <span class="bound">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_dlo<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lbs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">i</span><span class="main">.</span> Less <span class="main">(</span>Suc i<span class="main">)</span> <span class="main">0</span> <span class="main">←</span> <span class="free">as</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ubs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">j</span><span class="main">.</span> Less <span class="main">0</span> <span class="main">(</span>Suc j<span class="main">)</span> <span class="main">←</span> <span class="free">as</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="var">?lbs</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Us</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="var">?ubs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="var">?Ls</span><span class="main">.</span> <span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ub</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="var">?Us</span><span class="main">.</span> <span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="main">0</span> <span class="main">∉</span> set <span class="free">as</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?Ls</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> Less <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?Us</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> Less <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="main">0</span> <span class="main">∉</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Less <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_Less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dep <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">k</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Less <span class="main">0</span> <span class="main">0</span> <span class="main">∉</span> set <span class="free">as</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Nat.nat.nchotomy depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="var">?Us</span> <span class="main">∨</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="var">?Ls</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="var">?Ls</span><span class="main">.</span> <span class="skolem">a</span><span class="main">=</span>Less <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="var">?Us</span><span class="main">.</span> <span class="skolem">a</span><span class="main">=</span>Less <span class="main">0</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> qe1<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="main">0</span> <span class="main">∉</span> set <span class="free">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_dlo<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> qe1 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?Ls</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?Us</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_dlo<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?Ls</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?Us</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_set<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Less <span class="skolem">i</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">|</span> Less <span class="main">0</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">iprover</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Ls</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?Us</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="var">?Ls</span><span class="main">.</span> <span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> Min <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="var">?Us</span><span class="main">.</span> <span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lb</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="var">?ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="var">?Ls</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="var">?Us</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonempty finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>less<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Ls</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?Us</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lb</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_ub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> asm finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Ls</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?Us</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="var">?ub</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_lb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> asm finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ls</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?Us</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="main">0</span> <span class="main">∉</span> set <span class="free">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="skolem">i</span> <span class="main">0</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> order_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">|</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 less
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qe_dlo<span class="hidden">⇩</span><sub>1</sub>_def is_Less_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits nat.splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEdlo-I_qe_dlo"><span class="command">lemma</span></span> I_qe_dlo<span class="hidden">⇩</span><sub>1</sub>_pretty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> is_Less <span class="bound">a</span> <span class="main">∧</span> depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="main">⟹</span> DLO.is_dnf_qe <span class="main">_</span> qe_dlo<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> I_qe_dlo<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span>
   Less <span class="bound">m</span> <span class="bound">n</span> <span class="main">⇒</span> Less <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="bound">n</span><span class="main">)</span>
 <span class="main">|</span> Eq <span class="bound">m</span> <span class="bound">n</span> <span class="main">⇒</span> Eq <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEdlo-subst"><span class="command">lemma</span></span> subst<span class="hidden">⇩</span><sub>0</sub>_pretty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"subst<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Eq <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>Less <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span>subst <span class="free">i</span> <span class="free">j</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">i</span> <span class="free">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"subst<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Eq <span class="free">i</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>Eq <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span>subst <span class="free">i</span> <span class="free">j</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>subst <span class="free">i</span> <span class="free">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">(* needed for code generation *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift_dnfeq_qe</span> <span class="main">=</span> ATOM_EQ.lift_dnfeq_qe neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span> subst<span class="hidden">⇩</span><sub>0</sub>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">lift_eq_qe</span> <span class="main">=</span> ATOM_EQ.lift_eq_qe <span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span>
                                   <span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span> subst<span class="hidden">⇩</span><sub>0</sub>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> DLOe_code_lemmas <span class="main">=</span> DLO_code_lemmas lift_dnfeq_qe_def lift_eq_qe_def

<span class="keyword1"><span class="command">hide_const</span></span> lift_dnfeq_qe lift_eq_qe
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">interpretation</span></span> DLO<span class="hidden">⇩</span><sub>e</sub><span class="main">:</span>
  ATOM_EQ <span class="quoted">neg<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="quoted">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted">depends<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span> <span class="quoted">decr<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="bound">j</span><span class="main">=</span><span class="main">0</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span>Eq <span class="bound">i</span> <span class="bound">j</span> <span class="main">⇒</span> <span class="bound">i</span><span class="main">=</span><span class="bound">j</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span> <span class="quoted">subst<span class="hidden">⇩</span><sub>0</sub></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>subst_def nth_Cons' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>subst_def nth_Cons' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>subst_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">folded</span> DLOe_code_lemmas<span class="main">,</span> <span class="operator">code</span><span class="main">]</span> <span class="main">=</span>
  DLO<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe_def DLO<span class="hidden">⇩</span><sub>e</sub>.lift_eq_qe_def
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> DLO<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe<span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_dlo</span> <span class="main">=</span> DLO<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe qe_dlo<span class="hidden">⇩</span><sub>1</sub>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">folded</span> DLOe_code_lemmas<span class="main">,</span> <span class="operator">code</span><span class="main">]</span> <span class="main">=</span> qe_dlo_def 
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="QEdlo-qfree_qe_dlo"><span class="command">lemma</span></span> qfree_qe_dlo<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_dlo<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_dlo<span class="hidden">⇩</span><sub>1</sub>_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>qfree_list_conj<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> I_qe_dlo<span class="main">:</span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_dlo <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> qe_dlo_def
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> I_qe_dlo<span class="hidden">⇩</span><sub>1</sub> qfree_qe_dlo<span class="hidden">⇩</span><sub>1</sub> DLO<span class="hidden">⇩</span><sub>e</sub>.I_lift_dnfeq_qe
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_Less_iff not_is_Eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span>conj_cong<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_qe_dlo<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_dlo <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_dlo_def DLO<span class="hidden">⇩</span><sub>e</sub>.qfree_lift_dnfeq_qe qfree_qe_dlo<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QEdlo_ex">
<div class="head">
<h1>Theory QEdlo_ex</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QEdlo_ex <span class="keyword2"><span class="keyword">imports</span></span> <a href="#QEdlo">QEdlo</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* tweaking the reflection setup *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">interpret</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>dlo list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">interpret</span> <span class="main">=</span> Logic.interpret I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>"</span></span>

<span class="keyword1" id="QEdlo_ex-interpret_Atoms"><span class="command">lemma</span></span> interpret_Atoms<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interpret <span class="main">(</span>Atom <span class="main">(</span>Eq <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"interpret <span class="main">(</span>Atom <span class="main">(</span>Less <span class="free">i</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">i</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>interpret_def<span class="main">)</span>

<span class="keyword1" id="QEdlo_ex-interpret_others"><span class="command">lemma</span></span> interpret_others<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interpret <span class="main">(</span>Neg<span class="main">(</span>ExQ <span class="main">(</span>Neg <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> interpret <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"interpret <span class="main">(</span>Or <span class="main">(</span>Neg <span class="free">f1</span><span class="main">)</span> <span class="free">f2</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>interpret <span class="free">f1</span> <span class="free">xs</span> <span class="main">⟶</span> interpret <span class="free">f2</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>interpret_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> reify_eqs <span class="main">=</span>
  Logic.interpret.simps<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4-7<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub></span></span></span></span></span></span><span class="main">,</span> <span class="operator">folded</span> interpret_def<span class="main">]</span>
  interpret_others interpret_Atoms

<span class="keyword1"><span class="command">method_setup</span></span> dlo_reify <span class="main">=</span> <span class="quoted">‹
  Scan.succeed
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span>
    <span class="entity">Method.SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">Reification.tac</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> reify_eqs<span class="antiquote">}</span></span></span> NONE
     THEN' <span class="entity">simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="main">[</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span>"interpret_def"<span class="antiquote">}</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"dlo reification"</span>

<span class="comment1">(* leave just enough equations in to convert back to True/False by eval *)</span>
<span class="keyword1"><span class="command">declare</span></span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub>.simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">code</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Logic.interpret.simps<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span></span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> Logic.interpret.simps<span class="main">(</span>1-2<span class="main">)</span><span class="main">[</span><span class="operator">code</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span><span class="main">+</span><span class="free">b</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">*</span><span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">normalization</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="comment1">(* 160 secs *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">x</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="bound">z</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">x</span><span class="main">&lt;</span><span class="bound">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">dlo_reify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> I_qe_dlo <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ <span class="main">(</span>Imp <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ<span class="main">(</span>AllQ <span class="main">(</span>Imp <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ<span class="main">(</span>ExQ<span class="main">(</span>AllQ <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="numeral">2</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ<span class="main">(</span>ExQ<span class="main">(</span>ExQ <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="numeral">2</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ<span class="main">(</span>AllQ<span class="main">(</span>ExQ <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ<span class="main">(</span>AllQ<span class="main">(</span>ExQ <span class="main">(</span>Imp <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">1</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"qe_dlo<span class="main">(</span>AllQ <span class="main">(</span>Imp <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QEdlo_fr">
<div class="head">
<h1>Theory QEdlo_fr</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QEdlo_fr
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DLO">DLO</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Interior Point Method"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section formalizes a new quantifier elimination procedure
based on the idea of Ferrante and Rackoff~\cite{FerranteR-SIAM75} (see
also \S\ref{sec:FRE}) of taking a point between each lower and upper
bound as a test point. For dense linear orders it is not obvious how
to realize this because we cannot name any intermediate point
directly.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Less <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Less <span class="main">0</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>Eq <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst<span class="hidden">⇩</span><sub>2</sub></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>asubst<span class="hidden">⇩</span><sub>2</sub> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEdlo_fr-I_subst"><span class="command">lemma</span></span> I_subst<span class="hidden">⇩</span><sub>2</sub>1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">u</span> <span class="main">⟹</span> DLO.I <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="free">l</span> <span class="free">u</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>
 <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">u</span> <span class="main">⟹</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">u</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> asubst<span class="hidden">⇩</span><sub>2</sub>.cases<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nolub</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> LB <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> UB <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEdlo_fr-nolub_And"><span class="command">lemma</span></span> nolub_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolub <span class="main">(</span>And <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span>nolub <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span> <span class="main">∧</span> nolub <span class="free">g</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolub_def<span class="main">)</span>

<span class="keyword1" id="QEdlo_fr-nolub_Or"><span class="command">lemma</span></span> nolub_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolub <span class="main">(</span>Or <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span>nolub <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span> <span class="main">∧</span> nolub <span class="free">g</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolub_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>3<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="QEdlo_fr-innermost_intvl"><span class="command">lemma</span></span> innermost_intvl<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> nolub <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="free">u</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span><span class="main">;</span>
    DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">u</span><span class="main">⟧</span>
    <span class="main">⟹</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command">unfolding</span></span> nolub_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth.simps Ball_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm nat.splits<span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> not_le_imp_less order_antisym order_less_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Eq <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Suc <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>EQ_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Suc
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>EQ_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Suc <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="QEdlo_fr-I_subst"><span class="command">lemma</span></span> I_subst<span class="hidden">⇩</span><sub>2</sub>2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">u</span> <span class="main">⟹</span> nolub <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">l</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">u</span><span class="main">)</span>
 <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;..&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">u</span><span class="main">}</span><span class="main">.</span> DLO.I <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span>
 <span class="main">⟹</span> DLO.I <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="free">l</span> <span class="free">u</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">u</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> asubst<span class="hidden">⇩</span><sub>2</sub>.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> Atom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> EQ_def nolub_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_def<span class="main">)</span><span class="main">(</span><span class="operator">metis</span> innermost_intvl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_interior<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">;</span> <span class="bound">lbs</span> <span class="main">=</span> lbounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ubs</span> <span class="main">=</span> ubounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ebs</span> <span class="main">=</span> ebounds <span class="bound">as</span><span class="main">;</span>
     <span class="bound">intrs</span> <span class="main">=</span> <span class="main">[</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="bound">l</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="bound">l</span> <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">.</span> l<span class="main">←</span><span class="bound">lbs</span><span class="main">,</span> u<span class="main">←</span><span class="bound">ubs</span><span class="main">]</span>
 <span class="keyword1">in</span> list_disj <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="bound">intrs</span> <span class="main">@</span> map <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="bound">ebs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEdlo_fr-dense_interval"><span class="command">lemma</span></span> dense_interval<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>dlo<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> dense<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..&lt;</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">U</span><span class="main">;</span>
                       <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main">&lt;</span><span class="bound">u</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span><span class="main">;</span><span class="bound">y</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span><span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">∧</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∉</span><span class="free">L</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..&lt;</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∉</span><span class="free">U</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span><span class="main">:</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">u</span></span><span class="main">:</span><span class="free">U</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span><span class="main">:</span><span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?ll</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="var">?uu</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?uu</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?uu</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> Min_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="var">?uu</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="var">?uu</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ll</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="var">?uu</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dense greaterThanLessThan_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> I_interior1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_interior<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?QE</span> <span class="main">=</span> <span class="var">?EX</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> min_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def amap_fm_list_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> plus_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def amap_fm_list_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span> <span class="main">¬</span>DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span>DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">u</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="skolem">l</span> <span class="skolem">u</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">!</span><span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qe_interior<span class="hidden">⇩</span><sub>1</sub>_def set_lbounds set_ubounds I_subst EQ_conv_set_ebounds<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">!</span><span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> dense<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="free">φ</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> I_subst<span class="hidden">⇩</span><sub>2</sub>1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span><span class="main">!</span><span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">u</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>ebounds <span class="var">?as</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"DLO.I <span class="free">φ</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∨</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?E</span><span class="main">.</span> DLO.I <span class="main">(</span>subst <span class="free">φ</span> <span class="bound">k</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?E</span><span class="main">.</span> <span class="main">¬</span> DLO.I <span class="main">(</span>subst <span class="free">φ</span> <span class="bound">k</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> noE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ebounds EQ_def I_subst<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> LB <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> DLO.I<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> UB <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> UBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> DLO.I<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span>LB <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>UB <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">∧</span> nolub <span class="free">φ</span> <span class="free">xs</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">u</span> <span class="main">⟶</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dense_interval<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> finite_LB finite_UB <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">:</span>LB <span class="free">φ</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">:</span>UB <span class="free">φ</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> x<span class="main">]</span> x innermost_intvl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> _ _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nolub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"Less <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set <span class="var">?as</span>"</span></span> <span class="quoted"><span class="quoted">"Less <span class="main">0</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?as</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">!</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">n</span>"</span></span>
      <span class="quoted"><span class="quoted">"nolub <span class="free">φ</span> <span class="free">xs</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="skolem">m</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">n</span> <span class="main">⟶</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="skolem">m</span> <span class="skolem">n</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> noE
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> I_subst<span class="hidden">⇩</span><sub>2</sub>2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def bex_Un set_lbounds set_ubounds<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEdlo_fr-qfree_asubst"><span class="command">lemma</span></span> qfree_asubst<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>asubst<span class="hidden">⇩</span><sub>2</sub> <span class="free">l</span> <span class="free">u</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">u</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst<span class="hidden">⇩</span><sub>2</sub>.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="QEdlo_fr-qfree_subst"><span class="command">lemma</span></span> qfree_subst<span class="hidden">⇩</span><sub>2</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span>subst<span class="hidden">⇩</span><sub>2</sub> <span class="free">l</span> <span class="free">u</span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qfree_asubst<span class="hidden">⇩</span><sub>2</sub><span class="main">)</span>

<span class="keyword1" id="QEdlo_fr-qfree_interior1"><span class="command">lemma</span></span> qfree_interior1<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span>qe_interior<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_interior<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_list_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qfree_min_inf qfree_plus_inf qfree_subst<span class="hidden">⇩</span><sub>2</sub> qfree_map_fm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_interior</span> <span class="main">=</span> DLO.lift_nnf_qe qe_interior<span class="hidden">⇩</span><sub>1</sub>"</span></span>

<span class="keyword1" id="QEdlo_fr-qfree_qe_interior"><span class="command">lemma</span></span> qfree_qe_interior<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>qe_interior <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qe_interior_def DLO.qfree_lift_nnf_qe qfree_interior1<span class="main">)</span>

<span class="keyword1" id="QEdlo_fr-I_qe_interior"><span class="command">lemma</span></span> I_qe_interior<span class="main">:</span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_interior <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_interior_def DLO.I_lift_nnf_qe qfree_interior1 I_interior1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QEdlo_inf">
<div class="head">
<h1>Theory QEdlo_inf</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QEdlo_inf
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DLO">DLO</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Quantifier elimination with infinitesimals"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section presents a new quantifier elimination procedure
for dense linear orders based on (the simulation of) infinitesimals.
It is a fairly straightforward adaptation of the analogous algorithm
by Loos and Weispfenning for linear arithmetic described in
\S\ref{sec:lin-inf}.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst_peps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> atom <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Less <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Less <span class="main">0</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">then</span> TrueF
   <span class="keyword1">else</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Less <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> TrueF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Eq <span class="main">0</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Eq <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> FalseF"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span>Eq <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subst_peps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> nat <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">subst<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> <span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nolb</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> LB <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEdlo_inf-nolb_And"><span class="command">lemma</span></span> nolb_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolb <span class="main">(</span>And <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>nolb <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">∧</span> nolb <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="QEdlo_inf-nolb_Or"><span class="command">lemma</span></span> nolb_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolb <span class="main">(</span>Or <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>nolb <span class="free">φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">∧</span> nolb <span class="free">φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>3<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="QEdlo_inf-innermost_intvl"><span class="command">lemma</span></span> innermost_intvl<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">φ</span><span class="main">;</span> nolb <span class="free">φ</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">;</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span>
  <span class="main">⟹</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command">unfolding</span></span> nolb_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth.simps Ball_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm nat.splits<span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> not_le_imp_less order_antisym order_less_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ_def nolb_def nth_Cons'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">≠</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> And <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="QEdlo_inf-I_subst_peps2"><span class="command">lemma</span></span> I_subst_peps2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> nolb <span class="free">φ</span> <span class="free">xs</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">l</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>
 <span class="main">⟹</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;..</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>
 <span class="main">⟹</span> DLO.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="free">l</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FalseF <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> antisym_conv1 linorder_neq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst_peps.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nolb_def EQ_def Ball_def<span class="main">)</span>
         <span class="main">(</span><span class="operator">metis</span> One_nat_def antisym_conv1 not_less_iff_gr_or_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Atom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nolb_def EQ_def Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_def<span class="main">)</span><span class="main">(</span><span class="operator">metis</span> order_refl innermost_intvl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="QEdlo_inf-dense_interval"><span class="command">lemma</span></span> dense_interval<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>dlo<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> dense<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">l</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span><span class="main">;</span> <span class="bound">y</span><span class="main">≤</span><span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≤</span><span class="free">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?ll</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dense greaterThanLessThan_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="QEdlo_inf-I_subst_peps"><span class="command">lemma</span></span> I_subst_peps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> DLO.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="free">l</span><span class="main">)</span> <span class="free">xs</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">leps</span></span><span class="main">&gt;</span><span class="free">xs</span><span class="main">!</span><span class="free">l</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="free">l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">leps</span> <span class="main">⟶</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> TrueF <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> asubst_peps.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> dense<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> One_nat_def xt1<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> no_ub less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main">(</span><span class="operator">metis</span> no_ub<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Atom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> And <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"min <span class="improper">leps</span> <span class="improper">lepsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_eps<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">;</span> <span class="bound">lbs</span> <span class="main">=</span> lbounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ebs</span> <span class="main">=</span> ebounds <span class="bound">as</span>
 <span class="keyword1">in</span> list_disj <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> map <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="bound">lbs</span> <span class="main">@</span> map <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="bound">ebs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_qe_eps1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_eps<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?QE</span> <span class="main">=</span> <span class="var">?EX</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ebs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ebounds <span class="var">?as</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> min_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def amap_fm_list_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> set <span class="var">?ebs</span><span class="main">.</span> <span class="main">¬</span>DLO.I <span class="free">φ</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="bound">i</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">¬</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="skolem">l</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_subst qe_eps<span class="hidden">⇩</span><sub>1</sub>_def set_ebounds set_lbounds<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">leps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="free">φ</span> <span class="main">(</span><span class="skolem">leps</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> I_subst_peps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DLO.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ebs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ebounds <span class="var">?as</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"DLO.I <span class="free">φ</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="main">∈</span> set <span class="var">?ebs</span><span class="main">.</span> DLO.I <span class="main">(</span>subst <span class="free">φ</span> <span class="bound">k</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> DLO.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> set <span class="var">?ebs</span><span class="main">.</span> <span class="main">¬</span> DLO.I <span class="main">(</span>subst <span class="free">φ</span> <span class="bound">k</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> noE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ebounds EQ_def I_subst nth_Cons' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> LB <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> DLO.I<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span>LB <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">∧</span> nolb <span class="free">φ</span> <span class="free">xs</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dense_interval<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> finite_LB <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">∈</span>LB <span class="free">φ</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> x<span class="main">]</span> x innermost_intvl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> set <span class="var">?as</span> <span class="main">∧</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> nolb <span class="free">φ</span> <span class="free">xs</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="skolem">m</span><span class="main">)</span> <span class="skolem">x</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">m</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> DLO.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> noE <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> I_subst_peps2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def bex_Un set_lbounds set_ebounds<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEdlo_inf-qfree_asubst_peps"><span class="command">lemma</span></span> qfree_asubst_peps<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span><span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">k</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst_peps.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="QEdlo_inf-qfree_subst_peps"><span class="command">lemma</span></span> qfree_subst_peps<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qfree_asubst_peps<span class="main">)</span>

<span class="keyword1" id="QEdlo_inf-qfree_qe_eps"><span class="command">lemma</span></span> qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span>qe_eps<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_list_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qfree_min_inf qfree_subst_peps qfree_map_fm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_eps</span> <span class="main">=</span> DLO.lift_nnf_qe qe_eps<span class="hidden">⇩</span><sub>1</sub>"</span></span>

<span class="keyword1" id="QEdlo_inf-qfree_qe_eps"><span class="command">lemma</span></span> qfree_qe_eps<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>qe_eps <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qe_eps_def DLO.qfree_lift_nnf_qe qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword1" id="QEdlo_inf-I_qe_eps"><span class="command">lemma</span></span> I_qe_eps<span class="main">:</span> <span class="quoted"><span class="quoted">"DLO.I <span class="main">(</span>qe_eps <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> DLO.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps_def DLO.I_lift_nnf_qe qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub> I_qe_eps1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="LinArith">
<div class="head">
<h1>Theory LinArith</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Linear real arithmetic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> LinArith
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#QE">QE</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/ListVector.html">HOL-Library.ListVector</a>"</span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> iprod_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basics›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Syntax and Semantics›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> atom <span class="main">=</span> Less <span class="quoted">real</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="main">|</span> Eq <span class="quoted">real</span> <span class="quoted"><span class="quoted">"real list"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_Less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_Less</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">is_Less</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_Eq</span> <span class="main">≡</span> Not <span class="main">∘</span> is_Less"</span></span>

<span class="keyword1" id="LinArith-is_Less_iff"><span class="command">lemma</span></span> is_Less_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"is_Less <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">rs</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> Less <span class="bound">r</span> <span class="bound">rs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LinArith-is_Eq_iff"><span class="command">lemma</span></span> is_Eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">≠</span> Less <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Eq <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">neg<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Or <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hd_coeff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">c</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">c</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">c</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">c</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">depends<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span>hd_coeff <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">decr<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">rs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">I<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> real list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> ATOM.atoms<span class="hidden">⇩</span><sub>0</sub> depends<span class="hidden">⇩</span><sub>R</sub>"</span></span>
<span class="comment1">(* FIXME !!! (incl: display should hide params)*)</span>

<span class="keyword1"><span class="command">interpretation</span></span> R<span class="main">:</span> ATOM <span class="quoted">neg<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="quoted">I<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted">depends<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted">decr<span class="hidden">⇩</span><sub>R</sub></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ATOM.atoms<span class="hidden">⇩</span><sub>0</sub> depends<span class="hidden">⇩</span><sub>R</sub> <span class="main">=</span> atoms<span class="hidden">⇩</span><sub>0</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atoms<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> R.I<span class="antiquote">}</span></span>›</span>
<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> R.lift_nnf_qe<span class="antiquote">}</span></span>›</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Shared constructions›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">combine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">*</span> real list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>real <span class="main">*</span> real list<span class="main">)</span> <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">combine</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* More efficient combination than rhs of combine_conv below; unused
lemma combine_code:
  "combine (r1,c1,cs1) (r2,c2,cs2) =
  Less (c1*r2-c2*r1) (zipwith0 (%x y. c1*y-c2*x) cs1 cs2)"
apply(rule sym)
apply(simp)
apply(induct cs1 arbitrary:cs2)
 apply simp
apply(case_tac cs2)
 apply simp
apply simp
done*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lbounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">.</span> Less r <span class="main">(</span>c<span class="main">#</span>cs<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="bound">c</span><span class="main">&gt;</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ubounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">.</span> Less r <span class="main">(</span>c<span class="main">#</span>cs<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="bound">c</span><span class="main">&lt;</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ebounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">.</span> Eq r <span class="main">(</span>c<span class="main">#</span>cs<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="bound">c</span><span class="main">≠</span><span class="main">0</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="LinArith-set_lbounds"><span class="command">lemma</span></span> set_lbounds<span class="main">:</span>
 <span class="quoted"><span class="quoted">"set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Less <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lbounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits if_splits<span class="main">)</span>
<span class="keyword1" id="LinArith-set_ubounds"><span class="command">lemma</span></span> set_ubounds<span class="main">:</span>
 <span class="quoted"><span class="quoted">"set<span class="main">(</span>ubounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Less <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&lt;</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ubounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits if_splits<span class="main">)</span>
<span class="keyword1" id="LinArith-set_ebounds"><span class="command">lemma</span></span> set_ebounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set<span class="main">(</span>ebounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Eq <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ebounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits if_splits<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">EQ</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">EQ</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="bound">c</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Eq <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">LB</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">LB</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="bound">c</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Less <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">UB</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">UB</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="bound">c</span><span class="main">|</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> Less <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">&lt;</span><span class="main">0</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">*</span> real list <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> Less <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> Eq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="main">≡</span> <span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>asubst <span class="free"><span class="bound"><span class="entity">rcs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">*</span> real list <span class="main">⇒</span> real list <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="main">+</span> <span class="main">⟨</span>snd <span class="free"><span class="bound"><span class="entity">rcs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1" id="LinArith-I_asubst"><span class="command">lemma</span></span> I_asubst<span class="main">:</span>
 <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span>asubst <span class="free">t</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="main">(</span>eval <span class="free">t</span> <span class="free">xs</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eval_def distrib_left iprod_left_add_distrib<span class="main">)</span>
    <span class="operator">arith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eval_def distrib_left iprod_left_add_distrib<span class="main">)</span>
      <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LinArith-I_subst"><span class="command">lemma</span></span> I_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> R.I <span class="main">(</span>subst <span class="free">φ</span> <span class="free">t</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="main">(</span>eval <span class="free">t</span> <span class="free">xs</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_asubst<span class="main">)</span>
<span class="keyword1" id="LinArith-I_subst_pretty"><span class="command">lemma</span></span> I_subst_pretty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> R.I <span class="main">(</span>subst <span class="free">φ</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_subst eval_def<span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">min_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> FalseF <span class="keyword1">else</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> FalseF<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">plus_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> FalseF <span class="keyword1">else</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> FalseF<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1" id="LinArith-qfree_min_inf"><span class="command">lemma</span></span> qfree_min_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>min_inf.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="LinArith-qfree_plus_inf"><span class="command">lemma</span></span> qfree_plus_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>plus_inf.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="LinArith-min_inf"><span class="command">lemma</span></span> min_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≤</span><span class="bound">x</span><span class="main">.</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="LinArith-plus_inf"><span class="command">lemma</span></span> plus_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">≥</span><span class="bound">x</span><span class="main">.</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Less Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eq Cons
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>and_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>max <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 4<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="LinArith-LBex"><span class="command">lemma</span></span> LBex<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span>R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">l</span><span class="main">∈</span> LB <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits list.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="LinArith-UBex"><span class="command">lemma</span></span> UBex<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="main">¬</span>R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span> UB <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits list.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="LinArith-finite_LB"><span class="command">lemma</span></span> finite_LB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>LB <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">cs</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> set<span class="main">(</span>lbounds<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_lbounds image_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LinArith-finite_UB"><span class="command">lemma</span></span> finite_UB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>UB <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UB <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">cs</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> set<span class="main">(</span>ubounds<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ubounds image_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QElin">
<div class="head">
<h1>Theory QElin</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QElin
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#LinArith">LinArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Fourier›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">qe_FM<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom list <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_FM<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> list_conj <span class="main">[</span>Atom<span class="main">(</span>combine <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> p<span class="main">←</span>lbounds <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> q<span class="main">←</span>ubounds <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> is_Less <span class="bound">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> depends<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_FM<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Us</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>ubounds <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lbs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">UN</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">cs</span><span class="main">)</span><span class="main">:</span><span class="var">?Ls</span><span class="main">.</span> <span class="main">{</span><span class="bound">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ubs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">UN</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">cs</span><span class="main">)</span><span class="main">:</span><span class="var">?Us</span><span class="main">.</span> <span class="main">{</span><span class="bound">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="bound">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fins<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?lbs</span> <span class="main">∧</span> finite <span class="var">?ubs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="main">∃</span><span class="bound">r</span> <span class="bound">c</span> <span class="bound">cs</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> Less <span class="bound">r</span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="bound">cs</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="bound">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Ls</span> <span class="main">∨</span> <span class="bound">c</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">/</span><span class="bound">c</span><span class="main">,</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="bound">c</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">cs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Us</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dep less
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_lbounds set_ubounds is_Less_iff depends<span class="hidden">⇩</span><sub>R</sub>_def
                <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?lbs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?ubs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?lbs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="var">?ubs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">cs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Ls</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="var">?ubs</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">ds</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">ds</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Us</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_FM<span class="hidden">⇩</span><sub>1</sub>_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> iprod_left_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?ubs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Max <span class="var">?lbs</span> <span class="main">&lt;</span> Min <span class="var">?ubs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fins 1
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Max_less_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span> Min_gr_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Max <span class="var">?lbs</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">&lt;</span> Min <span class="var">?ubs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dense<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 nonempty
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ball_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bex_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?ubs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">(</span><span class="main">(</span>Max <span class="var">?lbs</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">cs</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Less <span class="skolem">r</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">cs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">c</span><span class="main">,</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Ls</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm 2 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span> <span class="main">≤</span> Max <span class="var">?lbs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm fins
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Max_ge_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>R</sub> <span class="skolem">a</span> <span class="main">(</span><span class="main">(</span>Max <span class="var">?lbs</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?ubs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">(</span><span class="main">(</span>Min <span class="var">?ubs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">cs</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Less <span class="skolem">r</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">cs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">c</span><span class="main">,</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span><span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Us</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"Min <span class="var">?ubs</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm fins
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Min_le_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>R</sub> <span class="skolem">a</span> <span class="main">(</span><span class="main">(</span>Min <span class="var">?ubs</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="var">?ubs</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Us</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>ubounds <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">c</span> <span class="skolem">cs</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">ds</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Less <span class="skolem">r</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"Less <span class="skolem">s</span> <span class="main">(</span><span class="skolem">d</span><span class="main">#</span><span class="skolem">ds</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qe_FM<span class="hidden">⇩</span><sub>1</sub>_def iprod_left_diff_distrib less <span class="dynamic"><span class="dynamic">field_simps</span></span> set_lbounds set_ubounds<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> I_qe_FM<span class="hidden">⇩</span><sub>1</sub>_pretty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> is_Less <span class="bound">a</span> <span class="main">∧</span> depends<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="main">⟹</span> R.is_dnf_qe qe_FM<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> I_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">subst<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span>
   Less <span class="bound">s</span> <span class="main">(</span><span class="bound">d</span><span class="main">#</span><span class="bound">ds</span><span class="main">)</span> <span class="main">⇒</span> Less <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">*</span><span class="bound">d</span><span class="main">)</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ds</span> <span class="main">-</span> <span class="main">(</span><span class="bound">d</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>
 <span class="main">|</span> Eq <span class="bound">s</span> <span class="main">(</span><span class="bound">d</span><span class="main">#</span><span class="bound">ds</span><span class="main">)</span> <span class="main">⇒</span> Eq <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">*</span><span class="bound">d</span><span class="main">)</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">ds</span> <span class="main">-</span> <span class="main">(</span><span class="bound">d</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QElin-subst"><span class="command">lemma</span></span> subst<span class="hidden">⇩</span><sub>0</sub>_pretty<span class="main">:</span>
 <span class="quoted"><span class="quoted">"subst<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Eq <span class="free">r</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Less <span class="free">s</span> <span class="main">(</span><span class="free">d</span><span class="main">#</span><span class="free">ds</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">ds</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">cs</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="quoted">"subst<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Eq <span class="free">r</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Eq <span class="free">s</span> <span class="main">(</span><span class="free">d</span><span class="main">#</span><span class="free">ds</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">ds</span> <span class="main">-</span> <span class="main">(</span><span class="free">d</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="QElin-I_subst"><span class="command">lemma</span></span> I_subst<span class="hidden">⇩</span><sub>0</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"depends<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
       I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span>subst<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span>Eq <span class="free">r</span> <span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="free">c</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def iprod_left_diff_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_divide_distrib <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> R<span class="hidden">⇩</span><sub>e</sub><span class="main">:</span>
  ATOM_EQ <span class="quoted">neg<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="quoted">I<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted">depends<span class="hidden">⇩</span><sub>R</sub></span> <span class="quoted">decr<span class="hidden">⇩</span><sub>R</sub></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span>Eq <span class="main"><span class="bound">_</span></span> <span class="main">(</span><span class="bound">c</span><span class="main">#</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span>Eq <span class="bound">r</span> <span class="bound">cs</span> <span class="main">⇒</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="bound">cs</span><span class="main">.</span> <span class="bound">c</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span>"</span></span> <span class="quoted">subst<span class="hidden">⇩</span><sub>0</sub></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>subst<span class="hidden">⇩</span><sub>0</sub>.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_subst<span class="hidden">⇩</span><sub>0</sub> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprod0_if_coeffs0 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> r ds c cs<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="improper">cs</span><span class="main">,</span><span class="improper">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_divide_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_list_diff set_replicate_conv_if
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* FIXME does not help
setup {* Sign.revert_abbrev "" @{const_name R<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe} *}
*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_FM</span> <span class="main">=</span> R<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe qe_FM<span class="hidden">⇩</span><sub>1</sub>"</span></span>

<span class="keyword1" id="QElin-qfree_qe_FM"><span class="command">lemma</span></span> qfree_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_FM<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_FM<span class="hidden">⇩</span><sub>1</sub>_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>qfree_list_conj<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> I_qe_FM<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_FM <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> qe_FM_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>e</sub>.I_lift_dnfeq_qe<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_qe_FM<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_FM <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_FM_def R<span class="hidden">⇩</span><sub>e</sub>.qfree_lift_dnfeq_qe qfree_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Tests›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> qesimps <span class="main">=</span> qe_FM_def R<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe_def R<span class="hidden">⇩</span><sub>e</sub>.lift_eq_qe_def R.qelim_def qe_FM<span class="hidden">⇩</span><sub>1</sub>_def lbounds_def ubounds_def list_conj_def list_disj_def and_def or_def depends<span class="hidden">⇩</span><sub>R</sub>_def

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"qe_FM<span class="main">(</span>TrueF<span class="main">)</span> <span class="main">=</span> TrueF"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qesimps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"qe_FM<span class="main">(</span>ExQ <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qesimps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
 <span class="quoted"><span class="quoted">"qe_FM<span class="main">(</span>ExQ <span class="main">(</span>And <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Atom<span class="main">(</span>Less <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">[</span><span class="main">-</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qesimps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QElin_opt">
<div class="head">
<h1>Theory QElin_opt</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QElin_opt
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#QElin">QElin</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹An optimization›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Atoms are simplified asap.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asimp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span>
 Less <span class="bound">r</span> <span class="bound">cs</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="bound">cs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>
               <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">r</span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> FalseF
               <span class="keyword1">else</span> Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">|</span>
 Eq <span class="bound">r</span> <span class="bound">cs</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="bound">cs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>
             <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="bound">r</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> FalseF <span class="keyword1">else</span> Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QElin_opt-asimp_pretty"><span class="command">lemma</span></span> asimp_pretty<span class="main">:</span>
<span class="quoted"><span class="quoted">"asimp <span class="main">(</span>Less <span class="free">r</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>
  <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">r</span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> FalseF
  <span class="keyword1">else</span> Atom<span class="main">(</span>Less <span class="free">r</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="quoted"><span class="quoted">"asimp <span class="main">(</span>Eq <span class="free">r</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">c</span><span class="main">∈</span> set <span class="free">cs</span><span class="main">.</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span>
  <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">r</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> FalseF
  <span class="keyword1">else</span> Atom<span class="main">(</span>Eq <span class="free">r</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>asimp_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">qe_FMo<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom list <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_FMo<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> list_conj <span class="main">[</span>asimp<span class="main">(</span>combine <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">.</span> p<span class="main">←</span>lbounds <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> q<span class="main">←</span>ubounds <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="QElin_opt-I_asimp"><span class="command">lemma</span></span> I_asimp<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>asimp <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>asimp_def iprod0_if_coeffs0 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.split<span class="main">)</span>

<span class="keyword1" id="QElin_opt-I_qe_FMo"><span class="command">lemma</span></span> I_qe_FMo<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_FMo<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="main">(</span>qe_FM<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_FM<span class="hidden">⇩</span><sub>1</sub>_def qe_FMo<span class="hidden">⇩</span><sub>1</sub>_def I_asimp<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_FMo</span> <span class="main">=</span> R<span class="hidden">⇩</span><sub>e</sub>.lift_dnfeq_qe qe_FMo<span class="hidden">⇩</span><sub>1</sub>"</span></span>

<span class="keyword1" id="QElin_opt-qfree_qe_FMo"><span class="command">lemma</span></span> qfree_qe_FMo<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_FMo<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_FM<span class="hidden">⇩</span><sub>1</sub>_def qe_FMo<span class="hidden">⇩</span><sub>1</sub>_def asimp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>qfree_list_conj
        <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.split<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> I_qe_FMo<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_FMo <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> qe_FMo_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="hidden">⇩</span><sub>e</sub>.I_lift_dnfeq_qe<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_qe_FMo<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> I_qe_FMo<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I_qe_FM<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_qe_FMo<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_FMo <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_FMo_def R<span class="hidden">⇩</span><sub>e</sub>.qfree_lift_dnfeq_qe qfree_qe_FMo<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FRE">
<div class="head">
<h1>Theory FRE</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> FRE
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#LinArith">LinArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Ferrante-Rackoff \label{sec:FRE}›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section formalizes a slight variant of Ferrante and
Rackoff's algorithm~\cite{FerranteR-SIAM75}. We consider equalities
separately, which improves performance.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">between</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">*</span> real list <span class="main">⇒</span> real <span class="main">*</span> real list <span class="main">⇒</span> real <span class="main">*</span> real list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">between</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FR<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">FR<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">;</span> <span class="bound">lbs</span> <span class="main">=</span> lbounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ubs</span> <span class="main">=</span> ubounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ebs</span> <span class="main">=</span> ebounds <span class="bound">as</span><span class="main">;</span>
     <span class="bound">intrs</span> <span class="main">=</span> <span class="main">[</span>subst <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">(</span>between <span class="bound">l</span> <span class="bound">u</span><span class="main">)</span> <span class="main">.</span> l <span class="main">←</span> <span class="bound">lbs</span><span class="main">,</span> u <span class="main">←</span> <span class="bound">ubs</span><span class="main">]</span>
 <span class="keyword1">in</span> list_disj <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="bound">intrs</span> <span class="main">@</span> map <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span> <span class="bound">ebs</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="FRE-dense_interval"><span class="command">lemma</span></span> dense_interval<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> dense<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..&lt;</span><span class="bound">u</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">U</span><span class="main">;</span>
                       <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span><span class="main">;</span><span class="free">x</span><span class="main">&lt;</span><span class="bound">u</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span><span class="main">;</span><span class="bound">y</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span><span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span><span class="main">:</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">u</span></span><span class="main">:</span><span class="free">U</span><span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span><span class="main">:</span><span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?ll</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="var">?uu</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?uu</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?uu</span> <span class="main">∈</span> <span class="var">?U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> Min_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="var">?uu</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="var">?uu</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ll</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="var">?uu</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?U</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dense greaterThanLessThan_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FRE-dense"><span class="command">lemma</span></span> dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> LB <span class="free">f</span> <span class="free">xs</span><span class="main">;</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">&lt;..&lt;</span><span class="free">u</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> UB <span class="free">f</span> <span class="free">xs</span><span class="main">;</span>
     <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">u</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span><span class="main">;</span>  R.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">u</span><span class="main">⟧</span>
   <span class="main">⟹</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom Less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom Less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom Less Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&lt;</span> <span class="var">?u</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom Less Cons <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">&lt;</span><span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="var">?u</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Atom Less Cons <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&gt;</span> <span class="var">?l</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom Less Cons <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">&gt;</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">&gt;</span><span class="free">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Atom Less Cons <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom Eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom Eq Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span> Atom Eq Cons <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">&lt;</span><span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">&lt;</span><span class="free">u</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_FR<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>FR<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?FR</span> <span class="main">=</span> <span class="var">?EX</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?FR</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?FR</span>›</span></span> min_inf<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?FR</span>›</span></span> plus_inf<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">xs</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?FR</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span> <span class="main">¬</span>R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>EQ <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span>R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?FR</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">ds</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>subst <span class="free">φ</span> <span class="main">(</span>between <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">ds</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FR<span class="hidden">⇩</span><sub>1</sub>_def eval_def
        diff_divide_distrib set_ebounds I_subst <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"R.I <span class="free">φ</span> <span class="main">(</span>eval <span class="main">(</span>between <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">ds</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_subst <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="free">φ</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∨</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?FR</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> EQ <span class="free">φ</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">cs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>ebounds<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ebounds <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>subst <span class="free">φ</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_subst <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> eval_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?FR</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> LB <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> UB <span class="free">φ</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> UBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span>LB <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>UB <span class="free">φ</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">u</span> <span class="main">⟶</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dense_interval<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> finite_LB finite_UB <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">:</span>LB <span class="free">φ</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">:</span>UB <span class="free">φ</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">u</span>›</span></span> x<span class="main">]</span> x dense<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> _ _ _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">φ</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">ds</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Less <span class="skolem">r</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Less <span class="skolem">s</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">#</span> <span class="skolem">ds</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">d</span> <span class="main">⟹</span> R.I <span class="free">φ</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">c</span> <span class="main">&lt;</span> eval <span class="main">(</span>between <span class="main">(</span><span class="skolem">r</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">/</span> <span class="skolem">d</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ds</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eval <span class="main">(</span>between <span class="main">(</span><span class="skolem">r</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">/</span> <span class="skolem">d</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ds</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_split_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>
        <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>
        <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> eval_def iprod_left_add_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?FR</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FR<span class="hidden">⇩</span><sub>1</sub>_def bex_Un set_lbounds set_ubounds set_ebounds I_subst <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?FR</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FR</span> <span class="main">=</span> R.lift_nnf_qe FR<span class="hidden">⇩</span><sub>1</sub>"</span></span>


<span class="keyword1" id="FRE-qfree_FR"><span class="command">lemma</span></span> qfree_FR<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span>FR<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FR<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_list_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qfree_min_inf qfree_plus_inf set_ubounds set_lbounds set_ebounds image_def qfree_map_fm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_FR<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>FR <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_FR<span class="hidden">⇩</span><sub>1</sub> FR_def R.I_lift_nnf_qe qfree_FR<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_FR<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>FR <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>FR_def R.qfree_lift_nnf_qe qfree_FR<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QElin_inf">
<div class="head">
<h1>Theory QElin_inf</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QElin_inf
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#LinArith">LinArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quantifier elimination with infinitesimals \label{sec:lin-inf}›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section formalizes Loos and Weispfenning's quantifier
elimination procedure based on (the simulation of)
infinitesimals~\cite{LoosW93}.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst_peps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">*</span> real list <span class="main">⇒</span> atom <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Atom<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
   <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">;</span> <span class="bound">v</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">;</span> <span class="bound">less</span> <span class="main">=</span> Atom<span class="main">(</span>Less <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>
   <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> <span class="bound">less</span> <span class="keyword1">else</span> Or <span class="bound">less</span> <span class="main">(</span>Atom<span class="main">(</span>Eq <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Atom<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="keyword1">else</span> FalseF<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst_peps</span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subst_peps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> real <span class="main">*</span> real list <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">subst<span class="hidden">⇩</span><sub>+</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span> <span class="main">≡</span> <span class="keyword1">amap<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span><span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">rcs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nolb</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">&lt;..&lt;</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> LB <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QElin_inf-nolb_And"><span class="command">lemma</span></span> nolb_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolb <span class="main">(</span>And <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>nolb <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">∧</span> nolb <span class="free">g</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="QElin_inf-nolb_Or"><span class="command">lemma</span></span> nolb_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nolb <span class="main">(</span>Or <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>nolb <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span> <span class="main">∧</span> nolb <span class="free">g</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span><span class="main"><span class="main">=</span></span>4<span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="QElin_inf-innermost_intvl"><span class="command">lemma</span></span> innermost_intvl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> nolb <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span><span class="main">;</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span>
  <span class="main">⟹</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Less <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&lt;</span> <span class="var">?u</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">&lt;</span><span class="var">?u</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">&gt;</span> <span class="var">?l</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def Ball_def nolb_def<span class="main">)</span>
               <span class="main">(</span><span class="operator">metis</span> linorder_not_le antisym order_less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Eq <span class="skolem">r</span> <span class="skolem">cs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">cs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>depends<span class="hidden">⇩</span><sub>R</sub>_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>›</span></span> Atom
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">EQ2</span> <span class="main">=</span> EQ"</span></span>

<span class="keyword1" id="QElin_inf-EQ2_Or"><span class="command">lemma</span></span> EQ2_Or<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"EQ2 <span class="main">(</span>Or <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>EQ2 <span class="free">f</span> <span class="free">xs</span> <span class="main">∪</span> EQ2 <span class="free">g</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ2_def<span class="main">)</span>

<span class="keyword1" id="QElin_inf-EQ2_And"><span class="command">lemma</span></span> EQ2_And<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"EQ2 <span class="main">(</span>And <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>EQ2 <span class="free">f</span> <span class="free">xs</span> <span class="main">∪</span> EQ2 <span class="free">g</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ2_def<span class="main">)</span>

<span class="keyword1" id="QElin_inf-innermost_intvl2"><span class="command">lemma</span></span> innermost_intvl2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">f</span><span class="main">;</span> nolb <span class="free">f</span> <span class="free">xs</span> <span class="free">l</span> <span class="free">x</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> EQ2 <span class="free">f</span> <span class="free">xs</span><span class="main">;</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">;</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span>
  <span class="main">⟹</span> R.I <span class="free">f</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> EQ2_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>innermost_intvl<span class="main">)</span>

<span class="keyword1" id="QElin_inf-I_subst_peps2"><span class="command">lemma</span></span> I_subst_peps2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="free">r</span><span class="main">+</span><span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟹</span> nolb <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="free">x</span>
 <span class="main">⟹</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">r</span><span class="main">+</span><span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;..</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∉</span> EQ2 <span class="free">f</span> <span class="free">xs</span>
 <span class="main">⟹</span> R.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> FalseF <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> antisym_conv1 linorder_neq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">cs</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst_peps.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span> <span class="skolem">cs</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">ds</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">*</span><span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> Atom 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_strict_left_mono_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprod_left_add_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?U</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?U</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">≠</span> <span class="var">?L</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?U</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="var">?L</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Atom 1
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nolb_def depends<span class="hidden">⇩</span><sub>R</sub>_def Ball_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">&lt;</span> <span class="var">?U</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> <span class="var">?U</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_linordered_idom order_refl<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom 1 <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iprod_left_add_distrib <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nolb_def EQ2_def depends<span class="hidden">⇩</span><sub>R</sub>_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Atom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Ball_def<span class="main">)</span><span class="main">(</span><span class="operator">metis</span> order_refl innermost_intvl2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="QElin_inf-I_subst_peps"><span class="command">lemma</span></span> I_subst_peps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> R.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">leps</span></span><span class="main">&gt;</span><span class="free">r</span><span class="main">+</span><span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">r</span><span class="main">+</span><span class="main">⟨</span><span class="free">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">leps</span> <span class="main">⟶</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> TrueF <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> less_add_one<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">cs</span><span class="main">)</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> asubst_peps.cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span> <span class="skolem">cs</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">ds</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> less_add_one<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Atom 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> dense<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?a</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="bound">y</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&lt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> add_le_cancel_right mult_le_cancel_left order_antisym linear mult.commute xt1<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="var">?a</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">d</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span> <span class="main">+</span> <span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Atom 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="var">?b</span> <span class="main">∨</span> <span class="var">?a</span> <span class="main">=</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="var">?b</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> Atom 1
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
            <span class="main">(</span><span class="operator">metis</span> add_0_left add_less_cancel_right distrib_left mult.commute mult_strict_left_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">+</span><span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">r</span><span class="main">+</span><span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">*</span><span class="main">(</span><span class="skolem">r</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> mult_strict_left_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">d</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ds</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">&lt;</span> <span class="var">?b</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iprod_left_add_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_linear<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Atom<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less_add_one<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> And <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"min <span class="improper">leps</span> <span class="improper">lepsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Or <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="QElin_inf-dense_interval"><span class="command">lemma</span></span> dense_interval<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> dense<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">l</span><span class="main">.</span> <span class="main">⟦</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span><span class="main">;</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span><span class="main">;</span> <span class="bound">y</span><span class="main">≤</span><span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="bound">l</span><span class="main">&lt;..&lt;</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≤</span><span class="free">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">l</span></span><span class="main">∈</span><span class="free">L</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">&lt;</span><span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>order_less_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="var">?ll</span><span class="main">&lt;</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">&lt;</span><span class="free">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="free">L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>dense greaterThanLessThan_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_eps<span class="hidden">⇩</span><sub>1</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span>
<span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="bound">lbs</span> <span class="main">=</span> lbounds <span class="bound">as</span><span class="main">;</span> <span class="bound">ebs</span> <span class="main">=</span> ebounds <span class="bound">as</span>
 <span class="keyword1">in</span> list_disj <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">#</span> map <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="bound">lbs</span> <span class="main">@</span> map <span class="main">(</span>subst <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="bound">ebs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_eps1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_eps<span class="hidden">⇩</span><sub>1</sub> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?QE</span> <span class="main">=</span> <span class="var">?EX</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ebs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ebounds <span class="var">?as</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> min_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def amap_fm_list_disj<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> EQ <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span>R.I <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qe_eps<span class="hidden">⇩</span><sub>1</sub>_def set_ebounds diff_divide_distrib eval_def I_subst <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">leps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"R.I <span class="free">f</span> <span class="main">(</span><span class="skolem">leps</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> I_subst_peps<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ebs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ebounds <span class="var">?as</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?EX</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rcs</span> <span class="main">∈</span> set <span class="var">?ebs</span><span class="main">.</span> R.I <span class="main">(</span>subst <span class="free">f</span> <span class="bound">rcs</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> R.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rcs</span> <span class="main">∈</span> set <span class="var">?ebs</span><span class="main">.</span> <span class="main">¬</span> R.I <span class="main">(</span>subst <span class="free">f</span> <span class="bound">rcs</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> noE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> EQ <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="main">¬</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">e</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_ebounds I_subst diff_divide_distrib eval_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> LB <span class="free">f</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LBex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span> x <span class="quoted"><span class="quoted">‹<span class="main">¬</span> R.I<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span>LB <span class="free">f</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">l</span><span class="main">&lt;</span><span class="skolem">x</span> <span class="main">∧</span> nolb <span class="free">f</span> <span class="free">xs</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dense_interval<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> finite_LB <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">∈</span>LB <span class="free">f</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">x</span>›</span></span> x<span class="main">]</span> x innermost_intvl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span> _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> EQ <span class="free">f</span> <span class="free">xs</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nolb_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">cs</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Less <span class="skolem">r</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">cs</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>R.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span>
            <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> nolb <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="skolem">x</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">cs</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span><span class="main">/</span><span class="skolem">c</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> R.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span><span class="main">/</span><span class="skolem">c</span><span class="main">,</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> noE
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> I_subst_peps2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>EQ2_def diff_divide_distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def bex_Un set_lbounds<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QElin_inf-qfree_asubst_peps"><span class="command">lemma</span></span> qfree_asubst_peps<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span><span class="keyword1">asubst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">rcs</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">rcs</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst_peps.cases<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="QElin_inf-qfree_subst_peps"><span class="command">lemma</span></span> qfree_subst_peps<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span><span class="keyword1">subst<span class="hidden">⇩</span><sub>+</sub></span> <span class="free">φ</span> <span class="free">rcs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qfree_asubst_peps<span class="main">)</span>

<span class="keyword1" id="QElin_inf-qfree_qe_eps"><span class="command">lemma</span></span> qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> qfree<span class="main">(</span>qe_eps<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> qfree_list_disj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qfree_min_inf qfree_subst_peps qfree_map_fm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_eps</span> <span class="main">=</span> R.lift_nnf_qe qe_eps<span class="hidden">⇩</span><sub>1</sub>"</span></span>

<span class="keyword1" id="QElin_inf-qfree_qe_eps"><span class="command">lemma</span></span> qfree_qe_eps<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree<span class="main">(</span>qe_eps <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qe_eps_def R.qfree_lift_nnf_qe qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>

<span class="keyword1" id="QElin_inf-I_qe_eps"><span class="command">lemma</span></span> I_qe_eps<span class="main">:</span> <span class="quoted"><span class="quoted">"R.I <span class="main">(</span>qe_eps <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> R.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_eps_def R.I_lift_nnf_qe qfree_qe_eps<span class="hidden">⇩</span><sub>1</sub> I_eps1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PresArith">
<div class="head">
<h1>Theory PresArith</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Presburger arithmetic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> PresArith
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#QE">QE</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/ListVector.html">HOL-Library.ListVector</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> iprod_assoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> atom <span class="main">=</span>
  Le <span class="quoted">int</span> <span class="quoted"><span class="quoted">"int list"</span></span> <span class="main">|</span> Dvd <span class="quoted">int</span> <span class="quoted">int</span> <span class="quoted"><span class="quoted">"int list"</span></span> <span class="main">|</span> NDvd <span class="quoted">int</span> <span class="quoted">int</span> <span class="quoted"><span class="quoted">"int list"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">divisor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">divisor</span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">divisor</span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">divisor</span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">neg<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom fm"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Le <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">neg<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> Atom<span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hd_coeff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff</span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">k</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff</span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">k</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff</span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">0</span> <span class="main">|</span> <span class="bound">k</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">decr<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">decr<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="main">=</span> NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>tl <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">I<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> int list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">atoms<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> ATOM.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="comment1">(* FIXME !!! (incl: display should hide params)*)</span>

<span class="keyword1"><span class="command">interpretation</span></span> Z<span class="main">:</span>
  ATOM <span class="quoted">neg<span class="hidden">⇩</span><sub>Z</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted">I<span class="hidden">⇩</span><sub>Z</sub></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="quoted">decr<span class="hidden">⇩</span><sub>Z</sub></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"ATOM.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> atoms<span class="hidden">⇩</span><sub>0</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atoms<span class="hidden">⇩</span><sub>0</sub>_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> Z.I<span class="antiquote">}</span></span>›</span>
<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹Sign.revert_abbrev <span class="inner_quoted">""</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_abbrev</span> Z.lift_dnf_qe<span class="antiquote">}</span></span>›</span>
<span class="comment1">(* FIXME doesn't work*)</span>
<span class="comment1">(* FIXME does not help
setup {* Sign.revert_abbrev "" @{const_abbrev Z.normal} *}
*)</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff_is1</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> Le <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> hd_coeff <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> hd_coeff <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">asubst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int list <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Le <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">asubst</span> <span class="free"><span class="bound"><span class="entity">i'</span></span></span> <span class="free"><span class="bound"><span class="entity">ks'</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int list <span class="main">⇒</span> atom fm <span class="main">⇒</span> atom fm"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subst</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span> <span class="main">≡</span> <span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>asubst <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="PresArith-IZ_asubst"><span class="command">lemma</span></span> IZ_asubst<span class="main">:</span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>asubst <span class="free">i</span> <span class="free">ks</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> iprod_left_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="PresArith-I_subst"><span class="command">lemma</span></span> I_subst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="free">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Z.I <span class="main">(</span>subst <span class="free">i</span> <span class="free">ks</span> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>IZ_asubst<span class="main">)</span>

<span class="keyword1" id="PresArith-divisor_asubst"><span class="command">lemma</span></span> divisor_asubst<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"divisor <span class="main">(</span>asubst <span class="free">i</span> <span class="free">ks</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> divisor <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">ks</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>asubst.induct<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lbounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">.</span> Le i <span class="main">(</span>k<span class="main">#</span>ks<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="bound">k</span><span class="main">&gt;</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ubounds</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">.</span> Le i <span class="main">(</span>k<span class="main">#</span>ks<span class="main">)</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="bound">k</span><span class="main">&lt;</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1" id="PresArith-set_lbounds"><span class="command">lemma</span></span> set_lbounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">|</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">ks</span><span class="main">.</span> Le <span class="bound">i</span> <span class="main">(</span><span class="bound">k</span><span class="main">#</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lbounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits if_splits<span class="main">)</span>
<span class="keyword1" id="PresArith-set_ubounds"><span class="command">lemma</span></span> set_ubounds<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set<span class="main">(</span>ubounds <span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">|</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">ks</span><span class="main">.</span> Le <span class="bound">i</span> <span class="main">(</span><span class="bound">k</span><span class="main">#</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&lt;</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ubounds_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits if_splits<span class="main">)</span>

<span class="keyword1" id="PresArith-lbounds_append"><span class="command">lemma</span></span> lbounds_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lbounds<span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> lbounds <span class="free">as</span> <span class="main">@</span> lbounds <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lbounds_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹LCM and lemmas›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">zlcms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int list <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">zlcms</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">zlcms</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">)</span> <span class="main">=</span> lcm <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free">zlcms</span> <span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="PresArith-dvd_zlcms"><span class="command">lemma</span></span> dvd_zlcms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> set <span class="free">is</span> <span class="main">⟹</span> <span class="free">i</span> <span class="keyword1">dvd</span> zlcms <span class="free">is</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">is</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="PresArith-zlcms_pos"><span class="command">lemma</span></span> zlcms_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> set <span class="free">is</span><span class="main">.</span> <span class="bound">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> zlcms <span class="free">is</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">is</span>"</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>lcm_pos_int<span class="main">)</span>

<span class="keyword1" id="PresArith-zlcms0_iff"><span class="command">lemma</span></span> zlcms0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zlcms <span class="free">is</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">∈</span> set <span class="free">is</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_by_0 dvd_eq_mod_eq_0 dvd_zlcms zlcms_pos less_le<span class="main">)</span>

<span class="keyword1" id="PresArith-elem_le_zlcms"><span class="command">lemma</span></span> elem_le_zlcms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> set <span class="free">is</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">is</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> zlcms <span class="free">is</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_zlcms zdvd_imp_le zlcms_pos<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Setting coeffiencients to 1 or -1›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">hd_coeff1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff1</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">m'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">div</span> <span class="main">(</span>abs <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="keyword1">in</span> Le <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span>sgn <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="bound">m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff1</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Dvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">m'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">in</span> Dvd <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">#</span> <span class="main">(</span><span class="bound">m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff1</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> NDvd <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">m'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">in</span> NDvd <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">#</span> <span class="main">(</span><span class="bound">m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeff1</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The def of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> hd_coeff1<span class="antiquote"><span class="antiquote">}</span></span></span></span> on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Dvd<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> NDvd<span class="antiquote"><span class="antiquote">}</span></span></span></span> is
different from the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Le<span class="antiquote"><span class="antiquote">}</span></span></span></span> because it allows the resulting head
coefficient to be 1 rather than 1 or -1. We show that the other version has
the same semantics:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="free">k</span> <span class="keyword1">dvd</span> <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span>
  I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="main">(</span>Dvd <span class="free">d</span> <span class="free">i</span> <span class="main">(</span><span class="free">k</span><span class="main">#</span><span class="free">ks</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">div</span> <span class="main">(</span>abs <span class="free">k</span><span class="main">)</span> <span class="keyword1">in</span>
  I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>Dvd <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="main">(</span><span class="bound">m'</span><span class="main">*</span><span class="free">i</span><span class="main">)</span> <span class="main">(</span>sgn <span class="free">k</span> <span class="main">#</span> <span class="main">(</span><span class="bound">m'</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">ks</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span> abs_if sgn_if<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zdiv_zminus2_eq_if dvd_eq_mod_eq_0<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> diff_conv_add_uminus add.left_commute dvd_minus_iff minus_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zdiv_zminus2_eq_if dvd_eq_mod_eq_0<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> diff_conv_add_uminus add.left_commute dvd_minus_iff minus_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="PresArith-I_hd_coeff1_mult_a"><span class="command">lemma</span></span> I_hd_coeff1_mult_a<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd_coeff <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">m</span> <span class="main">|</span> hd_coeff <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="free">a</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Le <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ks</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Le <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">div</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span> pos_imp_zdiv_pos_iff <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zdvd_imp_le<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> sgn <span class="skolem">k</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sgn <span class="skolem">k</span> <span class="main">*</span> abs <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="var">?m'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_sgn_abs<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sgn <span class="skolem">k</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>abs <span class="skolem">k</span> <span class="main">*</span> <span class="var">?m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sgn <span class="skolem">k</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_mult_div_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="main">(</span>Le <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span>
            <span class="main">(</span><span class="skolem">i</span><span class="main">*</span><span class="var">?m'</span> <span class="main">≤</span> sgn <span class="skolem">k</span> <span class="main">*</span> <span class="free">m</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?m'</span><span class="main">*</span><span class="skolem">i</span> <span class="main">≤</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m'</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Dvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ks</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Dvd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">div</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span> zdiv_eq_0_iff <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linorder_not_less zdvd_imp_le<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_mult_div_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="main">(</span>Dvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span>
            <span class="main">(</span><span class="var">?m'</span><span class="main">*</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?m'</span><span class="main">*</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">m</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?m'</span><span class="main">*</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>NDvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ks</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> NDvd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">div</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span> zdiv_eq_0_iff <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>linorder_not_less zdvd_imp_le<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="var">?m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_mult_div_cancel<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">m</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="main">(</span>NDvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span>
            <span class="main">¬</span><span class="main">(</span><span class="var">?m'</span><span class="main">*</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?m'</span><span class="main">*</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">m</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="var">?m'</span><span class="main">*</span><span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?m'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?m'</span><span class="main">≠</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="PresArith-I_hd_coeff1_mult"><span class="command">lemma</span></span> I_hd_coeff1_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">m</span> <span class="main">⟹</span>
 Z.I <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>hd_coeff1 <span class="free">m</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> I_hd_coeff1_mult_a<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="QEpres">
<div class="head">
<h1>Theory QEpres</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> QEpres
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#PresArith">PresArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹DNF-based quantifier elimination›</span></span>

<span class="comment1">(* all hd-coeffs are nonzero! *)</span>
<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeffs1</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> zlcms<span class="main">(</span>map hd_coeff <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>
  <span class="keyword1">in</span> Dvd <span class="bound">m</span> <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span> <span class="main">#</span> map <span class="main">(</span>hd_coeff1 <span class="bound">m</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QEpres-I_hd_coeffs1"><span class="command">lemma</span></span> I_hd_coeffs1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set<span class="main">(</span>hd_coeffs1 <span class="free">as</span><span class="main">)</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zlcms_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="var">?m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="var">?m</span><span class="main">*</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_hd_coeff1_mult_a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?m</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> dvd_zlcms 0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?m</span> <span class="keyword1">dvd</span> <span class="bound">x</span><span class="main">+</span><span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>hd_coeff1 <span class="var">?m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> unity_coeff_ex<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> meta_eq_to_obj_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_dvd</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> Le <span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_pres<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ds</span> <span class="main">=</span> filter is_dvd <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">;</span> <span class="main">(</span><span class="bound">d</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> zlcms<span class="main">(</span>map divisor <span class="bound">ds</span><span class="main">)</span><span class="main">;</span> <span class="bound">ls</span> <span class="main">=</span> lbounds <span class="free"><span class="bound"><span class="entity">as</span></span></span>
  <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">ls</span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">then</span> Disj <span class="main">[</span><span class="main">0</span><span class="main">..</span><span class="bound">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> list_conj<span class="main">(</span>map <span class="main">(</span>Atom <span class="main">∘</span> asubst <span class="bound">n</span> <span class="main">[]</span><span class="main">)</span> <span class="bound">ds</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span>
     Disj <span class="bound">ls</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">li</span><span class="main">,</span><span class="bound">lks</span><span class="main">)</span><span class="main">.</span>
       Disj <span class="main">[</span><span class="main">0</span><span class="main">..</span><span class="bound">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span>
         list_conj<span class="main">(</span>map <span class="main">(</span>Atom <span class="main">∘</span> asubst <span class="main">(</span><span class="bound">li</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="bound">lks</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\noindent Note the optimization in the case <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">ls</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: only the
divisibility atoms are tested, not the inequalities. This complicates
the proof.›</span></span>

<span class="keyword1" id="QEpres-I_cyclic"><span class="command">lemma</span></span> I_cyclic<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_dvd <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd_coeff <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> divisor <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> divisor <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="free">a</span> <span class="main">(</span><span class="free">i</span><span class="main">#</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="free">a</span> <span class="main">(</span><span class="free">j</span><span class="main">#</span><span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dvd <span class="skolem">d</span> <span class="skolem">l</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹hd_coeff <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ks'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="main">=</span> <span class="main">1</span><span class="main">#</span><span class="skolem">ks'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">=</span><span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">mod</span> divisor <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> divisor <span class="free">a</span>›</span></span> Dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>               
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Dvd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_eq_mod_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NDvd <span class="skolem">d</span> <span class="skolem">l</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹hd_coeff <span class="free">a</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ks'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="main">=</span> <span class="main">1</span><span class="main">#</span><span class="skolem">ks'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">=</span><span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="keyword1">mod</span> divisor <span class="free">a</span> <span class="main">=</span> <span class="free">j</span> <span class="keyword1">mod</span> divisor <span class="free">a</span>›</span></span> NDvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks'</span><span class="main">,</span><span class="free">e</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="skolem">d</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mod_add_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> NDvd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_eq_mod_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Le <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_dvd <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEpres-I_qe_pres"><span class="command">lemma</span></span> I_qe_pres<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> hd_coeff_is1 <span class="bound">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Z.I <span class="main">(</span>qe_pres<span class="hidden">⇩</span><sub>1</sub> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lbs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lbounds <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter is_dvd <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lcm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map divisor <span class="var">?ds</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> is_dvd <span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Us</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> Le <span class="main"><span class="bound">_</span></span> <span class="main">(</span><span class="bound">k</span><span class="main">#</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> Le <span class="main"><span class="bound">_</span></span> <span class="main">(</span><span class="bound">k</span><span class="main">#</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">as</span> <span class="main">=</span> <span class="var">?Ds</span> <span class="main">∪</span> <span class="var">?Ls</span> <span class="main">∪</span> <span class="var">?Us</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> atom.exhaust<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?Ds</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?QE</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?QE</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="var">?lcm</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?Ds</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="skolem">n</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>IZ_asubst qe_pres<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ls</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lbs</span> <span class="main">=</span> <span class="main">[]</span>›</span></span> set_lbounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">as</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>filter_empty_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.split list.split<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Us</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Ls</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">as</span> <span class="main">=</span> <span class="var">?Ds</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span><span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Us</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span>tl <span class="bound">ks</span><span class="main">,</span> <span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="bound">i</span><span class="main">|</span><span class="bound">ks</span> <span class="bound">i</span><span class="main">.</span> Le <span class="bound">i</span> <span class="bound">ks</span> <span class="main">∈</span> <span class="var">?Us</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Min <span class="var">?M</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?M</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span> <span class="main">(</span><span class="main">λ</span>Le <span class="bound">i</span> <span class="bound">ks</span> <span class="main">⇒</span> <span class="main">⟨</span>tl <span class="bound">ks</span><span class="main">,</span> <span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span>
                         <span class="main">{</span><span class="bound"><span class="bound">a</span></span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="bound">k</span> <span class="bound">ks</span><span class="main">.</span> <span class="bound">k</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> Le <span class="bound">i</span> <span class="main">(</span><span class="bound">k</span><span class="main">#</span><span class="bound">ks</span><span class="main">)</span><span class="main">}</span> <span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>image_def neq_Nil_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Us</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Le <span class="skolem">i</span> <span class="main">(</span><span class="skolem">k</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?Us</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="var">?lcm</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?lcm</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?Ds</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="var">?x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI ballI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"divisor <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="keyword1">dvd</span> <span class="var">?lcm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_zlcms<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">mod</span> <span class="var">?d</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="var">?d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?lcm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?d</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?d</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_diff_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?k</span> <span class="main">*</span> <span class="var">?lcm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_eq_mod_eq_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> dvd_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="var">?x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A I_cyclic<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>›</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> <span class="var">?Us</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="var">?x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Us</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Le <span class="skolem">l</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="skolem">l</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Min_le_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="var">?M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Us</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="var">?m</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span> <span class="main">&lt;</span> <span class="var">?lcm</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_mod_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zlcms_pos<span class="main"><span class="main">]</span></span> norm<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="var">?x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>minus_mod_eq_mult_div <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">as</span> <span class="main">=</span> <span class="var">?Ds</span> <span class="main">∪</span> <span class="var">?Us</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> as <span class="quoted"><span class="quoted">‹<span class="var">?Ls</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?QE</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">il</span></span> <span class="skolem"><span class="skolem">ksl</span></span> <span class="skolem"><span class="skolem">m</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="main">(</span>asubst <span class="main">(</span><span class="skolem">il</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">ksl</span> <span class="bound">a</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_pres<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">il</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ksl</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>IZ_asubst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?QE</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="var">?lcm</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="var">?Ds</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">mod</span> <span class="var">?lcm</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>iffI <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> I_cyclic
                <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_mod_cancel dvd_zlcms<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">mod</span> <span class="var">?lcm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x norm <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zlcms_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_pres<span class="hidden">⇩</span><sub>1</sub>_def IZ_asubst<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">|</span><span class="bound">ks</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Max <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span><span class="main">-</span><span class="main">⟨</span><span class="bound">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">`</span> set<span class="main">(</span>lbounds <span class="free">as</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>neq_Nil_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lm</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Max_in<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">li</span></span> <span class="skolem"><span class="skolem">lks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">li</span><span class="main">,</span><span class="skolem">lks</span><span class="main">)</span><span class="main">∈</span> set <span class="var">?lbs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lm</span> <span class="main">=</span> <span class="skolem">li</span><span class="main">-</span><span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?n</span> <span class="main">∧</span> <span class="var">?n</span> <span class="main">&lt;</span> <span class="var">?lcm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> norm <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zlcms_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">li</span> <span class="main">+</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ls</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Le <span class="skolem">i</span> <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ls</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_lbounds<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">≤</span> <span class="skolem">li</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lm<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹finite <span class="var">?L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Us</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">ks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Le <span class="skolem">i</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Le <span class="skolem">li</span> <span class="main">(</span><span class="main">1</span><span class="main">#</span><span class="skolem">lks</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">li</span><span class="main">,</span><span class="skolem">lks</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?lbs</span>›</span></span> hd
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_lbounds<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">li</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">-</span> <span class="var">?lm</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lm <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zmod_le_nonneg_dividend<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>›</span></span> lm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> I_cyclic<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ _ <span class="quoted"><span class="quoted">‹I<span class="hidden">⇩</span><sub>Z</sub> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_dvd <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd_coeff <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?Ds</span>›</span></span> hd
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>atom.splits list.splits<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">li</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">=</span> <span class="var">?lm</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> lm <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">li</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span> <span class="main">=</span>
                     <span class="main">(</span><span class="var">?lm</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
        <span class="main">(</span><span class="var">?lm</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="var">?lcm</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_add_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?lm</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_dvd <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span> set <span class="free">as</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_mod_cancel dvd_zlcms<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?lm</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="var">?lm</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> mod_add_eq<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">li</span> <span class="main">+</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">lks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">mod</span> divisor <span class="skolem">a</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> norm <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zlcms_pos<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">as</span>›</span></span> as <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lbs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_pres<span class="hidden">⇩</span><sub>1</sub>_def IZ_asubst split_def<span class="main">)</span>
           <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>int_nat_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEpres-divisors_hd_coeffs1"><span class="command">lemma</span></span>  divisors_hd_coeffs1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> div0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hd0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>set <span class="main">(</span>hd_coeffs1 <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"divisor <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Dvd <span class="var">?m</span> <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> hd_coeff1 <span class="var">?m</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∨</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hd0 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hd_coeff1 <span class="var">?m</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd_coeff <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"divisor <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> div0 hd0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Le <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Dvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">ks'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">#</span><span class="skolem">ks'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">as</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zlcms <span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b hd0 dvd_zlcms<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>NDvd <span class="skolem">d</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">ks'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ks</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">#</span><span class="skolem">ks'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">as</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zlcms <span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b hd0 dvd_zlcms<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="QEpres-hd_coeff_is1_hd_coeffs1"><span class="command">lemma</span></span> hd_coeff_is1_hd_coeffs1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> hd0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>set <span class="main">(</span>hd_coeffs1 <span class="free">as</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd_coeff_is1 <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Dvd <span class="var">?m</span> <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> hd_coeff1 <span class="var">?m</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∨</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hd0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">as</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hd_coeff1 <span class="var">?m</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd_coeff <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="QEpres-I_qe_pres"><span class="command">lemma</span></span> I_qe_pres<span class="hidden">⇩</span><sub>1</sub>_o<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
  Z.I <span class="main">(</span><span class="main">(</span>qe_pres<span class="hidden">⇩</span><sub>1</sub> <span class="main">∘</span> hd_coeffs1<span class="main">)</span> <span class="free">as</span><span class="main">)</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>Z</sub> <span class="bound">a</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> I_qe_pres<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divisors_hd_coeffs1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_coeff_is1_hd_coeffs1<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> I_hd_coeffs1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_pres</span> <span class="main">=</span> Z.lift_dnf_qe <span class="main">(</span>qe_pres<span class="hidden">⇩</span><sub>1</sub> <span class="main">∘</span> hd_coeffs1<span class="main">)</span>"</span></span>

<span class="keyword1" id="QEpres-qfree_qe_pres_o"><span class="command">lemma</span></span> qfree_qe_pres_o<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span><span class="main">(</span>qe_pres<span class="hidden">⇩</span><sub>1</sub> <span class="main">∘</span> hd_coeffs1<span class="main">)</span> <span class="free">as</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_pres<span class="hidden">⇩</span><sub>1</sub>_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>qfree_list_disj<span class="main">)</span>


<span class="keyword1" id="QEpres-normal_qe_pres"><span class="command">lemma</span></span> normal_qe_pres<span class="hidden">⇩</span><sub>1</sub>_o<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">as</span><span class="main">.</span> hd_coeff <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
   Z.normal <span class="main">(</span><span class="main">(</span>qe_pres<span class="hidden">⇩</span><sub>1</sub> <span class="main">∘</span> hd_coeffs1<span class="main">)</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> image_cong_simp <span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_pres<span class="hidden">⇩</span><sub>1</sub>_def Z.normal_def
   <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>atoms_list_disjE atoms_list_conjE<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_coeffs1_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zdiv_eq_0_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> elem_le_zlcms linorder_not_le zlcms_pos<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zdiv_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> elem_le_zlcms linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> linorder_not_le zlcms_pos<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_coeffs1_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zdiv_eq_0_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> elem_le_zlcms linorder_not_le zlcms_pos<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zdiv_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="free">as</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> elem_le_zlcms linorder_not_le<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> linorder_not_le zlcms_pos<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">theorem</span></span> I_pres_qe<span class="main">:</span> <span class="quoted"><span class="quoted">"Z.normal <span class="free">φ</span> <span class="main">⟹</span>  Z.I <span class="main">(</span>qe_pres <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> Z.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_pres_def Z.I_lift_dnf_qe_anormal I_qe_pres<span class="hidden">⇩</span><sub>1</sub>_o qfree_qe_pres_o normal_qe_pres<span class="hidden">⇩</span><sub>1</sub>_o <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>o_apply<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_pres_qe<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_pres <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_pres_def Z.qfree_lift_dnf_qe qfree_qe_pres_o <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>o_apply<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Cooper">
<div class="head">
<h1>Theory Cooper</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">theory</span></span> Cooper
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#PresArith">PresArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Cooper›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This section formalizes Cooper's algorithm~\cite{Cooper72}.›</span></span>

<span class="keyword1" id="Cooper-set_atoms0_iff"><span class="command">lemma</span></span> set_atoms0_iff<span class="main">:</span>
 <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> atoms <span class="free">φ</span> <span class="main">∧</span> hd_coeff <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">hd_coeffs1</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> zlcms<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">in</span> And <span class="main">(</span>Atom<span class="main">(</span>Dvd <span class="bound">m</span> <span class="main">0</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>hd_coeff1 <span class="bound">m</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cooper-I_hd_coeffs1"><span class="command">lemma</span></span> I_hd_coeffs1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="main">(</span>hd_coeffs1 <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zlcms_pos set_atoms0_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹qfree <span class="free">φ</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?l</span> <span class="keyword1">dvd</span> <span class="bound">x</span><span class="main">+</span><span class="main">0</span> <span class="main">∧</span> Z.I <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>hd_coeff1 <span class="var">?l</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="main">(</span><span class="keyword1">map<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">(</span>hd_coeff1 <span class="var">?l</span><span class="main">)</span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span><span class="main">*</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> unity_coeff_ex<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> meta_eq_to_obj_eq<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_hd_coeff1_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹qfree <span class="free">φ</span>›</span></span><span class="main"><span class="main">]</span></span> dvd_zlcms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">min_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom fm <span class="main">⇒</span> atom fm"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> and <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>Or <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> or <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="main">(</span>Atom<span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&lt;</span><span class="main">0</span> <span class="keyword1">then</span> TrueF <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="keyword1">then</span> FalseF <span class="keyword1">else</span> Atom<span class="main">(</span>Le <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ks</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">inf<span class="hidden">⇩</span><sub>-</sub></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">qe_cooper<span class="hidden">⇩</span><sub>1</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">as</span> <span class="main">=</span> Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">;</span> <span class="bound">d</span> <span class="main">=</span> zlcms<span class="main">(</span>map divisor <span class="bound">as</span><span class="main">)</span><span class="main">;</span> <span class="bound">ls</span> <span class="main">=</span> lbounds <span class="bound">as</span>
  <span class="keyword1">in</span> or <span class="main">(</span>Disj <span class="main">[</span><span class="main">0</span><span class="main">..</span><span class="bound">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> subst <span class="bound">n</span> <span class="main">[]</span> <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>Disj <span class="bound">ls</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">.</span>
           Disj <span class="main">[</span><span class="main">0</span><span class="main">..</span><span class="bound">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> subst <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="bound">ks</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Cooper-min_inf"><span class="command">lemma</span></span> min_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">f</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">f</span><span class="main">)</span><span class="main">.</span> hd_coeff_is1 <span class="bound">a</span>
   <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&lt;</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Z.I <span class="free">f</span> <span class="main">(</span><span class="bound">y</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="free">f</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> min_inf.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span> <span class="skolem">k</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom<span class="main">(</span>Le <span class="skolem">i</span> <span class="main">(</span><span class="skolem">k</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Atom<span class="main">(</span>Le <span class="skolem">i</span> <span class="main">(</span><span class="skolem">k</span><span class="main">#</span><span class="skolem">ks</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>And <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f1</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">f2</span> <span class="skolem">x2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>Or <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1" id="Cooper-min_inf_repeats"><span class="command">lemma</span></span> min_inf_repeats<span class="main">:</span>
  <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">d</span> <span class="main">⟹</span>
  Z.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">k</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> Z.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>min_inf.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span><span class="quoted">"4_4"</span> <span class="skolem">da</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ks</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">j</span> <span class="skolem">js</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="quoted">"4_4"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟷</span>
             <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟷</span>
              <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="free">d</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_diff zdvd_zdiffD dvd_mult mult.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ring_distribs<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span><span class="quoted">"4_5"</span> <span class="skolem">da</span> <span class="skolem">i</span> <span class="skolem">ks</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ks</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">j</span> <span class="skolem">js</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="quoted">"4_5"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟷</span>
             <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">*</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟷</span>
              <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">j</span><span class="main">*</span><span class="free">k</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="free">d</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_diff zdvd_zdiffD dvd_mult mult.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">da</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">js</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ring_distribs<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1" id="Cooper-atoms_subset"><span class="command">lemma</span></span> atoms_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">f</span> <span class="main">⟹</span> set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub><span class="main">(</span><span class="free">f</span><span class="main">::</span>atom fm<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> atoms <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(* copied from Amine *)</span>
<span class="keyword1" id="Cooper-β"><span class="command">lemma</span></span> β<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> nqfree <span class="free">φ</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> hd_coeff_is1 <span class="bound">a</span><span class="main">;</span>
     <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">d</span><span class="main">;</span> <span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span>
     <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="free">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>lbounds<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
         <span class="free">x</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">;</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">d</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Atom <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Le <span class="skolem">i</span> <span class="skolem">js</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">js</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Le Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Le Atom
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>lbounds_def Ball_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dvd <span class="skolem">m</span> <span class="skolem">i</span> <span class="skolem">js</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">js</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Dvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons Dvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons Dvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="free">d</span>›</span></span> dvd_diff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom Dvd Cons <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>NDvd <span class="skolem">m</span> <span class="skolem">i</span> <span class="skolem">js</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">js</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> NDvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">k</span> <span class="skolem">ks</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons NDvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons NDvd Atom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">d</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">⟨</span><span class="skolem">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="free">d</span>›</span></span> zdvd_zdiffD<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Atom NDvd Cons <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="Cooper-periodic_finite_ex"><span class="command">lemma</span></span> periodic_finite_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> modd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">k</span><span class="main">*</span><span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?LHS</span> <span class="main">=</span> <span class="var">?RHS</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?LHS</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span><span class="main">*</span><span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_div_mod_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> eq_diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> Pmod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> modd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dpos P Pmod <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">mod</span> <span class="free">d</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dpos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?RHS</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cooper-cpmi_eq"><span class="command">lemma</span></span> cpmi_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="free">D</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">P1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
<span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">D</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">D</span><span class="main">)</span> 
<span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">P1</span><span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="bound">k</span><span class="main">*</span><span class="free">D</span><span class="main">)</span>
<span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">D</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P1</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">D</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> minusinfinity<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">≤</span><span class="bound">k</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">k</span><span class="main">*</span><span class="free">D</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> decr_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">(</span><span class="improper">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">¦</span><span class="improper">x</span> <span class="main">-</span> <span class="improper">z</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">D</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">¦</span><span class="improper">x</span> <span class="main">-</span> <span class="improper">z</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  periodic_finite_ex<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>decr_mult_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">theorem</span></span> cp_thm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> hd_coeff_is1 <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">d</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> Z.I <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">∨</span>
   <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>lbounds<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">⟨</span><span class="bound">ks</span><span class="main">,</span><span class="free">xs</span><span class="main">⟩</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j</span><span class="main">∈</span> <span class="var">?D</span><span class="main">.</span> <span class="var">?M</span> <span class="bound">j</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">i</span> <span class="bound">ks</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> min_inf<span class="main">[</span><span class="operator">OF</span> nq u<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="bound">z</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?I</span> <span class="bound">i</span> <span class="bound">ks</span> <span class="main">|</span><span class="bound">i</span> <span class="bound">ks</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> BB'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">j</span><span class="main">∈</span><span class="var">?D</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ks</span><span class="main">)</span><span class="main">∈</span> <span class="var">?B</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">i</span> <span class="bound">ks</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="main">∈</span> <span class="var">?D</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="var">?B'</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="bound">b</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">j</span> <span class="main">∈</span> <span class="var">?D</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="var">?B'</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="main">(</span><span class="bound">b</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> β<span class="main">[</span><span class="operator">OF</span> nq u d dp<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bex_def<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> min_inf_repeats<span class="main">[</span><span class="operator">OF</span> nq d<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="bound">k</span><span class="main">.</span> <span class="var">?M</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">(</span><span class="bound">x</span><span class="main">-</span><span class="bound">k</span><span class="main">*</span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> cpmi_eq<span class="main">[</span><span class="operator">OF</span> dp th th2 th3<span class="main">]</span> BB' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* end of Amine *)</span>

<span class="keyword1" id="Cooper-qfree_min_inf"><span class="command">lemma</span></span> qfree_min_inf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>min_inf.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Cooper-I_qe_cooper"><span class="command">lemma</span></span> I_qe_cooper<span class="hidden">⇩</span><sub>1</sub><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>atoms <span class="free">φ</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> hd_coeff_is1 <span class="bound">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nqfree <span class="free">φ</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Z.I <span class="main">(</span>qe_cooper<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?as</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zlcms<span class="main">(</span>map divisor <span class="var">?as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> norm atoms_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">φ</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>zlcms_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> alld<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">.</span> divisor <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dvd_zlcms<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cp_thm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span> hd alld <span class="quoted"><span class="quoted">‹<span class="var">?d</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹nqfree <span class="free">φ</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_cooper<span class="hidden">⇩</span><sub>1</sub>_def I_subst<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> split_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cooper-divisor_hd_coeff1_neq0"><span class="command">lemma</span></span> divisor_hd_coeff1_neq0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> atoms <span class="free">φ</span> <span class="main">⟹</span> divisor <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
   divisor <span class="main">(</span>hd_coeff1 <span class="main">(</span>zlcms <span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">hypsubst_thin</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>set<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dvd_zlcms mult_eq_0_iff dvd_mult_div_cancel zlcms0_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_atoms0_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>image_def set_atoms0_iff Bex_def<span class="main">)</span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">hypsubst_thin</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> set<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>set<span class="main">(</span>map hd_coeff <span class="main">(</span>Z.atoms<span class="hidden">⇩</span><sub>0</sub> <span class="free">φ</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dvd_zlcms mult_eq_0_iff dvd_mult_div_cancel zlcms0_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_atoms0_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>image_def set_atoms0_iff Bex_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cooper-hd_coeff_is1_hd_coeff1"><span class="command">lemma</span></span> hd_coeff_is1_hd_coeff1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hd_coeff <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> hd_coeff_is1 <span class="main">(</span>hd_coeff1 <span class="free">m</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hd_coeff1.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zsgn_def<span class="main">)</span>

<span class="keyword1" id="Cooper-I_cooper1_hd_coeffs1"><span class="command">lemma</span></span> I_cooper1_hd_coeffs1<span class="main">:</span> <span class="quoted"><span class="quoted">"Z.normal <span class="free">φ</span> <span class="main">⟹</span> nqfree <span class="free">φ</span>
       <span class="main">⟹</span> Z.I <span class="main">(</span>qe_cooper<span class="hidden">⇩</span><sub>1</sub><span class="main">(</span>hd_coeffs1 <span class="free">φ</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> Z.I <span class="free">φ</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Z.normal_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> I_qe_cooper<span class="hidden">⇩</span><sub>1</sub><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def image_def set_atoms0_iff divisor_hd_coeff1_neq0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def qfree_map_fm set_atoms0_iff
                     hd_coeff_is1_hd_coeff1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hd_coeffs1_def nqfree_map_fm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_hd_coeffs1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">qe_cooper</span> <span class="main">=</span> Z.lift_nnf_qe <span class="main">(</span>qe_cooper<span class="hidden">⇩</span><sub>1</sub> <span class="main">∘</span> hd_coeffs1<span class="main">)</span>"</span></span>

<span class="keyword1" id="Cooper-qfree_cooper1_hd_coeffs1"><span class="command">lemma</span></span> qfree_cooper1_hd_coeffs1<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> qfree <span class="main">(</span>qe_cooper<span class="hidden">⇩</span><sub>1</sub> <span class="main">(</span>hd_coeffs1 <span class="free">φ</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>qe_cooper<span class="hidden">⇩</span><sub>1</sub>_def hd_coeffs1_def qfree_map_fm
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> qfree_or qfree_and qfree_list_disj qfree_min_inf<span class="main">)</span>


<span class="keyword1" id="Cooper-normal_min_inf"><span class="command">lemma</span></span> normal_min_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"Z.normal <span class="free">φ</span> <span class="main">⟹</span> Z.normal<span class="main">(</span><span class="keyword1">inf<span class="hidden">⇩</span><sub>-</sub></span> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">φ</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>min_inf.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Cooper-normal_cooper1"><span class="command">lemma</span></span> normal_cooper1<span class="main">:</span> <span class="quoted"><span class="quoted">"Z.normal <span class="free">φ</span> <span class="main">⟹</span> Z.normal<span class="main">(</span>qe_cooper<span class="hidden">⇩</span><sub>1</sub> <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_cooper<span class="hidden">⇩</span><sub>1</sub>_def Logic.or_def Z.normal_map_fm normal_min_inf split_def<span class="main">)</span>

<span class="keyword1" id="Cooper-normal_hd_coeffs1"><span class="command">lemma</span></span> normal_hd_coeffs1<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">φ</span> <span class="main">⟹</span> Z.normal <span class="free">φ</span> <span class="main">⟹</span> Z.normal<span class="main">(</span>hd_coeffs1 <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_coeffs1_def image_def set_atoms0_iff
              divisor_hd_coeff1_neq0 Z.normal_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> I_cooper<span class="main">:</span> <span class="quoted"><span class="quoted">"Z.normal <span class="free">φ</span> <span class="main">⟹</span>  Z.I <span class="main">(</span>qe_cooper <span class="free">φ</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> Z.I <span class="free">φ</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_cooper_def Z.I_lift_nnf_qe_normal qfree_cooper1_hd_coeffs1 I_cooper1_hd_coeffs1 normal_cooper1 normal_hd_coeffs1<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> qfree_cooper<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="main">(</span>qe_cooper <span class="free">φ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>qe_cooper_def Z.qfree_lift_nnf_qe qfree_cooper1_hd_coeffs1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CertDlo">
<div class="head">
<h1>Theory CertDlo</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007

A simple certificate based checker for q-free dlo formulae.
Certificate is cycle.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> CertDlo
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#QEdlo">QEdlo</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cyclerec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> atom list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> <span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span>
                               <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free">cyclerec</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cycle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom list <span class="main">⇒</span> nat list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cycle</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">is</span></span></span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="keyword1">case</span> map <span class="main">(</span>nth <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">is</span></span></span> <span class="keyword1">of</span> Less <span class="bound">i</span> <span class="bound">j</span> <span class="main">#</span> <span class="bound">fs'</span> <span class="main">⇒</span> cyclerec <span class="bound">i</span> <span class="bound">j</span> <span class="bound">fs'</span> <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">cyclic_dnf</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">iss</span><span class="main">.</span> list_all2 cycle <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="bound">iss</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CertDlo-refute_I"><span class="command">lemma</span></span> refute_I<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> Logic.interpret <span class="free">h</span> <span class="main">(</span>Neg <span class="free">f</span><span class="main">)</span> <span class="free">e</span> <span class="main">⟹</span> Logic.interpret <span class="free">h</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="CertDlo-cyclerecD"><span class="command">lemma</span></span> cyclerecD<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dlo list"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> cyclerec <span class="free">i</span> <span class="free">j</span> <span class="free">as</span><span class="main">;</span> <span class="free">xs</span><span class="main">!</span><span class="free">i</span> <span class="main">&lt;</span> <span class="free">xs</span><span class="main">!</span><span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="main">¬</span> I<span class="hidden">⇩</span><sub>d</sub><span class="hidden">⇩</span><sub>l</sub><span class="hidden">⇩</span><sub>o</sub> <span class="bound">a</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CertDlo-cycleD"><span class="command">lemma</span></span> cycleD<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> dlo list"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
 <span class="quoted"><span class="quoted">"cycle <span class="free">as</span> <span class="free">is</span> <span class="main">⟹</span> <span class="main">¬</span> DLO.I <span class="main">(</span>list_conj <span class="main">(</span>map Atom <span class="free">as</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cycle_def map_eq_Cons_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>list.splits atom.splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cyclerecD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">as</span><span class="main">!</span><span class="improper">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CertDlo-cyclic_dnfD"><span class="command">lemma</span></span> cyclic_dnfD<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">f</span> <span class="main">⟹</span> cyclic_dnf <span class="main">(</span>dnf<span class="main">(</span>DLO.nnf <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span>DLO.I <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DLO.I_nnf<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nnf_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DLO.I_dnf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> DLO.nqfree_nnf<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> nnf_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>cyclic_dnf_def list_all2_iff in_set_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>dnf<span class="main">(</span>DLO.nnf <span class="free">f</span><span class="main">)</span> <span class="main">!</span> <span class="improper">i</span><span class="main">,</span> <span class="improper">iss</span><span class="main">!</span><span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_zip<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cycleD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CertLin">
<div class="head">
<h1>Theory CertLin</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007

A simple certificate checker for q-free linear arithmetic:
is linear combination of atoms and certificate contradictory?
*)</span>

<span class="keyword1"><span class="command">theory</span></span> CertLin
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#LinArith">LinArith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> list_add_assoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">instantiation</span></span> atom <span class="main">::</span> <span class="quoted">monoid_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_atom</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">cs<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> Eq <span class="main">0</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_atom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">c</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">c</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">c</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">c</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="CertLin-I_R_additive"><span class="command">lemma</span></span> I_R_additive<span class="main">:</span> <span class="quoted"><span class="quoted">"I<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="free">xs</span> <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="free">b</span> <span class="free">xs</span> <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>R</sub><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>iprod_left_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>iprod_left_add_distrib<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_atom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> atom <span class="main">⇒</span> atom"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1"><span class="free">*<span class="hidden">⇩</span><sub>a</sub></span></span> Eq <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> Eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1"><span class="free">*<span class="hidden">⇩</span><sub>a</sub></span></span> Less <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> Eq <span class="main">0</span> <span class="main">[]</span> <span class="keyword1">else</span> Less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iprod_a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> atom list <span class="main">⇒</span> atom"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span>"</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="keyword1"><span class="free">⊙<span class="hidden">⇩</span><sub>a</sub></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">←</span> zip <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CertLin-iprod_a_Nil2"><span class="command">lemma</span></span> iprod_a_Nil2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>iprod_a_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">#</span><span class="free">cs</span><span class="main">)</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">as</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> <span class="free">cs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">as</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>iprod_a_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">contradict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"atom list <span class="main">⇒</span> real list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">contradict</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⟷</span> size <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> size <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">.</span> <span class="bound">c</span><span class="main">≥</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="keyword1">of</span> Eq <span class="bound">r</span> <span class="bound">cs</span> <span class="main">⇒</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>set <span class="bound">cs</span><span class="main">.</span> <span class="bound">c</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>
                  <span class="main">|</span> Less <span class="bound">r</span> <span class="bound">cs</span> <span class="main">⇒</span> <span class="bound">r</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>set <span class="bound">cs</span><span class="main">.</span> <span class="bound">c</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted"><span class="quoted">"<span class="free">contradict_dnf</span> <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">css</span><span class="main">.</span> list_all2 contradict <span class="free"><span class="bound"><span class="entity">ass</span></span></span> <span class="bound">css</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="CertLin-refute_I"><span class="command">lemma</span></span> refute_I<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> Logic.interpret <span class="free">h</span> <span class="main">(</span>Neg <span class="free">f</span><span class="main">)</span> <span class="free">e</span> <span class="main">⟹</span> Logic.interpret <span class="free">h</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="CertLin-I_R_mult_atom"><span class="command">lemma</span></span> I_R_mult_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="free">a</span> <span class="free">xs</span> <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CertLin-I_R_iprod_a"><span class="command">lemma</span></span> I_R_iprod_a<span class="main">:</span>
 <span class="quoted"><span class="quoted">"size <span class="free">cs</span> <span class="main">=</span> size <span class="free">as</span> <span class="main">⟹</span> <span class="main">∀</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> set<span class="main">(</span>zip <span class="free">cs</span> <span class="free">as</span><span class="main">)</span><span class="main">.</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> <span class="bound">a</span><span class="main">)</span> <span class="free">xs</span>
 <span class="main">⟹</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span><span class="free">cs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cs</span></span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>list_induct2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>zero_atom_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>I_R_additive<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CertLin-contradictD"><span class="command">lemma</span></span> contradictD<span class="main">:</span>
 <span class="quoted"><span class="quoted">"contradict <span class="free">as</span> <span class="free">cs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>set <span class="free">as</span><span class="main">.</span> <span class="main">¬</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="bound">a</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"contradict <span class="free">as</span> <span class="free">cs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> I<span class="hidden">⇩</span><sub>R</sub> <span class="main">(</span><span class="free">cs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">as</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cs</span> <span class="keyword1">⊙<span class="hidden">⇩</span><sub>a</sub></span> <span class="free">as</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Less <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹contradict <span class="free">as</span> <span class="free">cs</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>contradict_def iprod0_if_coeffs0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Eq <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹contradict <span class="free">as</span> <span class="free">cs</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>contradict_def iprod0_if_coeffs0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹contradict <span class="free">as</span> <span class="free">cs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>contradict_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> I_R_iprod_a I_R_mult_atom
             <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>in_set_zipE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CertLin-cyclic_dnfD"><span class="command">lemma</span></span> cyclic_dnfD<span class="main">:</span> <span class="quoted"><span class="quoted">"qfree <span class="free">f</span> <span class="main">⟹</span> contradict_dnf <span class="main">(</span>dnf<span class="main">(</span>R.nnf <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span>R.I <span class="free">f</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> R.I_nnf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> R.I_dnf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> R.nqfree_nnf<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>contradict_dnf_def list_all2_iff in_set_conv_nth<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>dnf<span class="main">(</span>R.nnf <span class="free">f</span><span class="main">)</span> <span class="main">!</span> <span class="improper">i</span><span class="main">,</span> <span class="improper">css</span><span class="main">!</span><span class="improper">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>set_zip<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">xs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contradictD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>