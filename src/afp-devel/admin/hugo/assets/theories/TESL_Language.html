<div id="Introduction">
<div class="head">
<h1>Theory Introduction</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹A Gentle Introduction to TESL›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Introduction
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Context›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The design of complex systems involves different formalisms for modeling their different parts or 
aspects. The global model of a system may therefore consist of a coordination of concurrent 
sub-models that use different paradigms such as differential equations, state machines, 
synchronous data-flow networks, 
discrete event models and so on, as illustrated in \autoref{fig:het-timed-system}. 
This raises the interest in architectural composition languages 
that allow for ``bolting the respective sub-models together'', along their various interfaces, and 
specifying the various ways of collaboration and coordination~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "nguyenvan:hal-01583815"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

We are interested in languages that allow for specifying the timed coordination of subsystems by 
addressing the following conceptual issues:
<span class="antiquoted"><span class="antiquoted">▪</span></span> events may occur in different sub-systems at unrelated times, leading to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹polychronous›</span></span> systems, 
  which do not necessarily have a common base clock,
<span class="antiquoted"><span class="antiquoted">▪</span></span> the behavior of the sub-systems is observed only at a series of discrete instants, and time 
  coordination has to take this <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹discretization›</span></span> into account,
<span class="antiquoted"><span class="antiquoted">▪</span></span> the instants at which a system is observed may be arbitrary and should not change its behavior 
  (<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹stuttering invariance›</span></span>),
<span class="antiquoted"><span class="antiquoted">▪</span></span> coordination between subsystems involves causality, so the occurrence of an event may enforce 
  the occurrence of other events, possibly after a certain duration has elapsed or an event has 
  occurred a given number of times,
<span class="antiquoted"><span class="antiquoted">▪</span></span> the domain of time (discrete, rational, continuous. . . ) may be different in the subsystems, 
  leading to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹polytimed›</span></span> systems,
<span class="antiquoted"><span class="antiquoted">▪</span></span> the time frames of different sub-systems may be related (for instance, time in a GPS satellite 
  and in a GPS receiver on Earth are related although they are not the same).
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
\begin{figure}[htbp]
 \centering
 \includegraphics{glue.pdf}
 \caption{A Heterogeneous Timed System Model}
 \label{fig:het-timed-system}
\end{figure}›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="comment1">― ‹Constants and notation to be able to write what we want as Isabelle terms, not as LaTeX maths›</span>
<span class="keyword1"><span class="command">consts</span></span> dummyInfty    <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyTESLSTAR <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span>›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyFUN      <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'c</span> set›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyCLOCK    <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyBOOL     <span class="main">::</span> <span class="quoted"><span class="quoted">‹bool set›</span></span> 
<span class="keyword1"><span class="command">consts</span></span> dummyTIMES    <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> set›</span></span> 
<span class="keyword1"><span class="command">consts</span></span> dummyLEQ      <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool›</span></span>

<span class="keyword1"><span class="command">notation</span></span> dummyInfty    <span class="main">(</span><span class="quoted">‹<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>∞</sup></span><span class="keyword3">)</span>›</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyTESLSTAR <span class="main">(</span><span class="quoted">‹<span class="keyword1">TESL<span class="hidden">⇧</span><sup>*</sup></span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyFUN      <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">→</span>›</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyCLOCK    <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝒦</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">notation</span></span> dummyBOOL     <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝔹</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">notation</span></span> dummyTIMES    <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝒯</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">notation</span></span> dummyLEQ      <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">≤<span class="hidden">⇩</span><sub>𝒯</sub></span>›</span> 100<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
In order to tackle the heterogeneous nature of the subsystems, we abstract their behavior as clocks. 
Each clock models an event, i.e., something that can occur or not at a given time. This time is measured 
in a time frame associated with each clock, and the nature of time (integer, rational, real, or any 
type with a linear order) is specific to each clock. 
When the event associated with a clock occurs, the clock ticks. In order to support any kind of 
behavior for the subsystems, we are only interested in specifying what we can observe at a series 
of discrete instants. There are two constraints on observations: a clock may tick only at an 
observation instant, and the time on any clock cannot decrease from an instant to the next one. 
However, it is always possible to add arbitrary observation instants, which allows for stuttering 
and modular composition of systems. 
As a consequence, the key concept of our setting is the notion of a clock-indexed Kripke model: 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">ℕ</span></span> <span class="main"><span class="main">→</span></span> <span class="keyword1"><span class="keyword1">𝒦</span></span> <span class="main"><span class="main">→</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">𝔹</span></span> <span class="main"><span class="main">×</span></span> <span class="keyword1"><span class="keyword1">𝒯</span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">𝒦</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an enumerable set of clocks, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">𝔹</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
is the set of booleans – used to  indicate that a clock ticks at a given instant – and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">𝒯</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
is a universal metric time space for which we only assume that it is large enough to contain all 
individual time spaces of clocks and that it is ordered by some linear ordering <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">(≤<span class="hidden">⇩</span><sub>𝒯</sub>)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The elements of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are called runs. A specification language is a set of 
  operators that constrains the set of possible monotonic runs. Specifications are composed by 
  intersecting the denoted run sets of constraint operators.
  Consequently, such specification languages do not limit the number of clocks used to model a 
  system (as long as it is finite) and it is always possible to add clocks to a specification. 
  Moreover, they are <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹compositional›</span></span> by construction since the composition of specifications 
  consists of the conjunction of their constraints.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This work provides the following contributions:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> defining the non-trivial language <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">TESL<span class="hidden">⇧</span><sup>*</sup></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in terms of clock-indexed Kripke models, 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> proving that this denotational semantics is stuttering invariant,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> defining an adapted form of symbolic primitives and presenting the set of operational 
    semantic rules,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> presenting formal proofs for soundness, completeness, and progress of the latter.
›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The TESL Language›</span></span>
   
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The TESL language <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "BouJacHarPro2014MEMOCODE"<span class="antiquote"><span class="antiquote">}</span></span></span></span> was initially designed to coordinate the
  execution of heterogeneous components during the simulation of a system. We define here a minimal
  kernel of operators that will form the basis of a family of specification languages, including the
  original TESL language, which is described at \url{http://wdi.supelec.fr/software/TESL/}.
›</span></span>  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Instantaneous Causal Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  TESL has operators to deal with instantaneous causality, i.e., to react to an event occurrence
  in the very same observation instant.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 implies c2›</span></span></span></span> means that at any instant where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> ticks, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> has to tick too.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 implies not c2›</span></span></span></span> means that at any instant where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> ticks, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> cannot tick.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 kills c2›</span></span></span></span> means that at any instant where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> ticks, and at any future instant, 
    <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> cannot tick.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Temporal Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  TESL also has chronometric temporal operators that deal with dates and chronometric delays.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c sporadic t›</span></span></span></span> means that clock <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c›</span></span></span></span> must have a tick at time <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹t›</span></span></span></span> on its own time scale.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 sporadic t on c2›</span></span></span></span> means that clock <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> must have a tick at an instant where the time 
    on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹t›</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 time delayed by d on m implies c2›</span></span></span></span> means that every time clock <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> ticks, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> must have 
    a tick at the first instant where the time on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹m›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹d›</span></span></span></span> later than it was when <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> had ticked.
    This means that every tick on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> is followed by a tick on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> after a delay <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹d›</span></span></span></span> measured
    on the time scale of clock <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹m›</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹time relation (c1, c2) in R›</span></span></span></span> means that at every instant, the current time on clocks <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span>
    and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> must be in relation <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹R›</span></span></span></span>. By default, the time lines of different clocks are 
    independent. This operator allows us to link two time lines, for instance to model the fact
    that time in a GPS satellite and time in a GPS receiver on Earth are not the same but are 
    related. Time being polymorphic in TESL, this can also be used to model the fact that the
    angular position on the camshaft of an engine moves twice as fast as the angular position 
    on the crankshaft~<span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">⁋</span></span>‹See \url{http://wdi.supelec.fr/software/TESL/GalleryEngine} for more details›</span></span>. 
    We may consider only linear arithmetic relations to restrict the problem to a domain where 
    the resolution is decidable.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Asynchronous Operators›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The last category of TESL operators allows the specification of asynchronous relations between
  event occurrences. They do not specify the precise instants at which ticks have to occur, 
  they only put bounds on the set of instants at which they should occur.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 weakly precedes c2›</span></span></span></span> means that for each tick on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span>, there must be at least one tick
    on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> at a previous or at the same instant. This can also be expressed by stating
    that at each instant, the number of ticks since the beginning of the run must be lower or 
    equal on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> than on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1 strictly precedes c2›</span></span></span></span> means that for each tick on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span>, there must be at least one tick
    on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> at a previous instant. This can also be expressed by saying that at each instant, 
    the number of ticks on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c2›</span></span></span></span> from the beginning of the run to this instant, must be lower or 
    equal to the number of ticks on <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹c1›</span></span></span></span> from the beginning of the run to the previous instant.
›</span></span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyInfty      <span class="main">(</span><span class="quoted">‹<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>∞</sup></span><span class="keyword3">)</span>›</span> <span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyTESLSTAR   <span class="main">(</span><span class="quoted">‹<span class="keyword1">TESL<span class="hidden">⇧</span><sup>*</sup></span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyFUN        <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">→</span>›</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyCLOCK      <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝒦</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">no_notation</span></span> dummyBOOL       <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝔹</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">no_notation</span></span> dummyTIMES      <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝒯</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">no_notation</span></span> dummyLEQ        <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">≤<span class="hidden">⇩</span><sub>𝒯</sub></span>›</span> 100<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="TESL">
<div class="head">
<h1>Theory TESL</h1>
</div>
<pre class="source"><span class="comment1">(*chapter‹The Core of the TESL Language: Syntax and Basics›*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\chapter[Core TESL: Syntax and Basics]{The Core of the TESL Language: Syntax and Basics}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> TESL
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Syntactic Representation›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We define here the syntax of TESL specifications.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic elements of a specification›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The following items appear in specifications:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Clocks, which are identified by a name.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Tag constants are just constants of a type which denotes the metric time space.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span>     clock         <span class="main">=</span> Clk <span class="quoted"><span class="quoted">‹string›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> instant_index <span class="main">=</span> <span class="quoted"><span class="quoted">‹nat›</span></span>

<span class="keyword1"><span class="command">datatype</span></span>     <span class="tfree">'τ</span> tag_const <span class="main">=</span>  TConst   <span class="main">(</span><span class="free"><span class="entity">the_tag_const</span></span> <span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'τ</span></span></span><span class="main">)</span>         <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Operators for the TESL language›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The type of atomic TESL constraints, which can be combined to form specifications.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'τ</span> TESL_atomic <span class="main">=</span>
    SporadicOn       <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span>  <span class="quoted"><span class="quoted">‹clock›</span></span>  <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">sporadic</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">on</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span> 55<span class="main">)</span>
  <span class="main">|</span> TagRelation      <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span> tag_const <span class="main">×</span> <span class="tfree">'τ</span> tag_const<span class="main">)</span> <span class="main">⇒</span> bool›</span></span> 
                                                      <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">time-relation</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌊</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌋</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∈</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span> 55<span class="main">)</span>
  <span class="main">|</span> Implies          <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span>                  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">implies</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span> 55<span class="main">)</span>
  <span class="main">|</span> ImpliesNot       <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span>                  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">implies</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">not</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span> 55<span class="main">)</span>
  <span class="main">|</span> TimeDelayedBy    <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span> 
                                                      <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">time-delayed</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">by</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">on</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">implies</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span> 55<span class="main">)</span>
  <span class="main">|</span> WeaklyPrecedes   <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span>                  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">weakly</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">precedes</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span> 55<span class="main">)</span>
  <span class="main">|</span> StrictlyPrecedes <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span>                  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">strictly</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">precedes</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span> 55<span class="main">)</span>
  <span class="main">|</span> Kills            <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span>                  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">kills</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A TESL formula is just a list of atomic constraints, with implicit conjunction
  for the semantics.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'τ</span> TESL_formula <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> TESL_atomic list›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We call <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹positive atoms›</span></span> the atomic constraints that create ticks from nothing.
  Only sporadic constraints are positive in the current version of TESL.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">positive_atom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> TESL_atomic <span class="main">⇒</span> bool›</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">positive_atom</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="keyword1">sporadic</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="keyword1">on</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> True›</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="free">positive_atom</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span>                   <span class="main">=</span> False›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">NoSporadic</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function removes sporadic constraints from a TESL formula.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">NoSporadic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> TESL_formula <span class="main">⇒</span> <span class="tfree">'τ</span> TESL_formula›</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">‹<span class="free">NoSporadic</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span>List.filter <span class="main">(</span><span class="main">λ</span><span class="bound">f<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">f<span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="keyword1">of</span>
      <span class="main"><span class="bound">_</span></span> <span class="keyword1">sporadic</span> <span class="main"><span class="bound">_</span></span> <span class="keyword1">on</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False
    <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> True<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Field Structure of the Metric Time Space›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In order to handle tag relations and delays, tags must belong to a field.
  We show here that this is the case when the type parameter of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree"><span class="tfree">'τ</span></span> tag_const›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  is itself a field.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> tag_const <span class="main">::</span><span class="main">(</span><span class="quoted">field</span><span class="main">)</span><span class="quoted">field</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inverse_tag_const</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹inverse <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">divide_tag_const</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹divide <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>divide <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_tag_const</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹uminus <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>uminus <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">minus_tag_const</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹minus <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>minus <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="class_parameter">one_tag_const</span></span> <span class="main">≡</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">1</span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_tag_const</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹times <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>times <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="class_parameter">zero_tag_const</span></span> <span class="main">≡</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">0</span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_tag_const</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹plus <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span>plus <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">t<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Multiplication is associative.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
                               <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">w</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.times_tag_const.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Multiplication is commutative.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹ <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.times_tag_const.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹One is neutral for multiplication.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.times_tag_const.simps one_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Addition is associative.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
                               <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">w</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.plus_tag_const.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Addition is commutative.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.plus_tag_const.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Zero is neutral for addition.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.plus_tag_const.simps zero_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The sum of an element and its opposite is zero.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.plus_tag_const.simps
                  TESL.uminus_tag_const.simps
                  zero_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Subtraction is adding the opposite.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">-</span><span class="skolem">b</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.minus_tag_const.simps
                  TESL.plus_tag_const.simps
                  TESL.uminus_tag_const.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Distributive property of multiplication over addition.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
                               <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">w</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.plus_tag_const.simps
                  TESL.times_tag_const.simps
                  ring_class.ring_distribs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The neutral elements are distinct.›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>field tag_const<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_tag_const_def zero_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The product of an element and its inverse is 1.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_tag_const_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹inverse <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.inverse_tag_const.simps
                  TESL.times_tag_const.simps
                  one_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Dividing is multiplying by the inverse.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>field tag_const›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tag_const.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> inverse <span class="skolem">b</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.divide_tag_const.simps
                  TESL.inverse_tag_const.simps
                  TESL.times_tag_const.simps
                  divide_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Zero is its own inverse.›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹inverse <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>field tag_const<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL.inverse_tag_const.simps zero_tag_const_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  For comparing dates (which are represented by tags) on clocks, we need an order on tags.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> tag_const <span class="main">::</span> <span class="main">(</span><span class="quoted">order</span><span class="main">)</span><span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">inductive</span></span> <span class="entity"><span class="class_parameter">less_eq_tag_const</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> tag_const <span class="main">⇒</span> <span class="tfree">'a</span> tag_const <span class="main">⇒</span> bool›</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    Int_less_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>      <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟹</span> <span class="main">(</span>TConst <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>TConst <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> less_tag<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="tfree">'a</span> tag_const<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>›</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span> <span class="tfree">'a</span> tag_const<span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_tag_const.simps less_tag <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> tag_const›</span></span>
    <span class="keyword1"><span class="command">from</span></span> tag_const.exhaust <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> TConst <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Int_less_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span>  <span class="main">::</span> <span class="tfree">'a</span> tag_const<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_tag_const.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span>  <span class="main">::</span> <span class="tfree">'a</span> tag_const<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_eq_tag_const.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  For ensuring that time does never flow backwards, we need a total order on tags.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> tag_const <span class="main">::</span> <span class="main">(</span><span class="quoted">linorder</span><span class="main">)</span><span class="quoted">linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> tag_const›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> tag_const›</span></span>
    <span class="keyword1"><span class="command">from</span></span> tag_const.exhaust <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> TConst <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> tag_const.exhaust <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> TConst <span class="skolem">y<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> less_eq_tag_const.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Run">
<div class="head">
<h1>Theory Run</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Defining Runs ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Run
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TESL.html">TESL</a>
      
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Runs are sequences of instants, and each instant maps a clock to a pair 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">h</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">t</span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">h</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> indicates whether the clock ticks or not, 
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">t</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the current time on this clock.
  The first element of the pair is called the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹hamlet›</span></span> of the clock (to tick or 
  not to tick), the second element is called the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹time›</span></span>.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hamlet</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">hamlet</span> <span class="main">≡</span> fst›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">time</span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">time</span> <span class="main">≡</span> snd›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'τ</span> instant <span class="main">=</span> <span class="quoted"><span class="quoted">‹clock <span class="main">⇒</span> <span class="main">(</span>bool <span class="main">×</span> <span class="tfree">'τ</span> tag_const<span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Runs have the additional constraint that time cannot go backwards on any clock
  in the sequence of instants.
  Therefore, for any clock, the time projection of a run is monotonous.
›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'τ</span><span class="main">::</span><span class="quoted">linordered_field</span> run <span class="main">=</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span> <span class="bound">ρ</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'τ</span> instant<span class="main">.</span> <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> time <span class="main">(</span><span class="bound">ρ</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>True<span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> time <span class="main">(</span><span class="bound">ρ</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Run-Abs_run_inverse_rewrite"><span class="command">lemma</span></span> Abs_run_inverse_rewrite<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> time <span class="main">(</span><span class="free">ρ</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Rep_run <span class="main">(</span>Abs_run <span class="free">ρ</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_run_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹dense›</span></span> run is a run in which something happens (at least one clock ticks) 
  at every instant.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">‹<span class="free">dense_run</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">run_tick_count</span></span> <span class="free"><span class="free">ρ</span></span> <span class="free"><span class="free">K</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> counts the number of ticks on clock <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">K</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  in the interval <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹[0, n]›</span></span></span></span> of run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ρ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">run_tick_count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> clock <span class="main">⇒</span> nat <span class="main">⇒</span> nat›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">#<span class="hidden">⇩</span><sub>≤</sub></span> _ _ _›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>≤</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">0</span><span class="main">)</span>       <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span>
                       <span class="keyword1">then</span> <span class="main">1</span>
                       <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>≤</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span>
                       <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>≤</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
                       <span class="keyword1">else</span> <span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>≤</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">run_tick_count_strictly</span></span> <span class="free"><span class="free">ρ</span></span> <span class="free"><span class="free">K</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> counts the number of ticks on
  clock <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">K</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the interval <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹[0, n[›</span></span></span></span> of run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ρ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">run_tick_count_strictly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> clock <span class="main">⇒</span> nat <span class="main">⇒</span> nat›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">#<span class="hidden">⇩</span><sub>&lt;</sub></span> _ _ _›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>&lt;</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">0</span><span class="main">)</span>       <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main"><span class="free">#<span class="hidden">⇩</span><sub>&lt;</sub></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">#<span class="hidden">⇩</span><sub>≤</sub></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">first_time</span></span> <span class="free"><span class="free">ρ</span></span> <span class="free"><span class="free">K</span></span> <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">τ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> tells whether instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">ρ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is the first one where the time on clock <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">K</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reaches <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">τ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first_time</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>linordered_field run <span class="main">⇒</span> clock <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> tag_const
                          <span class="main">⇒</span> bool›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">first_time</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≡</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">∄</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">ρ</span></span></span><span class="main">)</span> <span class="bound">n'</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The time on a clock is necessarily less than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">τ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> before the first instant
  at which it reaches <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">τ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Run-before_first_time"><span class="command">lemma</span></span> before_first_time<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">ρ</span> <span class="free">K</span> <span class="free">n</span> <span class="free">τ</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">m</span> <span class="free">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">τ</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">ρ</span> <span class="bound">n</span> <span class="free">K</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Rep_run <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">ρ</span> <span class="bound">n</span> <span class="free">K</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Rep_run <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">m</span> <span class="free">K</span><span class="main">)</span> <span class="main">≤</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">K</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">K</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> first_time_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">m</span> <span class="free">K</span><span class="main">)</span> <span class="main">≠</span> <span class="free">τ</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> first_time_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This leads to an alternate definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹first_time›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Run-alt_first_time_def"><span class="command">lemma</span></span> alt_first_time_def<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">τ</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">K</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">ρ</span> <span class="free">K</span> <span class="free">n</span> <span class="free">τ</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K</span><span class="main">)</span> <span class="main">≠</span> <span class="free">τ</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Denotational">
<div class="head">
<h1>Theory Denotational</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Denotational Semantics›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Denotational
<span class="keyword2"><span class="keyword">imports</span></span>
    <a href="TESL.html">TESL</a>
    <a href="Run.html">Run</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The denotational semantics maps TESL formulae to sets of satisfying runs.
  Firstly, we define the semantics of atomic formulae (basic constructs of the 
  TESL language), then we define the semantics of compound formulae as the
  intersection of the semantics of their components: a run must satisfy all
  the individual formulae of a compound formula.
›</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Denotational interpretation for atomic TESL formulae›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">consts</span></span> dummyT0 <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyDeltaT <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span>

<span class="keyword1"><span class="command">notation</span></span> dummyT0     <span class="main">(</span><span class="quoted">‹<span class="keyword1">t<span class="hidden">⇩</span><sub>0</sub></span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyDeltaT <span class="main">(</span><span class="quoted">‹<span class="keyword1">δt</span>›</span><span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TESL_interpretation_atomic</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> TESL_atomic <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦</span> _ <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> means that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> should tick at an 
      instant where the time on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">τ</span>›</span><span class="antiquote">}</span></span>.›</span>
    <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">sporadic</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">∧</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span>›</span><span class="antiquote">}</span></span> means that at each instant, the time 
      on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> and the time on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> are in relation~<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">R</span>›</span><span class="antiquote">}</span></span>.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span> <span class="keyword1">implies</span> <span class="free">slave</span>›</span><span class="antiquote">}</span></span> means that at each instant at which 
      <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span>›</span><span class="antiquote">}</span></span> ticks, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">slave</span>›</span><span class="antiquote">}</span></span> also ticks.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">slave</span>›</span><span class="antiquote">}</span></span> means that at each instant at which 
      <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span>›</span><span class="antiquote">}</span></span> ticks, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">slave</span>›</span><span class="antiquote">}</span></span> does not tick.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span>›</span><span class="antiquote">}</span></span> means that 
      at each instant at which  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">master</span>›</span><span class="antiquote">}</span></span> ticks, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">slave</span>›</span><span class="antiquote">}</span></span> will
      tick after a delay <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">δτ</span>›</span><span class="antiquote">}</span></span> measured on the time scale 
      of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">measuring</span>›</span><span class="antiquote">}</span></span>.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
    <span class="comment1">― ‹
      When master ticks, let's call <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="keyword1">t<span class="hidden">⇩</span><sub>0</sub></span>›</span><span class="antiquote">}</span></span> the current date on measuring. Then, 
      at the first instant when the date on measuring is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="keyword1">t<span class="hidden">⇩</span><sub>0</sub></span><span class="main">+</span><span class="keyword1">δt</span>›</span><span class="antiquote">}</span></span>, 
      slave has to tick.
    ›</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">measured_time</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
                  <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span>  first_time <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span> <span class="bound">m</span> <span class="main">(</span><span class="bound">measured_time</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span><span class="main">)</span>
                            <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span>
                 <span class="main">)</span>
        <span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> means that each tick on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>
        must be preceded by or coincide with at least one tick on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span>.
        Therefore, at each instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span>, the number of ticks on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> 
        must be less or equal to the number of ticks on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span>.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> means that each tick on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>
        must be preceded by at least one tick on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> at a previous instant.
        Therefore, at each instant n, the number of ticks on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>
        must be less or equal to the number of ticks on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> 
        at instant n - 1.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> means that when <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> ticks, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>
        cannot tick and is not allowed to tick at any further instant.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>
                        <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Denotational interpretation for TESL formulae›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  To satisfy a formula, a run has to satisfy the conjunction of its atomic 
  formulae. Therefore, the interpretation of a formula is the intersection
  of the interpretations of its components.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TESL_interpretation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> TESL_formula <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦⟦</span> _ <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="main">[]</span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span> <span class="main">=</span> <span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span></span>›</span></span>

<span class="keyword1" id="Denotational-TESL_interpretation_homo"><span class="command">lemma</span></span> TESL_interpretation_homo<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Image interpretation lemma›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> TESL_interpretation_image<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expansion law›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similar to the expansion laws of lattices.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> TESL_interp_homo_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Equational laws for the denotation of TESL formulae›</span></span>

<span class="keyword1" id="Denotational-TESL_interp_assoc"><span class="command">lemma</span></span> TESL_interp_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Denotational-TESL_interp_commute"><span class="command">lemma</span></span> TESL_interp_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interp_homo_append inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Denotational-TESL_interp_left_commute"><span class="command">lemma</span></span> TESL_interp_left_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TESL_interp_homo_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Denotational-TESL_interp_idem"><span class="command">lemma</span></span> TESL_interp_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> TESL_interp_homo_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Denotational-TESL_interp_left_idem"><span class="command">lemma</span></span> TESL_interp_left_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> TESL_interp_homo_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Denotational-TESL_interp_right_idem"><span class="command">lemma</span></span> TESL_interp_right_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> TESL_interp_homo_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> TESL_interp_aci <span class="main">=</span> TESL_interp_commute
                         TESL_interp_assoc
                         TESL_interp_left_commute
                         TESL_interp_left_idem

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The empty formula is the identity element.›</span></span>
<span class="keyword1" id="Denotational-TESL_interp_neutral1"><span class="command">lemma</span></span> TESL_interp_neutral1<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">[]</span> <span class="main">@</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Denotational-TESL_interp_neutral2"><span class="command">lemma</span></span> TESL_interp_neutral2<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="main">[]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Decreasing interpretation of TESL formulae›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Adding constraints to a TESL formula reduces the number of satisfying runs.
›</span></span>
<span class="keyword1" id="Denotational-TESL_sem_decreases_head"><span class="command">lemma</span></span> TESL_sem_decreases_head<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Denotational-TESL_sem_decreases_tail"><span class="command">lemma</span></span> TESL_sem_decreases_tail<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interp_homo_append<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Repeating a formula in a specification does not change the specification.
›</span></span>
<span class="keyword1" id="Denotational-TESL_interp_formula_stuttering"><span class="command">lemma</span></span> TESL_interp_formula_stuttering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="main">∈</span> set <span class="free">Φ</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="main">=</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="main">@</span> <span class="free">Φ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TESL_interp_homo_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms TESL_interpretation_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Removing duplicate formulae in a specification does not change the specification.
›</span></span>
<span class="keyword1" id="Denotational-TESL_interp_remdups_absorb"><span class="command">lemma</span></span> TESL_interp_remdups_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> remdups <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_formula_stuttering <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Specifications that contain the same formulae have the same semantics.
›</span></span>
<span class="keyword1" id="Denotational-TESL_interp_set_lifting"><span class="command">lemma</span></span> TESL_interp_set_lifting<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ</span> <span class="main">=</span> set <span class="free">Φ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>     
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>remdups <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>remdups <span class="free">Φ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fxpntΦ<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interpretation_image<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fxpntΦ'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interpretation_image<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_remdups_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The semantics of specifications is contravariant with respect to their inclusion.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> TESL_interp_decreases_setinc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ</span> <span class="main">⊆</span> set <span class="free">Φ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Φ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> decompose<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">Φ</span> <span class="main">@</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Φ'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">Φ</span> <span class="main">@</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Φ'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>set <span class="free">Φ</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Φ'</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TESL_interp_set_lifting decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interp_homo_append<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Denotational-TESL_interp_decreases_add_head"><span class="command">lemma</span></span> TESL_interp_decreases_add_head<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ</span> <span class="main">⊆</span> set <span class="free">Φ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms TESL_interp_decreases_setinc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Denotational-TESL_interp_decreases_add_tail"><span class="command">lemma</span></span> TESL_interp_decreases_add_tail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ</span> <span class="main">⊆</span> set <span class="free">Φ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="main">@</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Φ'</span> <span class="main">@</span> <span class="main">[</span><span class="free">φ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> TESL_interp_decreases_setinc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interpretation_image dual_order.trans<span class="main">)</span>

<span class="keyword1" id="Denotational-TESL_interp_absorb1"><span class="command">lemma</span></span> TESL_interp_absorb1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> set <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb1 TESL_interp_decreases_setinc
                          TESL_interp_homo_append assms<span class="main">)</span>

<span class="keyword1" id="Denotational-TESL_interp_absorb2"><span class="command">lemma</span></span> TESL_interp_absorb2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> set <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> TESL_interp_absorb1 TESL_interp_commute assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some special cases›</span></span>

<span class="keyword1" id="Denotational-NoSporadic_stable"><span class="command">lemma</span></span> NoSporadic_stable <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊆</span> <span class="main">⟦⟦</span> NoSporadic <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> filter_is_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>NoSporadic <span class="free">Φ</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Φ</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> TESL_interp_decreases_setinc<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Denotational-NoSporadic_idem"><span class="command">lemma</span></span> NoSporadic_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> NoSporadic <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> NoSporadic_stable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Denotational-NoSporadic_setinc"><span class="command">lemma</span></span> NoSporadic_setinc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹set <span class="main">(</span>NoSporadic <span class="free">Φ</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Φ</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_is_subset<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyT0    <span class="main">(</span><span class="quoted">‹<span class="keyword1">t<span class="hidden">⇩</span><sub>0</sub></span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyDeltaT <span class="main">(</span><span class="quoted">‹<span class="keyword1">δt</span>›</span><span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SymbolicPrimitive">
<div class="head">
<h1>Theory SymbolicPrimitive</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Symbolic Primitives for Building Runs›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SymbolicPrimitive
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Run.html">Run</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We define here the primitive constraints on runs, towards which we translate
  TESL specifications in the operational semantics.
  These constraints refer to a specific symbolic run and can therefore access
  properties of the run at particular instants (for instance, the fact that a clock
  ticks at instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of the run, or the time on a given clock at 
  that instant).

  In the previous chapters, we had no reference to particular instants of a run 
  because the TESL language should be invariant by stuttering in order to allow 
  the composition of specifications: adding an instant where no clock ticks to 
  a run that satisfies a formula should yield another run that satisfies the 
  same formula. However, when constructing runs that satisfy a formula, we
  need to be able to refer to the time or hamlet of a clock at a given instant.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Counter expressions are used to get the number of ticks of a clock up to 
  (strictly or not) a given instant index.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> cnt_expr <span class="main">=</span>
  TickCountLess <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹instant_index›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">#<span class="hidden">⇧</span><sup>&lt;</sup></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span><span class="main">)</span>
<span class="main">|</span> TickCountLeq <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="quoted"><span class="quoted">‹instant_index›</span></span>  <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">#<span class="hidden">⇧</span><sup>≤</sup></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Symbolic Primitives for Runs ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Tag values are used to refer to the time on a clock at a given instant index.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> tag_val <span class="main">=</span>
  TSchematic <span class="quoted"><span class="quoted">‹clock <span class="main">*</span> instant_index›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>›</span><span class="main">)</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'τ</span> constr <span class="main">=</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span>›</span><span class="antiquote">}</span></span> to have time <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">τ</span>›</span><span class="antiquote">}</span></span>
    at instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
  Timestamp     <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span>         <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⇓</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">@</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">m</span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δt</span> <span class="main">⇒</span> <span class="free">s</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">s</span>›</span><span class="antiquote">}</span></span> to tick at the
    first instant at which the time on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">m</span>›</span><span class="antiquote">}</span></span> has increased by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">δt</span>›</span><span class="antiquote">}</span></span>
    from the value it had at instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
<span class="main">|</span> TimeDelay     <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> tag_const›</span></span> <span class="quoted"><span class="quoted">‹clock›</span></span> <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">@</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⊕</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⇒</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span> <span class="main">⇑</span> <span class="free">n</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span>›</span><span class="antiquote">}</span></span> to tick
    at instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
<span class="main">|</span> Ticks         <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span>                        <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⇑</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span> <span class="main">¬⇑</span> <span class="free">n</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span>›</span><span class="antiquote">}</span></span> not to tick
    at instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
<span class="main">|</span> NotTicks      <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span>                        <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">¬⇑</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span> <span class="main">¬⇑</span> <span class="main">&lt;</span> <span class="free">n</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span>›</span><span class="antiquote">}</span></span> not to tick
    before instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
<span class="main">|</span> NotTicksUntil <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span>                        <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">¬⇑</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">&lt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span>›</span><span class="antiquote">}</span></span> constrains clock <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">c</span>›</span><span class="antiquote">}</span></span> not to tick
    at and after instant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">n</span>›</span><span class="antiquote">}</span></span> of the run.›</span>
<span class="main">|</span> NotTicksFrom  <span class="quoted"><span class="quoted">‹clock›</span></span>   <span class="quoted"><span class="quoted">‹instant_index›</span></span>                        <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">¬⇑</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">≥</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="main">⌊</span><span class="free">τ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">τ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span>›</span><span class="antiquote">}</span></span> constrains tag variables <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">τ<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> and  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">τ<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> 
    to be in relation <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">R</span>›</span><span class="antiquote">}</span></span>.›</span>
<span class="main">|</span> TagArith      <span class="quoted"><span class="quoted">‹tag_val›</span></span> <span class="quoted"><span class="quoted">‹tag_val›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span> tag_const <span class="main">×</span> <span class="tfree">'τ</span> tag_const<span class="main">)</span> <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌊</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌋</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∈</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="main">⌈</span><span class="free">k<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">k<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌉</span> <span class="main">∈</span> <span class="free">R</span>›</span><span class="antiquote">}</span></span> constrains counter expressions <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">k<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> and  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">k<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> 
    to be in relation <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">R</span>›</span><span class="antiquote">}</span></span>.›</span>
<span class="main">|</span> TickCntArith  <span class="quoted"><span class="quoted">‹cnt_expr›</span></span> <span class="quoted"><span class="quoted">‹cnt_expr›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> bool›</span></span>      <span class="main">(</span><span class="quoted">‹<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌈</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⌉</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∈</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>
<span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">k<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≼</span> <span class="free">k<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> constrains counter expression <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">k<span class="hidden">⇩</span><sub>1</sub></span>›</span><span class="antiquote">}</span></span> to be less or equal 
    to counter expression <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">k<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>.›</span>
<span class="main">|</span> TickCntLeq    <span class="quoted"><span class="quoted">‹cnt_expr›</span></span> <span class="quoted"><span class="quoted">‹cnt_expr›</span></span>                            <span class="main">(</span><span class="quoted">‹_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">≼</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _›</span><span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'τ</span> system <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> constr list›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The abstract machine has configurations composed of:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the past <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Γ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which captures choices that have already be made as a 
    list of symbolic primitive constraints on the run;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the current index <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which is the index of the present instant;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the present <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which captures the formulae that must be satisfied
    in the current instant;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the future <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Φ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which captures the constraints on the future of the run.
›</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'τ</span> config <span class="main">=</span>
                <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span> system <span class="main">*</span> instant_index <span class="main">*</span> <span class="tfree">'τ</span> TESL_formula <span class="main">*</span> <span class="tfree">'τ</span> TESL_formula›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics of Primitive Constraints ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The semantics of the primitive constraints is defined in a way similar to
  the semantics of TESL formulae.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">counter_expr_eval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> cnt_expr <span class="main">⇒</span> nat›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦</span> _ <span class="keyword1">⊢</span> _ <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free"><span class="bound"><span class="entity">clk</span></span></span> <span class="free"><span class="bound"><span class="entity">indx</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span></span> <span class="main">=</span> run_tick_count_strictly <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">clk</span></span></span> <span class="free"><span class="bound"><span class="entity">indx</span></span></span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free"><span class="bound"><span class="entity">clk</span></span></span> <span class="free"><span class="bound"><span class="entity">indx</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span></span> <span class="main">=</span> run_tick_count <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">clk</span></span></span> <span class="free"><span class="bound"><span class="entity">indx</span></span></span>›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">symbolic_run_interpretation_primitive</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> constr <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦</span> _ <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>  <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span>     <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">δt</span></span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">K'</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span>
                  <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>0</sub></span></span></span><span class="main">.</span> first_time <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="bound">n</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">δt</span></span></span><span class="main">)</span>
                               <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K'</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span>     <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">¬⇑</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span>   <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span>   <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇓</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span>
    <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="main">⌈</span><span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">⌉</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">(</span><span class="main">⟦</span> <span class="bound">ρ</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">,</span> <span class="main">⟦</span> <span class="bound">ρ</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">e<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">cnt_e<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">≼</span> <span class="free"><span class="bound"><span class="entity">cnt_e<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">ρ</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">cnt_e<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">≤</span> <span class="main">⟦</span> <span class="bound">ρ</span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">cnt_e<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The composition of primitive constraints is their conjunction, and we get the
  set of satisfying runs by intersection.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">symbolic_run_interpretation</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> constr list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run set›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦⟦</span> _ <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="main">[]</span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> True <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span> <span class="main">=</span> <span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">γ</span></span></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1"><span class="free">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span></span>›</span></span>

<span class="keyword1" id="SymbolicPrimitive-symbolic_run_interp_cons_morph"><span class="command">lemma</span></span> symbolic_run_interp_cons_morph<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent_context</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> constr list <span class="main">⇒</span> bool›</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">‹<span class="free">consistent_context</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">≡</span> <span class="main">(</span> <span class="main">⟦⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Defining a method for witness construction›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In order to build a run, we can start from an initial run in which no clock 
  ticks and the time is always 0 on any clock.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">initial_run</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">ρ<span class="hidden">⇩</span><sub>⊙</sub></span>›</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">ρ<span class="hidden">⇩</span><sub>⊙</sub></span></span> <span class="main">≡</span> Abs_run <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>False<span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span>nat <span class="main">⇒</span> clock <span class="main">⇒</span> <span class="main">(</span>bool <span class="main">×</span> <span class="tfree">'τ</span> tag_const<span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  To help avoiding that time flows backward, setting the time on a clock at a given 
  instant sets it for the future instants too.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">time_update</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> clock <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> tag_const <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'τ</span> instant<span class="main">)</span>
      <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'τ</span> instant<span class="main">)</span>›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">time_update</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n'</span> <span class="bound">K'</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">=</span> <span class="bound">K'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="bound">n'</span>
                                  <span class="keyword1">then</span> <span class="main">(</span>hamlet <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>
                                  <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ρ</span></span></span> <span class="bound">n'</span> <span class="bound">K'</span><span class="main">)</span>›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rules and properties of consistence›</span></span>

<span class="keyword1" id="SymbolicPrimitive-context_consistency_preservationI"><span class="command">lemma</span></span> context_consistency_preservationI<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹consistent_context <span class="main">(</span><span class="main">(</span><span class="free">γ</span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> constr<span class="main">)</span><span class="main">#</span><span class="free">Γ</span><span class="main">)</span> <span class="main">⟹</span> consistent_context <span class="free">Γ</span>›</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> consistent_context_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">― ‹This is very restrictive›</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">context_independency</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> constr <span class="main">⇒</span> <span class="tfree">'τ</span> constr list <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">⨝</span> _›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  NotTicks_independency<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main"><span class="free">⨝</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>›</span></span>
<span class="main">|</span> Ticks_independency<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main"><span class="free">⨝</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>›</span></span>
<span class="main">|</span> Timestamp_independency<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∄</span><span class="bound">τ'</span><span class="main">.</span> <span class="bound">τ'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇓</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⇓</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main"><span class="free">⨝</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span>›</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Major Theorems›</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interpretation of a context›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The interpretation of a context is the intersection of the interpretation 
  of its components.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> symrun_interp_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expansion law›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similar to the expansion laws of lattices›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> symrun_interp_expansion<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Equations for the interpretation of symbolic primitives›</span></span> 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General laws›</span></span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_assoc"><span class="command">lemma</span></span> symrun_interp_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_commute"><span class="command">lemma</span></span> symrun_interp_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_expansion inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_left_commute"><span class="command">lemma</span></span> symrun_interp_left_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> symrun_interp_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_idem"><span class="command">lemma</span></span> symrun_interp_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> symrun_interp_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_left_idem"><span class="command">lemma</span></span> symrun_interp_left_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> symrun_interp_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_right_idem"><span class="command">lemma</span></span> symrun_interp_right_idem<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> symrun_interp_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> symrun_interp_aci <span class="main">=</span>  symrun_interp_commute
                            symrun_interp_assoc
                            symrun_interp_left_commute
                            symrun_interp_left_idem

<span class="comment1">― ‹Identity element›</span>
<span class="keyword1" id="SymbolicPrimitive-symrun_interp_neutral1"><span class="command">lemma</span></span> symrun_interp_neutral1<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">[]</span> <span class="main">@</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_neutral2"><span class="command">lemma</span></span> symrun_interp_neutral2<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="main">[]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Decreasing interpretation of symbolic primitives›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Adding constraints to a context reduces the number of satisfying runs.
›</span></span>
<span class="keyword1" id="SymbolicPrimitive-TESL_sem_decreases_head"><span class="command">lemma</span></span> TESL_sem_decreases_head<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SymbolicPrimitive-TESL_sem_decreases_tail"><span class="command">lemma</span></span> TESL_sem_decreases_tail<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="main">[</span><span class="free">γ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_expansion<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Adding a constraint that is already in the context does not change the
  interpretation of the context.
›</span></span>
<span class="keyword1" id="SymbolicPrimitive-symrun_interp_formula_stuttering"><span class="command">lemma</span></span> symrun_interp_formula_stuttering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">γ</span> <span class="main">∈</span> set <span class="free">Γ</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="main">=</span> <span class="main">[</span><span class="free">γ</span><span class="main">]</span> <span class="main">@</span> <span class="free">Γ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">[</span><span class="free">γ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> symrun_interp_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms symrun_interp_fixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Removing duplicate constraints from a context does not change the
  interpretation of the context.
›</span></span>
<span class="keyword1" id="SymbolicPrimitive-symrun_interp_remdups_absorb"><span class="command">lemma</span></span> symrun_interp_remdups_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> remdups <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Γ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Cons
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> symrun_interp_formula_stuttering <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Two identical sets of constraints have the same interpretation,
  the order in the context does not matter.
›</span></span>
<span class="keyword1" id="SymbolicPrimitive-symrun_interp_set_lifting"><span class="command">lemma</span></span> symrun_interp_set_lifting<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ</span> <span class="main">=</span> set <span class="free">Γ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>     
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>remdups <span class="free">Γ</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>remdups <span class="free">Γ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fxpntΓ<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fxpntΓ'<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Γ'</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Γ</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">γ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">γ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">`</span> set <span class="free">Γ'</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> symrun_interp_remdups_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The interpretation of contexts is contravariant with regard to set inclusion.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> symrun_interp_decreases_setinc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ</span> <span class="main">⊆</span> set <span class="free">Γ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> decompose<span class="main">:</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">Γ</span> <span class="main">@</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Γ'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="free">Γ</span> <span class="main">@</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Γ'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>set <span class="free">Γ</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span><span class="main">)</span> <span class="main">=</span> set <span class="free">Γ'</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> symrun_interp_set_lifting decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_expansion<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>r</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_decreases_add_head"><span class="command">lemma</span></span> symrun_interp_decreases_add_head<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ</span> <span class="main">⊆</span> set <span class="free">Γ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">γ</span> <span class="main">#</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> symrun_interp_decreases_setinc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_decreases_add_tail"><span class="command">lemma</span></span> symrun_interp_decreases_add_tail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ</span> <span class="main">⊆</span> set <span class="free">Γ'</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="main">@</span> <span class="main">[</span><span class="free">γ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊇</span> <span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="main">@</span> <span class="main">[</span><span class="free">γ</span><span class="main">]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> symrun_interp_decreases_setinc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ'</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">⊆</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symrun_interp_expansion dual_order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_absorb1"><span class="command">lemma</span></span> symrun_interp_absorb1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> set <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb1 symrun_interp_decreases_setinc
                          symrun_interp_expansion assms<span class="main">)</span>

<span class="keyword1" id="SymbolicPrimitive-symrun_interp_absorb2"><span class="command">lemma</span></span> symrun_interp_absorb2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> set <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> symrun_interp_absorb1 symrun_interp_commute assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Operational">
<div class="head">
<h1>Theory Operational</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Operational Semantics›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\label{chap:operational_semantics}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Operational
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="SymbolicPrimitive.html">SymbolicPrimitive</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The operational semantics defines rules to build symbolic runs from a TESL 
  specification (a set of TESL formulae).
  Symbolic runs are described using the symbolic primitives presented in the 
  previous chapter.
  Therefore, the operational semantics compiles a set of constraints on runs, 
  as defined by the denotational semantics, into a set of symbolic constraints 
  on the instants of the runs. Concrete runs can then be obtained by solving the 
  constraints at each instant.
›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Operational steps›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We introduce a notation to describe configurations:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Γ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the context, the set of symbolic constraints on past instants of the run;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the index of the current instant, the present;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the TESL formula that must be satisfied at the current instant (present);
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Φ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the TESL formula that must be satisfied for the following instants (the future).
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">uncurry_conf</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> system <span class="main">⇒</span> instant_index <span class="main">⇒</span> <span class="tfree">'τ</span> TESL_formula <span class="main">⇒</span> <span class="tfree">'τ</span> TESL_formula
      <span class="main">⇒</span> <span class="tfree">'τ</span> config›</span></span>                                                  <span class="main">(</span><span class="quoted">‹_<span class="keyword1">,</span> _ <span class="keyword1">⊢</span> _ <span class="keyword1">▹</span> _›</span> 80<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main"><span class="free">▹</span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The only introduction rule allows us to progress to the next instant 
  when there are no more constraints to satisfy for the present instant.
›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operational_semantics_intro</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇩</span><sub>i</sub></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  instant_i<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>i</sub></span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The elimination rules describe how TESL formulae for the present are transformed 
  into constraints on the past and on the future.
›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operational_semantics_elim</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  sporadic_on_e1<span class="main">:</span>
<span class="comment1">― ‹A sporadic constraint can be ignored in the present and rejected into the future.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">sporadic</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">sporadic</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> sporadic_on_e2<span class="main">:</span>
<span class="comment1">― ‹It can also be handled in the present by making the clock tick and have 
  the expected time. Once it has been handled, it is no longer a constraint 
  to satisfy, so it disappears from the future.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">sporadic</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⇓</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> tagrel_e<span class="main">:</span>
<span class="comment1">― ‹A relation between time scales has to be obeyed at every instant.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
              <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> implies_e1<span class="main">:</span>
<span class="comment1">― ‹An implication can be handled in the present by forbidding a tick of the master
  clock. The implication is copied back into the future because it holds for 
  the whole run.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> implies_e2<span class="main">:</span>
<span class="comment1">― ‹It can also be handled in the present by making both the master and the slave
    clocks tick.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> implies_not_e1<span class="main">:</span>
<span class="comment1">― ‹A negative implication can be handled in the present by forbidding a tick of 
  the master clock. The implication is copied back into the future because 
  it holds for the whole run.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> implies_not_e2<span class="main">:</span>
<span class="comment1">― ‹It can also be handled in the present by making the master clock ticks and 
    forbidding a tick on the slave clock.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> timedelayed_e1<span class="main">:</span>
<span class="comment1">― ‹A timed delayed implication can be handled by forbidding a tick on 
    the master clock.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> timedelayed_e2<span class="main">:</span>
<span class="comment1">― ‹It can also be handled by making the master clock tick and adding a constraint 
    that makes the slave clock tick when the delay has elapsed on the measuring clock.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
            <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> weakly_precedes_e<span class="main">:</span>
<span class="comment1">― ‹A weak precedence relation has to hold at every instant.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
            <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> strictly_precedes_e<span class="main">:</span>
<span class="comment1">― ‹A strict precedence relation has to hold at every instant.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
            <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> kills_e1<span class="main">:</span>
<span class="comment1">― ‹A kill can be handled by forbidding a tick of the triggering clock.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">¬⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="main">|</span> kills_e2<span class="main">:</span>
<span class="comment1">― ‹It can also be handled by making the triggering clock tick and by forbidding 
    any further tick of the killed clock.›</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub></span></span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⇑</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A step of the operational semantics is either the application of the introduction 
  rule or the application of an elimination rule.
›</span></span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">operational_semantics_step</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪</span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  intro_part<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>i</sub></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>  <span class="main"><span class="free">↪</span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>
<span class="main">|</span> elims_part<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span>  <span class="main"><span class="free">↪</span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We introduce notations for the reflexive transitive closure of the operational 
  semantic step, its transitive closure and its reflexive closure.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">operational_semantics_step_rtranclp</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">↪<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> operational_semantics_step<span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">operational_semantics_step_tranclp</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">↪<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> operational_semantics_step<span class="main"><span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">operational_semantics_step_reflclp</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">↪<span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> operational_semantics_step<span class="main"><span class="hidden">⇧</span><sup>=</sup><span class="hidden">⇧</span><sup>=</sup></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span>›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">operational_semantics_step_relpowp</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>       <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪⇗</span>_<span class="keyword1">⇖</span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> ↪<span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> <span class="main">(</span>operational_semantics_step <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">operational_semantics_elim_inv</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config <span class="main">⇒</span> bool›</span></span>              <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇧</span><sup>←</sup></span> _›</span> 70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1"><span class="free">↪<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇧</span><sup>←</sup></span></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span> <span class="free"><span class="bound"><span class="entity">𝒞<span class="hidden">⇩</span><sub>1</sub></span></span></span>›</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Basic Lemmas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a configuration can be reached in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">m</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> steps from a configuration that 
  can be reached in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> steps from an original configuration, then it can be 
  reached in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span><span class="main"><span class="main">+</span></span><span class="free"><span class="free">m</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> steps from the original configuration.
›</span></span>
<span class="keyword1" id="Operational-operational_semantics_trans_generalized"><span class="command">lemma</span></span> operational_semantics_trans_generalized<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒞<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="free">n</span></sup><span class="hidden">⇖</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒞<span class="hidden">⇩</span><sub>2</sub></span> ↪<span class="hidden">⇗</span><sup><span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒞<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="free">n</span> <span class="main">+</span> <span class="free">m</span></sup><span class="hidden">⇖</span> <span class="free">𝒞<span class="hidden">⇩</span><sub>3</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> relcompp.relcompI<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">‹operational_semantics_step <span class="main">^^</span> <span class="free">n</span>›</span></span> <span class="main">_</span> <span class="main">_</span> 
                            <span class="quoted"><span class="quoted">‹operational_semantics_step <span class="main">^^</span> <span class="free">m</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relpowp_add<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We consider the set of configurations that can be reached in one operational
  step from a given configuration.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Cnext_solve</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="tfree">'τ</span> config set›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> _›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">𝒮'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">𝒮</span></span></span> <span class="main">↪</span> <span class="bound">𝒮'</span> <span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Advancing to the next instant is possible when there are no more constraints 
  on the current instant.
›</span></span>
<span class="keyword1" id="Operational-Cnext_solve_instant"><span class="command">lemma</span></span> Cnext_solve_instant<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="main">{</span> <span class="free">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="free">Φ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps operational_semantics_intro.instant_i<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following lemmas state that the configurations produced by the elimination 
  rules of the operational semantics belong to the configurations that can be 
  reached in one step.
›</span></span>
<span class="keyword1" id="Operational-Cnext_solve_sporadicon"><span class="command">lemma</span></span> Cnext_solve_sporadicon<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps
              operational_semantics_elim.sporadic_on_e1
              operational_semantics_elim.sporadic_on_e2<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_tagrel"><span class="command">lemma</span></span> Cnext_solve_tagrel<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span><span class="free">n</span>
          <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps operational_semantics_elim.tagrel_e<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_implies"><span class="command">lemma</span></span> Cnext_solve_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span><span class="main">,</span>
         <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps operational_semantics_elim.implies_e1
              operational_semantics_elim.implies_e2<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_implies_not"><span class="command">lemma</span></span> Cnext_solve_implies_not<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps
              operational_semantics_elim.implies_not_e1
              operational_semantics_elim.implies_not_e2<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_timedelayed"><span class="command">lemma</span></span> Cnext_solve_timedelayed<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
          <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps
              operational_semantics_elim.timedelayed_e1
              operational_semantics_elim.timedelayed_e2<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_weakly_precedes"><span class="command">lemma</span></span> Cnext_solve_weakly_precedes<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
          <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps
              operational_semantics_elim.weakly_precedes_e<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_strictly_precedes"><span class="command">lemma</span></span> Cnext_solve_strictly_precedes<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
          <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps
              operational_semantics_elim.strictly_precedes_e<span class="main">)</span>

<span class="keyword1" id="Operational-Cnext_solve_kills"><span class="command">lemma</span></span> Cnext_solve_kills<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⊇</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_step.simps operational_semantics_elim.kills_e1
              operational_semantics_elim.kills_e2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An empty specification can be reduced to an empty specification for 
  an arbitrary number of steps.
›</span></span>
<span class="keyword1" id="Operational-empty_spec_reductions"><span class="command">lemma</span></span> empty_spec_reductions<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">k</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Suc <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> instant_i operational_semantics_step.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Corecursive_Prop">
<div class="head">
<h1>Theory Corecursive_Prop</h1>
</div>
<pre class="source"><span class="comment1">(*chapter‹Equivalence of Operational and Denotational Semantics›*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\chapter[Semantics Equivalence]{Equivalence of the Operational and Denotational Semantics}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Corecursive_Prop
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="SymbolicPrimitive.html">SymbolicPrimitive</a>
    <a href="Operational.html">Operational</a>
    <a href="Denotational.html">Denotational</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stepwise denotational interpretation of TESL atoms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In order to prove the equivalence of the denotational and operational semantics, 
  we need to be able to ignore the past (for which the constraints are encoded 
  in the context) and consider only the satisfaction of the constraints from
  a given instant index.
  For this purpose, we define an interpretation of TESL formulae for a suffix of a run.
  That interpretation is closely related to the denotational semantics as
  defined in the preceding chapters.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TESL_interpretation_atomic_stepwise</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> TESL_atomic <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦</span> _ <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub>⇗≥</span> _<span class="keyword1">⇖</span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">sporadic</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">∧</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">master</span></span></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span> <span class="keyword1">on</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span> <span class="keyword1">implies</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">master</span></span></span><span class="main">)</span> <span class="main">⟶</span>
               <span class="main">(</span><span class="keyword1">let</span> <span class="bound">measured_time</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
                <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> first_time <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">measuring</span></span></span> <span class="bound">m</span> <span class="main">(</span><span class="bound">measured_time</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">δτ</span></span></span><span class="main">)</span>
                         <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">slave</span></span></span><span class="main">)</span>
               <span class="main">)</span>
      <span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">kills</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">i</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">K<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The denotational interpretation of TESL formulae can be unfolded into the 
  stepwise interpretation.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_sporadicon"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_sporadicon<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_tagrelgen"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_tagrelgen<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_implies"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="free">slave</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_implies_not"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_implies_not<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">slave</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_timedelayed"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_timedelayed<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span>
          <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_weakly_precedes"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_weakly_precedes<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_strictly_precedes"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_strictly_precedes<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
    <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_unfold_stepwise_kills"><span class="command">lemma</span></span> TESL_interp_unfold_stepwise_kills<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">kills</span> <span class="free">slave</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">kills</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Positive atomic formulae (the ones that create ticks from nothing) are unfolded
  as the union of the stepwise interpretations.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> TESL_interp_unfold_stepwise_positive_atoms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹positive_atom <span class="free">φ</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">φ</span><span class="main">::</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field TESL_atomic <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>
            <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">φ</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> positive_atom.elims<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span> <span class="keyword1">sporadic</span> <span class="skolem">v</span> <span class="keyword1">on</span> <span class="skolem">w</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> TESL_interp_unfold_stepwise_sporadicon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Negative atomic formulae are unfolded
  as the intersection of the stepwise interpretations.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> TESL_interp_unfold_stepwise_negative_atoms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> positive_atom <span class="free">φ</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">φ</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="bound">n</span></sup><span class="hidden">⇖</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SporadicOn <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TagRelation
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_tagrelgen <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Implies
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_implies <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> ImpliesNot
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_implies_not <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> TimeDelayedBy
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_timedelayed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> WeaklyPrecedes
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_weakly_precedes <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> StrictlyPrecedes
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_strictly_precedes <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Kills
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_unfold_stepwise_kills <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Some useful lemmas for reasoning on properties of sequences.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-forall_nat_expansion"><span class="command">lemma</span></span> forall_nat_expansion<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> Suc <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∨</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-exists_nat_expansion"><span class="command">lemma</span></span> exists_nat_expansion<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> Suc <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="main">(</span><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∨</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">n</span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc_le_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-forall_nat_set_suc"><span class="command">lemma</span></span> forall_nat_set_suc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="skolem">x</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="skolem">x</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="bound">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="bound">m</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> forall_nat_expansion <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-exists_nat_set_suc"><span class="command">lemma</span></span> exists_nat_set_suc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∨</span> <span class="bound">m</span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc_le_eq antisym_conv2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">m</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Coinduction Unfolding Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following lemmas show how  to shorten a suffix, i.e. to unfold one instant 
  in the construction of a run. They correspond to the rules of the operational 
  semantics.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_sporadicon_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_sporadicon_coind_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>
    <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>        <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">sporadic_on_e2</span></span><span class="antiquote">}</span></span>›</span>
    <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>   <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">sporadic_on_e1</span></span><span class="antiquote">}</span></span>›</span>
<span class="keyword1"><span class="command">unfolding</span></span> TESL_interpretation_atomic_stepwise.simps<span class="main">(</span>1<span class="main">)</span>
          symbolic_run_interpretation_primitive.simps<span class="main">(</span>1<span class="main">,</span>6<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> exists_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">ρ</span> <span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span>Rep_run <span class="bound">ρ</span> <span class="bound">n</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
                                     <span class="main">∧</span> time <span class="main">(</span>Rep_run <span class="bound">ρ</span> <span class="bound">n</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_conj_eq<span class="main">)</span>


<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_tagrel_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_tagrel_coind_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>        <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">tagrel_e</span></span><span class="antiquote">}</span></span>›</span>
     <span class="main">⟦</span> <span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
     <span class="main">∩</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
       <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>
       <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>Suc <span class="free">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span>
                                       time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_implies_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_implies_coind_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>
     <span class="main">(</span>   <span class="main">⟦</span> <span class="free">master</span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>                     <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">implies_e1</span></span><span class="antiquote">}</span></span>›</span>
       <span class="main">∪</span> <span class="main">⟦</span> <span class="free">master</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">slave</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>  <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">implies_e2</span></span><span class="antiquote">}</span></span>›</span>
     <span class="main">∩</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">master</span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">master</span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>
        <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>Suc <span class="free">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">master</span><span class="main">)</span>
                     <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">master</span><span class="main">)</span>
                                <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">slave</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_implies_not_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_implies_not_coind_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>
     <span class="main">(</span>    <span class="main">⟦</span> <span class="free">master</span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>                       <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">implies_not_e1</span></span><span class="antiquote">}</span></span>›</span>
        <span class="main">∪</span> <span class="main">⟦</span> <span class="free">master</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">slave</span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>  <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">implies_not_e2</span></span><span class="antiquote">}</span></span>›</span>
     <span class="main">∩</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">master</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>
       <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">master</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="free">n</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>
          <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span>Suc <span class="free">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">master</span><span class="main">)</span>
                     <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">slave</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">master</span><span class="main">)</span>
                               <span class="main">⟶</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">x</span><span class="main">)</span> <span class="bound">y</span> <span class="free">slave</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_timedelayed_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_timedelayed_coind_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>
     <span class="main">(</span>     <span class="main">⟦</span> <span class="free">master</span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>               <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">timedelayed_e1</span></span><span class="antiquote">}</span></span>›</span>
        <span class="main">∪</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">master</span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">measuring</span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">slave</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span><span class="main">)</span>
                                             <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">timedelayed_e2</span></span><span class="antiquote">}</span></span>›</span>
     <span class="main">∩</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?prop</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">ρ</span> <span class="bound">m</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">master</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">measured_time</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">measuring</span><span class="main">)</span> <span class="keyword1">in</span>
                  <span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">≥</span> <span class="bound">m</span><span class="main">.</span> first_time <span class="bound">ρ</span> <span class="free">measuring</span> <span class="bound">p</span> <span class="main">(</span><span class="bound">measured_time</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span>
                           <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">p</span> <span class="free">slave</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="free">n</span><span class="main">.</span> <span class="var">?prop</span> <span class="bound">ρ</span> <span class="bound">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?prop</span> <span class="bound">ρ</span> <span class="free">n</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> Suc <span class="free">n</span><span class="main">.</span> <span class="var">?prop</span> <span class="bound">ρ</span> <span class="bound">m</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="var"><span class="quoted"><span class="var">?prop</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?prop</span> <span class="bound">ρ</span> <span class="free">n</span><span class="main">}</span>
              <span class="main">∩</span> <span class="main">⟦</span> <span class="free">master</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">measuring</span> <span class="keyword1">implies</span> <span class="free">slave</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_weakly_precedes_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_weakly_precedes_coind_unfold<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>                 <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">weakly_precedes_e</span></span><span class="antiquote">}</span></span>›</span>
      <span class="main">⟦</span> <span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> 
      <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>
         <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>
         <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span>Suc <span class="free">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">ρ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span>
                                  <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_strictly_precedes_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_strictly_precedes_coind_unfold<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>               <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">strictly_precedes_e</span></span><span class="antiquote">}</span></span>›</span>
      <span class="main">⟦</span> <span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
      <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>
         <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">}</span>
         <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span>Suc <span class="free">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">p</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> forall_nat_set_suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">ρ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span>
                                  <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interp_stepwise_kills_coind_unfold"><span class="command">lemma</span></span> TESL_interp_stepwise_kills_coind_unfold<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span>
      <span class="main">(</span>   <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>                        <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">kills_e1</span></span><span class="antiquote">}</span></span>›</span>
        <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>    <span class="comment1">― ‹rule <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">kills_e2</span></span><span class="antiquote">}</span></span>›</span>
      <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?kills</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">n</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">p</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>
                             <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ticks</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">n</span> <span class="bound">ρ</span> <span class="bound">c</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dead</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">n</span> <span class="bound">ρ</span> <span class="bound">c</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">m</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="free">n</span> <span class="bound">ρ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span>  <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ρ</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field run›</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ρ</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="free">n</span> <span class="bound">ρ</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?kills</span> <span class="free">n</span> <span class="skolem">ρ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="var">?dead</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span><span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">ρ</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ρ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>
               <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="free">n</span> <span class="bound">ρ</span><span class="main">}</span>
           <span class="main">⊆</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span> 
            <span class="main">∪</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ρ</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field run›</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ρ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span>  <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">ρ</span>
             <span class="main">∨</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="var">?dead</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">ρ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?kills</span> <span class="free">n</span> <span class="skolem">ρ</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> dual_order.antisym not_less_eq_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?kills</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="main">∨</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="var">?dead</span> <span class="free">n</span> <span class="skolem">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?kills</span> <span class="free">n</span> <span class="skolem">ρ</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span>  <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span><span class="main">)</span>
          <span class="main">⊆</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="free">n</span> <span class="bound">ρ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span>
                 <span class="main">∪</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?ticks</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?dead</span> <span class="free">n</span> <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="var">?kills</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">ρ</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Collect_cong Collect_disj_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>
                 <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
                 <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The stepwise interpretation of a TESL formula is the intersection of the
  interpretation of its atomic components.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TESL_interpretation_stepwise</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field TESL_formula <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span>
  <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦⟦</span> _ <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub>⇗≥</span> _<span class="keyword1">⇖</span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> True<span class="main">}</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main"><span class="free">⟦⟦</span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span>›</span></span>

<span class="keyword1" id="Corecursive_Prop-TESL_interpretation_stepwise_fixpoint"><span class="command">lemma</span></span> TESL_interpretation_stepwise_fixpoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">φ</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">φ</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span> <span class="main">`</span> set <span class="free">Φ</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The global interpretation of a TESL formula is its interpretation starting
  at the first instant.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-TESL_interpretation_stepwise_zero"><span class="command">lemma</span></span> TESL_interpretation_stepwise_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">φ</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="main">0</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interpretation_stepwise_zero'"><span class="command">lemma</span></span> TESL_interpretation_stepwise_zero'<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="main">0</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interpretation_stepwise_zero<span class="main">)</span>

<span class="keyword1" id="Corecursive_Prop-TESL_interpretation_stepwise_cons_morph"><span class="command">lemma</span></span> TESL_interpretation_stepwise_cons_morph<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">φ</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">φ</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> TESL_interp_stepwise_composition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Interpretation of configurations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The interpretation of a configuration of the operational semantics abstract 
  machine is the intersection of:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the interpretation of its context (the past),
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the interpretation of its present from the current instant,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the interpretation of its future from the next instant.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">HeronConf_interpretation</span>
  <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field config <span class="main">⇒</span> <span class="tfree">'τ</span> run set›</span></span>          <span class="main">(</span><span class="quoted">‹<span class="keyword1">⟦</span> _ <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span> 71<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> <span class="keyword1"><span class="free">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free"><span class="bound"><span class="entity">Γ</span></span></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span></sup><span class="hidden">⇖</span>›</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_composition"><span class="command">lemma</span></span> HeronConf_interp_composition<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
     <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_composition symrun_interp_expansion
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interp_stepwise_composition
              symrun_interp_expansion inf_assoc inf_left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  When there are no remaining constraints on the present, the interpretation of
  a configuration is the same as the configuration at the next instant of its future.
  This corresponds to the introduction rule of the operational semantics.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_instant_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_instant_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span> <span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="free">Φ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="free">Φ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                  <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>
                 <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following lemmas use the unfolding properties of the stepwise denotational 
  semantics to give rewriting rules for the interpretation of configurations that
  match the elimination rules of the operational semantics.
›</span></span>
<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_sporadicon_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_sporadicon_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span>  <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span>  <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>
            <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_sporadicon_coind_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="free">τ</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
            <span class="main">∪</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>
           <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_tagrel_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_tagrel_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
        <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
        <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                 <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
          <span class="main">∩</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_tagrel_coind_unfold
            TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_implies_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_implies_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span>  <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                 <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
                <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_implies_coind_unfold
            TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
         <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
        <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_left_commute inf_assoc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib2 inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_implies_not_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_implies_not_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                  <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                  <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
              <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>
              <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_implies_not_coind_unfold
            TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
           <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
                    <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                    <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_left_commute inf_assoc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib2 inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_timedelayed_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_timedelayed_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
        <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
         <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                 <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
      <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
        <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
            <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
            <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interpretation_stepwise_cons_morph
            TESL_interp_stepwise_timedelayed_coind_unfold
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
            <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="free">δτ</span> <span class="main">⇒</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
            <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="free">K<span class="hidden">⇩</span><sub>3</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_timedelayed_coind_unfold
              TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_assoc Int_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_weakly_precedes_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_weakly_precedes_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
      <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
                <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
            <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_weakly_precedes_coind_unfold
            TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_strictly_precedes_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_strictly_precedes_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
      <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
                <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span>
            <span class="main">∩</span> <span class="main">⟦</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
          <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_strictly_precedes_coind_unfold
            TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Corecursive_Prop-HeronConf_interp_stepwise_kills_cases"><span class="command">lemma</span></span> HeronConf_interp_stepwise_kills_cases<span class="main">:</span>
   <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
    <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
        <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">=</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="free">Γ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
                  <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Φ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>
            <span class="main">=</span> <span class="main">(</span><span class="main">⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span><span class="main">)</span>
              <span class="main">∩</span> <span class="main">⟦</span> <span class="main">(</span><span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> ⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n</span></sup><span class="hidden">⇖</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> TESL_interp_stepwise_kills_coind_unfold
              TESL_interpretation_stepwise_cons_morph <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Hygge_Theory">
<div class="head">
<h1>Theory Hygge_Theory</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹Main Theorems›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hygge_Theory
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Corecursive_Prop.html">Corecursive_Prop</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the properties we have shown about the interpretation of configurations 
  and the stepwise unfolding of the denotational semantics, we can now prove 
  several important results about the construction of runs from a specification.
›</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Initial configuration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The denotational semantics of a specification <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the interpretation 
  at the first instant of a configuration which has <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as its present.
  This means that we can start to build a run that satisfies a specification by 
  starting from this configuration.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> solve_start<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Ψ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦</span> <span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Ψ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="main">0</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TESL_interpretation_stepwise_zero'<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span>
                      <span class="main">⟦⟦</span> <span class="main">[]</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="main">0</span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="main">[]</span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="main">0</span></sup><span class="hidden">⇖</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The interpretation of a configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is a refinement of a
  configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is contained in the interpretation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  This means that by making successive choices in building the instants of a run,
  we preserve the soundness of the constructed run with regard to the original 
  specification.
›</span></span>
<span class="keyword1" id="Hygge_Theory-sound_reduction"><span class="command">lemma</span></span> sound_reduction<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="main">↪</span>  <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></sup><span class="hidden">⇖</span>
          <span class="main">⊇</span>  <span class="main">⟦⟦</span> <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></sup><span class="hidden">⇖</span> <span class="main">∩</span> <span class="main">⟦⟦</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span> ⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub><span class="hidden">⇗</span><sup>≥ Suc <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></sup><span class="hidden">⇖</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">consider</span></span>
    <span class="main">(</span>a<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>i</sub></span>  <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
  <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span>  <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> operational_semantics_step.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> a
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> operational_semantics_intro.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> b <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> operational_semantics_elim.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">τ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_sporadicon_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">τ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="skolem">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_sporadicon_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                                      <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_tagrel_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                                   <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_not_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                                   <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_not_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">δτ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_timedelayed_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">δτ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
            <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="skolem">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_timedelayed_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_weakly_precedes_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_strictly_precedes_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_kills_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Γ</span> <span class="skolem">n</span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Ψ</span> <span class="skolem">Φ</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_kills_cases
                    HeronConf_interpretation.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> step_elim<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">↪</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>

<span class="keyword1" id="Hygge_Theory-sound_reduction'"><span class="command">lemma</span></span> sound_reduction'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">↪</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">⟦</span> <span class="bound">s<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊆</span> <span class="main">⟦</span> <span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="bound">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">↪</span> <span class="bound">s<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> sound_reduction <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hygge_Theory-sound_reduction_generalized"><span class="command">lemma</span></span> sound_reduction_generalized<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="main">0</span></sup><span class="hidden">⇖</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="quoted">"0.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword3"><span class="command">assume</span></span> ff<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="main">⟦</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊆</span> <span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝒮<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> red_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>n</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">𝒮<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">↪</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> hi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>n</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_decomp sound_reduction'<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="skolem">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  From the initial configuration, a configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> obtained after any 
  number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">k</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of reduction steps denotes runs from the 
  initial specification <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> soundness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span> <span class="free">𝒮</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦⟦</span> <span class="free">Ψ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⊇</span> <span class="main">⟦</span> <span class="free">𝒮</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sound_reduction_generalized solve_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We will now show that any run that satisfies a specification can be derived
  from the initial configuration, at any number of steps.

  We start by proving that any run that is denoted by a configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is necessarily denoted by at least one of the configurations that can be reached
  from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Hygge_Theory-complete_direct_successors"><span class="command">lemma</span></span> complete_direct_successors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">X</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Ψ</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_instant_cases operational_semantics_step.simps
            operational_semantics_intro.instant_i
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">ψ</span> <span class="skolem">Ψ</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ψ</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SporadicOn <span class="skolem">K1</span> <span class="skolem">τ</span> <span class="skolem">K2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_sporadicon_cases
                                      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">τ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_sporadicon<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">τ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TagRelation <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_tagrel_cases
                                  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_tagrel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Implies <span class="skolem">K1</span> <span class="skolem">K2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_cases
                                   <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_implies<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpliesNot <span class="skolem">K1</span> <span class="skolem">K2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_not_cases
                                       <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_implies_not<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TimeDelayedBy <span class="skolem">Kmast</span> <span class="skolem">τ</span> <span class="skolem">Kmeas</span> <span class="skolem">Kslave</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_timedelayed_cases
                          <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kmast</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">τ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kmeas</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kslave</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_timedelayed
                          <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kmast</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">τ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kmeas</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Kslave</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeaklyPrecedes <span class="skolem">K1</span> <span class="skolem">K2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_weakly_precedes_cases
                                           <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_weakly_precedes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrictlyPrecedes <span class="skolem">K1</span> <span class="skolem">K2</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_strictly_precedes_cases
                                             <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_strictly_precedes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Kills <span class="skolem">K1</span> <span class="skolem">K2</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_kills_cases<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span>
                Cnext_solve_kills<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">K1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">K2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Φ</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hygge_Theory-complete_direct_successors'"><span class="command">lemma</span></span> complete_direct_successors'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="free">𝒮</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free">𝒮</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">X</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> HeronConf_interpretation.cases <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">Ψ</span></span> <span class="skolem"><span class="skolem">Φ</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> complete_direct_successors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Γ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ψ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Φ</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Therefore, if a run belongs to a configuration, it necessarily belongs to a
  configuration derived from it.
›</span></span>
<span class="keyword1" id="Hygge_Theory-branch_existence"><span class="command">lemma</span></span> branch_existence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">↪</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms complete_direct_successors' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">X</span><span class="main">∈</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">X</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="keyword1">𝒞<span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇩</span><sub>x</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">s</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hygge_Theory-branch_existence'"><span class="command">lemma</span></span> branch_existence'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> ↪<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> branch_existence relpowp_Suc_I<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹operational_semantics_step›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Any run that belongs to the original specification <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has a corresponding 
  configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">𝒮</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> at any number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">k</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of reduction steps
  from the initial configuration. Therefore, any run that satisfies a specification
  can be derived from the initial configuration at any level of reduction.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">𝒮</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>  ↪<span class="hidden">⇗</span><sup><span class="free">k</span></sup><span class="hidden">⇖</span>  <span class="bound">𝒮</span><span class="main">)</span>
           <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">𝒮</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms branch_existence' solve_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Progress›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Reduction steps do not guarantee that the construction of a run progresses in the
  sequence of instants. We need to show that it is always possible to reach the next 
  instant, and therefore any future instant, through a number of steps.
›</span></span>
<span class="keyword1" id="Hygge_Theory-instant_index_increase"><span class="command">lemma</span></span> instant_index_increase<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span>  ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span>  <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">Ψ</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Γ</span></span> <span class="quoted"><span class="free">Φ</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil <span class="skolem">Γ</span> <span class="skolem">Φ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="main">1</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Φ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> instant_i intro_part <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Φ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Φ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms Nil.prems calculation<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">ψ</span> <span class="skolem">Ψ</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ψ</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>SporadicOn <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">τ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                      <span class="main">=</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                      <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_sporadicon_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> br1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                    <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                          ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                                      ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> h1 SporadicOn.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                    ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part sporadic_on_e1<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> br2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                        ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                            <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                    ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                             <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> h2 SporadicOn.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                            ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part sporadic_on_e2<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                    ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> branches SporadicOn.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">sporadic</span> <span class="skolem">τ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
             <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇓</span> <span class="free">n</span> <span class="main">@</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> br1 br2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TagRelation <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_tagrel_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
              ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> TagRelation.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                        <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                    ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
            <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌊</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="keyword1">τ<span class="hidden">⇩</span><sub>v</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n</span><span class="main">)</span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part tagrel_e<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Implies <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                    ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                        ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 Implies.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
            ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                  <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part implies_e1<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                            <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                              ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                          <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span>
                        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                          ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>
                    <span class="main">)</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h2 Implies.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part implies_e2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Implies.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ImpliesNot <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_implies_not_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                            <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                    ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                      ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 ImpliesNot.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                  <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part implies_not_e1<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                            <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                            <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                              ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                          <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span>
                     <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                       <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>
                    <span class="main">)</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h2 ImpliesNot.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part implies_not_e2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> ImpliesNot.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>TimeDelayedBy <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">δτ</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span>
        <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_timedelayed_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br1<span class="main">:</span>
        <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                         <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
          <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
            ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 TimeDelayedBy.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                      <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                    ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                    <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part timedelayed_e1<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br2<span class="main">:</span>
        <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                    <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                 <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                                 ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h2 TimeDelayedBy.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                         <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                       ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">@</span> <span class="free">n</span> <span class="main">⊕</span> <span class="skolem">δτ</span> <span class="main">⇒</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part timedelayed_e2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="skolem">δτ</span> <span class="keyword1">on</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">implies</span> <span class="skolem">K<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
            ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> TimeDelayedBy.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WeaklyPrecedes <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span>
        <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
            <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_weakly_precedes_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                            <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                  ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                        <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                             ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span>  WeaklyPrecedes.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                             ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part weakly_precedes_e<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                      ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> WeaklyPrecedes.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>StrictlyPrecedes <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span>
        <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
          <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_strictly_precedes_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                            <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                  ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                        <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                             ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                            <span class="main">∧</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span>  StrictlyPrecedes.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
                                  <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                             ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">⌈</span><span class="main">#<span class="hidden">⇧</span><sup>≤</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span><span class="main">,</span> <span class="main">#<span class="hidden">⇧</span><sup>&lt;</sup></span> <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">n</span><span class="main">⌉</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span>
              <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part strictly_precedes_e<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                      ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> StrictlyPrecedes.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Kills <span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> branches<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span> <span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">=</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">∪</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> HeronConf_interp_stepwise_kills_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
                <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                    ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                    ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 Kills.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                  <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">¬⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part kills_e1<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> br2<span class="main">:</span>
        <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>
          <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
                                ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span><span class="main">#</span><span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">#</span><span class="skolem">Φ</span><span class="main">)</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                      ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>
                    <span class="main">)</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> h2 Kills.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            fp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>
                ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span>
              <span class="main">↪</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⇑</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">¬⇑</span> <span class="main">≥</span> <span class="free">n</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Γ</span><span class="main">)</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Φ</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> elims_part kills_e2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="skolem">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">#</span> <span class="skolem">Ψ</span><span class="main">)</span> <span class="main">▹</span> <span class="skolem">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup>Suc <span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> fp relpowp_Suc_I2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Kills.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hygge_Theory-instant_index_increase_generalized"><span class="command">lemma</span></span> instant_index_increase_generalized<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&lt;</span> <span class="free">n<span class="hidden">⇩</span><sub>k</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δk</span></span> <span class="keyword2"><span class="keyword">where</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">n<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">=</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> add.commute assms<span class="main">(</span>1<span class="main">)</span> less_iff_Suc_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">δk</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> instant_index_increase assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">δk</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                  <span class="main">(</span><span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span></span> <span class="skolem"><span class="skolem">k</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> f0 assms<span class="main">(</span>1<span class="main">)</span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fcontinue<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="bound">k'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>
                                       ↪<span class="hidden">⇗</span><sup><span class="bound">k'</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> f0 cont instant_index_increase <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub>'</span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub>'</span></span> <span class="skolem"><span class="skolem">k'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> cont2<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span>
                        ↪<span class="hidden">⇗</span><sup><span class="skolem">k'</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">using</span></span> fcontinue cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">k'</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>k</sub>'</span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>k</sub>'</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> operational_semantics_trans_generalized cont cont2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> suc_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> suc_assoc<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">(</span><span class="free">Γ</span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="free">Φ</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> Suc <span class="skolem">δk</span> <span class="main">+</span> Suc <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> cont2 local.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Any run that belongs to a specification <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has a corresponding 
  configuration that develops it up to the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>\textsuperscript{th} instant.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> progress<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="free">Ψ</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>  ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="free">n</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">k</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="bound">Γ<span class="hidden">⇩</span><sub>k</sub></span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="bound">Ψ<span class="hidden">⇩</span><sub>k</sub></span> <span class="main">▹</span> <span class="bound">Φ<span class="hidden">⇩</span><sub>k</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms relpowp_0_I solve_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms relpowp_0_I solve_start <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> pos<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> assms solve_start <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ρ</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> ›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> instant_index_increase_generalized<span class="main">[</span><span class="operator">OF</span> pos this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Local termination›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Here, we prove that the computation of an instant in a run always terminates.
  Since this computation terminates when the list of constraints for the present
  instant becomes empty, we introduce a measure for this formula.
›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">measure_interpretation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field TESL_formula <span class="main">⇒</span> nat›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">μ</span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">μ</span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">μ</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="keyword1">of</span>
                      <span class="main"><span class="bound">_</span></span> <span class="keyword1">sporadic</span> <span class="main"><span class="bound">_</span></span> <span class="keyword1">on</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1"><span class="free">μ</span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span>
                    <span class="main">|</span> <span class="main"><span class="bound">_</span></span>                 <span class="main">⇒</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1"><span class="free">μ</span></span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">measure_interpretation_config</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'τ</span><span class="main">::</span>linordered_field config <span class="main">⇒</span> nat›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="free">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">μ</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We then show that the elimination rules make this measure decrease.
›</span></span>
<span class="keyword1" id="Hygge_Theory-elimation_rules_strictly_decreasing"><span class="command">lemma</span></span> elimation_rules_strictly_decreasing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span>  <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">μ</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&gt;</span> <span class="keyword1">μ</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> operational_semantics_elim.cases<span class="main">)</span>

<span class="keyword1" id="Hygge_Theory-elimation_rules_strictly_decreasing_meas"><span class="command">lemma</span></span> elimation_rules_strictly_decreasing_meas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span>  <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∈</span> measure <span class="keyword1">μ</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> operational_semantics_elim.cases<span class="main">)</span>

<span class="keyword1" id="Hygge_Theory-elimation_rules_strictly_decreasing_meas'"><span class="command">lemma</span></span> elimation_rules_strictly_decreasing_meas'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub></span>  <span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∈</span> measure <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> measure_interpretation_config.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Γ<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">Φ<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> measure_interpretation_config.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> elimation_rules_strictly_decreasing_meas assms p1 p2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">Ψ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∈</span> measure <span class="keyword1">μ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">μ</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> <span class="keyword1">μ</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">&lt;</span> <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">(</span><span class="skolem">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="skolem">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="skolem">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> p1 p2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Therefore, the relation made up of elimination rules is well-founded and the
  computation of an instant terminates.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> instant_computation_termination<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹wfP <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field config<span class="main">)</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">.</span> <span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span>  <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇧</span><sup>←</sup></span>  <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wfP_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹wf <span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field config<span class="main">)</span><span class="main">,</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇧</span><sup>←</sup></span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹measure <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field config<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                               <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_image_def less_eq measure_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field config<span class="main">)</span><span class="main">,</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">↪<span class="hidden">⇩</span><sub>e</sub><span class="hidden">⇧</span><sup>←</sup></span> <span class="bound">𝒮<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span>measure <span class="keyword1">μ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>o</sub><span class="hidden">⇩</span><sub>n</sub><span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>g</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> elimation_rules_strictly_decreasing_meas'
            operational_semantics_elim_inv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹wf <span class="main">(</span>measure measure_interpretation_config<span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="StutteringDefs">
<div class="head">
<h1>Theory StutteringDefs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Properties of TESL›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stuttering Invariance›</span></span>

<span class="keyword1"><span class="command">theory</span></span> StutteringDefs

<span class="keyword2"><span class="keyword">imports</span></span> <a href="Denotational.html">Denotational</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  When composing systems into more complex systems, it may happen that one system 
  has to perform some action while the rest of the complex system does nothing.
  In order to support the composition of TESL specifications, we want to be able 
  to insert stuttering instants in a run without breaking the conformance of a run 
  to its specification. This is what we call the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹stuttering invariance›</span></span> of TESL.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of stuttering›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We consider stuttering as the insertion of empty instants (instants at which no 
  clock ticks) in a run. We caracterize this insertion with a dilating function,
  which maps the instant indices of the original run to the corresponding instant
  indices of the dilated run.
  The properties of a dilating function are:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> it is strictly increasing because instants are inserted into the run,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the image of an instant index is greater than it because stuttering instants 
    can only delay the original instants of the run, 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> no instant is inserted before the first one in order to have a well defined 
    initial date on each clock,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not in the image of the function, no clock ticks at 
    instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the date on the clocks do not change.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dilating_fun</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">dilating_fun</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field run<span class="main">)</span>
    <span class="main">≡</span> strict_mono <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">≥</span> <span class="bound">n</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>
                                      <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a dilation of a run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sub</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by 
  function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a dilating function for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the time in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the time in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sub</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> dilated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the hamlet in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the hamlet in sub dilated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dilating</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">dilating</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">sub</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> dilating_fun <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">sub</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">sub</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹run›</span></span> is a <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹subrun›</span></span> of another run if there exists a dilation between them.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_subrun</span> <span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>linordered_field run <span class="main">⇒</span> <span class="tfree">'a</span> run <span class="main">⇒</span> bool›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">≪</span>›</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">sub</span></span></span> <span class="main"><span class="free">≪</span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> dilating <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">sub</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A contracting function is the reverse of a dilating fun, it maps an instant index 
  of a dilated run to the index of the last instant of a non stuttering run that
  precedes it. Since several successive stuttering instants are mapped to the same
  instant of the non stuttering run, such a function is monotonous, but not strictly.
  The image of the first instant of the dilated run is necessarily the first instant
  of the non stuttering run, and the image of an instant index is less that this 
  index because we remove stuttering instants. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">contracting_fun</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">contracting_fun</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> mono <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \autoref{fig:dilating-run} illustrates the relations between the instants of 
  a run and the instants of a dilated run, with the mappings by the dilating 
  function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the contracting function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
  \begin{figure}
    \centering
    \includegraphics{dilating.pdf}
    \caption{Dilating and contracting functions}\label{fig:dilating-run}
  \end{figure}
›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="comment1">― ‹Constants and notation to be able to write what we want as Isabelle terms, not as LaTeX maths›</span>
<span class="keyword1"><span class="command">consts</span></span> dummyf    <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> nat›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyg    <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat <span class="main">⇒</span> nat›</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummytwo  <span class="main">::</span> <span class="quoted"><span class="quoted">‹nat›</span></span>
<span class="keyword1"><span class="command">notation</span></span> dummyf    <span class="main">(</span><span class="quoted">‹<span class="keyword1">f</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">notation</span></span> dummyg    <span class="main">(</span><span class="quoted">‹<span class="keyword1">g</span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummytwo  <span class="main">(</span><span class="quoted">‹<span class="keyword1">2</span>›</span><span class="main">)</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">g</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is contracting with respect to the dilation of run
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">sub</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by the dilating function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1"><span class="keyword1">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> it is a contracting function ;
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the index of the last original instant before instant 
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, therefore:
    <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">n</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">n</span></span> ›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
    <span class="antiquoted"><span class="antiquoted">▪</span></span> the time does not change on any clock between instants <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>;
    <span class="antiquoted"><span class="antiquoted">▪</span></span> no clock ticks before <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> strictly after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      in run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  See \autoref{fig:dilating-run} for a better understanding. Notice that in this 
  example, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">2</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">2</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="numeral"><span class="numeral">3</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">f</span></span> <span class="main"><span class="main">∘</span></span> <span class="keyword1"><span class="keyword1">g</span></span><span class="main"><span class="main">)</span></span> <span class="numeral"><span class="numeral">4</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyf      <span class="main">(</span><span class="quoted">‹<span class="keyword1">f</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">no_notation</span></span> dummyg      <span class="main">(</span><span class="quoted">‹<span class="keyword1">g</span>›</span><span class="main">)</span> 
<span class="keyword1"><span class="command">no_notation</span></span> dummytwo    <span class="main">(</span><span class="quoted">‹<span class="keyword1">2</span>›</span><span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">contracting</span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">‹<span class="free">contracting</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sub</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>  contracting_fun <span class="free"><span class="bound"><span class="entity">g</span></span></span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">n</span>
                              <span class="main">⟶</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">k</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">sub</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">n</span>
                              <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">k</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For any dilating function, we can build its <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹inverse›</span></span>, as illustrated on
  \autoref{fig:dilating-run}, which is a contracting function:
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">‹<span class="free">dil_inverse</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹
  Alternate definitions for counting ticks.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For proving the stuttering invariance of TESL specifications, we will need
  these alternate definitions for counting ticks, which are based on sets.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">tick_count</span></span> <span class="free"><span class="free">r</span></span> <span class="free"><span class="free">c</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the number of ticks of clock <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in 
  run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> upto instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tick_count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>linordered_field run <span class="main">⇒</span> clock <span class="main">⇒</span> nat <span class="main">⇒</span> nat›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">tick_count</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">tick_count_strict</span></span> <span class="free"><span class="free">r</span></span> <span class="free"><span class="free">c</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the number of ticks of clock <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  in run <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> upto but excluding instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tick_count_strict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span><span class="main">::</span>linordered_field run <span class="main">⇒</span> clock <span class="main">⇒</span> nat <span class="main">⇒</span> nat›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">tick_count_strict</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">}</span>›</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="StutteringLemmas">
<div class="head">
<h1>Theory StutteringLemmas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Stuttering Lemmas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> StutteringLemmas

<span class="keyword2"><span class="keyword">imports</span></span> <a href="StutteringDefs.html">StutteringDefs</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we prove several lemmas that will be used to show that TESL 
  specifications are invariant by stuttering.

  The following one will be useful in proving properties over a sequence of 
  stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-bounded_suc_ind"><span class="command">lemma</span></span> bounded_suc_ind<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">z</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="free">z</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">k'</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas used to prove the invariance by stuttering›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since a dilating function is strictly monotonous, it is injective.›</span></span>

<span class="keyword1" id="StutteringLemmas-dilating_fun_injects"><span class="command">lemma</span></span> dilating_fun_injects<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="StutteringLemmas-dilating_injects"><span class="command">lemma</span></span> dilating_injects<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="free">A</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_injects <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a clock ticks at an instant in a dilated run, that instant is the image
  by the dilating function of an instant of the original run.
›</span></span>
<span class="keyword1" id="StutteringLemmas-ticks_image"><span class="command">lemma</span></span> ticks_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> dilating_fun_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="StutteringLemmas-ticks_image_sub"><span class="command">lemma</span></span> ticks_image_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms dilating_def ticks_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="StutteringLemmas-ticks_image_sub'"><span class="command">lemma</span></span> ticks_image_sub'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> ticks_image_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ 
  The image of the ticks in an interval by a dilating function is the interval 
  bounded by the image of the bounds of the original interval.
  This is proven for all 4 kinds of intervals:  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹]m, n[›</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹[m, n[›</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹]m, n]›</span></span></span></span>
  and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹[m, n]›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="StutteringLemmas-dilating_fun_image_strict"><span class="command">lemma</span></span> dilating_fun_image_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
            <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ticks_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_fun_def strict_mono_less<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SET</span> <span class="main">⊆</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilating_fun_image_left"><span class="command">lemma</span></span> dilating_fun_image_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ticks_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SET</span> <span class="main">⊆</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilating_fun_image_right"><span class="command">lemma</span></span> dilating_fun_image_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ticks_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SET</span> <span class="main">⊆</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilating_fun_image"><span class="command">lemma</span></span> dilating_fun_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> ticks_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dilating_fun_def strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_fun_def strict_mono_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SET</span> <span class="main">⊆</span> <span class="var">?IMG</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  On any clock, the number of ticks in an interval is preserved
  by a dilating function.
›</span></span>
<span class="keyword1" id="StutteringLemmas-ticks_as_often_strict"><span class="command">lemma</span></span> ticks_as_often_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">p</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?SET</span> <span class="main">=</span> card <span class="var">?IMG</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dilating_fun_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_iff_eq_card<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>image <span class="free">f</span> <span class="var">?SET</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dilating_fun_image_strict<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-ticks_as_often_left"><span class="command">lemma</span></span> ticks_as_often_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">p</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?SET</span> <span class="main">=</span> card <span class="var">?IMG</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dilating_fun_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_iff_eq_card<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>image <span class="free">f</span> <span class="var">?SET</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dilating_fun_image_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-ticks_as_often_right"><span class="command">lemma</span></span> ticks_as_often_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">p</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?SET</span> <span class="main">=</span> card <span class="var">?IMG</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dilating_fun_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_iff_eq_card<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>image <span class="free">f</span> <span class="var">?SET</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dilating_fun_image_right<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-ticks_as_often"><span class="command">lemma</span></span> ticks_as_often<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> card <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">≤</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">m</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">p</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?SET</span> <span class="main">=</span> card <span class="var">?IMG</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dilating_fun_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> inj_on_iff_eq_card<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> calculation
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>image <span class="free">f</span> <span class="var">?SET</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dilating_fun_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?IMG</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SET</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The date of an event is preserved by dilation.›</span></span>

<span class="keyword1" id="StutteringLemmas-ticks_tag_image"><span class="command">lemma</span></span> ticks_tag_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">k</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">k</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ticks_image_sub'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TESL operators are invariant by dilation.›</span></span>

<span class="keyword1" id="StutteringLemmas-ticks_sub"><span class="command">lemma</span></span> ticks_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="free">n</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>

<span class="keyword1" id="StutteringLemmas-no_tick_sub"><span class="command">lemma</span></span> no_tick_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">a</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lifting a total function to a partial function on an option domain.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">opt_lift</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option <span class="main">⇒</span> <span class="tfree">'a</span> option<span class="main">)</span>›</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">‹<span class="free">opt_lift</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">y</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The set of instants when a clock ticks in a dilated run is the image by the 
  dilation function of the set of instants when it ticks in the subrun.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_set_sub"><span class="command">lemma</span></span> tick_set_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?S</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?R</span>›</span></span>
    <span class="keyword1"><span class="command">with</span></span> no_tick_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> k0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> k0prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> image <span class="free">f</span> <span class="var">?S</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?R</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?S</span> <span class="main">⊆</span> <span class="var">?R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Strictly monotonous functions preserve the least element.
›</span></span>
<span class="keyword1" id="StutteringLemmas-Least_strict_mono"><span class="command">lemma</span></span> Least_strict_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> Least_mono<span class="main">[</span><span class="operator">OF</span> strict_mono_mono<span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A non empty set of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s has a least element.
›</span></span>
<span class="keyword1" id="StutteringLemmas-Least_nat_ex"><span class="command">lemma</span></span> Least_nat_ex<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> not_le_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹  
  The first instant when a clock ticks in a dilated run is the image by the dilation
  function of the first instant when it ticks in the subrun.
›</span></span>
<span class="keyword1" id="StutteringLemmas-Least_sub"><span class="command">lemma</span></span> Least_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">t</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
              <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">t</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="var">?R</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">)</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> least<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Least_nat_ex <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Least_strict_mono<span class="main">[</span><span class="operator">OF</span> this least<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="var">?S</span><span class="main">)</span>  <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> tick_set_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a clock ticks in a run, it ticks in the subrun.
›</span></span>
<span class="keyword1" id="StutteringLemmas-ticks_imp_ticks_sub"><span class="command">lemma</span></span> ticks_imp_ticks_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> ticks_image_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Stronger version: it ticks in the subrun and we know when.
›</span></span>
<span class="keyword1" id="StutteringLemmas-ticks_imp_ticks_subk"><span class="command">lemma</span></span> ticks_imp_ticks_subk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">k</span> <span class="free">c</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> no_tick_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A dilating function preserves the tick count on an interval for any clock.
›</span></span>
<span class="keyword1" id="StutteringLemmas-dilated_ticks_strict"><span class="command">lemma</span></span> dilated_ticks_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_monoD strict_mono_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SUB</span> <span class="main">⊆</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ticks_imp_ticks_subk<span class="main">[</span><span class="operator">OF</span> assms this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> i0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i0prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilated_ticks_left"><span class="command">lemma</span></span> dilated_ticks_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_monoD strict_mono_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SUB</span> <span class="main">⊆</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ticks_imp_ticks_subk<span class="main">[</span><span class="operator">OF</span> assms this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> i0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i0prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilated_ticks_right"><span class="command">lemma</span></span> dilated_ticks_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_monoD strict_mono_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SUB</span> <span class="main">⊆</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ticks_imp_ticks_subk<span class="main">[</span><span class="operator">OF</span> assms this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> i0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> strict_mono_less strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i0prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-dilated_ticks"><span class="command">lemma</span></span> dilated_ticks<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">=</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_mono_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span><span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹image <span class="free">f</span> <span class="var">?SUB</span> <span class="main">⊆</span> <span class="var">?RUN</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?RUN</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ticks_imp_ticks_subk<span class="main">[</span><span class="operator">OF</span> assms this<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> i0prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="skolem">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> i0prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">i<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RUN</span> <span class="main">⊆</span> image <span class="free">f</span> <span class="var">?SUB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  No tick can occur in a dilated run before the image of 0 by the dilation function.
›</span></span>

<span class="keyword1" id="StutteringLemmas-empty_dilated_prefix"><span class="command">lemma</span></span> empty_dilated_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">0</span>›</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> empty_dilated_prefix'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
         <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_mono_imp_le_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">0</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
     <span class="keyword1"><span class="command">using</span></span> empty_dilated_prefix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dilated_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> dilated_ticks<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> empty_dilated_prefix'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dilated_strict_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
          <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> dil<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating_fun <span class="free">f</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dilating_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> dil <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span>  <span class="keyword1"><span class="command">using</span></span> dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> dilating_fun_image_left<span class="main">[</span><span class="operator">OF</span> dil<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dilating_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A singleton of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be defined with a weaker property.›</span></span> 
<span class="keyword1" id="StutteringLemmas-nat_sing_prop"><span class="command">lemma</span></span> nat_sing_prop<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The set definition and the function definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> tick_count<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  are equivalent.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_is_fun"><span class="command">lemma</span></span> tick_count_is_fun<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">0</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">0</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_zero_eq nat_sing_prop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">0</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
             <span class="main">=</span> insert <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">k</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Suc.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
             <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> le_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">k</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  To show that the set definition and the function definition 
  of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> tick_count_strict<span class="antiquote"><span class="antiquote">}</span></span></span></span> are equivalent, we first show that
  the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹strictness›</span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> tick_count_strict<span class="antiquote"><span class="antiquote">}</span></span></span></span> can be softened using <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Suc<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span> 
<span class="keyword1" id="StutteringLemmas-tick_count_strict_suc"><span class="command">lemma</span></span> tick_count_strict_suc<span class="main">:</span><span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> tick_count_def tick_count_strict_def <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="StutteringLemmas-tick_count_strict_is_fun"><span class="command">lemma</span></span> tick_count_strict_is_fun<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> run_tick_count_strictly <span class="free">r</span> <span class="free">c</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_strict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> run_tick_count_strictly <span class="free">r</span> <span class="free">c</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> run_tick_count_strictly.simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> not0_implies_Suc<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">m</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> tick_count_strict_suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tick_count_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> run_tick_count_strictly <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> run_tick_count_strictly.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This leads to an alternate definition of the strict precedence relation.
›</span></span>
<span class="keyword1" id="StutteringLemmas-strictly_precedes_alt_def1"><span class="command">lemma</span></span> strictly_precedes_alt_def1<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">}</span>
 <span class="main">=</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The strict precedence relation can even be defined using 
  only <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ‹run_tick_count›<span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword1" id="StutteringLemmas-zero_gt_all"><span class="command">lemma</span></span> zero_gt_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="free">n</span>›</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="StutteringLemmas-strictly_precedes_alt_def2"><span class="command">lemma</span></span> strictly_precedes_alt_def2<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹<span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">}</span>
 <span class="main">=</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="main">0</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">=</span> <span class="var">?P'</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> run›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?P</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> tick_count_is_fun<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> tick_count_strict_is_fun<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> tick_count_strict_suc<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>2</sub></span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> tick_count_strict_suc<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">0</span> <span class="main">&lt;=</span> tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_strict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?P'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">⊆</span> <span class="var">?P'</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> run›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?P'</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> tick_count_strict_suc<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">K<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟶</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_strict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">0</span> <span class="main">≤</span> tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> zero_gt_all<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span> <span class="main">≤</span> tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span>›</span></span><span class="main">,</span> <span class="operator">OF</span> this <span class="main">]</span> *
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count_strict <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="skolem">r</span> <span class="free">K<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun tick_count_strict_is_fun<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P'</span> <span class="main">⊆</span> <span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Some properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ‹run_tick_count›<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ‹tick_count›<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ‹Suc›<span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword1" id="StutteringLemmas-run_tick_count_suc"><span class="command">lemma</span></span> run_tick_count_suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>
                                 <span class="keyword1">then</span> Suc <span class="main">(</span>run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>
                                 <span class="keyword1">else</span> run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> tick_count_suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>
                             <span class="keyword1">then</span> Suc <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>
                             <span class="keyword1">else</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Some generic properties on the cardinal of sets of nat that we will need later.
›</span></span>
<span class="keyword1" id="StutteringLemmas-card_suc"><span class="command">lemma</span></span> card_suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>
               <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-card_le_leq"><span class="command">lemma</span></span> card_le_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>
         <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-card_le_leq_0"><span class="command">lemma</span></span> card_le_leq_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-card_mnm"><span class="command">lemma</span></span> card_mnm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>
         <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span>
    <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">OF</span> 3 4 1<span class="main">]</span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-card_mnm'"><span class="command">lemma</span></span> card_mnm'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>
         <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span>
    <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> card_Un_disjoint<span class="main">[</span><span class="operator">OF</span> 3 4 1<span class="main">]</span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-nat_interval_union"><span class="command">lemma</span></span> nat_interval_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>
         <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms le_cases nat_less_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="StutteringLemmas-card_sing_prop"><span class="command">lemma</span></span> card_sing_prop<span class="main">:</span><span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">P</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="free">n</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_conv_if<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span> <span class="free">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_conv_if<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">P</span> <span class="free">n</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-card_prop_mono"><span class="command">lemma</span></span> card_prop_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">i</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a dilated run, no tick occurs strictly between two successive instants that 
  are the images by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of instants of the original run.
›</span></span>
<span class="keyword1" id="StutteringLemmas-no_tick_before_suc"><span class="command">lemma</span></span> no_tick_before_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">k</span> <span class="free">c</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> smf not_less_eq strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  From this, we show that the number of ticks on any clock at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">(</span></span>Suc <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  depends only on the number of ticks on this clock at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and whether
  this clock ticks at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">(</span></span>Suc <span class="free"><span class="free">n</span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  All the instants in between are stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_fsuc"><span class="command">lemma</span></span> tick_count_fsuc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> card <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                        <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">∪</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_interval_union strict_mono_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
                  <span class="main">∩</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                      card <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
                    <span class="main">+</span> card <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * card_Un_disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> no_tick_before_suc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> smf strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> tick_count_f_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>
         <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> tick_count_fsuc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      card_sing_prop<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> tick_count_f_suc_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>
                                         <span class="keyword1">then</span> Suc <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
                                         <span class="keyword1">else</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> tick_count_f_suc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="StutteringLemmas-tick_count_f_suc_sub"><span class="command">lemma</span></span> tick_count_f_suc_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>
                                         <span class="keyword1">then</span> Suc <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
                                         <span class="keyword1">else</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> tick_count_f_suc_suc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The number of ticks does not progress during stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_latest"><span class="command">lemma</span></span> tick_count_latest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> union<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
          <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> partition<span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
        <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_tick_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> union <span class="keyword2"><span class="keyword">and</span></span> partition <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We finally show that the number of ticks on any clock is preserved by dilation.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_sub"><span class="command">lemma</span></span> tick_count_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tick_count_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> dilated_prefix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tick_count_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> run_tick_count_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> run_tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tick_count_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span>›</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> tick_count_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> <span class="main">#<span class="hidden">⇩</span><sub>≤</sub></span> <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> tick_count_is_fun<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The number of ticks occurring strictly before the first instant is null.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_strict_0"><span class="command">lemma</span></span> tick_count_strict_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tick_count_strict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The number of ticks strictly before an instant does not progress
  during stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_strict_stable"><span class="command">lemma</span></span> tick_count_strict_stable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="free">k</span> <span class="main">=</span> tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> no_tick_before_suc<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> tick_count_strict_def <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>
         <span class="main">+</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_mnm' assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_strict_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, the number of ticks strictly before an instant is preserved by dilation.
›</span></span>
<span class="keyword1" id="StutteringLemmas-tick_count_strict_sub"><span class="command">lemma</span></span> tick_count_strict_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count_strict <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tick_count_strict_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">(</span>image <span class="free">f</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_injects<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">i</span> <span class="free">c</span><span class="main">)</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> dilated_strict_prefix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> tick_count_strict <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> tick_count_strict_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The tick count on any clock can only increase.
›</span></span>

<span class="keyword1" id="StutteringLemmas-mono_tick_count"><span class="command">lemma</span></span> mono_tick_count<span class="main">:</span>
  <span class="quoted"><span class="quoted">‹mono <span class="main">(</span><span class="main">λ</span> <span class="bound">k</span><span class="main">.</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="bound">k</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> card_prop_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">x</span> <span class="main">≤</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tick_count_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟹</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="bound">x</span> <span class="main">≤</span> tick_count <span class="free">r</span> <span class="free">c</span> <span class="bound">y</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In a dilated run, for any stuttering instant, there is an instant which is the 
  image of an instant in the original run, and which is the latest one before
  the stuttering instant.
›</span></span>
<span class="keyword1" id="StutteringLemmas-greatest_prev_image"><span class="command">lemma</span></span> greatest_prev_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems Suc_leI le_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> Suc <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a strictly monotonous function on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">‹nat›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> increases only by one,
  its argument was increased only by one.
›</span></span>
<span class="keyword1" id="StutteringLemmas-strict_mono_suc"><span class="command">lemma</span></span> strict_mono_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">sn</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn</span> <span class="main">=</span> Suc <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">sn</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> strict_mono_less<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn</span> <span class="main">&gt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn</span> <span class="main">≤</span> Suc <span class="free">n</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn</span> <span class="main">&gt;</span> Suc <span class="free">n</span>›</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">sn</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">sn</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_leI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Two successive non stuttering instants of a dilated run are the images
  of two successive instants of the original run.
›</span></span>
<span class="keyword1" id="StutteringLemmas-next_non_stuttering"><span class="command">lemma</span></span> next_non_stuttering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> smf assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">n</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹Suc <span class="free">n</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">sn<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ** Suc_lessI assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">&lt;</span> Suc <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> smf strict_mono_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> Suc <span class="free">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> smf <span class="keyword1"><span class="command">using</span></span> strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> ** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The order relation between tick counts on clocks is preserved by dilation.
›</span></span>
<span class="keyword1" id="StutteringLemmas-dil_tick_count"><span class="command">lemma</span></span> dil_tick_count<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> run_tick_count <span class="free">sub</span> <span class="free">a</span> <span class="bound">n</span> <span class="main">≤</span> run_tick_count <span class="free">sub</span> <span class="free">b</span> <span class="bound">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">r</span> <span class="free">a</span> <span class="free">n</span> <span class="main">≤</span> run_tick_count <span class="free">r</span> <span class="free">b</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">sub</span> <span class="free">a</span> <span class="main">0</span> <span class="main">≤</span> run_tick_count <span class="free">sub</span> <span class="free">b</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> run_tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">r</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> run_tick_count <span class="free">r</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dilating_def dilating_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n'</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fn0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">a</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹run_tick_count <span class="free">r</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">≤</span> run_tick_count <span class="free">r</span> <span class="free">b</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> run_tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fn0<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> * fn0 ticks_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.IH le_SucI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> * Suc.IH no_tick_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Time does not progress during stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-stutter_no_time"><span class="command">lemma</span></span> stutter_no_time<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>
            <span class="main">⟶</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> bounded_suc_ind<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> m0<span class="main">:</span><span class="quoted"><span class="quoted">‹Suc <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Suc_diff_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> m0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="StutteringLemmas-time_stuttering"><span class="command">lemma</span></span> time_stuttering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span>  stutter_no_time<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The first instant at which a given date is reached on a clock is preserved
  by dilation.
›</span></span>
<span class="keyword1" id="StutteringLemmas-first_time_image"><span class="command">lemma</span></span> first_time_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="free">t</span> <span class="main">=</span> first_time <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">t</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="free">t</span>›</span></span>
  <span class="keyword1"><span class="command">with</span></span> before_first_time<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> time<span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_time_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span>
    <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> time<span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">m</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">m</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> mm0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> hyp <span class="keyword1"><span class="command">have</span></span> m0n<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_mono_less<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mm0 m0n **<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m<span class="hidden">⇩</span><sub>p</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> greatest_prev_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
          mp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">m</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">c</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> time_stuttering<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> hyp mp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dilating_def dilating_fun_def strict_mono_less<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">m<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ** <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alt_first_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">r</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">t</span>›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">n</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_time_def before_first_time<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="free">n</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms dilating_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">k</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dilating_def dilating_fun_def strict_monoD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">sub</span> <span class="free">c</span> <span class="free">n</span> <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alt_first_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The first instant of a dilated run is necessarily the image of the first instant
  of the original run.
›</span></span>
<span class="keyword1" id="StutteringLemmas-first_dilated_instant"><span class="command">lemma</span></span> first_dilated_instant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> strict_monoD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For any instant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of a dilated run, let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be the last 
  instant before <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is the image of an original instant. All instants
  strictly after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n<span class="hidden">⇩</span><sub>0</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and before <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">n</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are stuttering instants.
›</span></span>
<span class="keyword1" id="StutteringLemmas-not_image_stut"><span class="command">lemma</span></span> not_image_stut<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">k</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> fxge<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">x</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_prefix<span class="main">:</span><span class="quoted"><span class="quoted">‹finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_less_ub fxge<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> fxge <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">&gt;</span> <span class="free">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Max.coboundedI<span class="main">[</span><span class="operator">OF</span> finite_prefix<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> strict_mono_less<span class="main">[</span><span class="operator">OF</span> smf<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For any dilating function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹dil_inverse <span class="free"><span class="free">f</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a 
  contracting function.
›</span></span>
<span class="keyword1" id="StutteringLemmas-contracting_inverse"><span class="command">lemma</span></span> contracting_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹contracting <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="free">r</span> <span class="free">sub</span> <span class="free">f</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> smf<span class="main">:</span><span class="quoted"><span class="quoted">‹strict_mono <span class="free">f</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> no_img_tick<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> no_img_time<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fxge<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">x</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> f0n<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">n</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> f0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> finite_prefix<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_less_ub fxge<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prefix_not_empty<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> f0n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹mono <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">‹nat›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">‹nat›</span></span> <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> inc<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hyp Collect_mono le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Max_mono<span class="main">[</span><span class="operator">OF</span> inc prefix_not_empty finite_prefix<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> first_dilated_instant<span class="main">[</span><span class="operator">OF</span> smf f0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> fxge <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> finite_prefix prefix_not_empty<span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> 1 2 3 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹contracting_fun <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contracting_fun_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> prefix_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> dilating_def dilating_fun_def Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">n</span>
                              <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_image_stut<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> no_img_tick <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span> <span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="bound">n</span>
                      <span class="main">⟶</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">k</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">c</span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?τ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> tau<span class="main">:</span><span class="quoted"><span class="quoted">‹time <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="var">?τ</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> gn<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> time_stuttering<span class="main">[</span><span class="operator">OF</span> assms tau<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> not_image_stut<span class="main">[</span><span class="operator">OF</span> assms gn<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">k</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span>Max <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dil_inverse_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> time_stuttering<span class="main">[</span><span class="operator">OF</span> assms tau<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> not_image_stut<span class="main">[</span><span class="operator">OF</span> assms gn<span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> * 4 5 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> contracting_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The only possible contracting function toward a dense run (a run with no empty 
  instants) is the inverse of the dilating function as defined by 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹dil_inverse›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1" id="StutteringLemmas-dense_run_dil_inverse_only"><span class="command">lemma</span></span> dense_run_dil_inverse_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="free">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹contracting <span class="free">g</span> <span class="free">r</span> <span class="free">sub</span> <span class="free">f</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹dense_run <span class="free">sub</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">=</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_less_ub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  dilating_def dilating_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&gt;</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def <span class="keyword1"><span class="command">using</span></span> Max_in<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> kprop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> dense_run_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k</span> <span class="skolem">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> kprop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_monoD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> contracting_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound"><span class="bound">k</span></span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span>
        <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> dil_inverse_def
        <span class="keyword1"><span class="command">using</span></span> Max_gr_iff<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≤</span> <span class="free">g</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≥</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def strict_mono_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> contracting_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leD<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">g</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span>dil_inverse <span class="free">f</span><span class="main">)</span> <span class="bound">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less_iff_gr_or_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Stuttering">
<div class="head">
<h1>Theory Stuttering</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Main Theorems›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Stuttering
<span class="keyword2"><span class="keyword">imports</span></span> <a href="StutteringLemmas.html">StutteringLemmas</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the lemmas of the previous section about the invariance by stuttering
  of various properties of TESL specifications, we can now prove that the atomic 
  formulae that compose TESL specifications are invariant by stuttering.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sporadic specifications are preserved in a dilated run.›</span></span>
<span class="keyword1" id="Stuttering-sporadic_sub"><span class="command">lemma</span></span> sporadic_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c</span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">c'</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c</span> <span class="keyword1">sporadic</span> <span class="free">τ</span> <span class="keyword1">on</span> <span class="free">c'</span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>
           <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">k</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> <span class="free">τ</span> <span class="main">∧</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Implications are preserved in a dilated run.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> implies_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ticks_imp_ticks_subk ticks_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> implies_not_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ticks_imp_ticks_subk ticks_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Precedence relations are preserved in a dilated run.›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> weakly_precedes_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> dil_tick_count<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>run_tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> strictly_precedes_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count_strictly <span class="bound">ρ</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> strictly_precedes_alt_def2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">c<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c<span class="hidden">⇩</span><sub>1</sub></span>›</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">ρ</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="bound">ρ</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>run_tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>run_tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span>
    1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>
     <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">n</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹n is in the image of f›</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fn<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">sn<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹Suc n is in the image of f›</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fsn<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> fn strict_mono_suc * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span>  dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fn fsn tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">― ‹Suc n is not in the image of f›</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_suc<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> fn tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_suc<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
                <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
                <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> fn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">― ‹n is not in the image of f›</span>
          <span class="keyword1"><span class="command">from</span></span> greatest_prev_image<span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span></span>  <span class="keyword2"><span class="keyword">where</span></span>
            np_prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∄</span><span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">k<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> tick_count_latest<span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">.</span></span> 
          <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">sn<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True <span class="comment1">― ‹Suc n is in the image of f›</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fsn<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> next_non_stuttering<span class="main">[</span><span class="operator">OF</span> * np_prop this<span class="main">]</span>  <span class="keyword1"><span class="command">have</span></span> sn_prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">sn<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> fsn a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">― ‹Suc n is not in the image of f›</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_suc<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">...</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> np_prop tick_count_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_latest<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * np_prop<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_suc<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
                <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
                <span class="quoted"><span class="quoted">‹tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹tick_count <span class="free">r</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> tick_count <span class="free">sub</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">n<span class="hidden">⇩</span><sub>p</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> np_prop mono_tick_count  <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> * empty_dilated_prefix ticks_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tick_count_is_fun strictly_precedes_alt_def2<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Time delayed relations are preserved in a dilated run.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> time_delayed_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">a</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">ms</span> <span class="keyword1">implies</span> <span class="free">b</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">a</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="free">δτ</span> <span class="keyword1">on</span> <span class="free">ms</span> <span class="keyword1">implies</span> <span class="free">b</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">a</span><span class="main">)</span>
                          <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> first_time <span class="free">sub</span> <span class="free">ms</span> <span class="bound">m</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span>
                                       <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">m</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> TESL_interpretation_atomic.simps<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">δτ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ms</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="main">≥</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> first_time <span class="free">r</span> <span class="free">ms</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span>
                                  <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>  ›</span></span>
    <span class="keyword1"><span class="command">using</span></span> first_time_image<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> dilating_def * <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">a</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> first_time <span class="free">r</span> <span class="free">ms</span> <span class="bound">m</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span>
                                <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">m</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span><span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">a</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">from</span></span> ticks_image_sub<span class="main">[</span><span class="operator">OF</span> * assm<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> nfn0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> ** assm <span class="keyword1"><span class="command">have</span></span> ft0<span class="main">:</span>
        <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="main">≥</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> first_time <span class="free">r</span> <span class="free">ms</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span>
                    <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="skolem">n</span><span class="main">.</span> first_time <span class="free">r</span> <span class="free">ms</span> <span class="bound">m</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="skolem">n</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span> 
                       <span class="main">⟶</span> hamlet <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">m</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> ›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">n</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹first_time <span class="free">r</span> <span class="free">ms</span> <span class="skolem">m</span> <span class="main">(</span>time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">n</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span> <span class="main">⟶</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">m</span> <span class="free">b</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">m</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ft0 hyp nfn0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_less_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">pm</span><span class="main">.</span> <span class="skolem">m</span> <span class="main">=</span> Suc <span class="bound">pm</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pm</span></span> <span class="keyword2"><span class="keyword">where</span></span> mpm<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">pm</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∄</span><span class="bound">pm<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">pm<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">pm</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∄</span><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">with</span></span> *  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span>Suc <span class="skolem">pm</span><span class="main">)</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">pm</span> <span class="free">ms</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> dilating_def dilating_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">pm</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">m</span> <span class="free">ms</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> mpm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mpm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">pm</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound"><span class="bound">m'</span></span> <span class="main">&lt;</span> <span class="skolem">m</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">m'</span> <span class="free">ms</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">m</span> <span class="free">ms</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>first_time <span class="free">r</span> <span class="free">ms</span> <span class="skolem">m</span> <span class="main">(</span>time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">n</span> <span class="free">ms</span><span class="main">)</span> <span class="main">+</span> <span class="free">δτ</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_time_def<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Time relations are preserved through dilation of a run.›</span></span>
<span class="keyword1" id="Stuttering-tagrel_sub'"><span class="command">lemma</span></span> tagrel_sub'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="free">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> TESL_interpretation_atomic.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">0</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="main">0</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∄</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">n</span> <span class="bound">c</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def dilating_fun_def<span class="main">)</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="hidden">⇩</span><sub>0</sub>prop<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> Suc <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> n<span class="hidden">⇩</span><sub>0</sub>prop * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> n<span class="hidden">⇩</span><sub>0</sub>prop * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="skolem">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dilating_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> tagrel_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> tagrel_sub'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> TESL_interpretation_atomic.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Time relations are also preserved by contraction›</span></span>
<span class="keyword1" id="Stuttering-tagrel_sub_inv"><span class="command">lemma</span></span> tagrel_sub_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">⌋</span> <span class="main">∈</span> <span class="free">R</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> df<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> TESL_interpretation_atomic.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ρ</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="bound">ρ</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dilating_def df <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">c</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span>time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">,</span> time <span class="main">(</span><span class="main">(</span>Rep_run <span class="free">sub</span><span class="main">)</span> <span class="bound">n<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Kill relations are preserved in a dilated run.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> kill_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">kills</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> is_subrun_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">‹dilating <span class="skolem">f</span> <span class="free">sub</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> TESL_interpretation_atomic.simps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">sub</span> <span class="bound">m</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ticks_sub<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">m</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">‹hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="skolem">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">m</span><span class="main">)</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound"><span class="bound">m</span></span><span class="main">≥</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">m</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">f</span> <span class="skolem">n</span>›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="skolem">m</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">m</span>›</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fm0<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≥</span> <span class="skolem">n</span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> * dilating_def dilating_fun_def h strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fm0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> ticks_image_sub'<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">n</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≥</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> hamlet <span class="main">(</span>Rep_run <span class="free">r</span> <span class="bound">m</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ticks_imp_ticks_subk<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TESL_interpretation_atomic.simps<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> atomic_sub_lemmas <span class="main">=</span> sporadic_sub tagrel_sub implies_sub implies_not_sub
                           time_delayed_sub weakly_precedes_sub
                           strictly_precedes_sub kill_sub

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now prove that all atomic specification formulae are preserved
  by the dilation of runs.
›</span></span>
<span class="keyword1" id="Stuttering-atomic_sub"><span class="command">lemma</span></span> atomic_sub<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="free">φ</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> atomic_sub_lemmas<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">φ</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, any TESL specification is invariant by stuttering.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> TESL_stuttering_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">≪</span> <span class="free">r</span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="free">S</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="free">S</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> sa<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">a</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> sb<span class="main">:</span><span class="quoted"><span class="quoted">‹<span class="free">sub</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="skolem">s</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> TESL_interpretation_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> sb<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦⟦</span> <span class="skolem">s</span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> atomic_sub<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sa<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="main">⟦</span> <span class="skolem">a</span> <span class="keyword1">⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span>  TESL_interpretation_image <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Config_Morphisms">
<div class="head">
<h1>Theory Config_Morphisms</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Config_Morphisms
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Hygge_Theory.html">Hygge_Theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  TESL morphisms change the time on clocks, preserving the ticks.
›</span></span>
<span class="keyword1"><span class="command">consts</span></span> morphism <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">::</span>linorder<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>›</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">‹<span class="keyword1">⨂</span>›</span> 100<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Applying a TESL morphism to a tag simply changes its value.
›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> morphism_tagconst <span class="main">≡</span> <span class="quoted"><span class="quoted">‹morphism <span class="main">::</span> <span class="tfree">'τ</span> tag_const <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'τ</span> tag_const›</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
  <span class="keyword1"><span class="command">definition</span></span> morphism_tagconst <span class="main">:</span>  
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="tfree">'τ</span> tag_const<span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">τ<span class="hidden">⇩</span><sub>c</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">(</span>the_tag_const <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> ›</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Applying a TESL morphism to an atomic formula only changes the dates.
›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> morphism_TESL_atomic <span class="main">≡</span> 
            <span class="quoted"><span class="quoted">‹morphism <span class="main">::</span> <span class="tfree">'τ</span> TESL_atomic <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'τ</span> TESL_atomic›</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span> morphism_TESL_atomic <span class="main">:</span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">::</span><span class="tfree">'τ</span> TESL_atomic<span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="keyword1">of</span>
                <span class="main">(</span><span class="bound">C</span> <span class="keyword1">sporadic</span> <span class="bound">t</span> <span class="keyword1">on</span> <span class="bound">C'</span><span class="main">)</span>     <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">sporadic</span> <span class="main">(</span><span class="bound">t</span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="keyword1">on</span> <span class="bound">C'</span><span class="main">)</span> 
              <span class="main">|</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="bound">C</span><span class="main">,</span> <span class="bound">C'</span><span class="main">⌋</span><span class="main">∈</span><span class="bound">R</span><span class="main">)</span><span class="main">⇒</span> <span class="main">(</span><span class="keyword1">time-relation</span> <span class="main">⌊</span><span class="bound">C</span><span class="main">,</span> <span class="bound">C'</span><span class="main">⌋</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span><span class="main">.</span> <span class="bound">R</span><span class="main">(</span><span class="bound">t</span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="bound">t'</span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">implies</span> <span class="bound">C'</span><span class="main">)</span>           <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">implies</span> <span class="bound">C'</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="bound">C'</span><span class="main">)</span>       <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">implies</span> <span class="keyword1">not</span> <span class="bound">C'</span><span class="main">)</span>       
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="bound">t</span> <span class="keyword1">on</span> <span class="bound">C'</span> <span class="keyword1">implies</span> <span class="bound">C''</span><span class="main">)</span> 
                                         <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">time-delayed</span> <span class="keyword1">by</span> <span class="bound">t</span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">on</span> <span class="bound">C'</span> <span class="keyword1">implies</span> <span class="bound">C''</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="bound">C'</span><span class="main">)</span>   <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">weakly</span> <span class="keyword1">precedes</span> <span class="bound">C'</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="bound">C'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">strictly</span> <span class="keyword1">precedes</span> <span class="bound">C'</span><span class="main">)</span> 
              <span class="main">|</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">kills</span> <span class="bound">C'</span><span class="main">)</span>             <span class="main">⇒</span> <span class="main">(</span><span class="bound">C</span> <span class="keyword1">kills</span> <span class="bound">C'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Applying a TESL morphism to a formula amounts to apply it to each atomic formula.
›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> morphism_TESL_formula <span class="main">≡</span> 
            <span class="quoted"><span class="quoted">‹morphism <span class="main">::</span> <span class="tfree">'τ</span> TESL_formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'τ</span> TESL_formula›</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">definition</span></span>  morphism_TESL_formula <span class="main">:</span> 
           <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">::</span><span class="tfree">'τ</span> TESL_formula<span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linorder <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⨂</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span>›</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Applying a TESL morphism to a configuration amounts to apply it to the 
  present and future formulae. The past (in the context <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Γ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) is not changed.
›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> morphism_TESL_config <span class="main">≡</span> 
            <span class="quoted"><span class="quoted">‹morphism <span class="main">::</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span> <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'τ</span> config›</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span> 
<span class="keyword1"><span class="command">fun</span></span>  <span class="entity">morphism_TESL_config</span> 
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> config<span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'τ</span> <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Γ</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⊢</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Ψ</span></span></span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">▹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Φ</span></span></span><span class="main">⨂</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>›</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A TESL formula is called consistent if it possesses Kripke-models 
  in its denotational interpretation.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> TESL_formula <span class="main">⇒</span> bool›</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">‹<span class="free">consistent</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="main">≡</span> <span class="main">⟦⟦</span> <span class="free"><span class="bound"><span class="entity">Ψ</span></span></span> <span class="keyword1">⟧⟧<span class="hidden">⇩</span><sub>T</sub><span class="hidden">⇩</span><sub>E</sub><span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>L</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If we can derive a consistent finite context from a TESL formula, the formula is consistent. 
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> consistency_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> start             <span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>  <span class="main">↪<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> init_invariant    <span class="main">:</span> <span class="quoted"><span class="quoted">‹consistent_context <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">Ψ</span>›</span></span>    
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span> ↪<span class="hidden">⇗</span><sup><span class="bound">n</span></sup><span class="hidden">⇖</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="main">[]</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtranclp_imp_relpowp start<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_context_def consistent_def
  <span class="keyword1"><span class="command">using</span></span> * consistent_context_def init_invariant soundness <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Snippets on runs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A run with no ticks and constant time for all clocks.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">const_nontick_run</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>clock <span class="main">⇒</span> <span class="tfree">'τ</span> tag_const<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run ›</span></span> <span class="main">(</span><span class="quoted">‹<span class="keyword1">□</span>_›</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">□</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>  Abs_run<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span>False<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Ensure a clock ticks in a run at a given instant.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_tick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> nat <span class="main">⇒</span> clock <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">)</span> run›</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">‹<span class="free">set_tick</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Abs_run<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span>  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="bound">n</span> 
                                           <span class="keyword1">then</span> <span class="main">(</span>True <span class="main">,</span> time<span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="keyword1">else</span> Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">c</span><span class="main">)</span> ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Ensure a clock does not tick in a run at a given instant.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unset_tick</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> nat <span class="main">⇒</span> clock <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'τ</span><span class="main">)</span> run›</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">‹<span class="free">unset_tick</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> Abs_run<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span>  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="bound">n</span> 
                                           <span class="keyword1">then</span> <span class="main">(</span>False <span class="main">,</span> time<span class="main">(</span>Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="keyword1">else</span> Rep_run <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">c</span><span class="main">)</span> ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Replace all instants after k in a run with the instants from another run.
  Warning: the result may not be a proper run since time may not be monotonous
  from instant k to instant k+1.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">patch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="tfree">'τ</span><span class="main">::</span>linordered_field<span class="main">)</span> run <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'τ</span> run <span class="main">⇒</span> <span class="tfree">'τ</span> run›</span></span> <span class="main">(</span><span class="quoted">‹_ <span class="keyword1">≫⇗</span>_<span class="keyword1">⇖</span> _›</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">‹<span class="free"><span class="bound"><span class="entity">r</span></span></span> ≫<span class="hidden">⇗</span><sup><span class="free"><span class="bound"><span class="entity">k</span></span></span></sup><span class="hidden">⇖</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="main">≡</span> Abs_run<span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">c</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">then</span> Rep_run <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span> <span class="keyword1">else</span>  Rep_run <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span> <span class="bound">n</span> <span class="bound">c</span><span class="main">)</span>›</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For some infinite cases, the idea for a proof scheme looks as follows: if we can derive
  from the initial configuration <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="main"><span class="main">[]</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">Ψ</span></span> <span class="main"><span class="main">▹</span></span> <span class="main"><span class="main">[]</span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> a start-point of a lasso
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and if we can traverse the lasso one time 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">↪<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">⊢</span></span> <span class="free"><span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">▹</span></span> <span class="free"><span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span></span><span class="main"><span class="main">)</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to isomorphic one, 
  we can always always make a derivation along the lasso. If the entry point of the lasso had traces 
  with prefixes consistent to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then there exist traces consisting of this prefix and 
  repetitions of the delta-prefix of the lasso which are consistent with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which implies
  the logical consistency of  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Ψ</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  
  So far the idea. Remains to prove it. Why does one symbolic run along a lasso generalises to 
  arbitrary runs ? 
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> consistency_coinduct <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> start             <span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">0</span> <span class="main">⊢</span> <span class="free">Ψ</span> <span class="main">▹</span> <span class="main">[]</span><span class="main">)</span>   <span class="main">↪<span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> loop              <span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">↪<span class="hidden">⇧</span><sup>+</sup><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> init_invariant    <span class="main">:</span> <span class="quoted"><span class="quoted">‹consistent_context <span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> post_invariant    <span class="main">:</span> <span class="quoted"><span class="quoted">‹consistent_context <span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> retract_condition <span class="main">:</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⨂</span> <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'τ</span> <span class="main">⇒</span> <span class="tfree">'τ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Γ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊢</span> <span class="free">Ψ<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">▹</span> <span class="free">Φ<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> ›</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="main">(</span><span class="free">Ψ</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'τ</span> <span class="main">::</span> linordered_field<span class="main">)</span>TESL_formula<span class="main">)</span>›</span></span>    
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>