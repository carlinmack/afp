<div id="Szpilrajn">
<div class="head">
<h1>Theory Szpilrajn</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Szpilrajn 
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We formalize a more general version of Szpilrajn's extension theorem~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Szpilrajn:1930"<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  employing the terminology of Bossert and Suzumura~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Bossert:2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. We also formalize 
  Theorem 2.7 of their book. Our extension theorem states that any preorder can be extended to a
  total preorder while maintaining its structure. The proof of the extension theorem follows the
  proof presented in the Wikipedia article~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Wiki<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Symmetric and asymmetric factor of a relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  According to Bossert and Suzumura, every relation can be partitioned into its symmetric
  and asymmetric factor. The symmetric factor of a relation <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span></span></span> contains all pairs
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">r</span></span>›</span></span></span></span> where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">r</span></span>›</span></span></span></span>. Conversely, the asymmetric factor contains all pairs
   where this is not the case. In terms of an order <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(≤)</span></span>›</span></span></span></span>, the asymmetric factor contains all
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">|</span></span><span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">≤</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">}</span></span>›</span></span></span></span> where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="free"><span class="free">y</span></span>›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sym_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sym_factor</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Szpilrajn-sym_factor_def'"><span class="command">lemma</span></span> sym_factor_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="free">r</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∩</span> <span class="free">r</span><span class="main">¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">asym_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">asym_factor</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span> <span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the symmetric factor›</span></span>

<span class="keyword1" id="Szpilrajn-sym_factorI"><span class="command">lemma</span></span> sym_factorI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-sym_factorE"><span class="command">lemma</span></span> sym_factorE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> sym_factor_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-sym_sym_factor"><span class="command">lemma</span></span> sym_sym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> symI<span class="main">)</span> 

<span class="keyword1" id="Szpilrajn-trans_sym_factor"><span class="command">lemma</span></span> trans_sym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span> <span class="main">⟹</span> trans <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def' <span class="keyword1"><span class="command">using</span></span> trans_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Szpilrajn-refl_on_sym_factor"><span class="command">lemma</span></span> refl_on_sym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> refl_on <span class="free">A</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> refl_onI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> refl_onD refl_onD1<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-sym_factor_absorb_if_sym"><span class="command">lemma</span></span> sym_factor_absorb_if_sym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">r</span> <span class="main">⟹</span> sym_factor <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def'
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-sym_factor_idem"><span class="command">lemma</span></span> sym_factor_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span> <span class="main">=</span> sym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sym_factor_absorb_if_sym<span class="main">[</span><span class="operator">OF</span> sym_sym_factor<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Szpilrajn-sym_factor_reflc"><span class="command">lemma</span></span> sym_factor_reflc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Szpilrajn-sym_factor_Restr"><span class="command">lemma</span></span> sym_factor_Restr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Restr <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In contrast to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹asym_factor›</span></span></span></span>, the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹sym_factor›</span></span></span></span> is monotone.
›</span></span>
<span class="keyword1" id="Szpilrajn-sym_factor_mono"><span class="command">lemma</span></span> sym_factor_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">s</span> <span class="main">⟹</span> sym_factor <span class="free">r</span> <span class="main">⊆</span> sym_factor <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the asymmetric factor›</span></span>

<span class="keyword1" id="Szpilrajn-asym_factorI"><span class="command">lemma</span></span> asym_factorI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> asym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-asym_factorE"><span class="command">lemma</span></span> asym_factorE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> asym_factor <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-refl_not_in_asym_factor"><span class="command">lemma</span></span> refl_not_in_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-irrefl_asym_factor"><span class="command">lemma</span></span> irrefl_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def irrefl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Szpilrajn-asym_asym_factor"><span class="command">lemma</span></span> asym_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asym <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irrefl_asym_factor
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> asymI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> asym_factor_def<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-trans_asym_factor"><span class="command">lemma</span></span> trans_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span> <span class="main">⟹</span> trans <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="Szpilrajn-asym_if_irrefl_trans"><span class="command">lemma</span></span> asym_if_irrefl_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> asym <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irrefl_def trans_def<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-antisym_if_irrefl_trans"><span class="command">lemma</span></span> antisym_if_irrefl_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> antisym <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> antisym_def asym.cases asym_if_irrefl_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Szpilrajn-asym_factor_asym_rel"><span class="command">lemma</span></span> asym_factor_asym_rel<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asym <span class="free">r</span> <span class="main">⟹</span> asym_factor <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> asym.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Szpilrajn-irrefl_trans_asym_factor_id"><span class="command">lemma</span></span> irrefl_trans_asym_factor_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> asym_factor <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> asym_factor_asym_rel<span class="main">[</span><span class="operator">OF</span> asym_if_irrefl_trans<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Szpilrajn-asym_factor_id"><span class="command">lemma</span></span> asym_factor_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asym_factor <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span> <span class="main">=</span> asym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> asym_factor_asym_rel<span class="main">[</span><span class="operator">OF</span> asym_asym_factor<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Szpilrajn-asym_factor_rtrancl"><span class="command">lemma</span></span> asym_factor_rtrancl<span class="main">:</span> <span class="quoted"><span class="quoted">"asym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">=</span> asym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_eq_or_trancl<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-asym_factor_Restr"><span class="command">lemma</span></span> asym_factor_Restr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"asym_factor <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> Restr <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-acyclic_asym_factor"><span class="command">lemma</span></span> acyclic_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"acyclic <span class="free">r</span> <span class="main">⟹</span> acyclic <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> acyclic_subset<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relations between symmetric and asymmetric factor›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We prove that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹sym_factor›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹asym_factor›</span></span></span></span> partition the input relation.
›</span></span>
<span class="keyword1" id="Szpilrajn-sym_asym_factor_Un"><span class="command">lemma</span></span> sym_asym_factor_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="free">r</span> <span class="main">∪</span> asym_factor <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-disjnt_sym_asym_factor"><span class="command">lemma</span></span> disjnt_sym_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"disjnt <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span> <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> disjnt_def
  <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-Field_sym_asym_factor_Un"><span class="command">lemma</span></span> Field_sym_asym_factor_Un<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Field <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span> <span class="main">∪</span> Field <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span> <span class="main">=</span> Field <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sym_asym_factor_Un Field_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Szpilrajn-asym_factor_tranclE"><span class="command">lemma</span></span> asym_factor_tranclE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sym_asym_factor_Un
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI subsetI trancl_mono<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extension of Orders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We use the definition of Bossert and Suzumura for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>extends›</span></span></span></span>. The requirement <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">R</span></span>›</span></span></span></span> is
  obvious. The second requirement <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹asym_factor <span class="free"><span class="free">r</span></span> <span class="main"><span class="main">⊆</span></span> asym_factor <span class="free"><span class="free">R</span></span>›</span></span></span></span> enforces that the 
  extension <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">R</span></span>›</span></span></span></span> maintains all strict preferences of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span></span></span> (viewing <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span>›</span></span></span></span> as a 
  preference relation).
›</span></span>
                    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">extends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">extends</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> asym_factor <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⊆</span> asym_factor <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a stronger notion of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹extends›</span></span></span></span> where we also demand that
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹sym_factor <span class="free"><span class="free">R</span></span> <span class="main"><span class="main">⊆</span></span> <span class="main"><span class="main">(</span></span>sym_factor <span class="free"><span class="free">r</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>=</sup></span></span>›</span></span></span></span>. This enforces that the extension does not introduce
  preference cycles between previously unrelated pairs <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">R</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">r</span></span>›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_extends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_extends</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> extends <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> sym_factor <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>

<span class="keyword1" id="Szpilrajn-extendsI"><span class="command">lemma</span></span> extendsI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="free">R</span> <span class="main">⟹</span> extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> extends_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-extendsE"><span class="command">lemma</span></span> extendsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-trancl_subs_extends_if_trans"><span class="command">lemma</span></span> trancl_subs_extends_if_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"extends <span class="free">r_ext</span> <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r_ext</span> <span class="main">⟹</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊆</span> <span class="free">r_ext</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> extends_def asym_factor_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subrelI trancl_id trancl_mono<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-extends_if_strict_extends"><span class="command">lemma</span></span> extends_if_strict_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="free">ext</span> <span class="main">⟹</span> extends <span class="free">r_ext</span> <span class="free">ext</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-strict_extendsI"><span class="command">lemma</span></span> strict_extendsI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="free">R</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI extendsI<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-strict_extendsE"><span class="command">lemma</span></span> strict_extendsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="free">R</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms extendsE <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-strict_extends_antisym_Restr"><span class="command">lemma</span></span> strict_extends_antisym_Restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"antisym <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"antisym <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="main">∪</span> Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> antisymI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="main">∪</span> Restr <span class="free">r</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="main">∪</span> Restr <span class="free">r</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹strict_extends <span class="free">R</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> strict_extendsE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> strict_extendsE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹antisym <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">-</span> <span class="free">r</span> <span class="main">∪</span> Restr <span class="free">r</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> antisymD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we prove that we have no preference cycles between previously unrelated pairs.›</span></span>
<span class="keyword1" id="Szpilrajn-antisym_Diff_if_strict_extends"><span class="command">lemma</span></span> antisym_Diff_if_strict_extends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"antisym <span class="main">(</span><span class="free">R</span> <span class="main">-</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> strict_extends_antisym_Restr<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Szpilrajn-strict_extends_antisym"><span class="command">lemma</span></span> strict_extends_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">R</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"antisym <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"antisym <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms strict_extends_antisym_Restr<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?A</span><span class="main"><span class="main">=</span></span><span class="quoted">UNIV</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> strict_extendsE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> antisym_def<span class="main">)</span> 

<span class="keyword1" id="Szpilrajn-strict_extends_if_strict_extends_reflc"><span class="command">lemma</span></span> strict_extends_if_strict_extends_reflc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strict_extendsI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> strict_extendsE<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">⊆</span> <span class="free">r_ext</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="free">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> asym_factor_def sym_factor_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="free">r_ext</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_factor_def strict_extends_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Szpilrajn-strict_extends_diff_Id"><span class="command">lemma</span></span> strict_extends_diff_Id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="free">r_ext</span> <span class="main">-</span> Id<span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strict_extendsI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="free">r_ext</span> <span class="main">-</span> Id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> strict_extendsE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irrefl_def<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> antisym_r <span class="main">=</span> antisym_if_irrefl_trans<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">with</span></span> assms strict_extends_if_strict_extends_reflc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="main">(</span><span class="free">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> strict_extends_antisym<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> antisymD<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> strict_extendsE transE<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms antisym_r <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="free">r_ext</span> <span class="main">-</span> Id<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> strict_extends_antisym<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> antisymD<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Both <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹extends›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_extends›</span></span></span></span> form a partial order since they
  are reflexive, transitive, and antisymmetric.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
    reflp_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"reflp extends"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    transp_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"transp extends"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    antisymp_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymp extends"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> extends_def reflp_def transp_def antisymp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">shows</span></span>
    reflp_strict_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"reflp strict_extends"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    transp_strict_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"transp strict_extends"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    antisymp_strict_extends<span class="main">:</span> <span class="quoted"><span class="quoted">"antisymp strict_extends"</span></span>
  <span class="keyword1"><span class="command">using</span></span> reflp_extends transp_extends antisymp_extends
  <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def reflp_def transp_def antisymp_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Missing order definitions›</span></span>

<span class="keyword1" id="Szpilrajn-preorder_onD"><span class="command">lemma</span></span> preorder_onD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Szpilrajn-preorder_onI"><span class="command">lemma</span></span> preorder_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> preorder_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">preorder</span> <span class="main">≡</span> preorder_on UNIV"</span></span>

<span class="keyword1" id="Szpilrajn-preorder_rtrancl"><span class="command">lemma</span></span> preorder_rtrancl<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> preorder_onI refl_rtrancl trans_rtrancl<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">total_preorder_on</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> preorder_on <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> total_on <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">total_preorder</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> total_preorder_on UNIV <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1" id="Szpilrajn-total_preorder_onI"><span class="command">lemma</span></span> total_preorder_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> total_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> total_preorder_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> total_preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI preorder_onI<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-total_preorder_onD"><span class="command">lemma</span></span> total_preorder_onD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> total_preorder_on_def preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">strict_partial_order</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> trans <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> irrefl <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1" id="Szpilrajn-strict_partial_orderI"><span class="command">lemma</span></span> strict_partial_orderI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"trans <span class="free">r</span> <span class="main">⟹</span> irrefl <span class="free">r</span> <span class="main">⟹</span> strict_partial_order <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strict_partial_order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-strict_partial_orderD"><span class="command">lemma</span></span> strict_partial_orderD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_partial_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> strict_partial_order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Szpilrajn-strict_partial_order_acyclic"><span class="command">lemma</span></span> strict_partial_order_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_partial_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acyclic_irrefl assms strict_partial_order_def trancl_id<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">partial_order</span> <span class="main">≡</span> partial_order_on UNIV"</span></span>

<span class="keyword1" id="Szpilrajn-partial_order_onI"><span class="command">lemma</span></span> partial_order_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> antisym <span class="free">r</span> <span class="main">⟹</span> partial_order_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> partial_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-linear_order_onI"><span class="command">lemma</span></span> linear_order_onI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> trans <span class="free">r</span> <span class="main">⟹</span> antisym <span class="free">r</span> <span class="main">⟹</span> total_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> linear_order_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> linear_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-linear_order_onD"><span class="command">lemma</span></span> linear_order_onD<span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"linear_order_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"antisym <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> linear_order_on_def<span class="main">]</span> partial_order_onD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A typical example is <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(⊂)</span></span>›</span></span></span></span> on sets:›</span></span>

<span class="keyword1" id="Szpilrajn-strict_partial_order_subset"><span class="command">lemma</span></span> strict_partial_order_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strict_partial_order <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊂</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊂</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊂</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irrefl_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We already have a definition of a strict linear order in <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_linear_order›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Extending preorders to total preorders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We start by proving that a preorder with two incomparable elements <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">x</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">y</span></span>›</span></span></span></span> can be
  strictly extended to a preorder where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="free"><span class="free">y</span></span>›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Szpilrajn-can_extend_preorder"><span class="command">lemma</span></span> can_extend_preorder<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> preorder_onD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹preorder_on <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">r</span></span>›</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">×</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> refl_on_domain <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">A</span> <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> preorder_onI refl_onI trans_trancl<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trancl_subset_Sigma <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> r_into_trancl' <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> refl_onD<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strict_extendsI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> preorder_onD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹preorder_on <span class="free">A</span> <span class="free">r</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">r</span> <span class="main">⊆</span> asym_factor <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def trancl_insert
       <span class="keyword1"><span class="command">using</span></span> rtranclD rtrancl_into_trancl1 r_r_into_trancl
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

     <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def trancl_insert
       <span class="keyword1"><span class="command">using</span></span> refl_onD rtranclD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹trans <span class="free">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="main">(</span>insert <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> trancl_insert sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With this, we can start the proof of our main extension theorem.
  For this we will use a variant of Zorns Lemma, which only considers nonempty chains:
›</span></span>
<span class="keyword1" id="Szpilrajn-Zorns_po_lemma_nonempty"><span class="command">lemma</span></span> Zorns_po_lemma_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> po<span class="main">:</span> <span class="quoted"><span class="quoted">"Partial_order <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">C</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">C</span> <span class="main">∈</span> Chains <span class="free">r</span><span class="main">;</span> <span class="bound">C</span><span class="main">≠</span><span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>Field <span class="free">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">∈</span>Field <span class="free">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>Field <span class="free">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Field <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> FieldI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Zorns_po_lemma <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> strict_extends_preorder_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="free">base_r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> total_preorder_on <span class="free">A</span> <span class="bound">r</span> <span class="main">∧</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We define an order on the set of strict extensions of the base relation <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">base_r</span></span>›</span></span></span></span>, 
    where <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">r</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">s</span></span>›</span></span></span></span> iff <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_extends <span class="free"><span class="free">r</span></span> <span class="free"><span class="free">base_r</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_extends <span class="free"><span class="free">s</span></span> <span class="free"><span class="free">r</span></span>›</span></span></span></span>:
  ›</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">order_of_orders</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> rel<span class="main">)</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">order_of_orders</span> <span class="main">=</span>
    Restr <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span> <span class="main">∧</span> strict_extends <span class="bound">s</span> <span class="bound">r</span><span class="main">}</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> preorder_on <span class="free">A</span> <span class="bound">r</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We show that this order consists of those relations that are preorders and that strictly extend
    the base relation <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">base_r</span></span>›</span></span></span></span>
  ›</span></span>

  <span class="keyword1"><span class="command">have</span></span> Field_order_of_orders<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="skolem">order_of_orders</span> <span class="main">=</span>
    <span class="main">{</span><span class="bound">r</span><span class="main">.</span> preorder_on <span class="free">A</span> <span class="bound">r</span> <span class="main">∧</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transp_strict_extends
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">r</span> <span class="free">base_r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> reflp_strict_extends <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span> <span class="main">∧</span> strict_extends <span class="bound">s</span> <span class="bound">r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> reflpE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹preorder_on <span class="free">A</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> order_of_orders_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Field_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_of_orders_def Field_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> transpE<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now show that this set has a maximum and that any maximum of this set is a total preorder
    and as thus is one of the extensions we are looking for.
    We begin by showing the existence of a maximal element using Zorn's lemma.
  ›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span><span class="main">.</span>
      <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Zorns_po_lemma_nonempty<span class="main">)</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Zorn's Lemma requires us to prove that our <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">order_of_orders</span></span>›</span></span></span></span> is a nonempty partial order
      and that every nonempty chain has an upper bound. 
      The partial order property is trivial, since we used <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_extends›</span></span></span></span> for the relation, 
      which is a partial order as shown above.
    ›</span></span>

    <span class="keyword1"><span class="command">from</span></span> reflp_strict_extends transp_strict_extends
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Refl <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span> <span class="main">∧</span> strict_extends <span class="bound">s</span> <span class="bound">r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def Field_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> transpE reflpE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span> <span class="main">∧</span> strict_extends <span class="bound">s</span> <span class="bound">r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> transp_strict_extends  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> transpE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"antisym <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> strict_extends <span class="bound">r</span> <span class="free">base_r</span> <span class="main">∧</span> strict_extends <span class="bound">s</span> <span class="bound">r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> antisymp_strict_extends <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> antisympD <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> antisymI<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Partial_order <span class="skolem">order_of_orders</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> order_of_orders_def order_on_defs
      <span class="keyword1"><span class="command">using</span></span> Field_order_of_orders Refl_Restr trans_Restr antisym_Restr
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Also, our order is obviously not empty since it contains <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">base_r</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">base_r</span></span><span class="main"><span class="main">)</span></span>›</span></span></span></span>:›</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">base_r</span><span class="main">,</span> <span class="free">base_r</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> order_of_orders_def
      <span class="keyword1"><span class="command">using</span></span> assms reflp_strict_extends <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> reflpD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">order_of_orders</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
      Next we show that each chain has an upper bound.
      For the upper bound we take the union of all relations in the chain.
    ›</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span>"</span></span> 
      <span class="keyword2"><span class="keyword">if</span></span> C_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> Chains <span class="skolem">order_of_orders</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">⋃</span></span><span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        Obviously each element in the chain is a strict extension of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">base_r</span></span>›</span></span></span></span> by definition
        and as such it is also a preorder.
      ›</span></span>

      <span class="keyword1"><span class="command">have</span></span> preorder_r<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> extends_r<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">r</span> <span class="free">base_r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span>
        <span class="keyword1"><span class="command">using</span></span> that C_def<span class="main">[</span><span class="operator">unfolded</span> order_of_orders_def Chains_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        Because a chain is partially ordered, the union of the chain is reflexive and transitive.
      ›</span></span>

      <span class="keyword1"><span class="command">have</span></span> total_subs_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">⊆</span> <span class="skolem">s</span> <span class="main">∨</span> <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
        <span class="keyword1"><span class="command">using</span></span> C_def that
        <span class="keyword1"><span class="command">unfolding</span></span> Chains_def order_of_orders_def strict_extends_def extends_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> preorder_UnC<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> preorder_onI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">A</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> preorder_onD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> preorder_r<span class="main">]</span> C_nonempty
          <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> total_subs_C <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_subset_trans_Union<span class="main">[</span><span class="operator">unfolded</span> chain_subset_def<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> preorder_onD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> preorder_r<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋃</span></span><span class="skolem"><span class="skolem">C</span></span>›</span></span></span></span> strictly extends the base relation.›</span></span>
    
      <span class="keyword1"><span class="command">have</span></span> strict_extends_UnC<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="free">base_r</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strict_extendsI<span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> extends_r_unfolded <span class="main">=</span> extends_r<span class="main">[</span><span class="operator">unfolded</span> extends_def strict_extends_def<span class="main">]</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">base_r</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> C_nonempty extends_r_unfolded
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">base_r</span> <span class="main">⊆</span> asym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> extends_r_unfolded
          <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="free">base_r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> sym_factor <span class="free">base_r</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">C</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

          <span class="keyword1"><span class="command">with</span></span> extends_r <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">c</span>"</span></span>
            <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">c</span> <span class="free">base_r</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> total_subs_C <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="skolem">c</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> sym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹strict_extends <span class="skolem">c</span> <span class="free">base_r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> sym_factor <span class="free">base_r</span>›</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> preorder_UnC strict_extends_UnC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Field_order_of_orders <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        Lastly, we prove by contradiction that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋃</span></span><span class="skolem"><span class="skolem">C</span></span>›</span></span></span></span> is an upper bound for the chain.
      ›</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">presume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">order_of_orders</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span><span class="main">,</span> <span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">order_of_orders</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">hence</span></span> strict_extends_m<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">m</span> <span class="free">base_r</span>"</span></span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> extends_r preorder_r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict_extends <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> preorder_UnC <span class="keyword1"><span class="command">unfolding</span></span> order_of_orders_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="skolem">C</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>sym_factor <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="main">(</span><span class="main">⋃</span> <span class="skolem">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> sym_factor <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> sym_factor <span class="free">base_r</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Id"</span></span>
            <span class="keyword1"><span class="command">using</span></span> strict_extends_UnC<span class="main">[</span><span class="operator">unfolded</span> strict_extends_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> sym_factor <span class="skolem">m</span>›</span></span> strict_extends_m<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> strict_extendsE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_factor_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> in_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> asym_factor <span class="skolem">m</span> <span class="main">⊆</span> asym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> strict_extends <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> asym_factor <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="main">(</span><span class="main">⋃</span><span class="skolem">C</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> extends <span class="skolem">m</span> <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> extends <span class="skolem">w</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">w</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="skolem">w</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> asym_factor <span class="skolem">m</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> extends <span class="skolem">w</span> <span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> extends_def<span class="main">)</span>

        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> C_def<span class="main">[</span><span class="operator">unfolded</span> Chains_def order_of_orders_def strict_extends_def<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let our maximal element be named <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹max›</span></span></span></span>:›</span></span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">max</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> max_field<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">max</span> <span class="main">∈</span> Field <span class="skolem">order_of_orders</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> is_max<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>Field <span class="skolem">order_of_orders</span><span class="main">.</span> <span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> max_field <span class="keyword1"><span class="command">have</span></span> max_extends_base<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="skolem">max</span>"</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">max</span> <span class="free">base_r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Field_order_of_orders <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We still have to show, that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">max</span></span>›</span></span></span></span> is a strict linear order,
    meaning that it is also a total order:
  ›</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">A</span> <span class="skolem">max</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">max</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        Assume that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">max</span></span>›</span></span></span></span> is not total, and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">x</span></span>›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">y</span></span>›</span></span></span></span> are incomparable.
        Then we can extend <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">max</span></span>›</span></span></span></span> by setting $x &lt; y$:
      ›</span></span>

      <span class="keyword3"><span class="command">presume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">max</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">max</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?max'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">max</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>

      <span class="keyword1"><span class="command">note</span></span> max'_extends_max <span class="main">=</span> can_extend_preorder<span class="main">[</span><span class="operator">OF</span>
          <span class="quoted"><span class="quoted"><span class="quoted">‹preorder_on <span class="free"><span class="free">A</span></span> <span class="skolem"><span class="skolem">max</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">y</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">A</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">A</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">y</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∉</span></span> <span class="skolem"><span class="skolem">max</span></span>›</span></span></span><span class="main">]</span>

      <span class="keyword1"><span class="command">hence</span></span> max'_extends_base<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="var">?max'</span> <span class="free">base_r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strict_extends <span class="skolem">max</span> <span class="free">base_r</span>›</span></span> transp_strict_extends <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> transpE<span class="main">)</span>


      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The extended relation is greater than <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">max</span></span>›</span></span></span></span>, which is a contradiction.›</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">max</span><span class="main">,</span> <span class="var">?max'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">order_of_orders</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> max'_extends_base max'_extends_max max_extends_base
        <span class="keyword1"><span class="command">unfolding</span></span> order_of_orders_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> FieldI2 <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">max</span>›</span></span> is_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹preorder_on <span class="free">A</span> <span class="skolem">max</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">A</span> <span class="skolem">max</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> total_preorder_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹strict_extends <span class="skolem">max</span> <span class="free">base_r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With this extension theorem, we can easily prove Szpilrajn's theorem and its equivalent for
  partial orders.
›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> partial_order_extension<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"partial_order_on <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r_ext</span><span class="main">.</span> linear_order_on <span class="free">A</span> <span class="bound">r_ext</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">⊆</span> <span class="bound">r_ext</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms strict_extends_preorder_on <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r_ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_ext<span class="main">:</span>
    <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">A</span> <span class="skolem">r_ext</span>"</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">r_ext</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partial_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"antisym <span class="skolem">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> partial_order_on_def <span class="keyword1"><span class="command">using</span></span> strict_extends_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">with</span></span> assms r_ext <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"linear_order_on <span class="free">A</span> <span class="skolem">r_ext</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">⊆</span> <span class="skolem">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> total_preorder_on_def order_on_defs strict_extends_def extends_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Szpilrajn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_partial_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r_ext</span><span class="main">.</span> strict_linear_order <span class="bound">r_ext</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">⊆</span> <span class="bound">r_ext</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"partial_order <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> antisym_if_irrefl_trans strict_partial_order_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> partial_order_extension<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r_ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"linear_order <span class="skolem">r_ext</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="skolem">r_ext</span> <span class="main">-</span> Id"</span></span> <span class="quoted"><span class="quoted">"strict_linear_order <span class="main">(</span><span class="skolem">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irrefl_def strict_linear_order_on_diff_Id <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> strict_partial_orderD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Consistency›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As a weakening of transitivity, Suzumura introduces the notion of consistency which rules out
  all preference cycles that contain at least one strict preference.
  Consistency characterises those order relations which can be extended (in terms of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹extends›</span></span></span></span>)
  to a total order relation. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">consistent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">consistent</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Szpilrajn-consistentI"><span class="command">lemma</span></span> consistentI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> consistent <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-consistent_if_preorder_on"><span class="command">lemma</span></span> consistent_if_preorder_on<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"preorder_on <span class="free">A</span> <span class="free">r</span> <span class="main">⟹</span> consistent <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def consistent_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Szpilrajn-consistent_asym_factor"><span class="command">lemma</span></span> consistent_asym_factor<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span> <span class="main">⟹</span> consistent <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def
  <span class="keyword1"><span class="command">using</span></span> asym_factor_tranclE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Szpilrajn-acyclic_asym_factor_if_consistent"><span class="command">lemma</span></span> acyclic_asym_factor_if_consistent<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span> <span class="main">⟹</span> acyclic <span class="main">(</span>asym_factor <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def acyclic_def
  <span class="keyword1"><span class="command">using</span></span> asym_factor_tranclE <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> case_prodD trancl.simps<span class="main">)</span>

<span class="keyword1" id="Szpilrajn-consistent_Restr"><span class="command">lemma</span></span> consistent_Restr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span> <span class="main">⟹</span> consistent <span class="main">(</span>Restr <span class="free">r</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> consistent_def asym_factor_def
  <span class="keyword1"><span class="command">using</span></span> trancl_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This corresponds to Theorem 2.2~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Bossert:2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> trans_if_refl_total_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"refl <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹total <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> total_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> refl_onD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹refl <span class="free">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Szpilrajn-order_extension_if_consistent"><span class="command">lemma</span></span> order_extension_if_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r_ext</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"extends <span class="free">r_ext</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_preorder <span class="free">r_ext</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> extends<span class="main">:</span> <span class="quoted"><span class="quoted">"extends <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> extends_def consistent_def asym_factor_def
    <span class="keyword1"><span class="command">using</span></span> rtranclD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Field_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> preorder<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def <span class="keyword1"><span class="command">using</span></span> refl_on_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">from</span></span> strict_extends_preorder_on<span class="main">[</span><span class="operator">OF</span> preorder<span class="main">]</span> extends <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r_ext</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"total_preorder <span class="skolem">r_ext</span>"</span></span> <span class="quoted"><span class="quoted">"extends <span class="skolem">r_ext</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpE<span class="main">[</span><span class="operator">OF</span> transp_extends<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Szpilrajn-consistent_if_extends_trans"><span class="command">lemma</span></span> consistent_if_extends_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"extends <span class="free">r_ext</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r_ext</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> consistentI<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> asym_factor <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> trancl_subs_extends_if_trans<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">r_ext</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> extends_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With Theorem 2.6~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Bossert:2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we show that <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹consistent›</span></span></span></span> characterises the existence
  of order extensions.
›</span></span>
<span class="keyword1"><span class="command">corollary</span></span> order_extension_iff_consistent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r_ext</span><span class="main">.</span> extends <span class="bound">r_ext</span> <span class="free">r</span> <span class="main">∧</span> total_preorder <span class="bound">r_ext</span><span class="main">)</span> <span class="main">⟷</span> consistent <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_extension_if_consistent consistent_if_extends_trans
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> total_preorder_onD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following theorem corresponds to Theorem 2.7~<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Bossert:2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Bossert and Suzumura claim that this theorem generalises Szpilrajn's theorem; however, we cannot
  use the theorem to strictly extend a given order <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Q</span></span>›</span></span></span></span>. Therefore, it is not strong enough to
  extend a strict partial order to a strict linear order. It works for total preorders (called 
  orderings by Bossert and Suzumura). Unfortunately, we were not able to generalise the theorem
  to allow for strict extensions.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> general_order_extension_iff_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total_preorder_on <span class="free">S</span> <span class="free">Ord</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">Ext</span><span class="main">.</span> extends <span class="bound">Ext</span> <span class="free">Q</span> <span class="main">∧</span> total_preorder <span class="bound">Ext</span> <span class="main">∧</span> Restr <span class="bound">Ext</span> <span class="free">S</span> <span class="main">=</span> <span class="free">Ord</span><span class="main">)</span>
     <span class="main">⟷</span> consistent <span class="free">Q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ExExt</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ExExt</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ext</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"extends <span class="skolem">Ext</span> <span class="free">Q</span>"</span></span>
    <span class="quoted"><span class="quoted">"refl <span class="skolem">Ext</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">Ext</span>"</span></span> <span class="quoted"><span class="quoted">"total <span class="skolem">Ext</span>"</span></span>
    <span class="quoted"><span class="quoted">"Restr <span class="skolem">Ext</span> <span class="free">S</span> <span class="main">=</span> Restr <span class="free">Ord</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> total_preorder_onD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> consistentI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹extends <span class="skolem">Ext</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹trans <span class="skolem">Ext</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Ext</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> extends_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trancl_id trancl_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="skolem">Ext</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹extends <span class="skolem">Ext</span> <span class="free">Q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> asym_factor <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> extends_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"consistent <span class="free">Q</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">≡</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∪</span> <span class="free">Ord</span> <span class="main">∪</span> <span class="free">Ord</span> <span class="keyword1">O</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∪</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="free">Ord</span> <span class="main">∪</span> <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> <span class="free">Ord</span><span class="main">)</span> <span class="keyword1">O</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refl <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"refl_on <span class="free">S</span> <span class="free">Ord</span>"</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">Ord</span>"</span></span> <span class="quoted"><span class="quoted">"total_on <span class="free">S</span> <span class="free">Ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> refl_rtrancl trans_rtrancl total_preorder_onD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹total_preorder_on <span class="free"><span class="free"><span class="free">S</span></span></span> <span class="free"><span class="free"><span class="free">Ord</span></span></span>›</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">assumption</span>

  <span class="keyword1"><span class="command">have</span></span> preorder_Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"preorder <span class="skolem">Q'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl <span class="skolem">Q'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q'_def refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹trans <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">S</span> <span class="free">Ord</span>›</span></span> <span class="quoted"><span class="quoted">‹trans <span class="free">Ord</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">Q'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q'_def<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> transI<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> relcomp.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> refl_on_domain rtranclD transD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"consistent <span class="skolem">Q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> consistent_if_preorder_on preorder_Q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extends <span class="skolem">Q'</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> extendsI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊆</span> Restr <span class="main">(</span><span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">(</span>Field <span class="free">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> FieldI1 FieldI2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">⊆</span> <span class="skolem">Q'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹consistent <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> consistentD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">unfolding</span></span> consistent_def asym_factor_def <span class="keyword1"><span class="command">using</span></span> rtranclD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> refl_on_domainE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Ord</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">P</span>
      <span class="keyword1"><span class="command">using</span></span> refl_on_domain<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">S</span> <span class="free">Ord</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asym_factor <span class="free">Q</span> <span class="main">⊆</span> asym_factor <span class="skolem">Q'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q'_def asym_factor_def Field_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> consistentD refl_on_domainE
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> r_into_rtrancl rtranclD rtrancl_trancl_trancl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> strict_extends_preorder_on<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹preorder <span class="skolem">Q'</span>›</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ext</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ext<span class="main">:</span> <span class="quoted"><span class="quoted">"extends <span class="skolem">Ext</span> <span class="skolem">Q'</span>"</span></span> <span class="quoted"><span class="quoted">"extends <span class="skolem">Ext</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"total_preorder <span class="skolem">Ext</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transpE transp_extends<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> not_in_Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">Ord</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Q'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Q'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">S</span> <span class="free">Ord</span>›</span></span> refl_on_def refl_on_domain rtranclD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Restr <span class="skolem">Ext</span> <span class="free">S</span> <span class="main">=</span> <span class="free">Ord</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹extends <span class="skolem">Ext</span> <span class="skolem">Q'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ord</span> <span class="main">⊆</span> <span class="skolem">Ext</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Q'_def extends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">S</span> <span class="free">Ord</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ord</span> <span class="main">⊆</span> Restr <span class="skolem">Ext</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> refl_on_domain <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Ord</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Ext</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">Ord</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> that not_in_Q' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Q'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹refl_on <span class="free">S</span> <span class="free">Ord</span>›</span></span> <span class="quoted"><span class="quoted">‹total_on <span class="free">S</span> <span class="free">Ord</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">Ord</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Ord</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def total_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Q'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Q'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Q'</span>›</span></span> <span class="quoted"><span class="quoted">‹extends <span class="skolem">Ext</span> <span class="skolem">Q'</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Ext</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> extends_def asym_factor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Ext</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Restr <span class="skolem">Ext</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">Ord</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> Ext <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ExExt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Strong consistency›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a stronger version of <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹consistent›</span></span></span></span> which requires that the relation does not
  contain hidden preference cycles, i.e. if there is a preference cycle then all the elements
  in the cycle should already be related (in both directions).
  In contrast to consistency which characterises relations that can be extended, strong consistency
  characterises relations that can be extended strictly (cf. <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹strict_extends›</span></span></span></span>).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">strongly_consistent</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> sym_factor <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊆</span> sym_factor <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Szpilrajn-consistent_if_strongly_consistent"><span class="command">lemma</span></span> consistent_if_strongly_consistent<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_consistent <span class="free">r</span> <span class="main">⟹</span> consistent <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strongly_consistent_def consistent_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_factor_def asym_factor_def<span class="main">)</span> 

<span class="keyword1" id="Szpilrajn-strongly_consistentI"><span class="command">lemma</span></span> strongly_consistentI<span class="main">:</span> <span class="quoted"><span class="quoted">"sym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="main">⊆</span> sym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span> <span class="main">⟹</span> strongly_consistent <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> strongly_consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Szpilrajn-strongly_consistent_if_trans_strict_extension"><span class="command">lemma</span></span> strongly_consistent_if_trans_strict_extension<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">r_ext</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"strongly_consistent <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> strongly_consistent_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> sym_factor <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms trancl_subs_extends_if_trans<span class="main">[</span><span class="operator">OF</span> extends_if_strict_extends<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sym_factor_mono strict_extendsE subsetD sym_factor_reflc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Szpilrajn-strict_order_extension_if_consistent"><span class="command">lemma</span></span> strict_order_extension_if_consistent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strongly_consistent <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r_ext</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="free">r_ext</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_preorder <span class="free">r_ext</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strongly_consistent_def strict_extends_def extends_def asym_factor_def sym_factor_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Field_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tranclD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_extends_def extends_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> asym_factor_rtrancl sym_factor_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rtranclD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> extends<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_extends <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpE<span class="main">[</span><span class="operator">OF</span> transp_strict_extends<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preorder <span class="main">(</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> preorder_on_def <span class="keyword1"><span class="command">using</span></span> refl_on_def trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> strict_extends_preorder_on<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> extends <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r_ext</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"total_preorder <span class="skolem">r_ext</span>"</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">r_ext</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> transpE<span class="main">[</span><span class="operator">OF</span> transp_strict_extends<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can instantiate the above theorem to get Szpilrajn's theorem.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_partial_order <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r_ext</span><span class="main">.</span> strict_linear_order <span class="bound">r_ext</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">⊆</span> <span class="bound">r_ext</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>                  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> strict_partial_order_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_consistent <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"antisym <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strongly_consistent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym_if_irrefl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> strict_order_extension_if_consistent<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r_ext</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_extends <span class="skolem">r_ext</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"total_preorder <span class="skolem">r_ext</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> strict_partial_order_def<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="skolem">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"irrefl <span class="main">(</span><span class="skolem">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"total <span class="main">(</span><span class="skolem">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">r_ext</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> strict_extends_antisym<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹antisym <span class="free">r</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> irrefl_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> strict_extendsE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trans_diff_Id <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> total_preorder_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strict_linear_order_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

 
<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

</pre>
</div>